{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/36717/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/36717/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/36717"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/36717"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/36717/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/36717"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/845858717eae8a04beae1875833360fea3cad150"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6450,
            "forks_count": 6450,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 2023,
            "open_issues_count": 2023,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-12-02T02:52:59Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 353514,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 94666,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-12-02T02:52:46Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 94666,
            "watchers_count": 94666,
            "web_commit_signoff_required": false
        },
        "sha": "e4ce0c7270e52ecaf586a0ddcee262e2f1adaabc",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "Problem: message ouptut highlights are affected by window-local _extui\r\ndefinitions. For example, `hi: IncSearch` is displayed incorrectly.\r\n\r\nSolution: for each override create a \"backup\" highlight definition and use it when set message extmark.\r\n\r\nFix: #36691\r\n<!--\r\n  Thank you for contributing to Neovim!\r\n  If this is your first time, check out https://github.com/neovim/neovim/blob/master/CONTRIBUTING.md#pull-requests-prs\r\n  for our PR guidelines.\r\n-->\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36717#discussion_r2573195996"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36717"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573195996"
                }
            },
            "author_association": "MEMBER",
            "body": "Namespaces are always assumed to be \"private\" (application-specific), there is no need to underscore them. And, we need to stop using \"extui\". Use a more meaningful name.",
            "commit_id": "845858717eae8a04beae1875833360fea3cad150",
            "created_at": "2025-11-29T21:27:23Z",
            "diff_hunk": "@@ -81,14 +81,28 @@ function M.check_targets()\n         api.nvim_set_option_value('bufhidden', 'hide', { scope = 'local' })\n         api.nvim_set_option_value('buftype', 'nofile', { scope = 'local' })\n         -- Use MsgArea except in the msg window. Hide Search highlighting except in the pager.\n-        local search_hide = 'Search:,CurSearch:,IncSearch:'\n-        local hl = 'Normal:MsgArea,' .. search_hide\n-        if type == 'pager' then\n-          hl = 'Normal:MsgArea'\n-        elseif type == 'msg' then\n-          hl = search_hide\n+        ---@type table<string, table<string, vim.api.keyset.highlight>>\n+        local highlights = {\n+          cmd = { Search = {}, CurSearch = {}, IncSearch = {}, Normal = { link = 'MsgArea' } },\n+          dialog = { Search = {}, CurSearch = {}, IncSearch = {}, Normal = { link = 'MsgArea' } },\n+          msg = { Search = {}, CurSearch = {}, IncSearch = {} },\n+          pager = { Normal = { link = 'MsgArea' } },\n+        }\n+\n+        local ns = api.nvim_create_namespace(('nvim._extui.%s_hl'):format(type))",
            "html_url": "https://github.com/neovim/neovim/pull/36717#discussion_r2573195996",
            "id": 2573195996,
            "line": 92,
            "node_id": "PRRC_kwDOAPphoM6ZX9rc",
            "original_commit_id": "845858717eae8a04beae1875833360fea3cad150",
            "original_line": 92,
            "original_position": 18,
            "original_start_line": null,
            "path": "runtime/lua/vim/_extui/shared.lua",
            "position": 18,
            "pull_request_review_id": 3520829921,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36717",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573195996/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T21:27:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573195996",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36717#discussion_r2573246010"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36717"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573246010"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Both `ns` and the whole loop (and so the \"backup\" highlights) below is unneeded if `hl_ns` proposed by @luukvbaal existed.\n\n",
            "commit_id": "845858717eae8a04beae1875833360fea3cad150",
            "created_at": "2025-11-29T23:22:32Z",
            "diff_hunk": "@@ -81,14 +81,28 @@ function M.check_targets()\n         api.nvim_set_option_value('bufhidden', 'hide', { scope = 'local' })\n         api.nvim_set_option_value('buftype', 'nofile', { scope = 'local' })\n         -- Use MsgArea except in the msg window. Hide Search highlighting except in the pager.\n-        local search_hide = 'Search:,CurSearch:,IncSearch:'\n-        local hl = 'Normal:MsgArea,' .. search_hide\n-        if type == 'pager' then\n-          hl = 'Normal:MsgArea'\n-        elseif type == 'msg' then\n-          hl = search_hide\n+        ---@type table<string, table<string, vim.api.keyset.highlight>>\n+        local highlights = {\n+          cmd = { Search = {}, CurSearch = {}, IncSearch = {}, Normal = { link = 'MsgArea' } },\n+          dialog = { Search = {}, CurSearch = {}, IncSearch = {}, Normal = { link = 'MsgArea' } },\n+          msg = { Search = {}, CurSearch = {}, IncSearch = {} },\n+          pager = { Normal = { link = 'MsgArea' } },\n+        }\n+\n+        local ns = api.nvim_create_namespace(('nvim._extui.%s_hl'):format(type))",
            "html_url": "https://github.com/neovim/neovim/pull/36717#discussion_r2573246010",
            "id": 2573246010,
            "in_reply_to_id": 2573195996,
            "line": 92,
            "node_id": "PRRC_kwDOAPphoM6ZYJ46",
            "original_commit_id": "845858717eae8a04beae1875833360fea3cad150",
            "original_line": 92,
            "original_position": 18,
            "original_start_line": null,
            "path": "runtime/lua/vim/_extui/shared.lua",
            "position": 18,
            "pull_request_review_id": 3520868566,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36717",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573246010/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T23:22:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573246010",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "More elegant solution welcome, the current was discussed in #36691.\r\n\r\nConfigurable hl definitions are not intended to propose here (to remove in next commit). \r\n\r\nTodo:\r\n- pager highlights\r\n- tests?\r\n\r\n@luukvbaal what do you think at the moment?",
            "created_at": "2025-11-27T12:22:29Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3585583904",
            "id": 3585583904,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7Vt6sg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3585583904/reactions"
            },
            "updated_at": "2025-11-27T12:25:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3585583904",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks. Might I suggest the following change to fix the pager highlights, lint errors and reduce the line count:\r\n```diff\r\ndiff --git a/runtime/lua/vim/_extui/messages.lua b/runtime/lua/vim/_extui/messages.lua\r\nindex f684017cc1..a722c9a24d 100644\r\n--- a/runtime/lua/vim/_extui/messages.lua\r\n+++ b/runtime/lua/vim/_extui/messages.lua\r\n@@ -35,6 +35,7 @@ local M = {\r\n     delayed = false, -- Whether placement of 'last' virt_text is delayed.\r\n   },\r\n   on_dialog_key = 0, -- vim.on_key namespace for paging in the dialog window.\r\n+  global_hl = {}, ---@type table<integer, string> map highlight IDs to group with global attributes.\r\n }\r\n \r\n function M.msg:close()\r\n@@ -281,7 +282,7 @@ function M.show_msg(tar, content, replace_last, append)\r\n       width = tar == 'msg' and math.max(width, api.nvim_strwidth(curline)) or 0\r\n \r\n       if chunk[3] > 0 then\r\n-        hlopts.end_col, hlopts.hl_group = end_col, ext._global_highlights[chunk[3]]\r\n+        hlopts.end_col, hlopts.hl_group = end_col, M.global_hl[chunk[3]] or chunk[3]\r\n         api.nvim_buf_set_extmark(ext.bufs[tar], ext.ns, row, col, hlopts)\r\n       end\r\n \r\ndiff --git a/runtime/lua/vim/_extui/shared.lua b/runtime/lua/vim/_extui/shared.lua\r\nindex b54ff4b9aa..42058552de 100644\r\n--- a/runtime/lua/vim/_extui/shared.lua\r\n+++ b/runtime/lua/vim/_extui/shared.lua\r\n@@ -14,36 +14,6 @@ local M = {\r\n       ---cmdline or in a separate ephemeral message window.\r\n       target = 'cmd',\r\n       timeout = 4000, -- Time a message is visible in the message window.\r\n-      ---@type table<string, vim.api.keyset.highlight>\r\n-      hl = {\r\n-        Search = {link = ''},\r\n-        CurSearch = {link = ''},\r\n-        IncSearch = {link = ''},\r\n-      },\r\n-    },\r\n-    pager = {\r\n-      ---@type table<string, vim.api.keyset.highlight>\r\n-      hl = {\r\n-        Normal = {link = 'MsgArea'},\r\n-      },\r\n-    },\r\n-    cmd = {\r\n-      ---@type table<string, vim.api.keyset.highlight>\r\n-      hl = {\r\n-        Search = {link = ''},\r\n-        CurSearch = {link = ''},\r\n-        IncSearch = {link = ''},\r\n-        Normal = {link = 'MsgArea'},\r\n-      },\r\n-    },\r\n-    dialog = {\r\n-      ---@type table<string, vim.api.keyset.highlight>\r\n-      hl = {\r\n-        Search = {link = ''},\r\n-        CurSearch = {link = ''},\r\n-        IncSearch = {link = ''},\r\n-        Normal = {link = 'MsgArea'},\r\n-      },\r\n     },\r\n   },\r\n }\r\n@@ -58,13 +28,6 @@ local wincfg = { -- Default cfg for nvim_open_win().\r\n   noautocmd = true,\r\n }\r\n \r\n----@private\r\n-M._global_highlights = setmetatable({}, {\r\n-  __index = function (t, k)\r\n-    return rawget(t, k) or k\r\n-  end\r\n-})\r\n-\r\n local tab = 0\r\n ---Ensure target buffers and windows are still valid.\r\n function M.check_targets()\r\n@@ -76,9 +39,9 @@ function M.check_targets()\r\n     end\r\n \r\n     if\r\n-        tab ~= curtab\r\n-        or not api.nvim_win_is_valid(M.wins[type])\r\n-        or not api.nvim_win_get_config(M.wins[type]).zindex -- no longer floating\r\n+      tab ~= curtab\r\n+      or not api.nvim_win_is_valid(M.wins[type])\r\n+      or not api.nvim_win_get_config(M.wins[type]).zindex -- no longer floating\r\n     then\r\n       local cfg = vim.tbl_deep_extend('force', wincfg, {\r\n         focusable = type == 'pager',\r\n@@ -118,13 +81,26 @@ function M.check_targets()\r\n         api.nvim_set_option_value('bufhidden', 'hide', { scope = 'local' })\r\n         api.nvim_set_option_value('buftype', 'nofile', { scope = 'local' })\r\n         -- Use MsgArea except in the msg window. Hide Search highlighting except in the pager.\r\n+        ---@type table<string, vim.api.keyset.highlight>\r\n+        local highlights = {\r\n+          cmd = { Search = {}, CurSearch = {}, IncSearch = {}, Normal = { link = 'MsgArea' } },\r\n+          msg = { Search = {}, CurSearch = {}, IncSearch = {} },\r\n+          pager = { Normal = { link = 'MsgArea' } },\r\n+          dialog = { Search = {}, CurSearch = {}, IncSearch = {}, Normal = { link = 'MsgArea' } },\r\n+        }\r\n         local ns = api.nvim_create_namespace(('nvim._extui.%s_hl'):format(type))\r\n         api.nvim_win_set_hl_ns(M.wins[type], ns)\r\n-        for group, hldef in pairs(M.cfg[type].hl) do\r\n-          local global_hl = '_extui.global_ns.' .. group\r\n-          api.nvim_set_hl(ns, global_hl, api.nvim_get_hl(0, {name = group, link = false}))\r\n-          M._global_highlights[group] = global_hl\r\n+        for group, hldef in pairs(highlights[type]) do\r\n           api.nvim_set_hl(ns, group, hldef)\r\n+          -- When these groups are used as a message highlight, we still want\r\n+          -- to show the global highlight definition: add a group with the global attributes.\r\n+          local hl_id = api.nvim_get_hl_id_by_name(group)\r\n+          if not M.msg.global_hl[hl_id] then\r\n+            local global_group = '_extui.global_ns.' .. group\r\n+            local global_def = api.nvim_get_hl(0, { name = group, link = false })\r\n+            api.nvim_set_hl(0, global_group, global_def--[[@as vim.api.keyset.highlight]])\r\n+            M.msg.global_hl[hl_id] = global_group\r\n+          end\r\n         end\r\n       end)\r\n       api.nvim_buf_set_name(M.bufs[type], ('[%s]'):format(type:sub(1, 1):upper() .. type:sub(2)))\r\n```",
            "created_at": "2025-11-27T13:09:49Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3585783839",
            "id": 3585783839,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7Vurgf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3585783839/reactions"
            },
            "updated_at": "2025-11-27T13:26:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3585783839",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for review too! Let me put temporary changes and look at your suggestion then. Before that I found that I used hl group names in the place where hl id should be used. ",
            "created_at": "2025-11-27T13:20:54Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3585832569",
            "id": 3585832569,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7Vu3Z5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3585832569/reactions"
            },
            "updated_at": "2025-11-27T13:59:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3585832569",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "`M.msg.global_hl` becomes outdated after redefining `IncSearch`.",
            "created_at": "2025-11-27T17:16:31Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3586840342",
            "id": 3586840342,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7VytcW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3586840342/reactions"
            },
            "updated_at": "2025-11-27T17:16:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3586840342",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Right, I don't see solution for extui other than just fetching these highlight definitions for each message (when they are used).\r\n\r\nA perhaps cleaner solution could be to add a highlight namespace override knob to `nvim_buf_set_extmark()`ðŸ«£",
            "created_at": "2025-11-28T00:46:48Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3587604697",
            "id": 3587604697,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7V1oDZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587604697/reactions"
            },
            "updated_at": "2025-11-28T00:46:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587604697",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> A perhaps cleaner solution could be to add a highlight namespace override knob to `nvim_buf_set_extmark()`ðŸ«£\r\n\r\nI tried to guess what is `priority` there but seems to be independent of how highlights are defined. \r\n\r\nWe also have no autocommand event to track changes on hl group definitions. ",
            "created_at": "2025-11-28T00:50:12Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3587608179",
            "id": 3587608179,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7V1o5z",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587608179/reactions"
            },
            "updated_at": "2025-11-28T00:51:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587608179",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I'm in no hurry to querying for each extmark, however on the other side:\r\n- we need to do it for only a few hl ids (controlled by extui, while not configurable),\r\n- we still can (and apparently should) cache it for a single message (`global_hl` would became a local table somewhere inside/above the loop of chunks?).",
            "created_at": "2025-11-28T01:03:39Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3587621441",
            "id": 3587621441,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7V1sJB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587621441/reactions"
            },
            "updated_at": "2025-11-28T01:06:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587621441",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes `priority` cannot solve this problem. It would look something like this:\r\n```diff\r\ndiff --git a/runtime/lua/vim/_extui/messages.lua b/runtime/lua/vim/_extui/messages.lua\r\nindex 08b230737c..7761bfe45c 100644\r\n--- a/runtime/lua/vim/_extui/messages.lua\r\n+++ b/runtime/lua/vim/_extui/messages.lua\r\n@@ -182,7 +182,9 @@ end\r\n \r\n -- We need to keep track of the current message column to be able to\r\n -- append or overwrite messages for :echon or carriage returns.\r\n-local col, will_full, hlopts = 0, false, { undo_restore = false, invalidate = true, priority = 1 }\r\n+local col, will_full = 0, false\r\n+local hlopts = { undo_restore = false, invalidate = true, priority = 1, hl_ns = 0 }\r\n+\r\n --- Move messages to cmdline or pager to show in full.\r\n local function msg_to_full(src)\r\n   if will_full then\r\ndiff --git a/src/nvim/api/extmark.c b/src/nvim/api/extmark.c\r\nindex a14cf426f4..2bce5b0db9 100644\r\n--- a/src/nvim/api/extmark.c\r\n+++ b/src/nvim/api/extmark.c\r\n@@ -618,6 +618,7 @@ Integer nvim_buf_set_extmark(Buffer buffer, Integer ns_id, Integer line, Integer\r\n     }\r\n     has_hl = hl.hl_id > 0;\r\n   }\r\n+  hl.hl_ns = (int)opts->hl_ns;\r\n \r\n   sign.hl_id = (int)opts->sign_hl_group;\r\n   sign.cursorline_hl_id = (int)opts->cursorline_hl_group;\r\ndiff --git a/src/nvim/api/keysets_defs.h b/src/nvim/api/keysets_defs.h\r\nindex a32076cdc9..ea71d520c7 100644\r\n--- a/src/nvim/api/keysets_defs.h\r\n+++ b/src/nvim/api/keysets_defs.h\r\n@@ -32,6 +32,7 @@ typedef struct {\r\n   Integer end_line;\r\n   Integer end_row;\r\n   Integer end_col;\r\n+  Integer hl_ns;\r\n   Object hl_group;\r\n   Array virt_text;\r\n   Enum(\"eol\", \"eol_right_align\", \"overlay\", \"right_align\", \"inline\") virt_text_pos;\r\ndiff --git a/src/nvim/decoration.c b/src/nvim/decoration.c\r\nindex 5030c337aa..21c141b9ad 100644\r\n--- a/src/nvim/decoration.c\r\n+++ b/src/nvim/decoration.c\r\n@@ -169,6 +169,7 @@ DecorSignHighlight decor_sh_from_inline(DecorHighlightInline item)\r\n     .priority = item.priority,\r\n     .text[0] = item.conceal_char,\r\n     .hl_id = item.hl_id,\r\n+    .hl_ns = item.hl_ns,\r\n     .number_hl_id = 0,\r\n     .line_hl_id = 0,\r\n     .cursorline_hl_id = 0,\r\n@@ -646,7 +647,8 @@ void decor_range_add_sh(DecorState *state, int start_row, int start_col, int end\r\n   if (sh->hl_id || (sh->url != NULL)\r\n       || (sh->flags & (kSHConceal | kSHSpellOn | kSHSpellOff))) {\r\n     if (sh->hl_id) {\r\n-      range.attr_id = syn_id2attr(sh->hl_id);\r\n+      bool optional = false;\r\n+      range.attr_id = syn_ns_id2attr(sh->hl_ns, sh->hl_id, &optional);\r\n     }\r\n     decor_range_insert(state, &range);\r\n   }\r\ndiff --git a/src/nvim/decoration_defs.h b/src/nvim/decoration_defs.h\r\nindex c392880818..edf56d70b9 100644\r\n--- a/src/nvim/decoration_defs.h\r\n+++ b/src/nvim/decoration_defs.h\r\n@@ -62,15 +62,17 @@ typedef struct {\r\n   uint16_t flags;\r\n   DecorPriority priority;\r\n   int hl_id;\r\n+  int hl_ns;\r\n   schar_T conceal_char;\r\n } DecorHighlightInline;\r\n \r\n-#define DECOR_HIGHLIGHT_INLINE_INIT { 0, DECOR_PRIORITY_BASE, 0, 0 }\r\n+#define DECOR_HIGHLIGHT_INLINE_INIT { 0, DECOR_PRIORITY_BASE, 0, -1, 0 }\r\n \r\n typedef struct {\r\n   uint16_t flags;\r\n   DecorPriority priority;\r\n   int hl_id;  // if sign: highlight of sign text\r\n+  int hl_ns;\r\n   schar_T text[SIGN_WIDTH];  // conceal text only uses text[0]\r\n   // NOTE: if more functionality is added to a Highlight these should be overloaded\r\n   // or restructured\r\n@@ -83,7 +85,7 @@ typedef struct {\r\n   const char *url;\r\n } DecorSignHighlight;\r\n \r\n-#define DECOR_SIGN_HIGHLIGHT_INIT { 0, DECOR_PRIORITY_BASE, 0, { 0, 0 }, NULL, 0, 0, 0, 0, \\\r\n+#define DECOR_SIGN_HIGHLIGHT_INIT { 0, DECOR_PRIORITY_BASE, 0, -1, { 0, 0 }, NULL, 0, 0, 0, 0, \\\r\n                                     DECOR_ID_INVALID, NULL }\r\n \r\n enum {\r\n```\r\n\r\nThoughts on a highlight namespace flag for `nvim_buf_set_extmark()` @bfredl @justinmk?\r\nReiterating the problem: extui is using window-local highlights (to link Normal to MsgArea and to hide search highlights), but needs to print messages that use those highlight groups with the definition from the global namespace.",
            "created_at": "2025-11-28T01:06:42Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3587624586",
            "id": 3587624586,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7V1s6K",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587624586/reactions"
            },
            "updated_at": "2025-11-28T01:08:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587624586",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Your patch works for me for redefined `IncSearch` (after using straight chunk ids again). ",
            "created_at": "2025-11-28T01:20:34Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3587638951",
            "id": 3587638951,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7V1wan",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587638951/reactions"
            },
            "updated_at": "2025-11-28T01:20:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3587638951",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Thoughts on a highlight namespace flag for `nvim_buf_set_extmark()` @bfredl @justinmk?\r\n> Reiterating the problem: extui is using window-local highlights (to link Normal to MsgArea and to hide search highlights), but needs to print messages that use those highlight groups with the definition from the global namespace.\r\n\r\nHaven't thought carefully about whether that makes sense as a general feature for `nvim_buf_set_extmark`, but the particular problem being solved in this PR is very special-case, so don't think it should drive a new `nvim_buf_set_extmark` feature.\r\n\r\nThe problem being solved here is pretty low-priority. Correct me if wrong, but we are talking about the particular behaviors of `:hi`, `:map`, and maybe a couple other commands that bring their own circus with how they present stuff. \r\n\r\nThe only reason that `:hi` and `:map` work that like is because of the way the legacy message system worked. There are two situations to consider:\r\n\r\n- situation 1: a script wants to programmatically get the output of `:hi` or `:map` for whatever reason. In that case highlighting isn't needed.\r\n- situation 2: a user wants to see a nice presentation of `:hi` and `:map`. In that case why are we using the message system at all? Instead, `:hi`/`:map`/etc could open a split window with a scratch buffer.\r\n\r\nI don't know how much work it would be to take that approach, so to unblock this, what can we do to make the current behavior reasonable without a bunch of new for-loops creating extra state? And how important is this problem actually?",
            "created_at": "2025-11-29T21:35:43Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3591953726",
            "id": 3591953726,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7WGN0-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3591953726/reactions"
            },
            "updated_at": "2025-11-29T21:36:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3591953726",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> so don't think it should drive a new nvim_buf_set_extmark feature.\r\n\r\nI agree, but I thought _if_ it makes sense as a general feature then why not. I pinged @bfredl to asses that, you because I've seen you express concerns about the exploding number of flags in `nvim_buf_set_extmark()` beforeðŸ«£\r\n\r\n> Correct me if wrong, but we are talking about the particular behaviors of :hi, :map, and maybe a couple other commands that bring their own circus with how they present stuff.\r\n\r\nIt concerns any message using highlight groups with window-local highlight definitions in the UI windows. E.g. `call nvim_echo([['Hello', 'Search']], 0, {})` is affected too. Not a critical problem but the extmark flag is the only solution I could think of that solves it in a manageable way.",
            "created_at": "2025-11-29T22:24:02Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3591988082",
            "id": 3591988082,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7WGWNy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3591988082/reactions"
            },
            "updated_at": "2025-11-29T22:24:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3591988082",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> E.g. `call nvim_echo([['Hello', 'Search']], 0, {})` is affected too\r\n\r\nAnd the tradeoff is that... a few highlights are shown wrong? Seems very low priority until we have finished other parts of ui2.",
            "created_at": "2025-11-30T16:20:35Z",
            "html_url": "https://github.com/neovim/neovim/pull/36717#issuecomment-3592776496",
            "id": 3592776496,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
            "node_id": "IC_kwDOAPphoM7WJWsw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3592776496/reactions"
            },
            "updated_at": "2025-11-30T16:20:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3592776496",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/36717/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/36717/commits",
    "created_at": "2025-11-27T12:18:31Z",
    "diff_url": "https://github.com/neovim/neovim/pull/36717.diff",
    "draft": true,
    "head": {
        "label": "przepompownia:ui2-fix-highlights",
        "ref": "ui2-fix-highlights",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/przepompownia/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/przepompownia/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/przepompownia/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/przepompownia/neovim/branches{/branch}",
            "clone_url": "https://github.com/przepompownia/neovim.git",
            "collaborators_url": "https://api.github.com/repos/przepompownia/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/przepompownia/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/przepompownia/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/przepompownia/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/przepompownia/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/przepompownia/neovim/contributors",
            "created_at": "2023-09-25T21:56:41Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/przepompownia/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/przepompownia/neovim/downloads",
            "events_url": "https://api.github.com/repos/przepompownia/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/przepompownia/neovim/forks",
            "full_name": "przepompownia/neovim",
            "git_commits_url": "https://api.github.com/repos/przepompownia/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/przepompownia/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/przepompownia/neovim/git/tags{/sha}",
            "git_url": "git://github.com/przepompownia/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/przepompownia/neovim/hooks",
            "html_url": "https://github.com/przepompownia/neovim",
            "id": 696503495,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/przepompownia/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/przepompownia/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/przepompownia/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/przepompownia/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/przepompownia/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/przepompownia/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/przepompownia/neovim/merges",
            "milestones_url": "https://api.github.com/repos/przepompownia/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOKYPMxw",
            "notifications_url": "https://api.github.com/repos/przepompownia/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/przepompownia/neovim/pulls{/number}",
            "pushed_at": "2025-12-01T05:41:58Z",
            "releases_url": "https://api.github.com/repos/przepompownia/neovim/releases{/id}",
            "size": 341541,
            "ssh_url": "git@github.com:przepompownia/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/przepompownia/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/przepompownia/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/przepompownia/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/przepompownia/neovim/subscription",
            "svn_url": "https://github.com/przepompownia/neovim",
            "tags_url": "https://api.github.com/repos/przepompownia/neovim/tags",
            "teams_url": "https://api.github.com/repos/przepompownia/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/przepompownia/neovim/git/trees{/sha}",
            "updated_at": "2025-10-26T22:37:55Z",
            "url": "https://api.github.com/repos/przepompownia/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "845858717eae8a04beae1875833360fea3cad150",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
            "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
            "followers_url": "https://api.github.com/users/przepompownia/followers",
            "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
            "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/przepompownia",
            "id": 11404453,
            "login": "przepompownia",
            "node_id": "MDQ6VXNlcjExNDA0NDUz",
            "organizations_url": "https://api.github.com/users/przepompownia/orgs",
            "received_events_url": "https://api.github.com/users/przepompownia/received_events",
            "repos_url": "https://api.github.com/users/przepompownia/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/przepompownia",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/36717",
    "id": 3050832390,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36717",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim 0.12 mesages/dialog/pager/notifications based on the UI-ext protocol",
            "id": 8934685970,
            "name": "ui2",
            "node_id": "LA_kwDOAPphoM8AAAACFIx9Eg",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui2"
        }
    ],
    "locked": false,
    "merge_commit_sha": "eda7221a3ece3982e66f5ab6cbe2d904c0dd9f66",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM612AIG",
    "number": 36717,
    "patch_url": "https://github.com/neovim/neovim/pull/36717.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/36717/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/845858717eae8a04beae1875833360fea3cad150",
    "title": "fix(ui2): preserve message highlights from window-local override",
    "updated_at": "2025-11-30T16:20:49Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/36717",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
        "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
        "followers_url": "https://api.github.com/users/przepompownia/followers",
        "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
        "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/przepompownia",
        "id": 11404453,
        "login": "przepompownia",
        "node_id": "MDQ6VXNlcjExNDA0NDUz",
        "organizations_url": "https://api.github.com/users/przepompownia/orgs",
        "received_events_url": "https://api.github.com/users/przepompownia/received_events",
        "repos_url": "https://api.github.com/users/przepompownia/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/przepompownia",
        "user_view_type": "public"
    }
}
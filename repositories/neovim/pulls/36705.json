{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/36705/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/36705/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/36705"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/36705"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/36705/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/12c98bb1b5e4daca47762822153eac6937795666"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6450,
            "forks_count": 6450,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 2023,
            "open_issues_count": 2023,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-12-02T02:52:59Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 353514,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 94666,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-12-02T02:52:46Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 94666,
            "watchers_count": 94666,
            "web_commit_signoff_required": false
        },
        "sha": "d62bbe24cbe5311ce595d73a0c40dc87af989666",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "Close #26500\r\nResolves https://github.com/neovim/neovim/issues/23026\r\n\r\nThis is currently just a rebase of #26500 onto HEAD\r\nThat PR was last active 2 years ago, and I would like to get it across the line.\r\n\r\nI have taken the existing resolved comments, but it's worth re-bikeshedding the outstanding ones, as a lot has changed since 2023.\r\n\r\nI have refactored a bit to make the logic cleaner to read, I also changed the fallback from the whole document, to the largest viewable area\r\n\r\nDiscussion Points:\r\n- Capability registration should proabably be on the base method `textDocument/semanticTokens`. This is back the spec `Since the registration option handles range, full and delta requests the method used to register for semantic tokens requests is textDocument/semanticTokens and not one of the specific methods described below.`\r\n- When a document supports both `full` and `range`, which should we prefer. This PR prefers `range` as it feels more performant, but open to thoughts?\r\n- This current implementation fires a lot of requests that will translate to `no-ops` when a method isnt supported. I can't think of a good way to get the from just a `bufnr`, (plus it could be any combo of support across multiple clients), so we fire the combos of possible requests, and when we are iterating through clients, we `no-op` methods they don't support.\r\n- Is the WinScrolled autocommand performant enough, or should we guard it so it only fires requests if needed (but with the same problems as above)\r\n\r\nAre any of these blockers, or something we can iterate on\r\nPs, this dif is easiest read with `Hide Whitespace` On",
    "closed_at": "2025-12-01T02:06:56Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2566746425"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2566746425"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "@ofseed Do you have any suggestions what to do here? Did you envision how we would handle capabilities that are handled by more than one method?",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-26T23:54:28Z",
            "diff_hunk": "@@ -42,6 +48,7 @@ local M = {}\n ---@field client_state table<integer, STClientState>\n local STHighlighter = {\n   name = 'semantic_tokens',\n+  -- TODO: how to handle this (tris203)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2566746425",
            "id": 2566746425,
            "line": 50,
            "node_id": "PRRC_kwDOAPphoM6Y_XE5",
            "original_commit_id": "92cfc76c7f398ca8efddf9ec7df4f5dcaf2f5646",
            "original_line": 50,
            "original_position": 27,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 27,
            "pull_request_review_id": 3513057005,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2566746425/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-26T23:54:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2566746425",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2566794925"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2566794925"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I did have this in mind. In fact, a big reason Capability is written in an OOP style is exactly to leave room for cases like this and ensure greater flexibility.\r\n\r\nThe purpose of specifying the method here is to attach the Capability to the buffer when the client supports the corresponding method. Since LSP servers, whether they support delta or range, should all support full, there shouldn’t be any need for special changes here.\r\n\r\nAs for Capability, there are many details I haven’t fully refined because I had previously considered implementing range as well, in order to handle more complex scenarios. I just haven’t had the time to keep pushing this forward this year, so I’m really glad to see you are taking a shot at implementing it!",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-27T00:40:41Z",
            "diff_hunk": "@@ -42,6 +48,7 @@ local M = {}\n ---@field client_state table<integer, STClientState>\n local STHighlighter = {\n   name = 'semantic_tokens',\n+  -- TODO: how to handle this (tris203)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2566794925",
            "id": 2566794925,
            "in_reply_to_id": 2566746425,
            "line": 50,
            "node_id": "PRRC_kwDOAPphoM6Y_i6t",
            "original_commit_id": "92cfc76c7f398ca8efddf9ec7df4f5dcaf2f5646",
            "original_line": 50,
            "original_position": 27,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 27,
            "pull_request_review_id": 3513106326,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2566794925/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-27T00:40:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2566794925",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2567522477"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2567522477"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "> Since LSP servers, whether they support delta or range, should all support full, there shouldn’t be any need for special changes here.\r\n> \r\nhttps://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#semanticTokensOptions\r\n\r\nI don't read it that way, To me that reads that:\r\n```lua\r\nSemanticTokensProvider = {\r\nrange = true,\r\nfull = false,\r\n}\r\n```\r\nor\r\n```lua\r\nSemanticTokensProvider = {\r\nrange = true,\r\nfull = nil,\r\n}\r\n```\r\n\r\nWould both be valid, and result in `/range` only configuration.\r\n\r\n",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-27T08:04:47Z",
            "diff_hunk": "@@ -42,6 +48,7 @@ local M = {}\n ---@field client_state table<integer, STClientState>\n local STHighlighter = {\n   name = 'semantic_tokens',\n+  -- TODO: how to handle this (tris203)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2567522477",
            "id": 2567522477,
            "in_reply_to_id": 2566746425,
            "line": 50,
            "node_id": "PRRC_kwDOAPphoM6ZCUit",
            "original_commit_id": "92cfc76c7f398ca8efddf9ec7df4f5dcaf2f5646",
            "original_line": 50,
            "original_position": 27,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 27,
            "pull_request_review_id": 3513944484,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2567522477/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-27T08:04:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2567522477",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2567881990"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2567881990"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I don’t mean that the LSP itself has such a rule; it’s in practice, servers that support semantic tokens also support full, or at least I haven’t seen an exception so far.\r\n\r\nIt would be better allowing Capability to support multiple corresponding methods, but this kind of requirement probably shouldn’t block this feature for now.",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-27T10:03:10Z",
            "diff_hunk": "@@ -42,6 +48,7 @@ local M = {}\n ---@field client_state table<integer, STClientState>\n local STHighlighter = {\n   name = 'semantic_tokens',\n+  -- TODO: how to handle this (tris203)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2567881990",
            "id": 2567881990,
            "in_reply_to_id": 2566746425,
            "line": 50,
            "node_id": "PRRC_kwDOAPphoM6ZDsUG",
            "original_commit_id": "92cfc76c7f398ca8efddf9ec7df4f5dcaf2f5646",
            "original_line": 50,
            "original_position": 27,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 27,
            "pull_request_review_id": 3514391018,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2567881990/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-27T10:03:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2567881990",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572569700"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572569700"
                }
            },
            "author_association": "MEMBER",
            "body": "Why do we need to invoke `highlighter:on_change` twice?",
            "commit_id": "6535799b0601037309a861615e8b75846733f494",
            "created_at": "2025-11-28T21:45:26Z",
            "diff_hunk": "@@ -164,11 +165,15 @@ function STHighlighter:new(bufnr)\n   self = Capability.new(self, bufnr)\n \n   api.nvim_buf_attach(bufnr, false, {\n-    on_lines = function(_, buf)\n+    on_lines = function(_, buf, _, first, last)\n       local highlighter = STHighlighter.active[buf]\n       if not highlighter then\n         return true\n       end\n+      highlighter:on_change({\n+        ['start'] = { line = first, character = 0 },\n+        ['end'] = { line = last, character = 0 },\n+      })\n       highlighter:on_change()",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572569700",
            "id": 2572569700,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZVkxk",
            "original_commit_id": "6535799b0601037309a861615e8b75846733f494",
            "original_line": 177,
            "original_position": 39,
            "original_start_line": 173,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520119603,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572569700/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-28T21:48:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572569700",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572570952"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572570952"
                }
            },
            "author_association": "MEMBER",
            "body": "Should the 2nd request be scheduled to happen after a certain timeout?",
            "commit_id": "6535799b0601037309a861615e8b75846733f494",
            "created_at": "2025-11-28T21:46:14Z",
            "diff_hunk": "@@ -184,20 +189,47 @@ function STHighlighter:new(bufnr)\n     buffer = self.bufnr,\n     group = self.augroup,\n     callback = function()\n+      -- Process tokens for only the visible portion of the window first, before requesting the rest of\n+      -- the document, so the visible portion of the buffer is updated first\n+      local visible_range = self:get_visible_range()\n+      self:send_request(visible_range)\n+\n       self:send_request()",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572570952",
            "id": 2572570952,
            "line": 193,
            "node_id": "PRRC_kwDOAPphoM6ZVlFI",
            "original_commit_id": "6535799b0601037309a861615e8b75846733f494",
            "original_line": 193,
            "original_position": 51,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520119603,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572570952/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-28T21:48:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572570952",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572573713"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572573713"
                }
            },
            "author_association": "MEMBER",
            "body": "Nit: To avoid the cast here I think you can type `method` in its declaration.",
            "commit_id": "6535799b0601037309a861615e8b75846733f494",
            "created_at": "2025-11-28T21:47:37Z",
            "diff_hunk": "@@ -229,63 +261,124 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n+\n+      -- Capability checks\n+      local hasRangeProvider =\n+        vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'range')\n+      local hasEditProvider =\n+        vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full', 'delta')\n+      local hasFullOnlyProvider = vim.tbl_get(\n+        client.server_capabilities,\n+        'semanticTokensProvider',\n+        'full'\n+      ) == true or vim.tbl_get(\n+        client.server_capabilities,\n+        'semanticTokensProvider',\n+        'full',\n+        'delta'\n+      ) == false\n+\n+      local full_request_version = active_requests['FULL'] and active_requests['FULL'].version\n+\n+      local new_version = current_result.version ~= version and full_request_version ~= version\n+\n+      if (new_version or range) and not (range and not hasRangeProvider) then\n+        -- Cancel stale in-flight request\n+        if new_version then\n+          self:cancel_all_requests(client)\n+        end\n \n-    local current_result = state.current_result\n-    local active_request = state.active_request\n-\n-    -- Only send a request for this client if the current result is out of date and\n-    -- there isn't a current a request in flight for this version\n-    if client and current_result.version ~= version and active_request.version ~= version then\n-      -- cancel stale in-flight request\n-      if active_request.request_id then\n-        client:cancel_request(active_request.request_id)\n-        active_request = {}\n-        state.active_request = active_request\n-      end\n+        local params = { textDocument = util.make_text_document_params(self.bufnr) }\n+\n+        local method = 'textDocument/semanticTokens/full'\n+\n+        if hasRangeProvider then\n+          method = 'textDocument/semanticTokens/range'\n+          if range then\n+            params.range = range\n+          else\n+            -- If no range is provided, send requests for all visible ranges\n+            -- This should be made better/removed once we can record capability  for textDocument/semanticTokens/range\n+            -- only\n+            local visible_range = self:get_visible_range()\n+            self:send_request(visible_range)\n+            return\n+          end\n+        elseif hasEditProvider then\n+          if current_result.result_id then\n+            method = 'textDocument/semanticTokens/full/delta'\n+            params.previousResultId = current_result.result_id\n+          end\n+        elseif not hasFullOnlyProvider then\n+          -- No suitable provider, skip this client\n+          return\n+        end\n \n-      local spec = client.server_capabilities.semanticTokensProvider.full\n-      local hasEditProvider = type(spec) == 'table' and spec.delta\n+        ---@cast method vim.lsp.protocol.Method.ClientToServer.Request",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572573713",
            "id": 2572573713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZVlwR",
            "original_commit_id": "6535799b0601037309a861615e8b75846733f494",
            "original_line": 328,
            "original_position": 174,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520119603,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572573713/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-28T21:48:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572573713",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572664422"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572664422"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "No , originally the idea was that it would request range eagerly (as it would probably be faster to compute) and then request a full in the background.\nBut due to the current capability registrations this wouldn't work.\n\nThe implementation now prefers range if available. But this reduces to just one request and lets `send_request` decide which request to make.",
            "commit_id": "6535799b0601037309a861615e8b75846733f494",
            "created_at": "2025-11-28T23:56:08Z",
            "diff_hunk": "@@ -184,20 +189,47 @@ function STHighlighter:new(bufnr)\n     buffer = self.bufnr,\n     group = self.augroup,\n     callback = function()\n+      -- Process tokens for only the visible portion of the window first, before requesting the rest of\n+      -- the document, so the visible portion of the buffer is updated first\n+      local visible_range = self:get_visible_range()\n+      self:send_request(visible_range)\n+\n       self:send_request()",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572664422",
            "id": 2572664422,
            "in_reply_to_id": 2572570952,
            "line": 193,
            "node_id": "PRRC_kwDOAPphoM6ZV75m",
            "original_commit_id": "6535799b0601037309a861615e8b75846733f494",
            "original_line": 193,
            "original_position": 51,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520224459,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572664422/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T00:35:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572664422",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572665323"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572665323"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "You are right, we don't. I have moved the range responsibility into `send_request`, so this double call isn't needed",
            "commit_id": "6535799b0601037309a861615e8b75846733f494",
            "created_at": "2025-11-28T23:58:01Z",
            "diff_hunk": "@@ -164,11 +165,15 @@ function STHighlighter:new(bufnr)\n   self = Capability.new(self, bufnr)\n \n   api.nvim_buf_attach(bufnr, false, {\n-    on_lines = function(_, buf)\n+    on_lines = function(_, buf, _, first, last)\n       local highlighter = STHighlighter.active[buf]\n       if not highlighter then\n         return true\n       end\n+      highlighter:on_change({\n+        ['start'] = { line = first, character = 0 },\n+        ['end'] = { line = last, character = 0 },\n+      })\n       highlighter:on_change()",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572665323",
            "id": 2572665323,
            "in_reply_to_id": 2572569700,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZV8Hr",
            "original_commit_id": "6535799b0601037309a861615e8b75846733f494",
            "original_line": 177,
            "original_position": 39,
            "original_start_line": 173,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520224459,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572665323/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-29T00:35:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572665323",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572700060"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572700060"
                }
            },
            "author_association": "MEMBER",
            "body": "Since these capabilities support dynamic registration, we should use `client:supports_method` (which takes into account support added after the initialize request).",
            "commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "created_at": "2025-11-29T01:03:52Z",
            "diff_hunk": "@@ -229,63 +252,124 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n+\n+      -- Capability checks",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572700060",
            "id": 2572700060,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZWEmc",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 267,
            "original_position": 82,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520259359,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572700060/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T01:07:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572700060",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572700808"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572700808"
                }
            },
            "author_association": "MEMBER",
            "body": "I would create a new constant variable for `'FULL'` instead of hardcoding the string literal everywhere.",
            "commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "created_at": "2025-11-29T01:05:39Z",
            "diff_hunk": "@@ -302,14 +386,18 @@ end\n ---@async\n ---@param response lsp.SemanticTokens|lsp.SemanticTokensDelta\n ---@private\n-function STHighlighter:process_response(response, client, version)\n+function STHighlighter:process_response(response, client, version, range)\n   local state = self.client_state[client.id]\n   if not state then\n     return\n   end\n+  local request_idx = range or 'FULL'",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572700808",
            "id": 2572700808,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZWEyI",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 394,
            "original_position": 241,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520259359,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572700808/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T01:07:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572700808",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572701059"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572701059"
                }
            },
            "author_association": "MEMBER",
            "body": "Don't we need to also set `state.active_requests = {}` here?\n\nOn that note, we might want to do that inside `cancel_all_requests`.",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-29T01:06:35Z",
            "diff_hunk": "@@ -509,12 +614,9 @@ function STHighlighter:reset()\n   for client_id, state in pairs(self.client_state) do\n     api.nvim_buf_clear_namespace(self.bufnr, state.namespace, 0, -1)\n     state.current_result = {}\n-    if state.active_request.request_id then\n-      local client = vim.lsp.get_client_by_id(client_id)\n-      assert(client)\n-      client:cancel_request(state.active_request.request_id)\n-      state.active_request = {}\n-    end\n+    local client = vim.lsp.get_client_by_id(client_id)\n+    assert(client)\n+    self:cancel_all_requests(client)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572701059",
            "id": 2572701059,
            "line": 608,
            "node_id": "PRRC_kwDOAPphoM6ZWE2D",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 608,
            "original_position": 304,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 293,
            "pull_request_review_id": 3520259359,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572701059/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T01:07:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572701059",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572701180"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572701180"
                }
            },
            "author_association": "MEMBER",
            "body": "See my comment on using `supports_method`.",
            "commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "created_at": "2025-11-29T01:07:00Z",
            "diff_hunk": "@@ -632,7 +730,10 @@ function M.start(bufnr, client_id, opts)\n     return\n   end\n \n-  if not vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full') then\n+  if\n+    not vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full')",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572701180",
            "id": 2572701180,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZWE38",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 734,
            "original_position": 331,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520259359,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572701180/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T01:07:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572701180",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572952381"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572952381"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Yes, you are right. I was following the style in the existing file. But this is better",
            "commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "created_at": "2025-11-29T10:56:22Z",
            "diff_hunk": "@@ -229,63 +252,124 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n+\n+      -- Capability checks",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572952381",
            "id": 2572952381,
            "in_reply_to_id": 2572700060,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZXCM9",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 267,
            "original_position": 82,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520643143,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572952381/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T11:49:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572952381",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572957002"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572957002"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Done.",
            "commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "created_at": "2025-11-29T11:07:01Z",
            "diff_hunk": "@@ -302,14 +386,18 @@ end\n ---@async\n ---@param response lsp.SemanticTokens|lsp.SemanticTokensDelta\n ---@private\n-function STHighlighter:process_response(response, client, version)\n+function STHighlighter:process_response(response, client, version, range)\n   local state = self.client_state[client.id]\n   if not state then\n     return\n   end\n+  local request_idx = range or 'FULL'",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572957002",
            "id": 2572957002,
            "in_reply_to_id": 2572700808,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZXDVK",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 394,
            "original_position": 241,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520643143,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572957002/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T11:49:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572957002",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572961231"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572961231"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Done",
            "commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "created_at": "2025-11-29T11:10:46Z",
            "diff_hunk": "@@ -632,7 +730,10 @@ function M.start(bufnr, client_id, opts)\n     return\n   end\n \n-  if not vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full') then\n+  if\n+    not vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full')",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572961231",
            "id": 2572961231,
            "in_reply_to_id": 2572701180,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZXEXP",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 734,
            "original_position": 331,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520643143,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572961231/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T11:49:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572961231",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572962256"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572962256"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "It already did it at the end of `cancel_all_requests` but i have updated it so it does it inside the loop of `cancell_all_requests`",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-29T11:11:26Z",
            "diff_hunk": "@@ -509,12 +614,9 @@ function STHighlighter:reset()\n   for client_id, state in pairs(self.client_state) do\n     api.nvim_buf_clear_namespace(self.bufnr, state.namespace, 0, -1)\n     state.current_result = {}\n-    if state.active_request.request_id then\n-      local client = vim.lsp.get_client_by_id(client_id)\n-      assert(client)\n-      client:cancel_request(state.active_request.request_id)\n-      state.active_request = {}\n-    end\n+    local client = vim.lsp.get_client_by_id(client_id)\n+    assert(client)\n+    self:cancel_all_requests(client)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572962256",
            "id": 2572962256,
            "in_reply_to_id": 2572701059,
            "line": 608,
            "node_id": "PRRC_kwDOAPphoM6ZXEnQ",
            "original_commit_id": "40abdaf4640a21d53c291c952d0339a4bba13359",
            "original_line": 608,
            "original_position": 304,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 293,
            "pull_request_review_id": 3520643143,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572962256/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T11:49:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572962256",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2572976025"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572976025"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "done",
            "commit_id": "6535799b0601037309a861615e8b75846733f494",
            "created_at": "2025-11-29T11:49:27Z",
            "diff_hunk": "@@ -229,63 +261,124 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n+\n+      -- Capability checks\n+      local hasRangeProvider =\n+        vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'range')\n+      local hasEditProvider =\n+        vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full', 'delta')\n+      local hasFullOnlyProvider = vim.tbl_get(\n+        client.server_capabilities,\n+        'semanticTokensProvider',\n+        'full'\n+      ) == true or vim.tbl_get(\n+        client.server_capabilities,\n+        'semanticTokensProvider',\n+        'full',\n+        'delta'\n+      ) == false\n+\n+      local full_request_version = active_requests['FULL'] and active_requests['FULL'].version\n+\n+      local new_version = current_result.version ~= version and full_request_version ~= version\n+\n+      if (new_version or range) and not (range and not hasRangeProvider) then\n+        -- Cancel stale in-flight request\n+        if new_version then\n+          self:cancel_all_requests(client)\n+        end\n \n-    local current_result = state.current_result\n-    local active_request = state.active_request\n-\n-    -- Only send a request for this client if the current result is out of date and\n-    -- there isn't a current a request in flight for this version\n-    if client and current_result.version ~= version and active_request.version ~= version then\n-      -- cancel stale in-flight request\n-      if active_request.request_id then\n-        client:cancel_request(active_request.request_id)\n-        active_request = {}\n-        state.active_request = active_request\n-      end\n+        local params = { textDocument = util.make_text_document_params(self.bufnr) }\n+\n+        local method = 'textDocument/semanticTokens/full'\n+\n+        if hasRangeProvider then\n+          method = 'textDocument/semanticTokens/range'\n+          if range then\n+            params.range = range\n+          else\n+            -- If no range is provided, send requests for all visible ranges\n+            -- This should be made better/removed once we can record capability  for textDocument/semanticTokens/range\n+            -- only\n+            local visible_range = self:get_visible_range()\n+            self:send_request(visible_range)\n+            return\n+          end\n+        elseif hasEditProvider then\n+          if current_result.result_id then\n+            method = 'textDocument/semanticTokens/full/delta'\n+            params.previousResultId = current_result.result_id\n+          end\n+        elseif not hasFullOnlyProvider then\n+          -- No suitable provider, skip this client\n+          return\n+        end\n \n-      local spec = client.server_capabilities.semanticTokensProvider.full\n-      local hasEditProvider = type(spec) == 'table' and spec.delta\n+        ---@cast method vim.lsp.protocol.Method.ClientToServer.Request",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2572976025",
            "id": 2572976025,
            "in_reply_to_id": 2572573713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZXH-Z",
            "original_commit_id": "6535799b0601037309a861615e8b75846733f494",
            "original_line": 328,
            "original_position": 174,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520643143,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572976025/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-29T11:49:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2572976025",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573288900"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573288900"
                }
            },
            "author_association": "MEMBER",
            "body": "It's always nice to see a `TODO` comment removed.",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-30T01:35:19Z",
            "diff_hunk": "@@ -412,8 +412,7 @@ function protocol.make_client_capabilities()\n         },\n         formats = { 'relative' },\n         requests = {\n-          -- TODO(jdrouhard): Add support for this",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573288900",
            "id": 2573288900,
            "line": 415,
            "node_id": "PRRC_kwDOAPphoM6ZYUXE",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 415,
            "original_position": 4,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/protocol.lua",
            "position": 4,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573288900/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573288900",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573289361"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573289361"
                }
            },
            "author_association": "MEMBER",
            "body": "Ahhh I forget how Lua's type system is a lie and we need hacks like these to create a constant string literal. I still think it's worth it here.",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-30T01:36:50Z",
            "diff_hunk": "@@ -23,14 +23,19 @@ local M = {}\n --- @field highlights? STTokenRange[] cache of highlight ranges for this document version\n --- @field tokens? integer[] raw token array as received by the server. used for calculating delta responses\n --- @field namespace_cleared? boolean whether the namespace was cleared for this result yet\n----\n+\n --- @class (private) STActiveRequest\n --- @field request_id? integer the LSP request ID of the most recent request sent to the server\n --- @field version? integer the document version associated with the most recent request\n----\n+\n+---@alias full_request 'FULL'\n+\n+---@type full_request\n+local FULL = 'FULL'",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573289361",
            "id": 2573289361,
            "line": 34,
            "node_id": "PRRC_kwDOAPphoM6ZYUeR",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 34,
            "original_position": 14,
            "original_start_line": 31,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 14,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573289361/reactions"
            },
            "side": "RIGHT",
            "start_line": 31,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573289361",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573290024"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573290024"
                }
            },
            "author_association": "MEMBER",
            "body": "Why can't we use the captured client?",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T01:39:41Z",
            "diff_hunk": "@@ -229,65 +256,110 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n \n-    local current_result = state.current_result\n-    local active_request = state.active_request\n-\n-    -- Only send a request for this client if the current result is out of date and\n-    -- there isn't a current a request in flight for this version\n-    if client and current_result.version ~= version and active_request.version ~= version then\n-      -- cancel stale in-flight request\n-      if active_request.request_id then\n-        client:cancel_request(active_request.request_id)\n-        active_request = {}\n-        state.active_request = active_request\n-      end\n+      local full_request_version = active_requests[FULL] and active_requests[FULL].version\n \n-      local spec = client.server_capabilities.semanticTokensProvider.full\n-      local hasEditProvider = type(spec) == 'table' and spec.delta\n+      local new_version = current_result.version ~= version and full_request_version ~= version\n \n-      local params = { textDocument = util.make_text_document_params(self.bufnr) }\n-      local method = 'textDocument/semanticTokens/full'\n-\n-      if hasEditProvider and current_result.result_id then\n-        method = method .. '/delta'\n-        params.previousResultId = current_result.result_id\n-      end\n-      ---@cast method vim.lsp.protocol.Method.ClientToServer.Request\n-      ---@param response? lsp.SemanticTokens|lsp.SemanticTokensDelta\n-      local success, request_id = client:request(method, params, function(err, response, ctx)\n-        -- look client up again using ctx.client_id instead of using a captured\n-        -- client object\n-        local c = vim.lsp.get_client_by_id(ctx.client_id)\n-        local bufnr = assert(ctx.bufnr)\n-        local highlighter = STHighlighter.active[bufnr]\n-        if not (c and highlighter) then\n-          return\n+      if new_version or range then\n+        -- Cancel stale in-flight request\n+        if new_version then\n+          self:cancel_all_requests(client)\n         end\n \n-        if err or not response then\n-          highlighter.client_state[c.id].active_request = {}\n+        local params = { textDocument = util.make_text_document_params(self.bufnr) }\n+\n+        ---@type vim.lsp.protocol.Method.ClientToServer.Request\n+        local method = 'textDocument/semanticTokens/full'\n+\n+        if client:supports_method('textDocument/semanticTokens/range', self.bufnr) then\n+          method = 'textDocument/semanticTokens/range'\n+          if range then\n+            params.range = range\n+          else\n+            -- If no range is provided, send requests for all visible ranges\n+            -- This should be made better/removed once we can record capability  for textDocument/semanticTokens/range\n+            -- only\n+            local visible_range = self:get_visible_range()\n+            self:send_request(visible_range)\n+            return\n+          end\n+        elseif client:supports_method('textDocument/semanticTokens/full/delta', self.bufnr) then\n+          if current_result.result_id then\n+            method = 'textDocument/semanticTokens/full/delta'\n+            params.previousResultId = current_result.result_id\n+          end\n+        elseif not client:supports_method('textDocument/semanticTokens/full', self.bufnr) then\n+          -- No suitable provider, skip this client\n           return\n         end\n \n-        coroutine.wrap(STHighlighter.process_response)(highlighter, response, c, version)\n-      end, self.bufnr)\n+        ---@param response? lsp.SemanticTokens|lsp.SemanticTokensDelta\n+        local success, request_id = client:request(method, params, function(err, response, ctx)\n+          -- look client up again using ctx.client_id instead of using a captured\n+          -- client object",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573290024",
            "id": 2573290024,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZYUoo",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 311,
            "original_position": 162,
            "original_start_line": 310,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573290024/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573290024",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573290261"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573290261"
                }
            },
            "author_association": "MEMBER",
            "body": "Based on the current usage it seems like this can be private?",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T01:40:43Z",
            "diff_hunk": "@@ -229,65 +256,110 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n \n-    local current_result = state.current_result\n-    local active_request = state.active_request\n-\n-    -- Only send a request for this client if the current result is out of date and\n-    -- there isn't a current a request in flight for this version\n-    if client and current_result.version ~= version and active_request.version ~= version then\n-      -- cancel stale in-flight request\n-      if active_request.request_id then\n-        client:cancel_request(active_request.request_id)\n-        active_request = {}\n-        state.active_request = active_request\n-      end\n+      local full_request_version = active_requests[FULL] and active_requests[FULL].version\n \n-      local spec = client.server_capabilities.semanticTokensProvider.full\n-      local hasEditProvider = type(spec) == 'table' and spec.delta\n+      local new_version = current_result.version ~= version and full_request_version ~= version\n \n-      local params = { textDocument = util.make_text_document_params(self.bufnr) }\n-      local method = 'textDocument/semanticTokens/full'\n-\n-      if hasEditProvider and current_result.result_id then\n-        method = method .. '/delta'\n-        params.previousResultId = current_result.result_id\n-      end\n-      ---@cast method vim.lsp.protocol.Method.ClientToServer.Request\n-      ---@param response? lsp.SemanticTokens|lsp.SemanticTokensDelta\n-      local success, request_id = client:request(method, params, function(err, response, ctx)\n-        -- look client up again using ctx.client_id instead of using a captured\n-        -- client object\n-        local c = vim.lsp.get_client_by_id(ctx.client_id)\n-        local bufnr = assert(ctx.bufnr)\n-        local highlighter = STHighlighter.active[bufnr]\n-        if not (c and highlighter) then\n-          return\n+      if new_version or range then\n+        -- Cancel stale in-flight request\n+        if new_version then\n+          self:cancel_all_requests(client)\n         end\n \n-        if err or not response then\n-          highlighter.client_state[c.id].active_request = {}\n+        local params = { textDocument = util.make_text_document_params(self.bufnr) }\n+\n+        ---@type vim.lsp.protocol.Method.ClientToServer.Request\n+        local method = 'textDocument/semanticTokens/full'\n+\n+        if client:supports_method('textDocument/semanticTokens/range', self.bufnr) then\n+          method = 'textDocument/semanticTokens/range'\n+          if range then\n+            params.range = range\n+          else\n+            -- If no range is provided, send requests for all visible ranges\n+            -- This should be made better/removed once we can record capability  for textDocument/semanticTokens/range\n+            -- only\n+            local visible_range = self:get_visible_range()\n+            self:send_request(visible_range)\n+            return\n+          end\n+        elseif client:supports_method('textDocument/semanticTokens/full/delta', self.bufnr) then\n+          if current_result.result_id then\n+            method = 'textDocument/semanticTokens/full/delta'\n+            params.previousResultId = current_result.result_id\n+          end\n+        elseif not client:supports_method('textDocument/semanticTokens/full', self.bufnr) then\n+          -- No suitable provider, skip this client\n           return\n         end\n \n-        coroutine.wrap(STHighlighter.process_response)(highlighter, response, c, version)\n-      end, self.bufnr)\n+        ---@param response? lsp.SemanticTokens|lsp.SemanticTokensDelta\n+        local success, request_id = client:request(method, params, function(err, response, ctx)\n+          -- look client up again using ctx.client_id instead of using a captured\n+          -- client object\n+          local c = vim.lsp.get_client_by_id(ctx.client_id)\n+          local bufnr = assert(ctx.bufnr)\n+          local highlighter = STHighlighter.active[bufnr]\n+          if not (c and highlighter) then\n+            return\n+          end\n \n-      if success then\n-        active_request.request_id = request_id\n-        active_request.version = version\n+          if err or not response then\n+            highlighter.client_state[c.id].active_requests[range or FULL] = {}\n+            return\n+          end\n+\n+          coroutine.wrap(STHighlighter.process_response)(highlighter, response, c, version)\n+        end, self.bufnr)\n+\n+        if success then\n+          active_requests[range or FULL] = { request_id = request_id, version = version }\n+        end\n       end\n     end\n   end\n end\n \n+--- Gets a range that encompasses all visible lines across all windows\n+--- @package",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573290261",
            "id": 2573290261,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZYUsV",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 336,
            "original_position": 190,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573290261/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573290261",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573291670"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573291670"
                }
            },
            "author_association": "MEMBER",
            "body": "Nit: I know that this function is already not including all parameters in the Luadoc but if we're adding `range` might as well include its type above.",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-30T01:46:28Z",
            "diff_hunk": "@@ -302,14 +374,18 @@ end\n ---@async\n ---@param response lsp.SemanticTokens|lsp.SemanticTokensDelta\n ---@private\n-function STHighlighter:process_response(response, client, version)\n+function STHighlighter:process_response(response, client, version, range)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573291670",
            "id": 2573291670,
            "line": 378,
            "node_id": "PRRC_kwDOAPphoM6ZYVCW",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 378,
            "original_position": 225,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 225,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573291670/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573291670",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573292000"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573292000"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n    and not client:supports_method('textDocument/semanticTokens/range', bufnr)\n```",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T01:48:04Z",
            "diff_hunk": "@@ -632,7 +718,10 @@ function M.start(bufnr, client_id, opts)\n     return\n   end\n \n-  if not vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full') then\n+  if\n+    not client:supports_method('textDocument/semanticTokens/full', bufnr)\n+    and client:supports_method('textDocument/semanticTokens/range', bufnr)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573292000",
            "id": 2573292000,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZYVHg",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 723,
            "original_position": 321,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573292000/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573292000",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2573292599"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573292599"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n  - From just the buffer we don't know if we want to send range requests or full requests.\n  -- So we send both \"visible ranges\" and \"full\" requests, which is fine as send_request() will no-op if one of these isn't supported\n```",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T01:49:53Z",
            "diff_hunk": "@@ -766,6 +855,8 @@ function M.force_refresh(bufnr)\n   local buffers = bufnr == nil and vim.tbl_keys(STHighlighter.active)\n     or { vim._resolve_bufnr(bufnr) }\n \n+  -- From the buffer only we dont know if we want to send range requests or full requests\n+  -- So send both for visible ranges and full, send_request() will no-op any that aren't supported",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2573292599",
            "id": 2573292599,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZYVQ3",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 859,
            "original_position": 331,
            "original_start_line": 858,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3520901813,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573292599/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-30T01:49:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2573292599",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2574775259"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574775259"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I removed this comment entirely, we only fire one request now. and its pretty clear what `send_request` does",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T20:29:44Z",
            "diff_hunk": "@@ -766,6 +855,8 @@ function M.force_refresh(bufnr)\n   local buffers = bufnr == nil and vim.tbl_keys(STHighlighter.active)\n     or { vim._resolve_bufnr(bufnr) }\n \n+  -- From the buffer only we dont know if we want to send range requests or full requests\n+  -- So send both for visible ranges and full, send_request() will no-op any that aren't supported",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2574775259",
            "id": 2574775259,
            "in_reply_to_id": 2573292599,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6Zd_Pb",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 859,
            "original_position": 331,
            "original_start_line": 858,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3522288503,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574775259/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-30T20:38:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574775259",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2574775602"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574775602"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "good catch",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T20:29:54Z",
            "diff_hunk": "@@ -632,7 +718,10 @@ function M.start(bufnr, client_id, opts)\n     return\n   end\n \n-  if not vim.tbl_get(client.server_capabilities, 'semanticTokensProvider', 'full') then\n+  if\n+    not client:supports_method('textDocument/semanticTokens/full', bufnr)\n+    and client:supports_method('textDocument/semanticTokens/range', bufnr)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2574775602",
            "id": 2574775602,
            "in_reply_to_id": 2573292000,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6Zd_Uy",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 723,
            "original_position": 321,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3522288503,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574775602/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-30T20:38:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574775602",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2574784259"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574784259"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "i added all the params",
            "commit_id": "12c98bb1b5e4daca47762822153eac6937795666",
            "created_at": "2025-11-30T20:33:34Z",
            "diff_hunk": "@@ -302,14 +374,18 @@ end\n ---@async\n ---@param response lsp.SemanticTokens|lsp.SemanticTokensDelta\n ---@private\n-function STHighlighter:process_response(response, client, version)\n+function STHighlighter:process_response(response, client, version, range)",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2574784259",
            "id": 2574784259,
            "in_reply_to_id": 2573291670,
            "line": 378,
            "node_id": "PRRC_kwDOAPphoM6ZeBcD",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 378,
            "original_position": 225,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 225,
            "pull_request_review_id": 3522288503,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574784259/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-11-30T20:38:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574784259",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/36705#discussion_r2574786139"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/36705"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574786139"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I don't know. The old code did, but i have removed it and used the original client, all seems well",
            "commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "created_at": "2025-11-30T20:34:21Z",
            "diff_hunk": "@@ -229,65 +256,110 @@ end\n --- are saved to facilitate document synchronization in the response.\n ---\n ---@package\n-function STHighlighter:send_request()\n+---@param range? lsp.Range\n+function STHighlighter:send_request(range)\n   local version = util.buf_versions[self.bufnr]\n \n   self:reset_timer()\n \n   for client_id, state in pairs(self.client_state) do\n     local client = vim.lsp.get_client_by_id(client_id)\n+    if client then\n+      local current_result = state.current_result\n+      local active_requests = state.active_requests\n \n-    local current_result = state.current_result\n-    local active_request = state.active_request\n-\n-    -- Only send a request for this client if the current result is out of date and\n-    -- there isn't a current a request in flight for this version\n-    if client and current_result.version ~= version and active_request.version ~= version then\n-      -- cancel stale in-flight request\n-      if active_request.request_id then\n-        client:cancel_request(active_request.request_id)\n-        active_request = {}\n-        state.active_request = active_request\n-      end\n+      local full_request_version = active_requests[FULL] and active_requests[FULL].version\n \n-      local spec = client.server_capabilities.semanticTokensProvider.full\n-      local hasEditProvider = type(spec) == 'table' and spec.delta\n+      local new_version = current_result.version ~= version and full_request_version ~= version\n \n-      local params = { textDocument = util.make_text_document_params(self.bufnr) }\n-      local method = 'textDocument/semanticTokens/full'\n-\n-      if hasEditProvider and current_result.result_id then\n-        method = method .. '/delta'\n-        params.previousResultId = current_result.result_id\n-      end\n-      ---@cast method vim.lsp.protocol.Method.ClientToServer.Request\n-      ---@param response? lsp.SemanticTokens|lsp.SemanticTokensDelta\n-      local success, request_id = client:request(method, params, function(err, response, ctx)\n-        -- look client up again using ctx.client_id instead of using a captured\n-        -- client object\n-        local c = vim.lsp.get_client_by_id(ctx.client_id)\n-        local bufnr = assert(ctx.bufnr)\n-        local highlighter = STHighlighter.active[bufnr]\n-        if not (c and highlighter) then\n-          return\n+      if new_version or range then\n+        -- Cancel stale in-flight request\n+        if new_version then\n+          self:cancel_all_requests(client)\n         end\n \n-        if err or not response then\n-          highlighter.client_state[c.id].active_request = {}\n+        local params = { textDocument = util.make_text_document_params(self.bufnr) }\n+\n+        ---@type vim.lsp.protocol.Method.ClientToServer.Request\n+        local method = 'textDocument/semanticTokens/full'\n+\n+        if client:supports_method('textDocument/semanticTokens/range', self.bufnr) then\n+          method = 'textDocument/semanticTokens/range'\n+          if range then\n+            params.range = range\n+          else\n+            -- If no range is provided, send requests for all visible ranges\n+            -- This should be made better/removed once we can record capability  for textDocument/semanticTokens/range\n+            -- only\n+            local visible_range = self:get_visible_range()\n+            self:send_request(visible_range)\n+            return\n+          end\n+        elseif client:supports_method('textDocument/semanticTokens/full/delta', self.bufnr) then\n+          if current_result.result_id then\n+            method = 'textDocument/semanticTokens/full/delta'\n+            params.previousResultId = current_result.result_id\n+          end\n+        elseif not client:supports_method('textDocument/semanticTokens/full', self.bufnr) then\n+          -- No suitable provider, skip this client\n           return\n         end\n \n-        coroutine.wrap(STHighlighter.process_response)(highlighter, response, c, version)\n-      end, self.bufnr)\n+        ---@param response? lsp.SemanticTokens|lsp.SemanticTokensDelta\n+        local success, request_id = client:request(method, params, function(err, response, ctx)\n+          -- look client up again using ctx.client_id instead of using a captured\n+          -- client object",
            "html_url": "https://github.com/neovim/neovim/pull/36705#discussion_r2574786139",
            "id": 2574786139,
            "in_reply_to_id": 2573290024,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6ZeB5b",
            "original_commit_id": "ae9366e715cdddf33d27bd7b2172d92b7bdbeda2",
            "original_line": 311,
            "original_position": 162,
            "original_start_line": 310,
            "path": "runtime/lua/vim/lsp/semantic_tokens.lua",
            "position": 1,
            "pull_request_review_id": 3522288503,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574786139/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-11-30T20:38:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2574786139",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "MEMBER",
            "body": "I'll update news.txt in the docs pr",
            "created_at": "2025-12-01T02:00:25Z",
            "html_url": "https://github.com/neovim/neovim/pull/36705#issuecomment-3594210278",
            "id": 3594210278,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36705",
            "node_id": "IC_kwDOAPphoM7WO0vm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3594210278/reactions"
            },
            "updated_at": "2025-12-01T02:00:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3594210278",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/36705/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/36705/commits",
    "created_at": "2025-11-26T16:36:11Z",
    "diff_url": "https://github.com/neovim/neovim/pull/36705.diff",
    "draft": false,
    "head": {
        "label": "tris203:semantictokens/range",
        "ref": "semantictokens/range",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/tris203/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/tris203/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/tris203/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/tris203/neovim/branches{/branch}",
            "clone_url": "https://github.com/tris203/neovim.git",
            "collaborators_url": "https://api.github.com/repos/tris203/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/tris203/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/tris203/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/tris203/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/tris203/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/tris203/neovim/contributors",
            "created_at": "2024-09-01T13:29:52Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/tris203/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/tris203/neovim/downloads",
            "events_url": "https://api.github.com/repos/tris203/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/tris203/neovim/forks",
            "full_name": "tris203/neovim",
            "git_commits_url": "https://api.github.com/repos/tris203/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/tris203/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/tris203/neovim/git/tags{/sha}",
            "git_url": "git://github.com/tris203/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/tris203/neovim/hooks",
            "html_url": "https://github.com/tris203/neovim",
            "id": 850679366,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/tris203/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/tris203/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/tris203/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/tris203/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/tris203/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/tris203/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/tris203/neovim/merges",
            "milestones_url": "https://api.github.com/repos/tris203/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOMrRWRg",
            "notifications_url": "https://api.github.com/repos/tris203/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/tris203/neovim/pulls{/number}",
            "pushed_at": "2025-12-01T22:25:50Z",
            "releases_url": "https://api.github.com/repos/tris203/neovim/releases{/id}",
            "size": 348450,
            "ssh_url": "git@github.com:tris203/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/tris203/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/tris203/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/tris203/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/tris203/neovim/subscription",
            "svn_url": "https://github.com/tris203/neovim",
            "tags_url": "https://api.github.com/repos/tris203/neovim/tags",
            "teams_url": "https://api.github.com/repos/tris203/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/tris203/neovim/git/trees{/sha}",
            "updated_at": "2025-12-01T15:32:29Z",
            "url": "https://api.github.com/repos/tris203/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "12c98bb1b5e4daca47762822153eac6937795666",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
            "events_url": "https://api.github.com/users/tris203/events{/privacy}",
            "followers_url": "https://api.github.com/users/tris203/followers",
            "following_url": "https://api.github.com/users/tris203/following{/other_user}",
            "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/tris203",
            "id": 18444302,
            "login": "tris203",
            "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
            "organizations_url": "https://api.github.com/users/tris203/orgs",
            "received_events_url": "https://api.github.com/users/tris203/received_events",
            "repos_url": "https://api.github.com/users/tris203/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/tris203",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/36705",
    "id": 3048227867,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36705",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "0052CC",
            "default": false,
            "description": "",
            "id": 6664957181,
            "name": "ci:skip-news",
            "node_id": "LA_kwDOAPphoM8AAAABjUMs_Q",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ci:skip-news"
        }
    ],
    "locked": false,
    "merge_commit_sha": "23ddb2028bce0998f53f5d23f3b6c2aac616f28e",
    "merged_at": "2025-12-01T02:06:56Z",
    "milestone": null,
    "node_id": "PR_kwDOAPphoM61sEQb",
    "number": 36705,
    "patch_url": "https://github.com/neovim/neovim/pull/36705.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/36705/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/12c98bb1b5e4daca47762822153eac6937795666",
    "title": "feat(lsp): add support for semanticTokens range requests",
    "updated_at": "2025-12-01T02:08:05Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/36705",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
        "events_url": "https://api.github.com/users/tris203/events{/privacy}",
        "followers_url": "https://api.github.com/users/tris203/followers",
        "following_url": "https://api.github.com/users/tris203/following{/other_user}",
        "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tris203",
        "id": 18444302,
        "login": "tris203",
        "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
        "organizations_url": "https://api.github.com/users/tris203/orgs",
        "received_events_url": "https://api.github.com/users/tris203/received_events",
        "repos_url": "https://api.github.com/users/tris203/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tris203",
        "user_view_type": "public"
    }
}
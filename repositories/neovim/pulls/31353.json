{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/31353/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/31353/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/31353"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/31353"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/31353/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/a75c43f9235d30a4e57a9ffc4d86a0ad6871e155"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 5926,
            "forks_count": 5926,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1872,
            "open_issues_count": 1872,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-03-11T01:51:56Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 311541,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 87036,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-03-11T02:33:20Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 87036,
            "watchers_count": 87036,
            "web_commit_signoff_required": false
        },
        "sha": "40a149e7f9926d29f19457da6a397b3b58b0b40f",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "Problem: internal augroup need nvim_ prefix and test case postion inside wrong function block\r\n\r\nSolution: add nvim_ prefix and move the test case to a single block\r\n\r\ncc @justinmk ",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1857870827"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857870827"
                }
            },
            "author_association": "MEMBER",
            "body": "Why aren't the tests removed from the old position?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-26T06:25:28Z",
            "diff_hunk": "@@ -301,4 +301,36 @@ describe('vim.lsp.util', function()\n       end)\n     end)\n   end)\n+\n+  describe('open_floating_preview', function()",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1857870827",
            "id": 1857870827,
            "line": 273,
            "node_id": "PRRC_kwDOAPphoM5uvNvr",
            "original_commit_id": "4a3c3aa21514315030cd4cbd7cd2b94684e67dd5",
            "original_line": 273,
            "original_position": 5,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/utils_spec.lua",
            "position": 22,
            "pull_request_review_id": 2460486397,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857870827/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-26T06:25:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857870827",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1857877274"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857877274"
                }
            },
            "author_association": "MEMBER",
            "body": "because before inside the `make_floating_popup_options` function describe block .",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-26T06:31:59Z",
            "diff_hunk": "@@ -301,4 +301,36 @@ describe('vim.lsp.util', function()\n       end)\n     end)\n   end)\n+\n+  describe('open_floating_preview', function()",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1857877274",
            "id": 1857877274,
            "in_reply_to_id": 1857870827,
            "line": 273,
            "node_id": "PRRC_kwDOAPphoM5uvPUa",
            "original_commit_id": "4a3c3aa21514315030cd4cbd7cd2b94684e67dd5",
            "original_line": 273,
            "original_position": 5,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/utils_spec.lua",
            "position": 22,
            "pull_request_review_id": 2460496378,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857877274/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-26T06:31:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857877274",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1857878514"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857878514"
                }
            },
            "author_association": "MEMBER",
            "body": "So why aren't they removed? Why are they now repeated twice?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-26T06:33:16Z",
            "diff_hunk": "@@ -301,4 +301,36 @@ describe('vim.lsp.util', function()\n       end)\n     end)\n   end)\n+\n+  describe('open_floating_preview', function()",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1857878514",
            "id": 1857878514,
            "in_reply_to_id": 1857870827,
            "line": 273,
            "node_id": "PRRC_kwDOAPphoM5uvPny",
            "original_commit_id": "4a3c3aa21514315030cd4cbd7cd2b94684e67dd5",
            "original_line": 273,
            "original_position": 5,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/utils_spec.lua",
            "position": 22,
            "pull_request_review_id": 2460498238,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857878514/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-26T06:34:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1857878514",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1858698046"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1858698046"
                }
            },
            "author_association": "MEMBER",
            "body": "Why is the augroup needed if we are returning `true` here? I guess to avoid \"duplicate\" WinClosed events? But at least, `nvim_del_augroup_by_name` shouldn't be necessary because of the `if not ok` check on line 1626.\r\n\r\nShould we instead create a single, global `WinClosed` handler that checks the win-id against `vim.b[bufnr].lsp_floating_preview` ?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-26T14:56:59Z",
            "diff_hunk": "@@ -1632,6 +1632,7 @@ function M.open_floating_preview(contents, syntax, opts)\n           vim.b[bufnr].lsp_floating_preview = nil\n         end\n         api.nvim_del_augroup_by_name(augroup_name)\n+        return true",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1858698046",
            "id": 1858698046,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5uyXs-",
            "original_commit_id": "39e798a719278bde688dde5383cbed427844f446",
            "original_line": 1635,
            "original_position": 13,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2461799563,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1858698046/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-26T14:57:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1858698046",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1859991091"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1859991091"
                }
            },
            "author_association": "MEMBER",
            "body": ">  I guess to avoid \"duplicate\" WinClosed events?\r\n\r\nyes because there can reuse a floating-window `  local floating_winnr = opts._update_win` in line 1531. \r\n\r\nDoes the global WinClosed mean that winid is not needed as pattern? Any window closing will trigger it. Another thing we are missing is a function to check the existence of augroup or autocmd? The current method of checking the existence of augroup always uses pcall wrapper. Checking whether it has been registered an event requires `#nvim_get_autocmd({filter}) > 0`. It would be better if the filter supports `count` then return count number or something else ðŸ¤”",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-27T06:05:40Z",
            "diff_hunk": "@@ -1632,6 +1632,7 @@ function M.open_floating_preview(contents, syntax, opts)\n           vim.b[bufnr].lsp_floating_preview = nil\n         end\n         api.nvim_del_augroup_by_name(augroup_name)\n+        return true",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1859991091",
            "id": 1859991091,
            "in_reply_to_id": 1858698046,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5u3TYz",
            "original_commit_id": "39e798a719278bde688dde5383cbed427844f446",
            "original_line": 1635,
            "original_position": 13,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2463977108,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1859991091/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-27T06:05:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1859991091",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1860674924"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1860674924"
                }
            },
            "author_association": "MEMBER",
            "body": "> Does the global WinClosed mean that winid is not needed as pattern? Any window closing will trigger it.\r\n\r\nYes. But we check `vim.b[bufnr].lsp_floating_preview ` and skip. Which simplifies this code and avoids the somewhat over-engineered per-window augroup.\r\n\r\n> a function to check the existence of augroup or autocmd?\r\n\r\n`vim.fn.exists()` can do that.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-27T13:34:44Z",
            "diff_hunk": "@@ -1632,6 +1632,7 @@ function M.open_floating_preview(contents, syntax, opts)\n           vim.b[bufnr].lsp_floating_preview = nil\n         end\n         api.nvim_del_augroup_by_name(augroup_name)\n+        return true",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1860674924",
            "id": 1860674924,
            "in_reply_to_id": 1858698046,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5u56Vs",
            "original_commit_id": "39e798a719278bde688dde5383cbed427844f446",
            "original_line": 1635,
            "original_position": 13,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2465046403,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1860674924/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-27T13:34:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1860674924",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1860684697"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1860684697"
                }
            },
            "author_association": "MEMBER",
            "body": "Yes. exists can check everything on vim side. It would be better if we have a simple lua api to match it on autocmd level .  not a big problem.  nvm",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-27T13:40:49Z",
            "diff_hunk": "@@ -1632,6 +1632,7 @@ function M.open_floating_preview(contents, syntax, opts)\n           vim.b[bufnr].lsp_floating_preview = nil\n         end\n         api.nvim_del_augroup_by_name(augroup_name)\n+        return true",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1860684697",
            "id": 1860684697,
            "in_reply_to_id": 1858698046,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5u58uZ",
            "original_commit_id": "39e798a719278bde688dde5383cbed427844f446",
            "original_line": 1635,
            "original_position": 13,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2465061955,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1860684697/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-27T13:40:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1860684697",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1862423163"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862423163"
                }
            },
            "author_association": "MEMBER",
            "body": "We could use `clear=true` here, which avoids all the `if exists(...)` code (and nesting). But doesn't need to block this PR.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-28T15:54:17Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1862423163",
            "id": 1862423163,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vAlJ7",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1626,
            "original_position": 11,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2468498149,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862423163/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-28T15:54:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862423163",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1862426387"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862426387"
                }
            },
            "author_association": "MEMBER",
            "body": "`floating_winnr` is bound to the closure when the autocmd was created. But the autocmd is long-lived, so that is not a valid approach. \r\n\r\nCan we check `vim.b[bufnr].lsp_floating_preview` instead?\r\n```suggestion\r\n        if tonumber(args.match) == vim.b[bufnr].lsp_floating_preview and api.nvim_buf_is_valid(bufnr) then\r\n```",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-28T15:56:33Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1862426387",
            "id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vAl8T",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2468503100,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862426387/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-28T15:56:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862426387",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1862981178"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862981178"
                }
            },
            "author_association": "MEMBER",
            "body": "if i remember correctly default is clear =true",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-29T05:45:58Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1862981178",
            "id": 1862981178,
            "in_reply_to_id": 1862423163,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vCtY6",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1626,
            "original_position": 11,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2469132592,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862981178/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-29T05:45:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862981178",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1862981352"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862981352"
                }
            },
            "author_association": "MEMBER",
            "body": "yes i also noticed it will make the variable move to heap.. and I think bufnr should not be also captured by closure either ? Can it be stored in w[floating_winnr].buf_hold_win?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-29T05:46:15Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1862981352",
            "id": 1862981352,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vCtbo",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2469132818,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862981352/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-29T05:59:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1862981352",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1863679270"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1863679270"
                }
            },
            "author_association": "MEMBER",
            "body": "> and I think bufnr should not be also captured by closure either ? Can it be stored in w[floating_winnr].buf_hold_win?\r\n\r\noh, right. I thought that was an event arg. We should get it from event args, or `api.nvim_get_current_buf()` or whatever.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-29T15:21:07Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1863679270",
            "id": 1863679270,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vFX0m",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2470159154,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1863679270/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-29T15:21:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1863679270",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1864112501"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1864112501"
                }
            },
            "author_association": "MEMBER",
            "body": "> We should get it from event args, or api.nvim_get_current_buf() \r\n\r\n1. `args.buf` is current buffer in floating_winnr  \r\n2.  if there trigger BufEnter which will close floating_winnr and get_current_buf will return a wrong buffer which maybe not hold the floating_winnr.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-11-30T06:34:59Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1864112501",
            "id": 1864112501,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vHBl1",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2470732787,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1864112501/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-11-30T06:34:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1864112501",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865763116"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865763116"
                }
            },
            "author_association": "MEMBER",
            "body": "what happened to the `return true` ? will the event handler be cleaned up?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T12:27:46Z",
            "diff_hunk": "@@ -1620,18 +1620,16 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n-      group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      group = api.nvim_create_augroup(augroup_name, { clear = true }),\n+      callback = function(args)\n+        if\n+          tonumber(args.match) == vim.b[bufnr].lsp_floating_preview and api.nvim_buf_is_valid(bufnr)\n+        then\n           vim.b[bufnr].lsp_floating_preview = nil\n         end\n-        api.nvim_del_augroup_by_name(augroup_name)\n       end,",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865763116",
            "id": 1865763116,
            "line": 1643,
            "node_id": "PRRC_kwDOAPphoM5vNUks",
            "original_commit_id": "4bda502014e5f3322e0f356c500004840d587d9f",
            "original_line": 1643,
            "original_position": 23,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": 31,
            "pull_request_review_id": 2472563400,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865763116/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T12:29:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865763116",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865766084"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865766084"
                }
            },
            "author_association": "MEMBER",
            "body": "surely we want to check `nvim_buf_is_valid` _before_ accessing `vim.b[bufnr]` ?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T12:30:09Z",
            "diff_hunk": "@@ -1620,18 +1620,16 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n-      group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      group = api.nvim_create_augroup(augroup_name, { clear = true }),\n+      callback = function(args)\n+        if\n+          tonumber(args.match) == vim.b[bufnr].lsp_floating_preview and api.nvim_buf_is_valid(bufnr)",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865766084",
            "id": 1865766084,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vNVTE",
            "original_commit_id": "4bda502014e5f3322e0f356c500004840d587d9f",
            "original_line": 1629,
            "original_position": 18,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2472568137,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865766084/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T12:30:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865766084",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865767859"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865767859"
                }
            },
            "author_association": "MEMBER",
            "body": "either `vim.b[bufnr].lsp_floating_preview` is valid or not. why does any of that matter?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T12:31:30Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865767859",
            "id": 1865767859,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vNVuz",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2472570897,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865767859/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T12:31:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865767859",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865777116"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865777116"
                }
            },
            "author_association": "MEMBER",
            "body": "> why does any of that matter?\r\n\r\nwe don't capture bufnr in closure ,then need to find bufnr which holds the floatinng_winnr. The event args or api.nvim_get_current_buf you proposed is not the previous bufnr in some cases, so this is invalid. Ineed to store this bufnr somewhere like win-var otherwise like now capture bufnr by closure move it to heap keep-alive   ",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T12:38:18Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865777116",
            "id": 1865777116,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vNX_c",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2472585334,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865777116/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T12:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865777116",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865798856"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865798856"
                }
            },
            "author_association": "MEMBER",
            "body": "this will make closure does not capture bufnr and can get correct buffer which hold the floating_winnr\r\n\r\n```diff\r\ndiff --git a/runtime/lua/vim/lsp/util.lua b/runtime/lua/vim/lsp/util.lua\r\nindex c2b3d903e..f50725564 100644\r\n--- a/runtime/lua/vim/lsp/util.lua\r\n+++ b/runtime/lua/vim/lsp/util.lua\r\n@@ -1619,16 +1619,21 @@ function M.open_floating_preview(contents, syntax, opts)\r\n     end\r\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\r\n   end\r\n+  api.nvim_win_set_var(floating_winnr, 'lsp_buf_hold_floating_win', bufnr)\r\n\r\n   local augroup_name = 'nvim_closing_floating_preview'\r\n   if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\r\n     api.nvim_create_autocmd('WinClosed', {\r\n       group = api.nvim_create_augroup(augroup_name, { clear = true }),\r\n       callback = function(args)\r\n+        local winid = tonumber(args.match)\r\n+        local buf_hold_win = vim.w[winid].buf_hold_win\r\n         if\r\n-          tonumber(args.match) == vim.b[bufnr].lsp_floating_preview and api.nvim_buf_is_valid(bufnr)\r\n+          buf_hold_win\r\n+          and api.nvim_buf_is_valid(buf_hold_win)\r\n+          and winid == vim.b[buf_hold_win].lsp_floating_preview\r\n         then\r\n-          vim.b[bufnr].lsp_floating_preview = nil\r\n+          vim.b[buf_hold_win].lsp_floating_preview = nil\r\n         end\r\n       end,\r\n     })\r\n\r\n```",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T12:54:38Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865798856",
            "id": 1865798856,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vNdTI",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2472619275,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865798856/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T12:55:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865798856",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865832091"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865832091"
                }
            },
            "author_association": "MEMBER",
            "body": "this is getting too complicated",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T13:13:15Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865832091",
            "id": 1865832091,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vNlab",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2472669289,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865832091/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T13:13:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865832091",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1865843703"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865843703"
                }
            },
            "author_association": "MEMBER",
            "body": "okay ..I'll try another approach.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-02T13:21:28Z",
            "diff_hunk": "@@ -1620,18 +1620,14 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then\n     api.nvim_create_autocmd('WinClosed', {\n       group = api.nvim_create_augroup(augroup_name, {}),\n-      pattern = tostring(floating_winnr),\n-      callback = function()\n-        if api.nvim_buf_is_valid(bufnr) then\n+      callback = function(args)\n+        if tonumber(args.match) == floating_winnr and api.nvim_buf_is_valid(bufnr) then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1865843703",
            "id": 1865843703,
            "in_reply_to_id": 1862426387,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vNoP3",
            "original_commit_id": "8728ac84bba5e16302091ead063fcd398050c835",
            "original_line": 1628,
            "original_position": 16,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2472688230,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865843703/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-02T13:21:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1865843703",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1873002436"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1873002436"
                }
            },
            "author_association": "MEMBER",
            "body": "Another way to do this is to prefix the augroup with the module it was defined in. e.g. `vim.lsp.util.closing_floating_preview`.\r\n\r\nThis is what I've done in #31031",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-06T10:25:33Z",
            "diff_hunk": "@@ -1620,18 +1620,16 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1873002436",
            "id": 1873002436,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vo7_E",
            "original_commit_id": "4bda502014e5f3322e0f356c500004840d587d9f",
            "original_line": 1623,
            "original_position": 8,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2484299442,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1873002436/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-06T10:25:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1873002436",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1873007957"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1873007957"
                }
            },
            "author_association": "MEMBER",
            "body": "Okay, this will be clearer.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2024-12-06T10:29:59Z",
            "diff_hunk": "@@ -1620,18 +1620,16 @@ function M.open_floating_preview(contents, syntax, opts)\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n   end\n \n-  local augroup_name = ('closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim_closing_floating_preview'",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1873007957",
            "id": 1873007957,
            "in_reply_to_id": 1873002436,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5vo9VV",
            "original_commit_id": "4bda502014e5f3322e0f356c500004840d587d9f",
            "original_line": 1623,
            "original_position": 8,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": null,
            "pull_request_review_id": 2484308474,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1873007957/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-12-06T10:29:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1873007957",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1987253642"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987253642"
                }
            },
            "author_association": "MEMBER",
            "body": "is this check still needed , or can we just always recreate with `group = nvim_create_augroup(augroup_name, { clear = true })` ?",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2025-03-10T13:08:51Z",
            "diff_hunk": "@@ -1622,20 +1622,24 @@ function M.open_floating_preview(contents, syntax, opts)\n       api.nvim_win_set_var(floating_winnr, opts.focus_id, bufnr)\n     end\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n+    api.nvim_win_set_var(floating_winnr, 'lsp_floating_bufnr', bufnr)\n   end\n \n-  local augroup_name = ('nvim.closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim.closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1987253642",
            "id": 1987253642,
            "line": 1629,
            "node_id": "PRRC_kwDOAPphoM52cxWK",
            "original_commit_id": "3663640d64ac4d72824a2379e5d17938591ead5d",
            "original_line": 1629,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": 12,
            "pull_request_review_id": 2670899257,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987253642/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-03-10T13:08:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987253642",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1987274005"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987274005"
                }
            },
            "author_association": "MEMBER",
            "body": "It may still be needed. because we registered a global WinClosed, we only need to create it once when first open a floating preview window.  ",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2025-03-10T13:21:22Z",
            "diff_hunk": "@@ -1622,20 +1622,24 @@ function M.open_floating_preview(contents, syntax, opts)\n       api.nvim_win_set_var(floating_winnr, opts.focus_id, bufnr)\n     end\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n+    api.nvim_win_set_var(floating_winnr, 'lsp_floating_bufnr', bufnr)\n   end\n \n-  local augroup_name = ('nvim.closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim.closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1987274005",
            "id": 1987274005,
            "in_reply_to_id": 1987253642,
            "line": 1629,
            "node_id": "PRRC_kwDOAPphoM52c2UV",
            "original_commit_id": "3663640d64ac4d72824a2379e5d17938591ead5d",
            "original_line": 1629,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": 12,
            "pull_request_review_id": 2670936408,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987274005/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-03-10T13:21:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987274005",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/31353#discussion_r1987418695"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/31353"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987418695"
                }
            },
            "author_association": "MEMBER",
            "body": "But `clear = true` will clear the existing one, so what's the problem? It's worth the code simplification.",
            "commit_id": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
            "created_at": "2025-03-10T14:32:13Z",
            "diff_hunk": "@@ -1622,20 +1622,24 @@ function M.open_floating_preview(contents, syntax, opts)\n       api.nvim_win_set_var(floating_winnr, opts.focus_id, bufnr)\n     end\n     api.nvim_buf_set_var(bufnr, 'lsp_floating_preview', floating_winnr)\n+    api.nvim_win_set_var(floating_winnr, 'lsp_floating_bufnr', bufnr)\n   end\n \n-  local augroup_name = ('nvim.closing_floating_preview_%d'):format(floating_winnr)\n-  local ok =\n-    pcall(api.nvim_get_autocmds, { group = augroup_name, pattern = tostring(floating_winnr) })\n-  if not ok then\n+  local augroup_name = 'nvim.closing_floating_preview'\n+  if vim.fn.exists(('#%s'):format(augroup_name)) == 0 then",
            "html_url": "https://github.com/neovim/neovim/pull/31353#discussion_r1987418695",
            "id": 1987418695,
            "in_reply_to_id": 1987253642,
            "line": 1629,
            "node_id": "PRRC_kwDOAPphoM52dZpH",
            "original_commit_id": "3663640d64ac4d72824a2379e5d17938591ead5d",
            "original_line": 1629,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/util.lua",
            "position": 12,
            "pull_request_review_id": 2671194289,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987418695/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-03-10T14:32:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1987418695",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "MEMBER",
            "body": "What's the status of this? Note that we use \"dot\" instead of underscore for augroup/namespace names.",
            "created_at": "2025-03-10T11:20:05Z",
            "html_url": "https://github.com/neovim/neovim/pull/31353#issuecomment-2710249670",
            "id": 2710249670,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31353",
            "node_id": "IC_kwDOAPphoM6hiyDG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2710249670/reactions"
            },
            "updated_at": "2025-03-10T11:20:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2710249670",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "just updated a way which not use closure ",
            "created_at": "2025-03-10T13:02:03Z",
            "html_url": "https://github.com/neovim/neovim/pull/31353#issuecomment-2710526387",
            "id": 2710526387,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31353",
            "node_id": "IC_kwDOAPphoM6hj1mz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2710526387/reactions"
            },
            "updated_at": "2025-03-10T13:02:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2710526387",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "what is the updated problem/solution? the current pr title + description doesn't seem like the main problem that is being solved",
            "created_at": "2025-03-10T13:06:40Z",
            "html_url": "https://github.com/neovim/neovim/pull/31353#issuecomment-2710540154",
            "id": 2710540154,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31353",
            "node_id": "IC_kwDOAPphoM6hj496",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2710540154/reactions"
            },
            "updated_at": "2025-03-10T13:06:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2710540154",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31353/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/31353/commits",
    "created_at": "2024-11-26T06:17:08Z",
    "diff_url": "https://github.com/neovim/neovim/pull/31353.diff",
    "draft": false,
    "head": {
        "label": "glepnir:follow",
        "ref": "follow",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/glepnir/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/glepnir/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/glepnir/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/glepnir/neovim/branches{/branch}",
            "clone_url": "https://github.com/glepnir/neovim.git",
            "collaborators_url": "https://api.github.com/repos/glepnir/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/glepnir/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/glepnir/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/glepnir/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/glepnir/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/glepnir/neovim/contributors",
            "created_at": "2022-07-17T05:15:58Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/glepnir/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/glepnir/neovim/downloads",
            "events_url": "https://api.github.com/repos/glepnir/neovim/events",
            "fork": true,
            "forks": 1,
            "forks_count": 1,
            "forks_url": "https://api.github.com/repos/glepnir/neovim/forks",
            "full_name": "glepnir/neovim",
            "git_commits_url": "https://api.github.com/repos/glepnir/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/glepnir/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/glepnir/neovim/git/tags{/sha}",
            "git_url": "git://github.com/glepnir/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/glepnir/neovim/hooks",
            "html_url": "https://github.com/glepnir/neovim",
            "id": 514752985,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/glepnir/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/glepnir/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/glepnir/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/glepnir/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/glepnir/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/glepnir/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/glepnir/neovim/merges",
            "milestones_url": "https://api.github.com/repos/glepnir/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOHq6B2Q",
            "notifications_url": "https://api.github.com/repos/glepnir/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/glepnir/neovim/pulls{/number}",
            "pushed_at": "2025-03-10T13:19:09Z",
            "releases_url": "https://api.github.com/repos/glepnir/neovim/releases{/id}",
            "size": 307074,
            "ssh_url": "git@github.com:glepnir/neovim.git",
            "stargazers_count": 2,
            "stargazers_url": "https://api.github.com/repos/glepnir/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/glepnir/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/glepnir/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/glepnir/neovim/subscription",
            "svn_url": "https://github.com/glepnir/neovim",
            "tags_url": "https://api.github.com/repos/glepnir/neovim/tags",
            "teams_url": "https://api.github.com/repos/glepnir/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/glepnir/neovim/git/trees{/sha}",
            "updated_at": "2025-03-10T05:13:39Z",
            "url": "https://api.github.com/repos/glepnir/neovim",
            "visibility": "public",
            "watchers": 2,
            "watchers_count": 2,
            "web_commit_signoff_required": false
        },
        "sha": "a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
            "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
            "followers_url": "https://api.github.com/users/glepnir/followers",
            "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
            "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/glepnir",
            "id": 41671631,
            "login": "glepnir",
            "node_id": "MDQ6VXNlcjQxNjcxNjMx",
            "organizations_url": "https://api.github.com/users/glepnir/orgs",
            "received_events_url": "https://api.github.com/users/glepnir/received_events",
            "repos_url": "https://api.github.com/users/glepnir/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/glepnir",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/31353",
    "id": 2200095914,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31353",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "locked": false,
    "merge_commit_sha": "e5c7c59fdfebb8950c48513f8808259c43eb2b3c",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM6DIsyq",
    "number": 31353,
    "patch_url": "https://github.com/neovim/neovim/pull/31353.patch",
    "requested_reviewers": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
            "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
            "followers_url": "https://api.github.com/users/MariaSolOs/followers",
            "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
            "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/MariaSolOs",
            "id": 62502207,
            "login": "MariaSolOs",
            "node_id": "MDQ6VXNlcjYyNTAyMjA3",
            "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
            "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
            "repos_url": "https://api.github.com/users/MariaSolOs/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/MariaSolOs",
            "user_view_type": "public"
        }
    ],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/31353/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/a75c43f9235d30a4e57a9ffc4d86a0ad6871e155",
    "title": "fix(lsp): improve LSP floating preview window cleanup",
    "updated_at": "2025-03-10T23:04:49Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/31353",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
        "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
        "followers_url": "https://api.github.com/users/glepnir/followers",
        "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
        "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/glepnir",
        "id": 41671631,
        "login": "glepnir",
        "node_id": "MDQ6VXNlcjQxNjcxNjMx",
        "organizations_url": "https://api.github.com/users/glepnir/orgs",
        "received_events_url": "https://api.github.com/users/glepnir/received_events",
        "repos_url": "https://api.github.com/users/glepnir/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/glepnir",
        "user_view_type": "public"
    }
}
{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/37075/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37075/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/37075"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/37075"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37075/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/e1856b6f7cafcb7122b618220b955faa0cc2035b"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6498,
            "forks_count": 6498,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 2067,
            "open_issues_count": 2067,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-12-29T22:30:24Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 366094,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 95274,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-12-30T01:59:06Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 95274,
            "watchers_count": 95274,
            "web_commit_signoff_required": false
        },
        "sha": "a979a6237e6367373e88ab204bfa0f8c4725285a",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "Problem:\r\nAutomatic background detection sets the background option too late, which loads colorschemes twice and causes problems when the user's terminal background doesn't match the default (#32109, #36211, #36416).\r\n\r\nSolution:\r\nUse a DA1 query to determine whether the TTY supports OSC 11. Wait for background detection and setting to complete before processing user config.\r\n\r\nNote:\r\nI maintained the existing behavior as much as possible by triggering OptionSet manually on VimEnter (since it won't trigger automatically if we set the bg during startup). However, I'm unsure if this behavior is truly desired given that the documentation says OptionSet is triggered \"After setting an option (except during |startup|).\"\r\n\r\nThese changes also fix the flickering issue described in #28667. To check for the flickering, you can run `nvim --clean --cmd \"set termguicolors\" --cmd \"echo \\\"foo\\\"\" --cmd \"sleep 10\"`. On master, this gives me a black screen for 10 seconds, but on this branch, the background is dark or light depending on the terminal background (since the option is now set during startup rather than after VimEnter).",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643591630"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643591630"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n            return not bg_response_received\n```",
            "commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "created_at": "2025-12-23T15:44:54Z",
            "diff_hunk": "@@ -805,31 +805,50 @@ do\n       -- an OSC 11 response from the terminal emulator. If the user has set\n       -- 'background' explicitly then we will delete this autocommand,\n       -- effectively disabling automatic background setting.\n-      local force = false\n+      local bg_response_received = false\n+      local bg_detection_complete = false\n       local id = vim.api.nvim_create_autocmd('TermResponse', {\n         group = group,\n         nested = true,\n         desc = \"Update the value of 'background' automatically based on the terminal emulator's background color\",\n         callback = function(args)\n           local resp = args.data.sequence ---@type string\n+\n+          -- DA1 response that should come after the OSC 11 response if the\n+          -- terminal supports it.\n+          if string.match(resp, '^\\x1b%[%?.-c$') then\n+            bg_detection_complete = true\n+            if not bg_response_received then\n+              return true\n+            end\n+            return false",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643591630",
            "id": 2643591630,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dkgHO",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 824,
            "original_position": 21,
            "original_start_line": 821,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3608488321,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643591630/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-23T15:44:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643591630",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643594756"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643594756"
                }
            },
            "author_association": "MEMBER",
            "body": "`pcall` is a red flag, can a condition be checked instead?",
            "commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "created_at": "2025-12-23T15:46:09Z",
            "diff_hunk": "@@ -841,13 +860,25 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n-            vim.api.nvim_del_autocmd(id)\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local cmdline_sid = -3\n+          if optinfo.last_set_sid > 0 or optinfo.last_set_sid == cmdline_sid then\n+            pcall(function()\n+              vim.api.nvim_del_autocmd(id)",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643594756",
            "id": 2643594756,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dkg4E",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 867,
            "original_position": 71,
            "original_start_line": 866,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3608492114,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643594756/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-23T15:46:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643594756",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643598907"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643598907"
                }
            },
            "author_association": "MEMBER",
            "body": "```\ndid_bg_response\ndid_bg_detection\n```",
            "commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "created_at": "2025-12-23T15:48:02Z",
            "diff_hunk": "@@ -805,31 +805,50 @@ do\n       -- an OSC 11 response from the terminal emulator. If the user has set\n       -- 'background' explicitly then we will delete this autocommand,\n       -- effectively disabling automatic background setting.\n-      local force = false\n+      local bg_response_received = false\n+      local bg_detection_complete = false",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643598907",
            "id": 2643598907,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dkh47",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 809,
            "original_position": 6,
            "original_start_line": 808,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3608496968,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643598907/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-23T15:48:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643598907",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643670400"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643670400"
                }
            },
            "author_association": "MEMBER",
            "body": "We intentionally don't delete this autocommand today because we want to handle other OSC 11 responses that are triggered from theme change notifications. This PR would regress that feature (I guess we don't have a test for that or else the test should have failed).\r\n\r\n**EDIT:** Ah I see, but if we receive the DA1 response without ever having received an OSC 11 response then we know the terminal doesn't support it, in which case removing the autocommand is ok. So this is fine actually.",
            "commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "created_at": "2025-12-23T16:10:21Z",
            "diff_hunk": "@@ -805,31 +805,50 @@ do\n       -- an OSC 11 response from the terminal emulator. If the user has set\n       -- 'background' explicitly then we will delete this autocommand,\n       -- effectively disabling automatic background setting.\n-      local force = false\n+      local bg_response_received = false\n+      local bg_detection_complete = false\n       local id = vim.api.nvim_create_autocmd('TermResponse', {\n         group = group,\n         nested = true,\n         desc = \"Update the value of 'background' automatically based on the terminal emulator's background color\",\n         callback = function(args)\n           local resp = args.data.sequence ---@type string\n+\n+          -- DA1 response that should come after the OSC 11 response if the\n+          -- terminal supports it.\n+          if string.match(resp, '^\\x1b%[%?.-c$') then\n+            bg_detection_complete = true\n+            if not bg_response_received then\n+              return true\n+            end\n+            return false\n+          end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643670400",
            "id": 2643670400,
            "line": 828,
            "node_id": "PRRC_kwDOAPphoM6dkzWA",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 826,
            "original_position": 23,
            "original_start_line": 819,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3608571248,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643670400/reactions"
            },
            "side": "RIGHT",
            "start_line": 818,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-23T16:12:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643670400",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643676765"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643676765"
                }
            },
            "author_association": "MEMBER",
            "body": "Should probably also update `tui_query_bg_color` in `tui.c` to also emit DA1.",
            "commit_id": "e1856b6f7cafcb7122b618220b955faa0cc2035b",
            "created_at": "2025-12-23T16:12:48Z",
            "diff_hunk": "@@ -841,13 +860,25 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n-            vim.api.nvim_del_autocmd(id)\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local cmdline_sid = -3\n+          if optinfo.last_set_sid > 0 or optinfo.last_set_sid == cmdline_sid then\n+            pcall(function()\n+              vim.api.nvim_del_autocmd(id)\n+            end)\n           end\n         end,\n       })\n \n-      vim.api.nvim_ui_send('\\027]11;?\\007')\n+      -- Send OSC 11 query along with DA1 request to determine whether terminal\n+      -- supports the query. #32109\n+      vim.api.nvim_ui_send('\\027]11;?\\007\\027[c')",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643676765",
            "id": 2643676765,
            "line": 877,
            "node_id": "PRRC_kwDOAPphoM6dk05d",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 875,
            "original_position": 80,
            "original_start_line": null,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 79,
            "pull_request_review_id": 3608579237,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643676765/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-12-23T16:12:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643676765",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643687717"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643687717"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "But if we receive the DA1 response before the OSC 11 response, doesn't that mean the terminal doesn't support the OSC 11 query (or processes out of order)? The theme change notifications may still trigger the bg query, but those would still (presumably) receive no response, right?\r\n\r\nEDIT: saw your edit.",
            "commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "created_at": "2025-12-23T16:16:33Z",
            "diff_hunk": "@@ -805,31 +805,50 @@ do\n       -- an OSC 11 response from the terminal emulator. If the user has set\n       -- 'background' explicitly then we will delete this autocommand,\n       -- effectively disabling automatic background setting.\n-      local force = false\n+      local bg_response_received = false\n+      local bg_detection_complete = false\n       local id = vim.api.nvim_create_autocmd('TermResponse', {\n         group = group,\n         nested = true,\n         desc = \"Update the value of 'background' automatically based on the terminal emulator's background color\",\n         callback = function(args)\n           local resp = args.data.sequence ---@type string\n+\n+          -- DA1 response that should come after the OSC 11 response if the\n+          -- terminal supports it.\n+          if string.match(resp, '^\\x1b%[%?.-c$') then\n+            bg_detection_complete = true\n+            if not bg_response_received then\n+              return true\n+            end\n+            return false\n+          end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643687717",
            "id": 2643687717,
            "in_reply_to_id": 2643670400,
            "line": 828,
            "node_id": "PRRC_kwDOAPphoM6dk3kl",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 826,
            "original_position": 23,
            "original_start_line": 819,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3608592342,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643687717/reactions"
            },
            "side": "RIGHT",
            "start_line": 818,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-23T16:34:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643687717",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643703352"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643703352"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I'm not sure whether we need it for all the subsequent queries because the DA1 is intended to detect the feature support in the first place. By detecting feature support during startup, we can wait for the background response before proceeding with user scripts. I don't see how it helps in queries that are triggered by theme changes (where, if there is no support, the autocommand shouldn't trigger at all), but there could easily be something I'm missing.",
            "commit_id": "e1856b6f7cafcb7122b618220b955faa0cc2035b",
            "created_at": "2025-12-23T16:23:16Z",
            "diff_hunk": "@@ -841,13 +860,25 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n-            vim.api.nvim_del_autocmd(id)\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local cmdline_sid = -3\n+          if optinfo.last_set_sid > 0 or optinfo.last_set_sid == cmdline_sid then\n+            pcall(function()\n+              vim.api.nvim_del_autocmd(id)\n+            end)\n           end\n         end,\n       })\n \n-      vim.api.nvim_ui_send('\\027]11;?\\007')\n+      -- Send OSC 11 query along with DA1 request to determine whether terminal\n+      -- supports the query. #32109\n+      vim.api.nvim_ui_send('\\027]11;?\\007\\027[c')",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643703352",
            "id": 2643703352,
            "in_reply_to_id": 2643676765,
            "line": 877,
            "node_id": "PRRC_kwDOAPphoM6dk7Y4",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 875,
            "original_position": 80,
            "original_start_line": null,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 79,
            "pull_request_review_id": 3608612962,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643703352/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-12-23T16:23:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643703352",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643726124"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643726124"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Just updated it to check if we got a response to the background query instead. I also changed the condition on the SID because I realized there were other SIDs that should trigger deletion (namely `SID_CMDARG`).",
            "commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "created_at": "2025-12-23T16:31:58Z",
            "diff_hunk": "@@ -841,13 +860,25 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n-            vim.api.nvim_del_autocmd(id)\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local cmdline_sid = -3\n+          if optinfo.last_set_sid > 0 or optinfo.last_set_sid == cmdline_sid then\n+            pcall(function()\n+              vim.api.nvim_del_autocmd(id)",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643726124",
            "id": 2643726124,
            "in_reply_to_id": 2643594756,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dlA8s",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 867,
            "original_position": 71,
            "original_start_line": 866,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3608643210,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643726124/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-23T16:31:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643726124",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2643726329"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643726329"
                }
            },
            "author_association": "MEMBER",
            "body": "It's not strictly necessary, but it keeps things consistent and removes potential for confusion caused by differences in implementation (\"why does this query emit DA1 but this one does not?\")",
            "commit_id": "e1856b6f7cafcb7122b618220b955faa0cc2035b",
            "created_at": "2025-12-23T16:32:03Z",
            "diff_hunk": "@@ -841,13 +860,25 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n-            vim.api.nvim_del_autocmd(id)\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local cmdline_sid = -3\n+          if optinfo.last_set_sid > 0 or optinfo.last_set_sid == cmdline_sid then\n+            pcall(function()\n+              vim.api.nvim_del_autocmd(id)\n+            end)\n           end\n         end,\n       })\n \n-      vim.api.nvim_ui_send('\\027]11;?\\007')\n+      -- Send OSC 11 query along with DA1 request to determine whether terminal\n+      -- supports the query. #32109\n+      vim.api.nvim_ui_send('\\027]11;?\\007\\027[c')",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2643726329",
            "id": 2643726329,
            "in_reply_to_id": 2643676765,
            "line": 877,
            "node_id": "PRRC_kwDOAPphoM6dlA_5",
            "original_commit_id": "5b5557a31d223eb3c2a425a97033d8c1401fb774",
            "original_line": 875,
            "original_position": 80,
            "original_start_line": null,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 79,
            "pull_request_review_id": 3608643657,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643726329/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-12-23T16:32:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2643726329",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2646742876"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2646742876"
                }
            },
            "author_association": "MEMBER",
            "body": "`did_del_autocmd` seems to confuse things. We already have an autocmd `id` so we know whether than `id` was deleted. But then `did_del_autocmd` implies that some other aucmd id might be present that we don't want to delete?",
            "commit_id": "170d4b20e157abee683b1d79bc520505b7c32c84",
            "created_at": "2025-12-25T08:43:29Z",
            "diff_hunk": "@@ -841,13 +859,23 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local sid_lua = -8\n+          if not did_del_autocmd and optinfo.was_set and optinfo.last_set_sid ~= sid_lua then\n             vim.api.nvim_del_autocmd(id)",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2646742876",
            "id": 2646742876,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dwhdc",
            "original_commit_id": "170d4b20e157abee683b1d79bc520505b7c32c84",
            "original_line": 865,
            "original_position": 68,
            "original_start_line": 864,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3612025350,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2646742876/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-25T08:43:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2646742876",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2647217773"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647217773"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Yeah, I did overcomplicate that. I think I was led astray by one of the errors I saw on the Windows tests and thought that it would throw an error if it tried to delete the same autocmd more than once. That appears not to be the case, so I should be able to remove that condition entirely.",
            "commit_id": "170d4b20e157abee683b1d79bc520505b7c32c84",
            "created_at": "2025-12-25T18:57:46Z",
            "diff_hunk": "@@ -841,13 +859,23 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local sid_lua = -8\n+          if not did_del_autocmd and optinfo.was_set and optinfo.last_set_sid ~= sid_lua then\n             vim.api.nvim_del_autocmd(id)",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2647217773",
            "id": 2647217773,
            "in_reply_to_id": 2646742876,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dyVZt",
            "original_commit_id": "170d4b20e157abee683b1d79bc520505b7c32c84",
            "original_line": 865,
            "original_position": 68,
            "original_start_line": 864,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3612504423,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647217773/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-25T18:57:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647217773",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2647242469"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647242469"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Okay, apparently my logic not to delete the autocmd was there for good reason. If the autocmd deletes itself by returning true, then subsequent calls to `nvim_del_autocmd` will throw. Perhaps that's a separate bug; I don't know if that behavior is intended. I'll check the autocmd's existence more directly using `nvim_get_autocmds` to avoid the confusing logic.",
            "commit_id": "170d4b20e157abee683b1d79bc520505b7c32c84",
            "created_at": "2025-12-25T20:01:56Z",
            "diff_hunk": "@@ -841,13 +859,23 @@ do\n         nested = true,\n         once = true,\n         callback = function()\n-          if vim.api.nvim_get_option_info2('background', {}).was_set then\n+          local optinfo = vim.api.nvim_get_option_info2('background', {})\n+          local sid_lua = -8\n+          if not did_del_autocmd and optinfo.was_set and optinfo.last_set_sid ~= sid_lua then\n             vim.api.nvim_del_autocmd(id)",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2647242469",
            "id": 2647242469,
            "in_reply_to_id": 2646742876,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6dybbl",
            "original_commit_id": "170d4b20e157abee683b1d79bc520505b7c32c84",
            "original_line": 865,
            "original_position": 68,
            "original_start_line": 864,
            "path": "runtime/lua/vim/_defaults.lua",
            "position": 1,
            "pull_request_review_id": 3612519614,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647242469/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-25T20:10:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647242469",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/37075#discussion_r2647558325"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/37075"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647558325"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "On Windows only, this autocmd was causing some problems. As far as I could determine, it was setting `number` on the parent nvim while the child nvim was loading Ex mode and updating the colors. These simultaneous conditions caused the numbers to sometimes update to start at 2 rather than 1. That seems to me like a minor bug when it comes to computing the numbers, but it also seems to be wholly unrelated to the purpose of this test. As such, I updated the test to be slightly more deterministic in its timing by getting rid of the `TermOpen` autocmd and manually calling `set number`. This also gets rid of the \"Entering Ex Mode\" prompt.\r\n\r\nGiven that the set of conditions that was causing the failure seems unrealistic (because you'd have to open the terminal and start Ex mode simultaneously with that specific autocmd), I think it's okay to update the test like this. I couldn't think of a better way. The only alternative I could come up with is disabling the `vim.wait` for the bg detection in Ex mode, but updating the logic there just to make a test work felt counterproductive.",
            "commit_id": "e1856b6f7cafcb7122b618220b955faa0cc2035b",
            "created_at": "2025-12-26T05:15:17Z",
            "diff_hunk": "@@ -845,20 +845,26 @@ describe('buffer cursor position is correct in terminal with number column', fun\n     }, {\n       cols = 70,\n     })\n+    screen:expect([[\n+                                                                            |*4\n+      Entering Ex mode.  Type \"visual\" to go to Normal mode.                |\n+      :^                                                                     |\n+      {5:-- TERMINAL --}                                                        |\n+    ]])\n+    command('set number')\n     screen:expect([[\n       {121:  1 }                                                                  |\n       {121:  2 }                                                                  |\n       {121:  3 }                                                                  |\n       {121:  4 }                                                                  |\n-      {121:  5 }Entering Ex mode.  Type \"visual\" to go to Normal mode.            |\n+      {121:  5 }                                                                  |\n       {121:  6 }:^                                                                 |\n       {5:-- TERMINAL --}                                                        |\n     ]])\n   end\n \n   before_each(function()\n     clear()\n-    command('au TermOpen * set number')\n   end)",
            "html_url": "https://github.com/neovim/neovim/pull/37075#discussion_r2647558325",
            "id": 2647558325,
            "line": 868,
            "node_id": "PRRC_kwDOAPphoM6dzoi1",
            "original_commit_id": "83cf9e9bee6911636e9d12526a7b161a49496e19",
            "original_line": 868,
            "original_position": 26,
            "original_start_line": 848,
            "path": "test/functional/terminal/cursor_spec.lua",
            "position": 26,
            "pull_request_review_id": 3612781485,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647558325/reactions"
            },
            "side": "RIGHT",
            "start_line": 848,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-12-26T05:15:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2647558325",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "I'm not sure why the Windows and FreeBSD builds have some failing tests. Also not sure if you want me to add some tests for this, but I'm happy to do so. Will just take me some more time to figure out how it all works.\r\n\r\nP.S. I'm not sure how useful the test is for the flickering, given that the behavior still seemed to be present on master.\r\n\r\nEDIT: Who am I kidding? Of course I should add some tests. I'm working on that now.",
            "created_at": "2025-12-23T16:46:43Z",
            "html_url": "https://github.com/neovim/neovim/pull/37075#issuecomment-3687297132",
            "id": 3687297132,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37075",
            "node_id": "IC_kwDOAPphoM7bx7Bs",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3687297132/reactions"
            },
            "updated_at": "2025-12-23T19:56:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3687297132",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "As long as this change doesn't regress things, or fail existing (correct) tests, it is low risk. So I would suggest maybe only 1 test that tests the most important aspect(s), and only if it is reliable. Adding new tests that are unreliable and not super important is a poor tradeoff.",
            "created_at": "2025-12-25T08:46:59Z",
            "html_url": "https://github.com/neovim/neovim/pull/37075#issuecomment-3691165168",
            "id": 3691165168,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37075",
            "node_id": "IC_kwDOAPphoM7cArXw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691165168/reactions"
            },
            "updated_at": "2025-12-25T08:46:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691165168",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> As long as this change doesn't regress things, or fail existing (correct) tests, it is low risk. So I would suggest maybe only 1 test that tests the most important aspect(s), and only if it is reliable. Adding new tests that are unreliable and not super important is a poor tradeoff.\r\n\r\n@justinmk Okay, I'll cut it down to one, and then axe that if it doesn't seem reliable. I was mostly struggling with a couple existing tests (on Windows and FreeBSD). The `terminal/cursor_spec.lua` tests such as `buffer cursor position is correct in terminal with number column in a line with double-cell multibyte chars and no trailing spaces` became flaky on Windows with these changes. Somehow it occasionally messes up the line numbers:\r\n```\r\n ERROR    test/functional/terminal/cursor_spec.lua @ 1110: buffer cursor position is correct in terminal with number column in a line with double-cell multibyte chars and no trailing spaces, before_each\r\ntest/functional\\terminal\\cursor_spec.lua:848: Row 1 did not match.\r\nExpected:\r\n  |*{121:  1 }                                                                  |\r\n  |*{121:  2 }                                                                  |\r\n  |*{121:  3 }                                                                  |\r\n  |*{121:  4 }                                                                  |\r\n  |*{121:  5 }Entering Ex mode.  Type \"visual\" to go to Normal mode.            |\r\n  |*{121:  6 }:^                                                                 |\r\n  |{5:-- TERMINAL --}                                                        |\r\nActual:\r\n  |*{121:  2 }                                                                  |\r\n  |*{121:  3 }                                                                  |\r\n  |*{121:  4 }                                                                  |\r\n  |*{121:  5 }                                                                  |\r\n  |*{121:  6 }Entering Ex mode.  Type \"visual\" to go to Normal mode.            |\r\n  |*{121:  7 }:^                                                                 |\r\n  |{5:-- TERMINAL --}                                                        |\r\n  ```\r\nI know very little about the internals, so I'm struggling to figure out what's going wrong there. I've been troubleshooting that on another branch.\r\n\r\nThe FreeBSD build is also failing on an existing test, but I haven't had time to look at that yet:\r\n```\r\n[1m[35mFAILED  [0m[0m [36mtest/functional/terminal/tui_spec.lua[0m @ [36m3910[0m: [1mTUI bg color is properly set in a nested Nvim instance when background=light[0m\r\ntest/functional/terminal/tui_spec.lua:3925: retry() attempts: 464\r\ntest/functional/terminal/tui_spec.lua:3926: Expected objects to be the same.\r\nPassed in:\r\n(table: 0x017a330cd738) {\r\n  [1] = true\r\n *[2] = 'dark' }\r\nExpected:\r\n(table: 0x017a330cd6d8) {\r\n  [1] = true\r\n *[2] = 'light' }\r\n ```",
            "created_at": "2025-12-25T19:08:53Z",
            "html_url": "https://github.com/neovim/neovim/pull/37075#issuecomment-3691679763",
            "id": 3691679763,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37075",
            "node_id": "IC_kwDOAPphoM7cCpAT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691679763/reactions"
            },
            "updated_at": "2025-12-25T19:08:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691679763",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk Alright, I initially cut it down to one test, but that one was still mildly flaky on [Ubuntu arm](https://github.com/kylesower/neovim/actions/runs/20509907994/job/58929645062) when I ran it 100 times, so I cut that one too.",
            "created_at": "2025-12-25T19:50:04Z",
            "html_url": "https://github.com/neovim/neovim/pull/37075#issuecomment-3691701094",
            "id": 3691701094,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37075",
            "node_id": "IC_kwDOAPphoM7cCuNm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691701094/reactions"
            },
            "updated_at": "2025-12-25T19:50:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691701094",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk @gpanders There's a minor amount of flakiness in the current solution caused by `tui_query_kitty_keyboard` in `src/nvim/tui/tui.c`. \r\n```c\r\nstatic void tui_query_kitty_keyboard(TUIData *tui)\r\n  FUNC_ATTR_NONNULL_ALL\r\n{\r\n  // Set the key encoding whenever the Device Attributes (DA1) response is received.\r\n  tui->input.callbacks.primary_device_attr = tui_set_key_encoding;\r\n  out(tui, S_LEN(\"\\x1b[?u\\x1b[c\"));\r\n}\r\n```\r\nSince it's also making use of DA1 as a sentinel, there's a race condition with the TermResponse autocmd. If the kitty DA1 response comes after the TermResponse autocommand is created, then it gets handled by the autocmd and the `vim.wait()` completes before we actually get a response for the BG query. That's the reason for the FreeBSD failure that's still there.\r\n\r\nI can think of two solutions at present. The first solution is to send two DA1 requests with the BG query, then wait until we receive two DA1 responses. If we receive two, then there are two possibilities: one is from the kitty query and one is from the BG query, or both are from the BG query. The latter is what occurs in most cases since the TermResponse autocmd is typically created after the kitty DA1 response is already received/handled. I don't think we'll have the reverse problem where the DA1 response from the BG query comes before the kitty query response since the kitty query should be flushed during client initialization, so the kitty keyboard detection should still work with this solution. `runtime/plugin/osc52.lua` does use another DA1, but there it's actually using the DA1 response, so it shouldn't be an issue if it receives a leftover response from the BG query.\r\n\r\nThe second solution is to use a different sentinel query. I was thinking of a DSR `\\x1b[5n`, which should have a `\\x1b[0n` response. Currently, this is not sent as a TermResponse, but that's pretty easy to add in `src/nvim/tui/input.c`.\r\n\r\nI've tried both solutions, and both seem to work. What are your thoughts?\r\n\r\nEDIT: just to add, I think the only test where there's some remaining flakiness is the black flicker test: `has no black flicker when clearing regions during startup with termguicolors`. However, I'm not sure that there's much value in the test since the flicker still seemed to be present on master when I checked. Since I updated the code not to delete the autocmd, if we detect the kitty DA1 response first, it just means that the `vim.wait()` will finish before setting the bg, and the behavior is then similar to how it used to be, though perhaps less predictable when the bg is set.",
            "created_at": "2025-12-27T16:25:40Z",
            "html_url": "https://github.com/neovim/neovim/pull/37075#issuecomment-3694075561",
            "id": 3694075561,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37075",
            "node_id": "IC_kwDOAPphoM7cLx6p",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3694075561/reactions"
            },
            "updated_at": "2025-12-27T16:58:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3694075561",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37075/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/37075/commits",
    "created_at": "2025-12-22T20:49:13Z",
    "diff_url": "https://github.com/neovim/neovim/pull/37075.diff",
    "draft": true,
    "head": {
        "label": "kylesower:fix_bg_detection",
        "ref": "fix_bg_detection",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/kylesower/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/kylesower/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/kylesower/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/kylesower/neovim/branches{/branch}",
            "clone_url": "https://github.com/kylesower/neovim.git",
            "collaborators_url": "https://api.github.com/repos/kylesower/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/kylesower/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/kylesower/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/kylesower/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/kylesower/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/kylesower/neovim/contributors",
            "created_at": "2025-12-22T20:24:38Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/kylesower/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/kylesower/neovim/downloads",
            "events_url": "https://api.github.com/repos/kylesower/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/kylesower/neovim/forks",
            "full_name": "kylesower/neovim",
            "git_commits_url": "https://api.github.com/repos/kylesower/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/kylesower/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/kylesower/neovim/git/tags{/sha}",
            "git_url": "git://github.com/kylesower/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/kylesower/neovim/hooks",
            "html_url": "https://github.com/kylesower/neovim",
            "id": 1121334516,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/kylesower/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/kylesower/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/kylesower/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/kylesower/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/kylesower/neovim/labels{/name}",
            "language": null,
            "languages_url": "https://api.github.com/repos/kylesower/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/kylesower/neovim/merges",
            "milestones_url": "https://api.github.com/repos/kylesower/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOQtY09A",
            "notifications_url": "https://api.github.com/repos/kylesower/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
                "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
                "followers_url": "https://api.github.com/users/kylesower/followers",
                "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
                "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kylesower",
                "id": 50718101,
                "login": "kylesower",
                "node_id": "MDQ6VXNlcjUwNzE4MTAx",
                "organizations_url": "https://api.github.com/users/kylesower/orgs",
                "received_events_url": "https://api.github.com/users/kylesower/received_events",
                "repos_url": "https://api.github.com/users/kylesower/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kylesower",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/kylesower/neovim/pulls{/number}",
            "pushed_at": "2025-12-29T14:47:39Z",
            "releases_url": "https://api.github.com/repos/kylesower/neovim/releases{/id}",
            "size": 352249,
            "ssh_url": "git@github.com:kylesower/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/kylesower/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/kylesower/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/kylesower/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/kylesower/neovim/subscription",
            "svn_url": "https://github.com/kylesower/neovim",
            "tags_url": "https://api.github.com/repos/kylesower/neovim/tags",
            "teams_url": "https://api.github.com/repos/kylesower/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/kylesower/neovim/git/trees{/sha}",
            "updated_at": "2025-12-22T20:24:38Z",
            "url": "https://api.github.com/repos/kylesower/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "e1856b6f7cafcb7122b618220b955faa0cc2035b",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
            "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
            "followers_url": "https://api.github.com/users/kylesower/followers",
            "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
            "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/kylesower",
            "id": 50718101,
            "login": "kylesower",
            "node_id": "MDQ6VXNlcjUwNzE4MTAx",
            "organizations_url": "https://api.github.com/users/kylesower/orgs",
            "received_events_url": "https://api.github.com/users/kylesower/received_events",
            "repos_url": "https://api.github.com/users/kylesower/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/kylesower",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/37075",
    "id": 3124166189,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37075",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim defaults for options, colorscheme/theme, autocmds/events, etc.",
            "id": 103777064,
            "name": "defaults",
            "node_id": "MDU6TGFiZWwxMDM3NzcwNjQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/defaults"
        }
    ],
    "locked": false,
    "merge_commit_sha": "5522f119fe35c76c2e299467f20ffe5e7d68dd05",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM66Nv4t",
    "number": 37075,
    "patch_url": "https://github.com/neovim/neovim/pull/37075.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/37075/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/e1856b6f7cafcb7122b618220b955faa0cc2035b",
    "title": "fix(startup): Wait for bg detection before processing user scripts",
    "updated_at": "2025-12-27T16:58:26Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/37075",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/50718101?v=4",
        "events_url": "https://api.github.com/users/kylesower/events{/privacy}",
        "followers_url": "https://api.github.com/users/kylesower/followers",
        "following_url": "https://api.github.com/users/kylesower/following{/other_user}",
        "gists_url": "https://api.github.com/users/kylesower/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kylesower",
        "id": 50718101,
        "login": "kylesower",
        "node_id": "MDQ6VXNlcjUwNzE4MTAx",
        "organizations_url": "https://api.github.com/users/kylesower/orgs",
        "received_events_url": "https://api.github.com/users/kylesower/received_events",
        "repos_url": "https://api.github.com/users/kylesower/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kylesower/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kylesower/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kylesower",
        "user_view_type": "public"
    }
}
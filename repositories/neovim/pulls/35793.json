{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/35793/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/35793/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/35793"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/35793"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/35793/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6343,
            "forks_count": 6343,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1996,
            "open_issues_count": 1996,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-09-30T01:54:02Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 344511,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 93098,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-09-30T01:54:08Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 93098,
            "watchers_count": 93098,
            "web_commit_signoff_required": false
        },
        "sha": "b256e0476bdb353437a07b7bc05a1cd176b077d5",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "<!--\r\n  Thank you for contributing to Neovim!\r\n  If this is your first time, check out https://github.com/neovim/neovim/blob/master/CONTRIBUTING.md#pull-requests-prs\r\n  for our PR guidelines.\r\n-->\r\n\r\nFixes #27896, fixes #35366.\r\n\r\nReplaces my work in #34285.\r\n\r\nIn action:\r\n\r\n\r\n\r\nhttps://github.com/user-attachments/assets/ff88ca53-0f6e-46c6-922f-fa176048bc8a\r\n\r\n\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2351551344"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351551344"
                }
            },
            "author_association": "MEMBER",
            "body": "This isn't called anywhere.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-16T08:53:41Z",
            "diff_hunk": "@@ -2596,6 +2609,20 @@ static void vimresume_event(void **argv)\n   pending_vimresume = kFalse;\n }\n \n+/// Initialize the safe autocommand event queue.\n+void autocmd_init(void)\n+{\n+  safe_autocmd_events = multiqueue_new_child(main_loop.events);\n+}\n+\n+#ifdef EXITFREE\n+void autocmd_free_all_mem(void)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2351551344",
            "id": 2351551344,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6MKdNw",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 2626,
            "original_position": 38,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3228504491,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351551344/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-16T09:15:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351551344",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6256228?v=4",
                "events_url": "https://api.github.com/users/seandewar/events{/privacy}",
                "followers_url": "https://api.github.com/users/seandewar/followers",
                "following_url": "https://api.github.com/users/seandewar/following{/other_user}",
                "gists_url": "https://api.github.com/users/seandewar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seandewar",
                "id": 6256228,
                "login": "seandewar",
                "node_id": "MDQ6VXNlcjYyNTYyMjg=",
                "organizations_url": "https://api.github.com/users/seandewar/orgs",
                "received_events_url": "https://api.github.com/users/seandewar/received_events",
                "repos_url": "https://api.github.com/users/seandewar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seandewar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seandewar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seandewar",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2351579369"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351579369"
                }
            },
            "author_association": "MEMBER",
            "body": "Never take `buf_T` by value, it can cause all sorts of problems. `apply_autocmds` takes it by pointer anyway.\r\n\r\nHowever, both approaches are wrong here because autocommands may free the buffer and invalidate pointers. [Take it by handle instead](https://github.com/neovim/neovim/issues/35366#issuecomment-3226437401) and use that handle to retrieve the `buf_T *` if it's valid (e.g: `find_buffer_by_handle`). If invalid, don't fire the event (maybe for some events it'll make sense to fallback to `curbuf` in that case; something to consider for later).",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-16T09:01:30Z",
            "diff_hunk": "@@ -64,3 +64,10 @@ struct AutoPatCmd_S {\n };\n \n typedef kvec_t(AutoCmd) AutoCmdVec;\n+\n+typedef struct {\n+  event_T event;\n+  char *fname;\n+  char *fname_io;\n+  buf_T buf;",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2351579369",
            "id": 2351579369,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6MKkDp",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 72,
            "original_position": 9,
            "original_start_line": null,
            "path": "src/nvim/autocmd_defs.h",
            "position": 1,
            "pull_request_review_id": 3228504491,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351579369/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-16T09:32:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351579369",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6256228?v=4",
                "events_url": "https://api.github.com/users/seandewar/events{/privacy}",
                "followers_url": "https://api.github.com/users/seandewar/followers",
                "following_url": "https://api.github.com/users/seandewar/following{/other_user}",
                "gists_url": "https://api.github.com/users/seandewar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seandewar",
                "id": 6256228,
                "login": "seandewar",
                "node_id": "MDQ6VXNlcjYyNTYyMjg=",
                "organizations_url": "https://api.github.com/users/seandewar/orgs",
                "received_events_url": "https://api.github.com/users/seandewar/received_events",
                "repos_url": "https://api.github.com/users/seandewar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seandewar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seandewar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seandewar",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2351623441"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351623441"
                }
            },
            "author_association": "MEMBER",
            "body": "Not much use to push here (unless it's to maintain the event order if more are pushed while processing the queue, but in that case `SafeState` should always just trigger for whatever `curbuf` is at that point, not what it was when it was enqueued).\r\n\r\nCan just process the queue and fire `SafeState` via `apply_autocmds` after (or maybe it's better to do so before?) for whatever `curbuf` happens to be.\r\n\r\nPresumably the queue will be processed in more places? [Doing it here is too limited](https://github.com/neovim/neovim/pull/34285#issuecomment-3194653155).",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-16T09:14:35Z",
            "diff_hunk": "@@ -305,7 +305,13 @@ void may_trigger_safestate(bool safe)\n     DLOG(is_safe ? \"SafeState: Start triggering\" : \"SafeState: Stop triggering\");\n   }\n   if (is_safe) {\n-    apply_autocmds(EVENT_SAFESTATE, NULL, NULL, false, curbuf);\n+    SafeAutocommandEvent *evdata = xmalloc(sizeof(SafeAutocommandEvent));\n+    evdata->event = EVENT_SAFESTATE;\n+    evdata->fname = NULL;\n+    evdata->fname_io = NULL;\n+    evdata->buf = *curbuf;\n+    multiqueue_put(safe_autocmd_events, safe_autocmd_event, evdata);\n+    multiqueue_process_events(safe_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2351623441",
            "id": 2351623441,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6MKu0R",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 314,
            "original_position": 11,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3228504491,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351623441/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-16T21:45:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2351623441",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6256228?v=4",
                "events_url": "https://api.github.com/users/seandewar/events{/privacy}",
                "followers_url": "https://api.github.com/users/seandewar/followers",
                "following_url": "https://api.github.com/users/seandewar/following{/other_user}",
                "gists_url": "https://api.github.com/users/seandewar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seandewar",
                "id": 6256228,
                "login": "seandewar",
                "node_id": "MDQ6VXNlcjYyNTYyMjg=",
                "organizations_url": "https://api.github.com/users/seandewar/orgs",
                "received_events_url": "https://api.github.com/users/seandewar/received_events",
                "repos_url": "https://api.github.com/users/seandewar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seandewar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seandewar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seandewar",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2353279110"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2353279110"
                }
            },
            "author_association": "MEMBER",
            "body": "we shouldn't need a pointer anyway, just the buf number (aka \"handle\")?",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-16T18:09:35Z",
            "diff_hunk": "@@ -64,3 +64,10 @@ struct AutoPatCmd_S {\n };\n \n typedef kvec_t(AutoCmd) AutoCmdVec;\n+\n+typedef struct {\n+  event_T event;\n+  char *fname;\n+  char *fname_io;\n+  buf_T buf;",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2353279110",
            "id": 2353279110,
            "in_reply_to_id": 2351579369,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6MRDCG",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 72,
            "original_position": 9,
            "original_start_line": null,
            "path": "src/nvim/autocmd_defs.h",
            "position": 1,
            "pull_request_review_id": 3231146084,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2353279110/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-16T18:09:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2353279110",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2353310597"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2353310597"
                }
            },
            "author_association": "MEMBER",
            "body": "Ya, that's my suggestion :grin: (but `apply_autocmds` eventually takes a `buf_T *`)",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-16T18:24:29Z",
            "diff_hunk": "@@ -64,3 +64,10 @@ struct AutoPatCmd_S {\n };\n \n typedef kvec_t(AutoCmd) AutoCmdVec;\n+\n+typedef struct {\n+  event_T event;\n+  char *fname;\n+  char *fname_io;\n+  buf_T buf;",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2353310597",
            "id": 2353310597,
            "in_reply_to_id": 2351579369,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6MRKuF",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 72,
            "original_position": 9,
            "original_start_line": null,
            "path": "src/nvim/autocmd_defs.h",
            "position": 1,
            "pull_request_review_id": 3231190444,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 1,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2353310597/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-16T18:25:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2353310597",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6256228?v=4",
                "events_url": "https://api.github.com/users/seandewar/events{/privacy}",
                "followers_url": "https://api.github.com/users/seandewar/followers",
                "following_url": "https://api.github.com/users/seandewar/following{/other_user}",
                "gists_url": "https://api.github.com/users/seandewar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seandewar",
                "id": 6256228,
                "login": "seandewar",
                "node_id": "MDQ6VXNlcjYyNTYyMjg=",
                "organizations_url": "https://api.github.com/users/seandewar/orgs",
                "received_events_url": "https://api.github.com/users/seandewar/received_events",
                "repos_url": "https://api.github.com/users/seandewar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seandewar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seandewar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seandewar",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2365877218"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365877218"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the callout. Missed the spot in memory.c where we free all the queues.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T00:11:19Z",
            "diff_hunk": "@@ -2596,6 +2609,20 @@ static void vimresume_event(void **argv)\n   pending_vimresume = kFalse;\n }\n \n+/// Initialize the safe autocommand event queue.\n+void autocmd_init(void)\n+{\n+  safe_autocmd_events = multiqueue_new_child(main_loop.events);\n+}\n+\n+#ifdef EXITFREE\n+void autocmd_free_all_mem(void)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2365877218",
            "id": 2365877218,
            "in_reply_to_id": 2351551344,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBGvi",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 2626,
            "original_position": 38,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3249319721,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365877218/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T00:27:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365877218",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2365880606"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365880606"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Ah, `find_buffer_by_handle` was what I was missing! Thanks for the pointer @seandewar",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T00:28:13Z",
            "diff_hunk": "@@ -64,3 +64,10 @@ struct AutoPatCmd_S {\n };\n \n typedef kvec_t(AutoCmd) AutoCmdVec;\n+\n+typedef struct {\n+  event_T event;\n+  char *fname;\n+  char *fname_io;\n+  buf_T buf;",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2365880606",
            "id": 2365880606,
            "in_reply_to_id": 2351579369,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBHke",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 72,
            "original_position": 9,
            "original_start_line": null,
            "path": "src/nvim/autocmd_defs.h",
            "position": 1,
            "pull_request_review_id": 3249322438,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365880606/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T00:28:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365880606",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2365881474"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365881474"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "My intention was for SafeState to be an example of this new queuing style. Agreed that it's a bit of a contrived example. \r\n\r\nI went ahead and implemented `MarkSet` with the queue. Let me know what you think.\r\n\r\n> Presumably the queue will be processed in more places?\r\n\r\nMy understanding was that SafeState will be a [temporary location](https://github.com/neovim/neovim/issues/35366#issuecomment-3207188338) until we find a more permanent home. I'll defer to @justinmk on that though.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T00:33:32Z",
            "diff_hunk": "@@ -305,7 +305,13 @@ void may_trigger_safestate(bool safe)\n     DLOG(is_safe ? \"SafeState: Start triggering\" : \"SafeState: Stop triggering\");\n   }\n   if (is_safe) {\n-    apply_autocmds(EVENT_SAFESTATE, NULL, NULL, false, curbuf);\n+    SafeAutocommandEvent *evdata = xmalloc(sizeof(SafeAutocommandEvent));\n+    evdata->event = EVENT_SAFESTATE;\n+    evdata->fname = NULL;\n+    evdata->fname_io = NULL;\n+    evdata->buf = *curbuf;\n+    multiqueue_put(safe_autocmd_events, safe_autocmd_event, evdata);\n+    multiqueue_process_events(safe_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2365881474",
            "id": 2365881474,
            "in_reply_to_id": 2351623441,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBHyC",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 314,
            "original_position": 11,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3249323261,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365881474/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T06:45:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365881474",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2365985588"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365985588"
                }
            },
            "author_association": "MEMBER",
            "body": "\nI guess `state_handle_k_event` would be the other \"obvious\" place.\n\n> Presumably the queue will be processed in more places? [Doing it here is too limited](https://github.com/neovim/neovim/pull/34285#issuecomment-3194653155).\n\np.s. reading the doc for SafeState, it sounds like CursorHold with a \"0ms\" timeout. I wonder why another event was added instead.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T06:55:29Z",
            "diff_hunk": "@@ -305,7 +305,13 @@ void may_trigger_safestate(bool safe)\n     DLOG(is_safe ? \"SafeState: Start triggering\" : \"SafeState: Stop triggering\");\n   }\n   if (is_safe) {\n-    apply_autocmds(EVENT_SAFESTATE, NULL, NULL, false, curbuf);\n+    SafeAutocommandEvent *evdata = xmalloc(sizeof(SafeAutocommandEvent));\n+    evdata->event = EVENT_SAFESTATE;\n+    evdata->fname = NULL;\n+    evdata->fname_io = NULL;\n+    evdata->buf = *curbuf;\n+    multiqueue_put(safe_autocmd_events, safe_autocmd_event, evdata);\n+    multiqueue_process_events(safe_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2365985588",
            "id": 2365985588,
            "in_reply_to_id": 2351623441,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBhM0",
            "original_commit_id": "24862f83d254465a7adf01c3e37cf4cefac30722",
            "original_line": 314,
            "original_position": 11,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3249436411,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365985588/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T06:55:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2365985588",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366003236"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366003236"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n• |MarkSet| is triggered after a |mark| is set.\n```",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T07:07:46Z",
            "diff_hunk": "@@ -203,6 +203,7 @@ EVENTS\n • New `msg_id` paremeter for |ui-messages| `msg_show` event.\n • 'rulerformat' is emitted as `msg_ruler` when not part of the statusline.\n • Creating or updating a progress message with |nvim_echo()| triggers a |Progress| event.\n+• |MarkSet| triggered after a |mark| is set.",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366003236",
            "id": 2366003236,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBlgk",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 206,
            "original_position": 4,
            "original_start_line": null,
            "path": "runtime/doc/news.txt",
            "position": 1,
            "pull_request_review_id": 3249474220,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366003236/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T07:07:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366003236",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366004274"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366004274"
                }
            },
            "author_association": "MEMBER",
            "body": "alphanum order",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T07:08:31Z",
            "diff_hunk": "@@ -82,6 +82,7 @@ return {\n     LspRequest = false, -- after an LSP request is started, canceled, or completed\n     LspTokenUpdate = false, -- after a visible LSP token is updated\n     MenuPopup = false, -- just before popup menu is displayed\n+    MarkSet = false, -- after a mark is set",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366004274",
            "id": 2366004274,
            "line": 84,
            "node_id": "PRRC_kwDOAPphoM6NBlwy",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 84,
            "original_position": 4,
            "original_start_line": 84,
            "path": "src/nvim/auevents.lua",
            "position": 1,
            "pull_request_review_id": 3249476672,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366004274/reactions"
            },
            "side": "RIGHT",
            "start_line": 84,
            "start_side": "LEFT",
            "subject_type": "line",
            "updated_at": "2025-09-21T07:08:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366004274",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366006290"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366006290"
                }
            },
            "author_association": "MEMBER",
            "body": "let's drop mentioning \"safe\" (everywhere in this PR), it's confusing given the existence of SafeState. and it's not really necessary.\n\n```suggestion\nvoid aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf,\n```",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T07:09:38Z",
            "diff_hunk": "@@ -1493,6 +1494,60 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Put a safe autocommand event on the queue, to be triggered at a safe time.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void queue_safe_autocommand(event_T event, char *fname, char *fname_io, int group, buf_T *buf,",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366006290",
            "id": 2366006290,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBmQS",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 1506,
            "original_position": 21,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3249482023,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366006290/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T07:15:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366006290",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366008482"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366008482"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n/// Schedules an autocommand event, to be executed at the next event-loop tick.\n```",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T07:11:11Z",
            "diff_hunk": "@@ -1493,6 +1494,60 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Put a safe autocommand event on the queue, to be triggered at a safe time.",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366008482",
            "id": 2366008482,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBmyi",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 1497,
            "original_position": 12,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3249487516,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366008482/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T07:15:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366008482",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366009827"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366009827"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n  DeferredEvent *evdata = xmalloc(sizeof(DeferredEvent));\n```",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T07:12:05Z",
            "diff_hunk": "@@ -1493,6 +1494,60 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Put a safe autocommand event on the queue, to be triggered at a safe time.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void queue_safe_autocommand(event_T event, char *fname, char *fname_io, int group, buf_T *buf,\n+                            exarg_T *eap, Object *data)\n+{\n+  SafeAutocommandEvent *evdata = xmalloc(sizeof(SafeAutocommandEvent));",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366009827",
            "id": 2366009827,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBnHj",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 1509,
            "original_position": 24,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3249490762,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366009827/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T07:12:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366009827",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366017757"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366017757"
                }
            },
            "author_association": "MEMBER",
            "body": "should be done as early as possible. looks like it depends on multique and the event-loop, so just after that. i guess line 156.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T07:18:08Z",
            "diff_hunk": "@@ -159,6 +159,7 @@ void event_init(void)\n   channel_init();\n   terminal_init();\n   ui_init();\n+  autocmd_init();",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366017757",
            "id": 2366017757,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NBpDd",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 162,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/main.c",
            "position": 1,
            "pull_request_review_id": 3249512739,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366017757/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T07:18:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366017757",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366073927"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366073927"
                }
            },
            "author_association": "MEMBER",
            "body": "should be skipped if there are no MarkSet commands (`!has_event(EVENT_MARKSET)`).\n\noff topic: other things like `do_autocmd_progress` should also do that... https://github.com/neovim/neovim/pull/35871\n",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-21T08:06:38Z",
            "diff_hunk": "@@ -87,6 +89,22 @@ void clear_fmark(fmark_T *const fm, const Timestamp timestamp)\n   fm->timestamp = timestamp;\n }\n \n+/// Execute \"MarkSet\" autocommand.\n+///\n+/// @param c The name of the mark, e.g., 'a'.\n+/// @param pos Position of the mark in the buffer.\n+/// @param buf The buffer of the mark.\n+static void do_markset_autocmd(char c, pos_T *pos, buf_T *buf)\n+{\n+  MAXSIZE_TEMP_DICT(data, 3);\n+  char mark_str[2] = { c, '\\0' };\n+  PUT_C(data, \"mark\", STRING_OBJ(((String){ .data = mark_str, .size = 1 })));\n+  PUT_C(data, \"line\", INTEGER_OBJ(pos->lnum));\n+  PUT_C(data, \"col\", INTEGER_OBJ(pos->col));",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366073927",
            "id": 2366073927,
            "line": 107,
            "node_id": "PRRC_kwDOAPphoM6NB2xH",
            "original_commit_id": "7f0e149dcc1608f9cbb698043a7080c6f1f47473",
            "original_line": 107,
            "original_position": 25,
            "original_start_line": 99,
            "path": "src/nvim/mark.c",
            "position": 29,
            "pull_request_review_id": 3249702100,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366073927/reactions"
            },
            "side": "RIGHT",
            "start_line": 103,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-09-22T01:14:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366073927",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366400713"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366400713"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk let me know if you were thinking of a different spot to process events in `state_handle_k_event`.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T21:26:37Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366400713",
            "id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NDGjJ",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250167200,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366400713/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T21:38:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366400713",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366442596"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366442596"
                }
            },
            "author_association": "MEMBER",
            "body": "I don't think this makes sense. `deferred_autocmd_events` is already a child queue of `main_loop.events`, so `deferred_autocmd_events` is already empty when `main_loop.events` is empty.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-21T23:35:11Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366442596",
            "id": 2366442596,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NDQxk",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250206769,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366442596/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-21T23:35:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366442596",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366474261"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366474261"
                }
            },
            "author_association": "MEMBER",
            "body": "can drop this comment.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T00:43:32Z",
            "diff_hunk": "@@ -2596,6 +2650,19 @@ static void vimresume_event(void **argv)\n   pending_vimresume = kFalse;\n }\n \n+/// Initialize the safe autocommand event queue.",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366474261",
            "id": 2366474261,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NDYgV",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 2653,
            "original_position": 72,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3250242815,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366474261/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T00:43:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366474261",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366494937"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366494937"
                }
            },
            "author_association": "MEMBER",
            "body": "any reason not to do it just before the `os_breakcheck` (below)?\n\nside-note, now I'm wondering if `aucmd_defer` should just add directly to `main_loop.events`, maybe a separate queue isn't needed? just something to keep in mind (and is a 1-line change to try it).",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T01:18:34Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366494937",
            "id": 2366494937,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NDdjZ",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250266359,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366494937/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T01:19:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366494937",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366497201"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366497201"
                }
            },
            "author_association": "MEMBER",
            "body": "I think there is another problem. `K_EVENT` is only processed when there is no pending input, which means when executing a macro `MarkSet` autocommands are postponed after the end of the macro. I'm not sure if this is desired for `MarkSet`, but it's possible for some other autocommands this is not desired.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T01:21:48Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366497201",
            "id": 2366497201,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NDeGx",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250268784,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366497201/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T01:23:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366497201",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366497467"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366497467"
                }
            },
            "author_association": "MEMBER",
            "body": "so far the tests are working? that is cool.\n\ntry adding a test that does insane things in the `MarkSet`, such as\n\n- `:bwipeout!` on its buffer\n- switches windows\n- switches tabpage\n\nand then the test accesses/asserts the `data` and other event state. ",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-22T01:22:11Z",
            "diff_hunk": "@@ -0,0 +1,49 @@\n+local t = require('test.testutil')\n+local n = require('test.functional.testnvim')()\n+\n+local api = n.api\n+local clear = n.clear\n+local command = n.command\n+local feed = n.feed\n+local poke_eventloop = n.poke_eventloop\n+local eval = n.eval\n+\n+local eq = t.eq\n+\n+describe('MarkSet', function()",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366497467",
            "id": 2366497467,
            "line": 23,
            "node_id": "PRRC_kwDOAPphoM6NDeK7",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 23,
            "original_position": 13,
            "original_start_line": null,
            "path": "test/functional/autocmd/markset_spec.lua",
            "position": 23,
            "pull_request_review_id": 3250269071,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366497467/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T01:23:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366497467",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366502657"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366502657"
                }
            },
            "author_association": "MEMBER",
            "body": "we can deal with that by processing the queue in multiple places, right?\r\n\r\nalternatively, queuing into `main_loop.events` would also address that?",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T01:29:56Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366502657",
            "id": 2366502657,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NDfcB",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250275149,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366502657/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T01:29:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366502657",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366799670"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366799670"
                }
            },
            "author_association": "MEMBER",
            "body": "> we can deal with that by processing the queue in multiple places, right?\r\n\r\nYes.\r\n\r\n> alternatively, queuing into `main_loop.events` would also address that?\r\n\r\nNo.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T05:57:38Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366799670",
            "id": 2366799670,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEn82",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250714429,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366799670/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T05:57:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366799670",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366803269"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366803269"
                }
            },
            "author_association": "MEMBER",
            "body": "nit: place near top, before `augroup_map_del` \n\nthough maybe this won't be needed if main_loop.events turns out to be best",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T06:00:13Z",
            "diff_hunk": "@@ -2596,6 +2671,18 @@ static void vimresume_event(void **argv)\n   pending_vimresume = kFalse;\n }\n \n+void autocmd_init(void)\n+{\n+  deferred_autocmd_events = multiqueue_new_child(main_loop.events);\n+}\n+\n+#ifdef EXITFREE\n+void autocmd_free_all_mem(void)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366803269",
            "id": 2366803269,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEo1F",
            "original_commit_id": "645970c2858fc7abfc7834e6b535197df2fbed7c",
            "original_line": 2679,
            "original_position": 125,
            "original_start_line": 2674,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3250718944,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366803269/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-09-22T06:00:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366803269",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366804639"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366804639"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Let me know if there's a better way to do this. This was required to get `v:event` working in the test.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T06:01:11Z",
            "diff_hunk": "@@ -1843,8 +1900,23 @@ bool apply_autocmds_group(event_T event, char *fname, char *fname_io, bool force\n     patcmd.next = active_apc_list;\n     active_apc_list = &patcmd;\n \n-    // Attach data to command\n-    patcmd.data = data;\n+    // set v:event with event data (if any)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366804639",
            "id": 2366804639,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEpKf",
            "original_commit_id": "645970c2858fc7abfc7834e6b535197df2fbed7c",
            "original_line": 1914,
            "original_position": 85,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3250720657,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366804639/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:07:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366804639",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366816809"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366816809"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Both queues work in my testing. (See both `test/functional/autocmd/markset_spec.lua` and the video above.)\r\n\r\nCurrent approach keeps the `deferred_autocmd_events` queue but let me know if I should replace it with `main_loop.events`.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T06:09:47Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366816809",
            "id": 2366816809,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEsIp",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250738169,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366816809/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:09:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366816809",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366829750"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366829750"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Weirdly, we don't need to process our events at all? My testing works fine without it. Is this because `state_handle_k_event` processes all events in the main loop until empty, including children loops?",
            "commit_id": "a4b7852034f6b15d286bd0475dcc7009a35e31f6",
            "created_at": "2025-09-22T06:18:31Z",
            "diff_hunk": "@@ -124,6 +124,8 @@ void state_handle_k_event(void)\n       return;\n     }\n \n+    // multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366829750",
            "id": 2366829750,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEvS2",
            "original_commit_id": "4e2d93aaf2d2d17c19bd7581e4b57092b708661c",
            "original_line": 127,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250755406,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366829750/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:21:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366829750",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366835917"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366835917"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Note: the feature works event without any explicit queue processing: https://github.com/neovim/neovim/pull/35793#discussion_r2366829750",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T06:22:24Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366835917",
            "id": 2366835917,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEwzN",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250763429,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366835917/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:22:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366835917",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366843635"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366843635"
                }
            },
            "author_association": "MEMBER",
            "body": "This affects `nvim_exec_autocmds` as well, so it should be documented at `:h nvim_exec_autocmds()`",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T06:25:42Z",
            "diff_hunk": "@@ -1843,8 +1900,23 @@ bool apply_autocmds_group(event_T event, char *fname, char *fname_io, bool force\n     patcmd.next = active_apc_list;\n     active_apc_list = &patcmd;\n \n-    // Attach data to command\n-    patcmd.data = data;\n+    // set v:event with event data (if any)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366843635",
            "id": 2366843635,
            "in_reply_to_id": 2366804639,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEyrz",
            "original_commit_id": "645970c2858fc7abfc7834e6b535197df2fbed7c",
            "original_line": 1914,
            "original_position": 85,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3250774113,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366843635/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:26:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366843635",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366844904"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366844904"
                }
            },
            "author_association": "MEMBER",
            "body": "Yes",
            "commit_id": "a4b7852034f6b15d286bd0475dcc7009a35e31f6",
            "created_at": "2025-09-22T06:26:10Z",
            "diff_hunk": "@@ -124,6 +124,8 @@ void state_handle_k_event(void)\n       return;\n     }\n \n+    // multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366844904",
            "id": 2366844904,
            "in_reply_to_id": 2366829750,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NEy_o",
            "original_commit_id": "4e2d93aaf2d2d17c19bd7581e4b57092b708661c",
            "original_line": 127,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3250776348,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366844904/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:26:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366844904",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2366856393"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366856393"
                }
            },
            "author_association": "MEMBER",
            "body": "this is definitely interesting, so even if you decide to revert it in this pr, please consider a separate pr for it",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-22T06:31:32Z",
            "diff_hunk": "@@ -1843,8 +1900,23 @@ bool apply_autocmds_group(event_T event, char *fname, char *fname_io, bool force\n     patcmd.next = active_apc_list;\n     active_apc_list = &patcmd;\n \n-    // Attach data to command\n-    patcmd.data = data;\n+    // set v:event with event data (if any)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2366856393",
            "id": 2366856393,
            "in_reply_to_id": 2366804639,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NE1zJ",
            "original_commit_id": "645970c2858fc7abfc7834e6b535197df2fbed7c",
            "original_line": 1914,
            "original_position": 85,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 1,
            "pull_request_review_id": 3250793739,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366856393/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-22T06:31:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2366856393",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2374210491"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2374210491"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Cool, I'll just remove this processing line then. Looks like we don't need it!",
            "commit_id": "a4b7852034f6b15d286bd0475dcc7009a35e31f6",
            "created_at": "2025-09-24T04:30:00Z",
            "diff_hunk": "@@ -124,6 +124,8 @@ void state_handle_k_event(void)\n       return;\n     }\n \n+    // multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2374210491",
            "id": 2374210491,
            "in_reply_to_id": 2366829750,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6Ng5O7",
            "original_commit_id": "4e2d93aaf2d2d17c19bd7581e4b57092b708661c",
            "original_line": 127,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3260855575,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2374210491/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-24T04:30:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2374210491",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2374290153"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2374290153"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I found moving the `v:event` bit up avoided breaking any of the other tests. This shouldn't affect `nvim_exec_autocmds` although I guess `v:event` won't be set if `nvim_exec_autocmds(\"MarkSet\", ...)` is called.\n\nMy main motivation for doing this copying is to make the testing in `test/functional/autocmd/markset_spec.lua` possible – I couldn't find any other autocommand tests that made use of the Lua-style `data`. Very much open to alternatives if we don't want this behavior.",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-24T04:47:41Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf, exarg_T *eap,\n+                 Object *data)\n+{\n+  DeferredEvent *evdata = xmalloc(sizeof(DeferredEvent));\n+  evdata->event = event;\n+  evdata->fname = fname;\n+  evdata->fname_io = fname_io;\n+  evdata->group = group;\n+  evdata->buf = buf->handle;\n+  evdata->eap = eap;\n+  if (data) {\n+    evdata->data = xmalloc(sizeof(Object));\n+    *evdata->data = copy_object(*data, NULL);\n+  } else {\n+    evdata->data = NULL;\n+  }\n+\n+  multiqueue_put(deferred_autocmd_events, deferred_event, evdata);\n+}\n+\n+/// Execute a deferred autocommand event\n+static void deferred_event(void **argv)\n+{\n+  DeferredEvent *e = argv[0];\n+  event_T event = e->event;\n+  char *fname = e->fname;\n+  char *fname_io = e->fname_io;\n+  int group = e->group;\n+  exarg_T *eap = e->eap;\n+  Object *data = e->data;\n+\n+  Error err = ERROR_INIT;\n+  buf_T *buf = find_buffer_by_handle(e->buf, &err);\n+  if (buf) {\n+    // set v:event with event data (if any)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2374290153",
            "id": 2374290153,
            "line": 1553,
            "node_id": "PRRC_kwDOAPphoM6NhMrp",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1553,
            "original_position": 76,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 76,
            "pull_request_review_id": 3260913251,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2374290153/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-24T04:47:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2374290153",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377411522"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377411522"
                }
            },
            "author_association": "MEMBER",
            "body": "Ah, because it uses `multiqueue_new_child`. Technically, I think this means we don't need `deferred_autocmd_events`, we could directly queue the events on `main.events`. But let's keep it for now until we are certain we won't want to \"flush\" all the events from `deferred_autocmd_events` at some specific time.",
            "commit_id": "3c8ffa16597ca1b50f64ad3ff8df7f915c5809e0",
            "created_at": "2025-09-25T01:13:47Z",
            "diff_hunk": "@@ -121,6 +121,7 @@ void state_handle_k_event(void)\n     if (multiqueue_empty(main_loop.events)) {\n       // don't breakcheck before return, caller should return to main-loop\n       // and handle input already.\n+      multiqueue_process_events(deferred_autocmd_events);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377411522",
            "id": 2377411522,
            "in_reply_to_id": 2366400713,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM6NtGvC",
            "original_commit_id": "f4cf0d621b6b671c7d829b180a67dcd8258d19e1",
            "original_line": 124,
            "original_position": 4,
            "original_start_line": null,
            "path": "src/nvim/state.c",
            "position": 1,
            "pull_request_review_id": 3265191500,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377411522/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T01:14:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377411522",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377414706"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377414706"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n/// @param event Event to schedule\n```",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:17:29Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377414706",
            "id": 2377414706,
            "line": 1512,
            "node_id": "PRRC_kwDOAPphoM6NtHgy",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1512,
            "original_position": 35,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 35,
            "pull_request_review_id": 3265195326,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377414706/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T01:17:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377414706",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377415217"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415217"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n/// @param fname_io Filename to use for <afile> on cmdline,\n```",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:18:00Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377415217",
            "id": 2377415217,
            "line": 1514,
            "node_id": "PRRC_kwDOAPphoM6NtHox",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1514,
            "original_position": 37,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 37,
            "pull_request_review_id": 3265195884,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415217/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T01:18:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415217",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377415460"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415460"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n/// @param group Group ID or AUGROUP_ALL\n```",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:18:15Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377415460",
            "id": 2377415460,
            "line": 1516,
            "node_id": "PRRC_kwDOAPphoM6NtHsk",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1516,
            "original_position": 39,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 39,
            "pull_request_review_id": 3265196165,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415460/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T01:18:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415460",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377415907"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415907"
                }
            },
            "author_association": "MEMBER",
            "body": "missing `@param` doc",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:18:46Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf, exarg_T *eap,\n+                 Object *data)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377415907",
            "id": 2377415907,
            "line": 1520,
            "node_id": "PRRC_kwDOAPphoM6NtHzj",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1520,
            "original_position": 43,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 43,
            "pull_request_review_id": 3265196706,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415907/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T01:18:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377415907",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377422742"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377422742"
                }
            },
            "author_association": "MEMBER",
            "body": "Do we need to free `data` here ? oh, it's stack-allocated in `do_markset_autocmd`.  Seems fine for now.",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:25:56Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf, exarg_T *eap,\n+                 Object *data)\n+{\n+  DeferredEvent *evdata = xmalloc(sizeof(DeferredEvent));\n+  evdata->event = event;\n+  evdata->fname = fname;\n+  evdata->fname_io = fname_io;\n+  evdata->group = group;\n+  evdata->buf = buf->handle;\n+  evdata->eap = eap;\n+  if (data) {\n+    evdata->data = xmalloc(sizeof(Object));\n+    *evdata->data = copy_object(*data, NULL);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377422742",
            "id": 2377422742,
            "line": 1531,
            "node_id": "PRRC_kwDOAPphoM6NtJeW",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1531,
            "original_position": 54,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 54,
            "pull_request_review_id": 3265204531,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377422742/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T01:25:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377422742",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377431867"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377431867"
                }
            },
            "author_association": "MEMBER",
            "body": "> `v:event` won't be set if `nvim_exec_autocmds(\"MarkSet\", ...)` is called.\n\nThat (known) limitation of `nvim_exec_autocmds` applies to all events. (That's one reason why `v:event` is unofficially deprecated in favor of `data`.)\n\n\n> couldn't find any other autocommand tests that made use of the Lua-style `data`\n\n? [ex1](https://github.com/neovim/neovim/blob/0be3dee44f0659be58d455b067d1919525e773ee/test/functional/api/autocmd_spec.lua#L344-L347), [ex2](https://github.com/neovim/neovim/blob/0be3dee44f0659be58d455b067d1919525e773ee/test/functional/api/autocmd_spec.lua#L378) unless I misunderstood you. \n",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:32:53Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf, exarg_T *eap,\n+                 Object *data)\n+{\n+  DeferredEvent *evdata = xmalloc(sizeof(DeferredEvent));\n+  evdata->event = event;\n+  evdata->fname = fname;\n+  evdata->fname_io = fname_io;\n+  evdata->group = group;\n+  evdata->buf = buf->handle;\n+  evdata->eap = eap;\n+  if (data) {\n+    evdata->data = xmalloc(sizeof(Object));\n+    *evdata->data = copy_object(*data, NULL);\n+  } else {\n+    evdata->data = NULL;\n+  }\n+\n+  multiqueue_put(deferred_autocmd_events, deferred_event, evdata);\n+}\n+\n+/// Execute a deferred autocommand event\n+static void deferred_event(void **argv)\n+{\n+  DeferredEvent *e = argv[0];\n+  event_T event = e->event;\n+  char *fname = e->fname;\n+  char *fname_io = e->fname_io;\n+  int group = e->group;\n+  exarg_T *eap = e->eap;\n+  Object *data = e->data;\n+\n+  Error err = ERROR_INIT;\n+  buf_T *buf = find_buffer_by_handle(e->buf, &err);\n+  if (buf) {\n+    // set v:event with event data (if any)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377431867",
            "id": 2377431867,
            "in_reply_to_id": 2374290153,
            "line": 1553,
            "node_id": "PRRC_kwDOAPphoM6NtLs7",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1553,
            "original_position": 76,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 76,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377431867/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377431867",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377439838"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377439838"
                }
            },
            "author_association": "MEMBER",
            "body": "Although `v:event` is unofficially deprecated, there is a benefit to this: it avoids the autocmd impl needing to manually set `v_event` fields. Instead, all new autocmds can focus on `data`, which is the \"preferred\" way.\n\nWe could consider migrating all the old autocmds to this, so that `data` is a superset of `v:event`.",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:39:05Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf, exarg_T *eap,\n+                 Object *data)\n+{\n+  DeferredEvent *evdata = xmalloc(sizeof(DeferredEvent));\n+  evdata->event = event;\n+  evdata->fname = fname;\n+  evdata->fname_io = fname_io;\n+  evdata->group = group;\n+  evdata->buf = buf->handle;\n+  evdata->eap = eap;\n+  if (data) {\n+    evdata->data = xmalloc(sizeof(Object));\n+    *evdata->data = copy_object(*data, NULL);\n+  } else {\n+    evdata->data = NULL;\n+  }\n+\n+  multiqueue_put(deferred_autocmd_events, deferred_event, evdata);\n+}\n+\n+/// Execute a deferred autocommand event\n+static void deferred_event(void **argv)\n+{\n+  DeferredEvent *e = argv[0];\n+  event_T event = e->event;\n+  char *fname = e->fname;\n+  char *fname_io = e->fname_io;\n+  int group = e->group;\n+  exarg_T *eap = e->eap;\n+  Object *data = e->data;\n+\n+  Error err = ERROR_INIT;\n+  buf_T *buf = find_buffer_by_handle(e->buf, &err);\n+  if (buf) {\n+    // set v:event with event data (if any)\n+    save_v_event_T save_v_event;\n+    dict_T *v_event = get_v_event(&save_v_event);\n+    if (data && data->type == kObjectTypeDict) {\n+      for (size_t i = 0; i < data->data.dict.size; i++) {\n+        KeyValuePair item = data->data.dict.items[i];\n+        typval_T tv;\n+        object_to_vim(item.value, &tv, &err);\n+        if (ERROR_SET(&err)) {\n+          api_clear_error(&err);\n+          continue;\n+        }\n+        tv_dict_add_tv(v_event, item.key.data, item.key.size, &tv);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377439838",
            "id": 2377439838,
            "line": 1565,
            "node_id": "PRRC_kwDOAPphoM6NtNpe",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1565,
            "original_position": 88,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 88,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377439838/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377439838",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377453960"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377453960"
                }
            },
            "author_association": "MEMBER",
            "body": "```\n= Direct leak of 8 byte(s) in 4 object(s) allocated from:\n=     #0 0x56474fd71da3 in malloc (/home/runner/work/neovim/neovim/build/bin/nvim+0xd2dda3) (BuildId: 3ca905c7565ef1e6de420bec49eabad8f09550cb)\n=     #1 0x564750a10c34 in try_malloc /home/runner/work/neovim/neovim/src/nvim/memory.c:113:15\n=     #2 0x564750a10e94 in xmalloc /home/runner/work/neovim/neovim/src/nvim/memory.c:147:15\n=     #3 0x564750a112aa in xmallocz /home/runner/work/neovim/neovim/src/nvim/memory.c:219:15\n=     #4 0x564750a113e3 in xmemdupz /home/runner/work/neovim/neovim/src/nvim/memory.c:237:17\n=     #5 0x5647502c7446 in decode_string /home/runner/work/neovim/neovim/src/nvim/eval/decode.c:278:69\n=     #6 0x56474fe3c10d in object_to_vim_take_luaref /home/runner/work/neovim/neovim/src/nvim/api/private/converter.c:307:11\n=     #7 0x56474fe3b298 in object_to_vim /home/runner/work/neovim/neovim/src/nvim/api/private/converter.c:268:3\n```",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:48:35Z",
            "diff_hunk": "@@ -1493,6 +1507,77 @@ void aucmd_restbuf(aco_save_T *aco)\n   }\n }\n \n+/// Schedules an autocommand event, to be executed at the next event-loop tick.\n+///\n+/// @param event event that occurred\n+/// @param fname filename, NULL or empty means use actual file name\n+/// @param fname_io filename to use for <afile> on cmdline,\n+///                 NULL means use `fname`.\n+/// @param group autocmd group ID or AUGROUP_ALL\n+/// @param buf Buffer for <abuf>\n+/// @param eap Ex command arguments\n+void aucmd_defer(event_T event, char *fname, char *fname_io, int group, buf_T *buf, exarg_T *eap,\n+                 Object *data)\n+{\n+  DeferredEvent *evdata = xmalloc(sizeof(DeferredEvent));\n+  evdata->event = event;\n+  evdata->fname = fname;\n+  evdata->fname_io = fname_io;\n+  evdata->group = group;\n+  evdata->buf = buf->handle;\n+  evdata->eap = eap;\n+  if (data) {\n+    evdata->data = xmalloc(sizeof(Object));\n+    *evdata->data = copy_object(*data, NULL);\n+  } else {\n+    evdata->data = NULL;\n+  }\n+\n+  multiqueue_put(deferred_autocmd_events, deferred_event, evdata);\n+}\n+\n+/// Execute a deferred autocommand event\n+static void deferred_event(void **argv)\n+{\n+  DeferredEvent *e = argv[0];\n+  event_T event = e->event;\n+  char *fname = e->fname;\n+  char *fname_io = e->fname_io;\n+  int group = e->group;\n+  exarg_T *eap = e->eap;\n+  Object *data = e->data;\n+\n+  Error err = ERROR_INIT;\n+  buf_T *buf = find_buffer_by_handle(e->buf, &err);\n+  if (buf) {\n+    // set v:event with event data (if any)\n+    save_v_event_T save_v_event;\n+    dict_T *v_event = get_v_event(&save_v_event);\n+    if (data && data->type == kObjectTypeDict) {\n+      for (size_t i = 0; i < data->data.dict.size; i++) {\n+        KeyValuePair item = data->data.dict.items[i];\n+        typval_T tv;\n+        object_to_vim(item.value, &tv, &err);",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377453960",
            "id": 2377453960,
            "line": 1560,
            "node_id": "PRRC_kwDOAPphoM6NtRGI",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 1560,
            "original_position": 83,
            "original_start_line": null,
            "path": "src/nvim/autocmd.c",
            "position": 83,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377453960/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377453960",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377455983"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377455983"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n/// Schedules \"MarkSet\" event.\n```",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:49:30Z",
            "diff_hunk": "@@ -87,6 +89,26 @@ void clear_fmark(fmark_T *const fm, const Timestamp timestamp)\n   fm->timestamp = timestamp;\n }\n \n+/// Execute \"MarkSet\" autocommand.",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377455983",
            "id": 2377455983,
            "line": 92,
            "node_id": "PRRC_kwDOAPphoM6NtRlv",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 92,
            "original_position": 14,
            "original_start_line": null,
            "path": "src/nvim/mark.c",
            "position": 14,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377455983/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377455983",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377462039"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377462039"
                }
            },
            "author_association": "MEMBER",
            "body": "i don't think these `poke_eventloop` should be necessary? when `eval()` is called below, it should flush queued events. or if i'm wrong about that, maybe only one `poke_eventloop` is needed before that.",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:53:11Z",
            "diff_hunk": "@@ -0,0 +1,167 @@\n+local t = require('test.testutil')\n+local n = require('test.functional.testnvim')()\n+\n+local api = n.api\n+local clear = n.clear\n+local command = n.command\n+local feed = n.feed\n+local poke_eventloop = n.poke_eventloop\n+local eval = n.eval\n+\n+local eq = t.eq\n+\n+--- Find an event by mark name\n+--- @param all_events table[] List of mark events\n+--- @param mark string The mark character to find\n+--- @return table|nil The event with the specified mark, or nil if not found\n+local function get_event(all_events, mark)\n+  return vim.iter(all_events):find(function(event)\n+    return event.event.mark == mark\n+  end)\n+end\n+\n+describe('MarkSet', function()\n+  before_each(function()\n+    clear()\n+    command(\"autocmd MarkSet * let g:autocmd ..= 'M'\")\n+    command([[let g:autocmd = '']])\n+    api.nvim_buf_set_lines(0, 0, -1, true, {\n+      'foo\\0bar',\n+      'baz text',\n+    })\n+  end)\n+\n+  it('is called after a lowercase mark is set', function()\n+    feed('ma')\n+    poke_eventloop()\n+    feed('j')\n+    poke_eventloop()\n+    feed('mb')\n+    poke_eventloop()\n+\n+    eq('MM', eval('g:autocmd'))\n+  end)\n+\n+  it('is called after an uppercase mark is set', function()\n+    feed('mA')\n+    poke_eventloop()\n+    feed('l')\n+    poke_eventloop()\n+    feed('mB')\n+    poke_eventloop()\n+    feed('j')\n+    poke_eventloop()\n+    feed('mC')\n+    poke_eventloop()",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377462039",
            "id": 2377462039,
            "line": 55,
            "node_id": "PRRC_kwDOAPphoM6NtTEX",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 55,
            "original_position": 55,
            "original_start_line": 47,
            "path": "test/functional/autocmd/markset_spec.lua",
            "position": 55,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377462039/reactions"
            },
            "side": "RIGHT",
            "start_line": 47,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377462039",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377465839"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377465839"
                }
            },
            "author_association": "MEMBER",
            "body": "`command()` is blocking/synchronous (i.e. it already does a \"poke\") so shouldn't need `poke_eventloop` . \n\nmost of the `poke_eventloop` calls in this PR shouldn't be needed.",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:56:36Z",
            "diff_hunk": "@@ -0,0 +1,167 @@\n+local t = require('test.testutil')\n+local n = require('test.functional.testnvim')()\n+\n+local api = n.api\n+local clear = n.clear\n+local command = n.command\n+local feed = n.feed\n+local poke_eventloop = n.poke_eventloop\n+local eval = n.eval\n+\n+local eq = t.eq\n+\n+--- Find an event by mark name\n+--- @param all_events table[] List of mark events\n+--- @param mark string The mark character to find\n+--- @return table|nil The event with the specified mark, or nil if not found\n+local function get_event(all_events, mark)\n+  return vim.iter(all_events):find(function(event)\n+    return event.event.mark == mark\n+  end)\n+end\n+\n+describe('MarkSet', function()\n+  before_each(function()\n+    clear()\n+    command(\"autocmd MarkSet * let g:autocmd ..= 'M'\")\n+    command([[let g:autocmd = '']])\n+    api.nvim_buf_set_lines(0, 0, -1, true, {\n+      'foo\\0bar',\n+      'baz text',\n+    })\n+  end)\n+\n+  it('is called after a lowercase mark is set', function()\n+    feed('ma')\n+    poke_eventloop()\n+    feed('j')\n+    poke_eventloop()\n+    feed('mb')\n+    poke_eventloop()\n+\n+    eq('MM', eval('g:autocmd'))\n+  end)\n+\n+  it('is called after an uppercase mark is set', function()\n+    feed('mA')\n+    poke_eventloop()\n+    feed('l')\n+    poke_eventloop()\n+    feed('mB')\n+    poke_eventloop()\n+    feed('j')\n+    poke_eventloop()\n+    feed('mC')\n+    poke_eventloop()\n+\n+    eq('MMM', eval('g:autocmd'))\n+  end)\n+\n+  it('survives multiple operations: buffer wipeout, window/tab switching', function()\n+    local orig_bufnr = api.nvim_get_current_buf()\n+\n+    command('enew')\n+    local second_bufnr = api.nvim_get_current_buf()\n+    api.nvim_buf_set_lines(second_bufnr, 0, -1, true, {\n+      'second buffer line 1',\n+      'second buffer line 2',\n+    })\n+\n+    command('enew')\n+    local third_bufnr = api.nvim_get_current_buf()\n+    api.nvim_buf_set_lines(third_bufnr, 0, -1, true, {\n+      'third buffer line 1',\n+      'third buffer line 2',\n+    })\n+\n+    -- Split windows\n+    command('split')\n+    command('vsplit')\n+\n+    -- Create new tabpage\n+    command('tabnew')\n+    command('split')\n+\n+    -- Enhanced autocmd to capture more data\n+    command([[\n+      let g:markset_events = []\n+      autocmd MarkSet * call add(g:markset_events, {'bufnr': bufnr('%'), 'event': deepcopy(v:event)})\n+    ]])\n+\n+    -- Go back to original buffer and set a mark\n+    command('buffer ' .. orig_bufnr)\n+    feed('gg')\n+    poke_eventloop()\n+    feed('mA')\n+    poke_eventloop()\n+\n+    -- OPERATION 1: Switch to different window\n+    command('wincmd w')\n+    poke_eventloop()",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377465839",
            "id": 2377465839,
            "line": 100,
            "node_id": "PRRC_kwDOAPphoM6NtT_v",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 100,
            "original_position": 100,
            "original_start_line": null,
            "path": "test/functional/autocmd/markset_spec.lua",
            "position": 100,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377465839/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377465839",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377468515"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377468515"
                }
            },
            "author_association": "MEMBER",
            "body": "The \"crazy\" things that we want to test are when the autocmd handler *itself* does a bdelete/bwipeout/window-switch on *its own window*. That is historically the source of many crashes in vim/nvim, and is one reason why \"deferring\" is valuable.",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T01:59:06Z",
            "diff_hunk": "@@ -0,0 +1,167 @@\n+local t = require('test.testutil')\n+local n = require('test.functional.testnvim')()\n+\n+local api = n.api\n+local clear = n.clear\n+local command = n.command\n+local feed = n.feed\n+local poke_eventloop = n.poke_eventloop\n+local eval = n.eval\n+\n+local eq = t.eq\n+\n+--- Find an event by mark name\n+--- @param all_events table[] List of mark events\n+--- @param mark string The mark character to find\n+--- @return table|nil The event with the specified mark, or nil if not found\n+local function get_event(all_events, mark)\n+  return vim.iter(all_events):find(function(event)\n+    return event.event.mark == mark\n+  end)\n+end\n+\n+describe('MarkSet', function()\n+  before_each(function()\n+    clear()\n+    command(\"autocmd MarkSet * let g:autocmd ..= 'M'\")\n+    command([[let g:autocmd = '']])\n+    api.nvim_buf_set_lines(0, 0, -1, true, {\n+      'foo\\0bar',\n+      'baz text',\n+    })\n+  end)\n+\n+  it('is called after a lowercase mark is set', function()\n+    feed('ma')\n+    poke_eventloop()\n+    feed('j')\n+    poke_eventloop()\n+    feed('mb')\n+    poke_eventloop()\n+\n+    eq('MM', eval('g:autocmd'))\n+  end)\n+\n+  it('is called after an uppercase mark is set', function()\n+    feed('mA')\n+    poke_eventloop()\n+    feed('l')\n+    poke_eventloop()\n+    feed('mB')\n+    poke_eventloop()\n+    feed('j')\n+    poke_eventloop()\n+    feed('mC')\n+    poke_eventloop()\n+\n+    eq('MMM', eval('g:autocmd'))\n+  end)\n+\n+  it('survives multiple operations: buffer wipeout, window/tab switching', function()\n+    local orig_bufnr = api.nvim_get_current_buf()\n+\n+    command('enew')\n+    local second_bufnr = api.nvim_get_current_buf()\n+    api.nvim_buf_set_lines(second_bufnr, 0, -1, true, {\n+      'second buffer line 1',\n+      'second buffer line 2',\n+    })\n+\n+    command('enew')\n+    local third_bufnr = api.nvim_get_current_buf()\n+    api.nvim_buf_set_lines(third_bufnr, 0, -1, true, {\n+      'third buffer line 1',\n+      'third buffer line 2',\n+    })\n+\n+    -- Split windows\n+    command('split')\n+    command('vsplit')\n+\n+    -- Create new tabpage\n+    command('tabnew')\n+    command('split')\n+\n+    -- Enhanced autocmd to capture more data\n+    command([[\n+      let g:markset_events = []\n+      autocmd MarkSet * call add(g:markset_events, {'bufnr': bufnr('%'), 'event': deepcopy(v:event)})\n+    ]])\n+\n+    -- Go back to original buffer and set a mark\n+    command('buffer ' .. orig_bufnr)\n+    feed('gg')\n+    poke_eventloop()\n+    feed('mA')\n+    poke_eventloop()\n+\n+    -- OPERATION 1: Switch to different window\n+    command('wincmd w')\n+    poke_eventloop()\n+\n+    -- OPERATION 2: Switch to different tabpage\n+    command('tabnext')\n+    poke_eventloop()\n+\n+    -- OPERATION 3: Set mark in current buffer\n+    feed('mB')\n+    poke_eventloop()\n+\n+    -- OPERATION 4: Wipeout the original buffer (this is the nuclear option!)\n+    command('bwipeout! ' .. orig_bufnr)",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377468515",
            "id": 2377468515,
            "line": 111,
            "node_id": "PRRC_kwDOAPphoM6NtUpj",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 111,
            "original_position": 111,
            "original_start_line": null,
            "path": "test/functional/autocmd/markset_spec.lua",
            "position": 111,
            "pull_request_review_id": 3265217086,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377468515/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:01:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377468515",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377488488"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377488488"
                }
            },
            "author_association": "MEMBER",
            "body": "Use common names where possible. `name` seems to fit here?\n\nNote: also want to keep the door open for extending this to new marks in the future, maybe even user-defined marks. And possibly extmarks (which were loosely intended, as their name implies, to be a superset of \"regular marks\").\n\nI don't see anything in your design that puts that at risk, but mentioning it in case you think of anything. \n\n",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T02:12:49Z",
            "diff_hunk": "@@ -758,6 +758,15 @@ LspNotify\t\t\tSee |LspNotify|\n LspProgress\t\t\tSee |LspProgress|\n LspRequest\t\t\tSee |LspRequest|\n LspTokenUpdate\t\t\tSee |LspTokenUpdate|\n+\t\t\t\t\t\t\t*MarkSet*\n+MarkSet\t\t\t\tJust after a |mark| is set. The |event-data|\n+\t\t\t\tis a table with the following fields:\n+\n+\t\t\t\t- mark: the character of the set mark. (ex:\n+\t\t\t\t  'a')",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377488488",
            "id": 2377488488,
            "line": 766,
            "node_id": "PRRC_kwDOAPphoM6NtZho",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 766,
            "original_position": 9,
            "original_start_line": 765,
            "path": "runtime/doc/autocmd.txt",
            "position": 9,
            "pull_request_review_id": 3265292261,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377488488/reactions"
            },
            "side": "RIGHT",
            "start_line": 765,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-09-25T02:12:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377488488",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377492934"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377492934"
                }
            },
            "author_association": "MEMBER",
            "body": "What is set as the \"pattern\"? Presumably plugins may want to listen to specific marks only (for performance):\n\n```lua\nvim.api.nvim_create_autocmd({'MarkSet'}, {\n  pattern = {'[', ']'},\n  command = \"echo 'foo'\",\n})\n```\n",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T02:16:05Z",
            "diff_hunk": "@@ -758,6 +758,15 @@ LspNotify\t\t\tSee |LspNotify|\n LspProgress\t\t\tSee |LspProgress|\n LspRequest\t\t\tSee |LspRequest|\n LspTokenUpdate\t\t\tSee |LspTokenUpdate|\n+\t\t\t\t\t\t\t*MarkSet*\n+MarkSet\t\t\t\tJust after a |mark| is set. The |event-data|",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377492934",
            "id": 2377492934,
            "line": 762,
            "node_id": "PRRC_kwDOAPphoM6NtanG",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 762,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/doc/autocmd.txt",
            "position": 5,
            "pull_request_review_id": 3265301132,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377492934/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:16:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377492934",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/35793#discussion_r2377495390"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/35793"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377495390"
                }
            },
            "author_association": "MEMBER",
            "body": "What about special marks like `']` ? Those could be quite useful. Even if they're not supported yet, it would be good to explicitly test all of them, to have a clear picture of which ones are/aren't supported. (But we don't need a test for every single a-z/A-Z mark :)",
            "commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "created_at": "2025-09-25T02:17:53Z",
            "diff_hunk": "@@ -0,0 +1,167 @@\n+local t = require('test.testutil')\n+local n = require('test.functional.testnvim')()\n+\n+local api = n.api\n+local clear = n.clear\n+local command = n.command\n+local feed = n.feed\n+local poke_eventloop = n.poke_eventloop\n+local eval = n.eval\n+\n+local eq = t.eq\n+\n+--- Find an event by mark name\n+--- @param all_events table[] List of mark events\n+--- @param mark string The mark character to find\n+--- @return table|nil The event with the specified mark, or nil if not found\n+local function get_event(all_events, mark)\n+  return vim.iter(all_events):find(function(event)\n+    return event.event.mark == mark\n+  end)\n+end\n+\n+describe('MarkSet', function()\n+  before_each(function()\n+    clear()\n+    command(\"autocmd MarkSet * let g:autocmd ..= 'M'\")\n+    command([[let g:autocmd = '']])\n+    api.nvim_buf_set_lines(0, 0, -1, true, {\n+      'foo\\0bar',\n+      'baz text',\n+    })\n+  end)\n+\n+  it('is called after a lowercase mark is set', function()",
            "html_url": "https://github.com/neovim/neovim/pull/35793#discussion_r2377495390",
            "id": 2377495390,
            "line": 34,
            "node_id": "PRRC_kwDOAPphoM6NtbNe",
            "original_commit_id": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
            "original_line": 34,
            "original_position": 34,
            "original_start_line": null,
            "path": "test/functional/autocmd/markset_spec.lua",
            "position": 34,
            "pull_request_review_id": 3265305659,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377495390/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-09-25T02:18:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2377495390",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/35793/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/35793/commits",
    "created_at": "2025-09-16T03:41:52Z",
    "diff_url": "https://github.com/neovim/neovim/pull/35793.diff",
    "draft": false,
    "head": {
        "label": "nathanmsmith:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/nathanmsmith/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/nathanmsmith/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/nathanmsmith/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/nathanmsmith/neovim/branches{/branch}",
            "clone_url": "https://github.com/nathanmsmith/neovim.git",
            "collaborators_url": "https://api.github.com/repos/nathanmsmith/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/nathanmsmith/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/nathanmsmith/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/nathanmsmith/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/nathanmsmith/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/nathanmsmith/neovim/contributors",
            "created_at": "2024-09-25T02:19:20Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/nathanmsmith/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/nathanmsmith/neovim/downloads",
            "events_url": "https://api.github.com/repos/nathanmsmith/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/nathanmsmith/neovim/forks",
            "full_name": "nathanmsmith/neovim",
            "git_commits_url": "https://api.github.com/repos/nathanmsmith/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/nathanmsmith/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/nathanmsmith/neovim/git/tags{/sha}",
            "git_url": "git://github.com/nathanmsmith/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/nathanmsmith/neovim/hooks",
            "html_url": "https://github.com/nathanmsmith/neovim",
            "id": 862677711,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/nathanmsmith/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/nathanmsmith/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/nathanmsmith/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/nathanmsmith/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/nathanmsmith/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/nathanmsmith/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/nathanmsmith/neovim/merges",
            "milestones_url": "https://api.github.com/repos/nathanmsmith/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOM2tqzw",
            "notifications_url": "https://api.github.com/repos/nathanmsmith/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
                "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
                "followers_url": "https://api.github.com/users/nathanmsmith/followers",
                "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
                "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nathanmsmith",
                "id": 5677971,
                "login": "nathanmsmith",
                "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
                "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
                "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
                "repos_url": "https://api.github.com/users/nathanmsmith/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nathanmsmith",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/nathanmsmith/neovim/pulls{/number}",
            "pushed_at": "2025-09-24T04:39:48Z",
            "releases_url": "https://api.github.com/repos/nathanmsmith/neovim/releases{/id}",
            "size": 331743,
            "ssh_url": "git@github.com:nathanmsmith/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/nathanmsmith/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/nathanmsmith/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/nathanmsmith/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/nathanmsmith/neovim/subscription",
            "svn_url": "https://github.com/nathanmsmith/neovim",
            "tags_url": "https://api.github.com/repos/nathanmsmith/neovim/tags",
            "teams_url": "https://api.github.com/repos/nathanmsmith/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/nathanmsmith/neovim/git/trees{/sha}",
            "updated_at": "2025-09-24T04:39:52Z",
            "url": "https://api.github.com/repos/nathanmsmith/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
            "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
            "followers_url": "https://api.github.com/users/nathanmsmith/followers",
            "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
            "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/nathanmsmith",
            "id": 5677971,
            "login": "nathanmsmith",
            "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
            "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
            "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
            "repos_url": "https://api.github.com/users/nathanmsmith/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/nathanmsmith",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/35793",
    "id": 2831247323,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35793",
    "labels": [],
    "locked": false,
    "merge_commit_sha": "02dd7168ad8f28c8801a1e526947e5702b8f8d91",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM6owWfb",
    "number": 35793,
    "patch_url": "https://github.com/neovim/neovim/pull/35793.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/35793/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/baa5b0b50dc166ac7bd1c9aa58c61ab100a8c7bb",
    "title": "feat(events): deferred events queue, `MarkSet` autocmd",
    "updated_at": "2025-09-25T02:17:53Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/35793",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5677971?v=4",
        "events_url": "https://api.github.com/users/nathanmsmith/events{/privacy}",
        "followers_url": "https://api.github.com/users/nathanmsmith/followers",
        "following_url": "https://api.github.com/users/nathanmsmith/following{/other_user}",
        "gists_url": "https://api.github.com/users/nathanmsmith/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/nathanmsmith",
        "id": 5677971,
        "login": "nathanmsmith",
        "node_id": "MDQ6VXNlcjU2Nzc5NzE=",
        "organizations_url": "https://api.github.com/users/nathanmsmith/orgs",
        "received_events_url": "https://api.github.com/users/nathanmsmith/received_events",
        "repos_url": "https://api.github.com/users/nathanmsmith/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/nathanmsmith/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/nathanmsmith/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/nathanmsmith",
        "user_view_type": "public"
    }
}
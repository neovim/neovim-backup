{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/25301/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/25301/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/25301"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/25301"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/25301/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/d2c6d7a1ad14840078b65bba8c18d0626f136d62"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 4983,
            "forks_count": 4983,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1679,
            "open_issues_count": 1679,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2023-11-15T00:25:36Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 230819,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 70893,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2023-11-15T01:34:38Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 70893,
            "watchers_count": 70893,
            "web_commit_signoff_required": false
        },
        "sha": "ad2fad9a3b07d84e24c189b6a5773e979e8c0afd",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim"
        }
    },
    "body": "Defines the minimal API for LSP snippet support. The initial design is:\r\n1. `vim.snippet.expand` receives the snippet text and parses it using the LPEG grammar.\r\n2. The snippet's children are transformed as follows:\r\n    - Known variables are replaced by their values (e.g. `$TM_FILENAME` becomes `foo.txt`), falling back to their defaults when provided.\r\n    - When a variable is unknown, the name of the variable is inserted and it is transformed into a placeholder.\r\n    - Placeholders have their text[^1] inserted.\r\n    - With choice nodes, the first value is inserted (see below for future work).\r\n    - Text nodes are inserted as given.\r\n3. Based on `expandtab` and the indentation of the current line, the snippet is indented accordingly. \r\n4. The snippet text is set in the current buffer.\r\n5. To \"fill out\" the snippet, tabstops can be navigated using `vim.snippet.jump(direction)` (using `1` for jumping forward and `-1` for backwards). `vim.snippet.jumpable(direction)` can also be used before jumping to check if the jump in the given direction is valid.\r\n6. The snippet session is cancelled when reaching the final tabstop (`$0`) or when the cursor moves outside the snippet's tabstops. Tabstops can be customized with the `SnippetTabstop` highlight group.\r\n\r\nNote that the following features remain yet to be implemented in more mature versions of the snippet API:\r\n- Variable transformations via regexes.\r\n- Choice placeholders, in which the user can select from a given set of options to insert.\r\n- Nested placeholders. Right now the value of a placeholder is simply converted to a string and inserted.\r\n\r\nPending discussion items in this PR:\r\n- [X] _My use of `Range4` despite it being a \"Treesitter\" type_: Seems like we're fine with this given that [we plan on refactoring ranges/positions anyway](https://github.com/neovim/neovim/issues/25509).\r\n- [x] _Currently `vim.snippet.jump` uses `vim.snippet.jumpable` to check that the movement is valid. Do we want to instead ask the user to invoke `jumpable` first and remove the check?_ No harm in keeping the check.\r\n- [x] _I'm not 100% sure about the name of `vim.snippet.cancel`, since sometimes it does cancel the snippet session but it's also invoked when the snippet navigation is complete. Do we want to give it another name?_ Looks like we're all happy with `vim.snippet.exit`.\r\n\r\n[^1]: When I say that the text of a node is inserted, I don't mean the raw table string, but the output from [`Node:__tostring()`](https://github.com/neovim/neovim/blob/a041d8ac118f45b9e20d4975737f25a548cb6337/runtime/lua/vim/lsp/_snippet_grammar.lua#L85).",
    "closed_at": "2023-10-21T06:51:27Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334293206"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334293206"
                }
            },
            "author_association": "MEMBER",
            "body": "üëç  say no to uppercase (spicy zero-likes tweet: https://twitter.com/justinmk/status/1669461598786711552 )",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T12:07:27Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334293206",
            "id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Ph7LW",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1639822849,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334293206/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T12:07:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334293206",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334294741"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334294741"
                }
            },
            "author_association": "MEMBER",
            "body": "\"should\" is always redundant in test names\r\n```suggestion\r\n        it('disposes snippet if edit outside of range', function()\r\n```",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T12:09:03Z",
            "diff_hunk": "@@ -0,0 +1,336 @@\n+local helpers = require('test.functional.helpers')(after_each)\n+\n+local eq = helpers.eq\n+local clear = helpers.clear\n+local feed = helpers.feed\n+local exec_lua = helpers.exec_lua\n+\n+describe('vim.snippet', function()\n+  for _, selection in ipairs({ 'inclusive', 'exclusive' }) do\n+    for _, virtualedit in ipairs({ '', 'all', 'onemore' }) do\n+      describe(('selection=%s, virtualedit=%s'):format(selection, virtualedit), function()\n+        before_each(function()\n+          clear()\n+          exec_lua(([[\n+            vim.o.selection = '%s';\n+            vim.o.virtualedit = '%s';\n+            vim.snippet.dispose()\n+            vim.keymap.set({ 'n', 'i', 's' }, '<C-l>', '<Cmd>lua vim.snippet._sync()<CR>', { buffer = true })\n+            vim.keymap.set({ 'i', 's' }, '<Tab>', '<Cmd>lua vim.snippet.jump(vim.snippet.JumpDirection.Next)<CR>', { buffer = true })\n+            vim.keymap.set({ 'i', 's' }, '<S-Tab>', '<Cmd>lua vim.snippet.jump(vim.snippet.JumpDirection.Prev)<CR>', { buffer = true })\n+            vim.keymap.set({ 's' }, '<BS>', '\"\\\\<BS>\" .. (getcurpos()[2] == col(\"$\") - 1 ? \"a\" : \"i\")', { expr = true })\n+\n+            function get_state()\n+              local m = vim.api.nvim_get_mode().mode\n+              local select_s = vim.fn.getpos(\"'<\")\n+              local select_e = vim.fn.getpos(\"'>\")\n+              local cursor = vim.fn.getpos('.')\n+              local exclusive_offset = vim.o.selection == 'exclusive' and 1 or 0\n+              return {\n+                m = m,\n+                s = m ~= 's' and ({ cursor[2] - 1, cursor[3] - 1 }) or ({ select_s[2] - 1, select_s[3] - 1 }),\n+                e = m ~= 's' and ({ cursor[2] - 1, cursor[3] - 1 }) or ({ select_e[2] - 1, select_e[3] - exclusive_offset }),\n+              }\n+            end\n+          ]]):format(selection, virtualedit))\n+        end)\n+        after_each(function()\n+          clear()\n+        end)\n+\n+        it('should expand snippet with considering buffer indent setting', function()\n+          local snippet = table.concat({\n+            'class ${1:ClassName} {',\n+            '\\tpublic $1($2) {',\n+            '\\t\\t${3}',\n+            '\\t}',\n+            '}',\n+            ''\n+          }, '\\n')\n+\n+          for _, case in ipairs({\n+            {\n+              base_indent = [[  ]],\n+              indent_setting = [[\n+                vim.o.expandtab = true\n+                vim.o.shiftwidth = 2\n+              ]],\n+              expects = {\n+                '  class ClassName {',\n+                '    public ClassName() {',\n+                '      ',\n+                '    }',\n+                '  }',\n+                '  ',\n+              }\n+            }, {\n+            base_indent = [[  ]],\n+            indent_setting = [[\n+              vim.o.expandtab = true\n+              vim.o.shiftwidth = 0\n+              vim.o.tabstop = 2\n+            ]],\n+            expects = {\n+              '  class ClassName {',\n+              '    public ClassName() {',\n+              '      ',\n+              '    }',\n+              '  }',\n+              '  ',\n+            }\n+          }, {\n+            base_indent = [[<Tab>]],\n+            indent_setting = [[\n+              vim.o.expandtab = false\n+            ]],\n+            expects = {\n+              '\\tclass ClassName {',\n+              '\\t\\tpublic ClassName() {',\n+              '\\t\\t\\t',\n+              '\\t\\t}',\n+              '\\t}',\n+              '\\t',\n+            }\n+          }\n+          }) do\n+            clear()\n+            exec_lua(case.indent_setting)\n+            feed('i' .. case.base_indent)\n+            exec_lua('vim.snippet.expand(...)', snippet)\n+            eq(case.expects, helpers.buf_lines(0))\n+          end\n+        end)\n+\n+        it('should be able to jump through all placeholders', function()\n+          exec_lua('vim.snippet.expand(...)', table.concat({\n+            'class ${1:ClassName} {',\n+            '\\tpublic $1($2) {',\n+            '\\t\\t${3}',\n+            '\\t}',\n+            '}',\n+            ''\n+          }, '\\n'))\n+          local cases = {\n+            { m = 's', s = { 0, 6 },  e = { 0, 15 }, },\n+            { m = 'i', s = { 1, 18 }, e = { 1, 18 }, },\n+            { m = 'i', s = { 2, 2 },  e = { 2, 2 }, },\n+            { m = 'i', s = { 5, 0 },  e = { 5, 0 }, },\n+          }\n+          for i = 1, #cases do\n+            eq(cases[i], exec_lua([[return get_state()]]))\n+            eq(i ~= #cases, exec_lua([[return vim.snippet.jumpable(vim.snippet.JumpDirection.Next)]]))\n+            feed('<Tab>')\n+          end\n+          eq(cases[#cases], exec_lua([[return get_state()]]))\n+          for i = #cases, 1, -1 do\n+            eq(cases[i], exec_lua([[return get_state()]]))\n+            eq(i ~= 1, exec_lua([[return vim.snippet.jumpable(vim.snippet.JumpDirection.Prev)]]))\n+            feed('<S-Tab>')\n+          end\n+          eq(cases[1], exec_lua([[return get_state()]]))\n+        end)\n+\n+        it('should sync same tabstops', function()\n+          exec_lua('vim.snippet.expand(...)', table.concat({\n+            'class ${1:ClassName} {',\n+            '\\tpublic $1($2) {',\n+            '\\t\\t${3}',\n+            '\\t}',\n+            '}',\n+            ''\n+          }, '\\n'))\n+          feed('ModifiedClassName<C-l>')\n+          eq({\n+            'class ModifiedClassName {',\n+            '\\tpublic ModifiedClassName() {',\n+            '\\t\\t',\n+            '\\t}',\n+            '}',\n+            '',\n+          }, helpers.buf_lines(0))\n+        end)\n+\n+        -- We can't manage `complete(...)` in test.\n+        -- it('should insert selected choice', function()\n+        --   exec_lua('vim.snippet.expand(...)', table.concat({\n+        --     'console.${1|log,info,warn,error|}($2);',\n+        --   }, '\\n'))\n+        --   feed('<C-n><C-n><C-n><C-y>')\n+        --   eq({\n+        --     'console.warn();',\n+        --   }, helpers.buf_lines(0))\n+        -- end)\n+\n+        it('should dispose directly modified non-origin tabstop', function()\n+          exec_lua('vim.snippet.expand(...)', table.concat({\n+            'class ${1:ClassName} {',\n+            '\\tpublic $1($2) {',\n+            '\\t\\t${3}',\n+            '\\t}',\n+            '}',\n+            ''\n+          }, '\\n'))\n+          eq({\n+            'class ClassName {',\n+            '\\tpublic ClassName() {',\n+            '\\t\\t',\n+            '\\t}',\n+            '}',\n+            '',\n+          }, helpers.buf_lines(0))\n+          feed('<Esc><Cmd>call cursor(2, 9)<CR>ciwDirectlyModified<C-l>')\n+          eq({\n+            'class ClassName {',\n+            '\\tpublic DirectlyModified() {',\n+            '\\t\\t',\n+            '\\t}',\n+            '}',\n+            '',\n+          }, helpers.buf_lines(0))\n+        end)\n+\n+        it('should restore the state with undo', function()\n+          exec_lua('vim.snippet.expand(...)', table.concat({\n+            'class ${1:ClassName} {',\n+            '\\tpublic $1($2) {',\n+            '\\t\\t${3}',\n+            '\\t}',\n+            '}',\n+            ''\n+          }, '\\n'))\n+          feed('ModifiedClassName<C-l><Tab>argument<Esc>')\n+          eq({\n+            'class ModifiedClassName {',\n+            '\\tpublic ModifiedClassName(argument) {',\n+            '\\t\\t',\n+            '\\t}',\n+            '}',\n+            '',\n+          }, helpers.buf_lines(0))\n+\n+          feed('u<C-l>')\n+          eq({\n+            'class ClassName {',\n+            '\\tpublic ClassName() {',\n+            '\\t\\t',\n+            '\\t}',\n+            '}',\n+            '',\n+          }, helpers.buf_lines(0))\n+\n+          local to_insert = selection == 'exclusive' and 'i' or 'a'\n+          feed(('i<S-Tab><C-g>o<Esc>%sModified<C-l>'):format(to_insert))\n+          eq({\n+            'class ClassNameModified {',\n+            '\\tpublic ClassNameModified() {',\n+            '\\t\\t',\n+            '\\t}',\n+            '}',\n+            '',\n+          }, helpers.buf_lines(0))\n+        end)\n+\n+        it('should dispose snippet if edit outside of range', function()",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334294741",
            "id": 1334294741,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Ph7jV",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 233,
            "original_position": 233,
            "original_start_line": null,
            "path": "test/functional/lua/snippet_spec.lua",
            "position": null,
            "pull_request_review_id": 1639825180,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334294741/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T12:09:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334294741",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334295676"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334295676"
                }
            },
            "author_association": "MEMBER",
            "body": "üëÄ  https://github.com/neovim/neovim/pull/25154 @llllvvuu ",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T12:10:01Z",
            "diff_hunk": "@@ -0,0 +1,726 @@\n+local lsp_snippet = require('vim.lsp._snippet')\n+\n+---@alias vim.snippet.MarkId integer\n+---@alias vim.snippet.Tabstop integer\n+---@alias vim.snippet.Changenr integer\n+---@alias vim.snippet.Position { [1]: integer, [2]: integer } # The 0-origin utf8 byte index.\n+---@alias vim.snippet.Range { s: vim.snippet.Position, e: vim.snippet.Position } # The 0-origin utf8 byte index.\n+\n+---@class vim.snippet.TraverseContext\n+---@field depth integer\n+---@field range vim.snippet.Range\n+---@field replace fun(new_node: vim.lsp.snippet.Node): nil\n+\n+---Feed keys.\n+---NOTE: This always enables `virtualedit=onemore`\n+---@param keys string\n+local function feedkeys(keys)\n+  local k = {}\n+  table.insert(k, '<Cmd>set virtualedit=onemore<CR>')\n+  table.insert(k, keys)\n+  table.insert(k, ('<Cmd>set virtualedit=%s<CR>'):format(vim.o.virtualedit))\n+  vim.api.nvim_feedkeys(vim.api.nvim_replace_termcodes(table.concat(k), true, true, true), 'ni', true)\n+end\n+\n+---Return true if range contains position.\n+---@param range vim.snippet.Range\n+---@param position vim.snippet.Position\n+---@return boolean\n+local function within(range, position)\n+  -- Check the cursor is before the range start position.\n+  if position[1] < range.s[1] or (position[1] == range.s[1] and position[2] < range.s[2]) then\n+    return false\n+  end\n+\n+  -- Check the cursor is after the range end position.\n+  if range.e[1] < position[1] or (range.e[1] == position[1] and range.e[2] < position[2]) then\n+    return false\n+  end\n+\n+  return true\n+end\n+\n+---Return cursor position.\n+---@return vim.snippet.Position\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+---Return one indent string of current buffer.\n+---@return string\n+local function get_one_indent()\n+  local expandtab = vim.api.nvim_get_option('expandtab')\n+  if not expandtab then\n+    return '\\t'\n+  end\n+  local shiftwidth = vim.api.nvim_get_option('shiftwidth')\n+  if shiftwidth > 0 then\n+    return string.rep(' ', shiftwidth)\n+  end\n+  return string.rep(' ', vim.api.nvim_get_option('tabstop'))\n+end\n+\n+---Return base indent of current line.\n+---@return string\n+local function get_base_indent()\n+  return string.match(vim.api.nvim_get_current_line(), '^%s*') or ''\n+end\n+\n+---Adjust snippet indent\n+---@param snippet_text string\n+---@return string\n+local function adjust_indent(snippet_text)\n+  local one_indent = get_one_indent()\n+  local base_indent = get_base_indent()\n+\n+  local adjusted_snippet_text = {}\n+  local snippet_lines = vim.split(snippet_text, '\\n', { plain = true })\n+  for i, line in ipairs(snippet_lines) do\n+    if i == 1 then\n+      -- Use first line as-is.\n+      table.insert(adjusted_snippet_text, line)\n+    elseif i ~= #snippet_lines and string.match(line, '^%s*$') then\n+      -- Remove space only lines except the last line.\n+      table.insert(adjusted_snippet_text, '')\n+    else\n+      -- 1. Change \\t as one_indent.\n+      -- 2. Add base_indent.\n+      line = string.gsub(line, '^(\\t+)', function(indent)\n+        return string.gsub(indent, '\\t', one_indent)\n+      end)\n+      table.insert(adjusted_snippet_text, base_indent .. line)\n+    end\n+  end\n+  return table.concat(adjusted_snippet_text, '\\n')\n+end\n+\n+---Get range from extmark.\n+---@param ns integer\n+---@param mark_id vim.snippet.MarkId\n+---@return vim.snippet.Range\n+local function get_range_from_mark(ns, mark_id)\n+  local mark = vim.api.nvim_buf_get_extmark_by_id(0, ns, mark_id, { details = true })\n+  local s = { mark[1], mark[2] }\n+  local e = { mark[3].end_row, mark[3].end_col }\n+  if s[1] > e[1] or (s[1] == e[1] and s[2] > e[2]) then\n+    local t = s\n+    s = e\n+    e = t\n+  end\n+  return { s = s, e = e }\n+end\n+\n+---Get text from range.\n+---@param range vim.snippet.Range\n+---@return string\n+local function get_text_by_range(range)\n+  local lines = vim.api.nvim_buf_get_lines(0, range.s[1], range.e[1] + 1, false)\n+  if range.s[1] ~= range.e[1] then\n+    lines[1] = string.sub(lines[1], range.s[2] + 1)\n+    lines[#lines] = string.sub(lines[#lines], 1, range.e[2])\n+  else\n+    lines[1] = string.sub(lines[1], range.s[2] + 1, range.e[2])\n+  end\n+  return table.concat(lines, '\\n')\n+end\n+\n+---Traverse snippet ast.\n+---The `context.range` is calculated by `tostring(node)`, so it can be used only for processing before snippet insertion.\n+---@param snippet_node table\n+---@param callback fun(node: table, context: vim.snippet.TraverseContext): table|nil\n+local function traverse(snippet_node, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334295676",
            "id": 1334295676,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Ph7x8",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 136,
            "original_position": 132,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1639826656,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334295676/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T12:10:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334295676",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334298996"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334298996"
                }
            },
            "author_association": "MEMBER",
            "body": "yet more cases for the Position/Range discussion https://github.com/neovim/neovim/issues/25509\r\n\r\nNot a blocker, just for reference.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T12:13:14Z",
            "diff_hunk": "@@ -0,0 +1,726 @@\n+local lsp_snippet = require('vim.lsp._snippet')\n+\n+---@alias vim.snippet.MarkId integer\n+---@alias vim.snippet.Tabstop integer\n+---@alias vim.snippet.Changenr integer\n+---@alias vim.snippet.Position { [1]: integer, [2]: integer } # The 0-origin utf8 byte index.\n+---@alias vim.snippet.Range { s: vim.snippet.Position, e: vim.snippet.Position } # The 0-origin utf8 byte index.\n+\n+---@class vim.snippet.TraverseContext\n+---@field depth integer\n+---@field range vim.snippet.Range\n+---@field replace fun(new_node: vim.lsp.snippet.Node): nil\n+\n+---Feed keys.\n+---NOTE: This always enables `virtualedit=onemore`\n+---@param keys string\n+local function feedkeys(keys)\n+  local k = {}\n+  table.insert(k, '<Cmd>set virtualedit=onemore<CR>')\n+  table.insert(k, keys)\n+  table.insert(k, ('<Cmd>set virtualedit=%s<CR>'):format(vim.o.virtualedit))\n+  vim.api.nvim_feedkeys(vim.api.nvim_replace_termcodes(table.concat(k), true, true, true), 'ni', true)\n+end\n+\n+---Return true if range contains position.\n+---@param range vim.snippet.Range\n+---@param position vim.snippet.Position\n+---@return boolean\n+local function within(range, position)\n+  -- Check the cursor is before the range start position.\n+  if position[1] < range.s[1] or (position[1] == range.s[1] and position[2] < range.s[2]) then\n+    return false\n+  end\n+\n+  -- Check the cursor is after the range end position.\n+  if range.e[1] < position[1] or (range.e[1] == position[1] and range.e[2] < position[2]) then\n+    return false\n+  end\n+\n+  return true\n+end\n+\n+---Return cursor position.\n+---@return vim.snippet.Position\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+---Return one indent string of current buffer.\n+---@return string\n+local function get_one_indent()\n+  local expandtab = vim.api.nvim_get_option('expandtab')\n+  if not expandtab then\n+    return '\\t'\n+  end\n+  local shiftwidth = vim.api.nvim_get_option('shiftwidth')\n+  if shiftwidth > 0 then\n+    return string.rep(' ', shiftwidth)\n+  end\n+  return string.rep(' ', vim.api.nvim_get_option('tabstop'))\n+end\n+\n+---Return base indent of current line.\n+---@return string\n+local function get_base_indent()\n+  return string.match(vim.api.nvim_get_current_line(), '^%s*') or ''\n+end\n+\n+---Adjust snippet indent\n+---@param snippet_text string\n+---@return string\n+local function adjust_indent(snippet_text)\n+  local one_indent = get_one_indent()\n+  local base_indent = get_base_indent()\n+\n+  local adjusted_snippet_text = {}\n+  local snippet_lines = vim.split(snippet_text, '\\n', { plain = true })\n+  for i, line in ipairs(snippet_lines) do\n+    if i == 1 then\n+      -- Use first line as-is.\n+      table.insert(adjusted_snippet_text, line)\n+    elseif i ~= #snippet_lines and string.match(line, '^%s*$') then\n+      -- Remove space only lines except the last line.\n+      table.insert(adjusted_snippet_text, '')\n+    else\n+      -- 1. Change \\t as one_indent.\n+      -- 2. Add base_indent.\n+      line = string.gsub(line, '^(\\t+)', function(indent)\n+        return string.gsub(indent, '\\t', one_indent)\n+      end)\n+      table.insert(adjusted_snippet_text, base_indent .. line)\n+    end\n+  end\n+  return table.concat(adjusted_snippet_text, '\\n')\n+end\n+\n+---Get range from extmark.\n+---@param ns integer\n+---@param mark_id vim.snippet.MarkId\n+---@return vim.snippet.Range\n+local function get_range_from_mark(ns, mark_id)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334298996",
            "id": 1334298996,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Ph8l0",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 106,
            "original_position": 102,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1639831592,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334298996/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-05T09:44:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334298996",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334310739"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334310739"
                }
            },
            "author_association": "MEMBER",
            "body": "I still don't understand what's so offensive about ASCII values 65-90. Does your font have particularly bad glyphs for this range or something?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T12:24:51Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334310739",
            "id": 1334310739,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Ph_dT",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1639849741,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 4,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334310739/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T12:24:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334310739",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334337319"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334337319"
                }
            },
            "author_association": "MEMBER",
            "body": "I see it as a cargo-cult (a useless, mindless habit). I obviously don't agree that it reduces to being offended by a character range.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T12:49:36Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334337319",
            "id": 1334337319,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PiF8n",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1639889718,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334337319/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T12:51:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334337319",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334384246"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334384246"
                }
            },
            "author_association": "MEMBER",
            "body": "> I obviously don't agree that it reduces to being offended by a character range.\r\n\r\nOn that twitter thread you wrote:\r\n\r\n> Do prefer kOhShitHereComesAKonstant? \r\n>\r\n> sure, the k is less noisy than uppercase + underscores. \r\n>\r\n> why does this single property of a variable matter so much compared to all other possible dimensions ?\r\n\r\nI can only read this as a distaste for consecutive ASCII 65-90,95, whilst also suggesting that extra unrelated `k`'s are ok ü§î.\r\n\r\nI've explained this before....\r\n\r\nBeing able to easily determine whether something is state or not, statically, **is** a very important property in all programming domains. I hope that's something we can agree on. Using uppercase for this has simply become a popular convention. If there are other, better, ways to do it then I'm sure the cult is open to suggestions.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T13:29:41Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334384246",
            "id": 1334384246,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PiRZ2",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1639963684,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334384246/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T13:29:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334384246",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334408340"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334408340"
                }
            },
            "author_association": "MEMBER",
            "body": "> I can only read this as a distaste for consecutive ASCII 65-90,95, whilst also suggesting that extra unrelated `k`'s are ok ü§î.\r\n\r\nNo, it's a distaste for cargo cults. The \"k\" thing is a C workaround and totally irrelevant for other languages, which is where the vast majority of the cargo cult continues to practice.\r\n\r\n> Being able to easily determine whether something is state or not, statically, is a very important property in all programming domains.\r\n\r\nIn this case the symbols are part of a table. An enum is similar. Both are statically analyzable.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T13:48:32Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334408340",
            "id": 1334408340,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PiXSU",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1640000624,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334408340/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T14:00:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334408340",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334448482"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334448482"
                }
            },
            "author_association": "MEMBER",
            "body": "> No, it's a distaste for cargo cults.\r\n\r\nUp until now, I've not seen any evidence presented that this is one. I've only seen your opinion that you think const-ness isn't important when it comes to readability, which I deeply disagree with. I refactored enough code at this point to know this. Further repeating \"cargo cult\" (on its own) makes this increasingly frustrating.\r\n\r\n> Both are statically analyzable.\r\n\r\nWe have no tools other than `@enum` for that, and because of that we don't uppercase enums nor do we have a convention to indicate whether a symbol is a table or not. Inlay hints can do that for us, and even clangd now does a very good job with semantic tokens at differentiating const-ness without the need for a naming convention.\r\n\r\nIn this case it's unlikely `SNIPPET` is going to be used as a symbol by itself and is likely to be prefixed with `Node.type.`, so it's unlikely that convention is beneficial here. And as you suggest, this could be an `@enum`.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T14:19:45Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334448482",
            "id": 1334448482,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PihFi",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1640065088,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334448482/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T14:19:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334448482",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334463365"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334463365"
                }
            },
            "author_association": "MEMBER",
            "body": "> even clangd now does a very good job with semantic tokens at differentiating const-ness without the need for a naming convention.\r\n\r\nWe're in violent agreement? üòÖ ",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T14:31:43Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334463365",
            "id": 1334463365,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PikuF",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1640088700,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334463365/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T14:31:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334463365",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334475288"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334475288"
                }
            },
            "author_association": "MEMBER",
            "body": "Lua 5.1, unlike C (or even Javascript) does not have language level attributes for const-ness, and LuaLS currently has no `@const` annotation. So.... our only choice to provide such a distinction to code readers is via naming convention. The same applies to python, bash, tcl, etc.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T14:40:31Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334475288",
            "id": 1334475288,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PinoY",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1640108199,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334475288/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T14:40:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334475288",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334490395"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334490395"
                }
            },
            "author_association": "MEMBER",
            "body": "Yet most javascript programmers follow the convention. Hence \"cargo cult\".\r\n\r\nRegarding Lua: it's not something I will insist on in our codebase, but the argument for it has a shelf-life that is expiring.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T14:52:48Z",
            "diff_hunk": "@@ -173,32 +173,33 @@ P.seq = function(...)\n   end\n end\n \n-local Node = {}\n-\n-Node.Type = {\n-  SNIPPET = 0,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334490395",
            "id": 1334490395,
            "in_reply_to_id": 1334293206,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PirUb",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 179,
            "original_position": 7,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_snippet.lua",
            "position": null,
            "pull_request_review_id": 1640130799,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334490395/reactions"
            },
            "side": "LEFT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T14:52:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334490395",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1334623207"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334623207"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "oh yay another use case! just left a status update on that PR",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-09-22T16:54:00Z",
            "diff_hunk": "@@ -0,0 +1,726 @@\n+local lsp_snippet = require('vim.lsp._snippet')\n+\n+---@alias vim.snippet.MarkId integer\n+---@alias vim.snippet.Tabstop integer\n+---@alias vim.snippet.Changenr integer\n+---@alias vim.snippet.Position { [1]: integer, [2]: integer } # The 0-origin utf8 byte index.\n+---@alias vim.snippet.Range { s: vim.snippet.Position, e: vim.snippet.Position } # The 0-origin utf8 byte index.\n+\n+---@class vim.snippet.TraverseContext\n+---@field depth integer\n+---@field range vim.snippet.Range\n+---@field replace fun(new_node: vim.lsp.snippet.Node): nil\n+\n+---Feed keys.\n+---NOTE: This always enables `virtualedit=onemore`\n+---@param keys string\n+local function feedkeys(keys)\n+  local k = {}\n+  table.insert(k, '<Cmd>set virtualedit=onemore<CR>')\n+  table.insert(k, keys)\n+  table.insert(k, ('<Cmd>set virtualedit=%s<CR>'):format(vim.o.virtualedit))\n+  vim.api.nvim_feedkeys(vim.api.nvim_replace_termcodes(table.concat(k), true, true, true), 'ni', true)\n+end\n+\n+---Return true if range contains position.\n+---@param range vim.snippet.Range\n+---@param position vim.snippet.Position\n+---@return boolean\n+local function within(range, position)\n+  -- Check the cursor is before the range start position.\n+  if position[1] < range.s[1] or (position[1] == range.s[1] and position[2] < range.s[2]) then\n+    return false\n+  end\n+\n+  -- Check the cursor is after the range end position.\n+  if range.e[1] < position[1] or (range.e[1] == position[1] and range.e[2] < position[2]) then\n+    return false\n+  end\n+\n+  return true\n+end\n+\n+---Return cursor position.\n+---@return vim.snippet.Position\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+---Return one indent string of current buffer.\n+---@return string\n+local function get_one_indent()\n+  local expandtab = vim.api.nvim_get_option('expandtab')\n+  if not expandtab then\n+    return '\\t'\n+  end\n+  local shiftwidth = vim.api.nvim_get_option('shiftwidth')\n+  if shiftwidth > 0 then\n+    return string.rep(' ', shiftwidth)\n+  end\n+  return string.rep(' ', vim.api.nvim_get_option('tabstop'))\n+end\n+\n+---Return base indent of current line.\n+---@return string\n+local function get_base_indent()\n+  return string.match(vim.api.nvim_get_current_line(), '^%s*') or ''\n+end\n+\n+---Adjust snippet indent\n+---@param snippet_text string\n+---@return string\n+local function adjust_indent(snippet_text)\n+  local one_indent = get_one_indent()\n+  local base_indent = get_base_indent()\n+\n+  local adjusted_snippet_text = {}\n+  local snippet_lines = vim.split(snippet_text, '\\n', { plain = true })\n+  for i, line in ipairs(snippet_lines) do\n+    if i == 1 then\n+      -- Use first line as-is.\n+      table.insert(adjusted_snippet_text, line)\n+    elseif i ~= #snippet_lines and string.match(line, '^%s*$') then\n+      -- Remove space only lines except the last line.\n+      table.insert(adjusted_snippet_text, '')\n+    else\n+      -- 1. Change \\t as one_indent.\n+      -- 2. Add base_indent.\n+      line = string.gsub(line, '^(\\t+)', function(indent)\n+        return string.gsub(indent, '\\t', one_indent)\n+      end)\n+      table.insert(adjusted_snippet_text, base_indent .. line)\n+    end\n+  end\n+  return table.concat(adjusted_snippet_text, '\\n')\n+end\n+\n+---Get range from extmark.\n+---@param ns integer\n+---@param mark_id vim.snippet.MarkId\n+---@return vim.snippet.Range\n+local function get_range_from_mark(ns, mark_id)\n+  local mark = vim.api.nvim_buf_get_extmark_by_id(0, ns, mark_id, { details = true })\n+  local s = { mark[1], mark[2] }\n+  local e = { mark[3].end_row, mark[3].end_col }\n+  if s[1] > e[1] or (s[1] == e[1] and s[2] > e[2]) then\n+    local t = s\n+    s = e\n+    e = t\n+  end\n+  return { s = s, e = e }\n+end\n+\n+---Get text from range.\n+---@param range vim.snippet.Range\n+---@return string\n+local function get_text_by_range(range)\n+  local lines = vim.api.nvim_buf_get_lines(0, range.s[1], range.e[1] + 1, false)\n+  if range.s[1] ~= range.e[1] then\n+    lines[1] = string.sub(lines[1], range.s[2] + 1)\n+    lines[#lines] = string.sub(lines[#lines], 1, range.e[2])\n+  else\n+    lines[1] = string.sub(lines[1], range.s[2] + 1, range.e[2])\n+  end\n+  return table.concat(lines, '\\n')\n+end\n+\n+---Traverse snippet ast.\n+---The `context.range` is calculated by `tostring(node)`, so it can be used only for processing before snippet insertion.\n+---@param snippet_node table\n+---@param callback fun(node: table, context: vim.snippet.TraverseContext): table|nil\n+local function traverse(snippet_node, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1334623207",
            "id": 1334623207,
            "in_reply_to_id": 1334295676,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5PjLvn",
            "original_commit_id": "98ac771c1b9497c38c6d59d49b9c1db5ed80c274",
            "original_line": 136,
            "original_position": 132,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1640338568,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334623207/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-09-22T16:54:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1334623207",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5601392?v=4",
                "events_url": "https://api.github.com/users/llllvvuu/events{/privacy}",
                "followers_url": "https://api.github.com/users/llllvvuu/followers",
                "following_url": "https://api.github.com/users/llllvvuu/following{/other_user}",
                "gists_url": "https://api.github.com/users/llllvvuu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/llllvvuu",
                "id": 5601392,
                "login": "llllvvuu",
                "node_id": "MDQ6VXNlcjU2MDEzOTI=",
                "organizations_url": "https://api.github.com/users/llllvvuu/orgs",
                "received_events_url": "https://api.github.com/users/llllvvuu/received_events",
                "repos_url": "https://api.github.com/users/llllvvuu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/llllvvuu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/llllvvuu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/llllvvuu"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1348178743"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348178743"
                }
            },
            "author_association": "MEMBER",
            "body": "LSP defines this variable as the currently selected text or the empty string. However snippet expansion/insertion will always (?) happen in insert mode, so there won't be a visual selection, and I don't want to use `'<`/`'>` since it might not be intended for the last visual selection to be inserted here.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T02:28:35Z",
            "diff_hunk": "@@ -0,0 +1,66 @@\n+local grammar = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { [1]: integer, [2]: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+--- Resolves variables.\n+--- @param var string\n+--- @return integer|string|nil\n+local function get_variable_value(var)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return ''",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1348178743",
            "id": 1348178743,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QW5M3",
            "original_commit_id": "37f8b93133d7e287631eb4f867d7cb1e2074d365",
            "original_line": 15,
            "original_position": 15,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1661022385,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348178743/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-06T02:28:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348178743",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1348374702"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348374702"
                }
            },
            "author_association": "MEMBER",
            "body": "If snippet expansion always happens in insert-mode, what is the intention of this case?\r\n\r\nNote that vim has `:help Select-mode` (as opposed to `:help Visual-mode`) which behaves more like selections in other text editors. Unfortunately It sets `'<`/`'>`, and `visualmode()` doesn't give a hint about whether the last mode was select-mode or visual-mode. But `mode()` does the right thing if we are currently in select-mode.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T07:55:50Z",
            "diff_hunk": "@@ -0,0 +1,66 @@\n+local grammar = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { [1]: integer, [2]: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+--- Resolves variables.\n+--- @param var string\n+--- @return integer|string|nil\n+local function get_variable_value(var)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return ''",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1348374702",
            "id": 1348374702,
            "in_reply_to_id": 1348178743,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QXpCu",
            "original_commit_id": "37f8b93133d7e287631eb4f867d7cb1e2074d365",
            "original_line": 15,
            "original_position": 15,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1661316009,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348374702/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-06T07:55:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348374702",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1348377518"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348377518"
                }
            },
            "author_association": "MEMBER",
            "body": "The issue here is that the LSP spec describes (poorly) how variables should work with defaults, even if that combination doesn't make sense in the vast majority of cases; this is one of the \"nonsense\" combinations. Nevertheless, if we want to implement the spec, we need to handle them somehow.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T07:58:32Z",
            "diff_hunk": "@@ -0,0 +1,66 @@\n+local grammar = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { [1]: integer, [2]: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+--- Resolves variables.\n+--- @param var string\n+--- @return integer|string|nil\n+local function get_variable_value(var)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return ''",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1348377518",
            "id": 1348377518,
            "in_reply_to_id": 1348178743,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QXpuu",
            "original_commit_id": "37f8b93133d7e287631eb4f867d7cb1e2074d365",
            "original_line": 15,
            "original_position": 15,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1661320360,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348377518/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-06T07:58:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348377518",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1348378929"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348378929"
                }
            },
            "author_association": "MEMBER",
            "body": "(This case is much more relevant for snippet _plugins_ that implement manual triggers; it's not relevant to expanding LSP snippets from completion items.)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T07:59:55Z",
            "diff_hunk": "@@ -0,0 +1,66 @@\n+local grammar = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { [1]: integer, [2]: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+--- Resolves variables.\n+--- @param var string\n+--- @return integer|string|nil\n+local function get_variable_value(var)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return ''",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1348378929",
            "id": 1348378929,
            "in_reply_to_id": 1348178743,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QXqEx",
            "original_commit_id": "37f8b93133d7e287631eb4f867d7cb1e2074d365",
            "original_line": 15,
            "original_position": 15,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1661322616,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348378929/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-06T07:59:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348378929",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1348941381"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348941381"
                }
            },
            "author_association": "MEMBER",
            "body": "Right. I also need to have this case because `TM_SELECTED_TEXT` is a defined variable, and so even if we noop for it we would insert its default if present.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T16:24:59Z",
            "diff_hunk": "@@ -0,0 +1,66 @@\n+local grammar = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { [1]: integer, [2]: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+--- Resolves variables.\n+--- @param var string\n+--- @return integer|string|nil\n+local function get_variable_value(var)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return ''",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1348941381",
            "id": 1348941381,
            "in_reply_to_id": 1348178743,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QZzZF",
            "original_commit_id": "37f8b93133d7e287631eb4f867d7cb1e2074d365",
            "original_line": 15,
            "original_position": 15,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1662248615,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348941381/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-06T16:25:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348941381",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1348947069"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348947069"
                }
            },
            "author_association": "MEMBER",
            "body": "Sure, we need to handle whatever the spec demands; I'm just saying don't sweat it if it doesn't make sense ;)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T16:27:19Z",
            "diff_hunk": "@@ -0,0 +1,66 @@\n+local grammar = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { [1]: integer, [2]: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { cursor[1] - 1, cursor[2] }\n+end\n+\n+--- Resolves variables.\n+--- @param var string\n+--- @return integer|string|nil\n+local function get_variable_value(var)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return ''",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1348947069",
            "id": 1348947069,
            "in_reply_to_id": 1348178743,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QZ0x9",
            "original_commit_id": "37f8b93133d7e287631eb4f867d7cb1e2074d365",
            "original_line": 15,
            "original_position": 15,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1662257323,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348947069/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-06T16:27:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1348947069",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1349177134"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349177134"
                }
            },
            "author_association": "MEMBER",
            "body": "Note that the snippet grammar says that the variable's default can be any node, but here I'm just assuming that their string representation should be inserted and not doing any extra parsing.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-06T18:22:21Z",
            "diff_hunk": "@@ -0,0 +1,84 @@\n+local G = require('_snippet_grammar')\n+\n+--- Returns the current cursor position (0-based).\n+--- @return { line: integer, col: integer }\n+local function cursor_position()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return { line = cursor[1] - 1, col = cursor[2] }\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default? string\n+--- @return integer|string|nil\n+local function resolve_variable(var, default)\n+  if var == 'TM_SELECTED_TEXT' then\n+    return default or ''\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return vim.fn.expand('<cword>') --[[@as string]]\n+      or default\n+  elseif var == 'TM_LINE_INDEX' then\n+    return cursor_position().line\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return cursor_position().line + 1\n+  end\n+\n+  local bufname = vim.api.nvim_buf_get_name(0)\n+  if bufname == '' then\n+    return default\n+  end\n+  if var == 'TM_FILENAME' then\n+    return vim.fn.fnamemodify(bufname, ':p:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    local filename_base = vim.fn.fnamemodify(bufname, ':p:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return vim.fn.fnamemodify(bufname, ':p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return bufname\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- @alias vim.snippet.Direction\n+--- | -1 # Previous\n+--- | 1 # Next\n+\n+local M = {}\n+\n+--- @param direction vim.snippet.Direction\n+function M.jumpable(direction) end\n+\n+--- @param direction vim.snippet.Direction\n+function M.jump(direction) end\n+\n+--- Expands the given snippet text.\n+--- @param snippet_text string\n+function M.expand(snippet_text)\n+  local snippet = G.parse(snippet_text)\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Variable then\n+      --- @cast data vim.snippet.VariableData\n+      -- Try to get the variable's value.\n+      local value = resolve_variable(data.name, tostring(data.default))",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1349177134",
            "id": 1349177134,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Qas8u",
            "original_commit_id": "34c1ba3cf3a1422146b522ca2acaccc12f316d11",
            "original_line": 75,
            "original_position": 75,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1662579417,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349177134/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-08T05:41:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349177134",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1349610621"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349610621"
                }
            },
            "author_association": "MEMBER",
            "body": "Sorry for the unrelated change. When using this function I noticed the missing type annotations and decided to piggy-back the fix here.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-08T02:25:03Z",
            "diff_hunk": "@@ -8049,7 +8049,7 @@ function vim.fn.shellescape(string, special) end\n --- will be assumed.\n ---\n --- @param col? integer\n---- @return any\n+--- @return integer",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1349610621",
            "id": 1349610621,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5QcWx9",
            "original_commit_id": "68de01ff2e4c90e534d8c0ef55437e9d00c3e156",
            "original_line": 8058,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/_meta/vimfn.lua",
            "position": null,
            "pull_request_review_id": 1663145505,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349610621/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-08T02:25:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349610621",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1349610930"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349610930"
                }
            },
            "author_association": "MEMBER",
            "body": "I didn't want to define yet another range type and so I opted to use `Range4` here. It might be confusing given that the definition lives in the treesitter module, but it also seems like there's a spike in refactoring the entire position/range API (#25509) so I'm unsure of what would be the best action right now.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-08T02:28:33Z",
            "diff_hunk": "@@ -0,0 +1,286 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  end\n+\n+  if var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+--- @param cursor_row integer\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1349610930",
            "id": 1349610930,
            "line": 73,
            "node_id": "PRRC_kwDOAPphoM5QcW2y",
            "original_commit_id": "68de01ff2e4c90e534d8c0ef55437e9d00c3e156",
            "original_line": 73,
            "original_position": 92,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 73,
            "pull_request_review_id": 1663145788,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349610930/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-08T05:42:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1349610930",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1354293038"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1354293038"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "LSP ranges are more annoying than Tree-sitter ranges due the string keys, but Tree-sitter is further conceptually from snippets. Tricky. It may depend on if the return value will be directly passed into other functions that do have a defined API, but if there's an impending refactor like you said, maybe don't need to think too much about this",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-11T07:12:03Z",
            "diff_hunk": "@@ -0,0 +1,286 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  end\n+\n+  if var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+--- @param cursor_row integer\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1354293038",
            "id": 1354293038,
            "in_reply_to_id": 1349610930,
            "line": 73,
            "node_id": "PRRC_kwDOAPphoM5QuN8u",
            "original_commit_id": "68de01ff2e4c90e534d8c0ef55437e9d00c3e156",
            "original_line": 73,
            "original_position": 92,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 73,
            "pull_request_review_id": 1670204785,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1354293038/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-12T06:17:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1354293038",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5601392?v=4",
                "events_url": "https://api.github.com/users/llllvvuu/events{/privacy}",
                "followers_url": "https://api.github.com/users/llllvvuu/followers",
                "following_url": "https://api.github.com/users/llllvvuu/following{/other_user}",
                "gists_url": "https://api.github.com/users/llllvvuu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/llllvvuu",
                "id": 5601392,
                "login": "llllvvuu",
                "node_id": "MDQ6VXNlcjU2MDEzOTI=",
                "organizations_url": "https://api.github.com/users/llllvvuu/orgs",
                "received_events_url": "https://api.github.com/users/llllvvuu/received_events",
                "repos_url": "https://api.github.com/users/llllvvuu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/llllvvuu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/llllvvuu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/llllvvuu"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1356097372"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1356097372"
                }
            },
            "author_association": "MEMBER",
            "body": "Stale comment. I ended up doing this in a separate PR.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-12T06:01:54Z",
            "diff_hunk": "@@ -8049,7 +8049,7 @@ function vim.fn.shellescape(string, special) end\n --- will be assumed.\n ---\n --- @param col? integer\n---- @return any\n+--- @return integer",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1356097372",
            "id": 1356097372,
            "in_reply_to_id": 1349610621,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Q1Gdc",
            "original_commit_id": "68de01ff2e4c90e534d8c0ef55437e9d00c3e156",
            "original_line": 8058,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/_meta/vimfn.lua",
            "position": null,
            "pull_request_review_id": 1673086416,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1356097372/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-12T06:01:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1356097372",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1356137714"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1356137714"
                }
            },
            "author_association": "MEMBER",
            "body": "Right, but here I'm not dealing with ranges as defined by the LSP spec (I'm not receiving or sending LSP objects from the client directly), this is just for me to be able to represent the range of a snippet tabstop in a less verbose way.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-12T06:34:07Z",
            "diff_hunk": "@@ -0,0 +1,286 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  end\n+\n+  if var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+--- @param cursor_row integer\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1356137714",
            "id": 1356137714,
            "in_reply_to_id": 1349610930,
            "line": 73,
            "node_id": "PRRC_kwDOAPphoM5Q1QTy",
            "original_commit_id": "68de01ff2e4c90e534d8c0ef55437e9d00c3e156",
            "original_line": 73,
            "original_position": 92,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 73,
            "pull_request_review_id": 1673145994,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1356137714/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-12T06:34:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1356137714",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359068313"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359068313"
                }
            },
            "author_association": "MEMBER",
            "body": "@lewis6991 @clason @gpanders or anyone else that's familiar with the intricacies of the type generator: I just want to generate the documentation for the returned table in this module (`M`, which has the public snippet API). As noticed in this diff, `gen_vimdoc` is also including the other utility classes in this module (`Session` and `Tabstop`). I guess I can try just marking all of those methods with `@nodoc` to prevent them being included here, but that's cumbersome. Do you know of a better workaround with the existing doc infrastructure? ",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T02:28:29Z",
            "diff_hunk": "@@ -3670,4 +3670,87 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+cancel()                                                    *snippet.cancel()*\n+    Cancels the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text.\n+\n+    Parameters: ~\n+      ‚Ä¢ {input}  (string)\n+\n+jump({direction})                                             *snippet.jump()*\n+    Jumps (if possible) within the active snippet in the given direction.\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  vim.snippet.Direction\n+\n+jumpable({direction})                                     *snippet.jumpable()*\n+    @alias vim.snippet.Direction | -1 # Previous | 1 # Next Returns `true` if\n+    there is an active snippet which can be jumped in the given direction.\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  vim.snippet.Direction\n+\n+    Return: ~\n+        (boolean)\n+\n+new({index}, {bufnr}, {range})                                 *snippet.new()*",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359068313",
            "id": 1359068313,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RAbyZ",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 3708,
            "original_position": 39,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": null,
            "pull_request_review_id": 1677679555,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359068313/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T02:28:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359068313",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359180584"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359180584"
                }
            },
            "author_association": "MEMBER",
            "body": "Maybe worth linking to the grammar definition, so users know what kind of input is accepted.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:13:35Z",
            "diff_hunk": "@@ -3670,4 +3670,87 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+cancel()                                                    *snippet.cancel()*\n+    Cancels the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text.\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359180584",
            "id": 1359180584,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA3Mo",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 3688,
            "original_position": 19,
            "original_start_line": 3687,
            "path": "runtime/doc/lua.txt",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359180584/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359180584",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359200714"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359200714"
                }
            },
            "author_association": "MEMBER",
            "body": "Is removing newlines part of the spec? If a snippet contains them, shouldn't they be preserved?\r\n\r\n---\r\n\r\nJust as info: I suspect using `vim.tbl_filter` would be more efficient as it avoids the concat/split work. Fine to keep as well given that this is not run in an inner loop or performance sensitive.\r\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:19:39Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359200714",
            "id": 1359200714,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8HK",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359200714/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359200714",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359201179"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359201179"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n```\r\n\r\nI suspect this isn't needed?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:24:29Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359201179",
            "id": 1359201179,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8Ob",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 126,
            "original_position": 126,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359201179/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359201179",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359201357"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359201357"
                }
            },
            "author_association": "MEMBER",
            "body": "Could using `nvim_buf_get_text` simplify this due to its column parameters?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:26:06Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359201357",
            "id": 1359201357,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8RN",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 168,
            "original_position": 168,
            "original_start_line": 166,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359201357/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359201357",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202067"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202067"
                }
            },
            "author_association": "MEMBER",
            "body": "Is this intentionally mutating the `Session` object?\r\nIf not:\r\n\r\n\r\n```suggestion\r\nfunction Session.new()\r\n  local state = {\r\n    bufnr = vim.api.nvim_get_current_buf(),\r\n    tabstops = {},\r\n    current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\r\n  }\r\n  return setmetatable(state, __index = Session)\r\nend\r\n```\r\n\r\nIf it is intentional, I'd tend towards using a regular global table, without class style because class style usually involves different instances with encapsulated state.\r\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:32:58Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202067",
            "id": 1359202067,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8cT",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 175,
            "original_position": 203,
            "original_start_line": 197,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202067/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202067",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202510"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202510"
                }
            },
            "author_association": "MEMBER",
            "body": "Would `api.nvim_win_set_cursor` also work here? If not - maybe add a comment why it can't be used",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:34:31Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202510",
            "id": 1359202510,
            "line": 237,
            "node_id": "PRRC_kwDOAPphoM5RA8jO",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 237,
            "original_position": 242,
            "original_start_line": 238,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 237,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202510/reactions"
            },
            "side": "RIGHT",
            "start_line": 233,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202510",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202677"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202677"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n  local mode = vim.fn.mode()\r\n  -- For empty and the final tabstop, start insert mode at the end of the range.\r\n  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\r\n    if mode ~= 'i' then\r\n      if mode == 's' then\r\n        feedkeys('<Esc>')\r\n      end\r\n      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\r\n    end\r\n  else\r\n    -- Else, select the tabstop's text.\r\n    if mode ~= 'n' then\r\n      feedkeys('<Esc>')\r\n    end\r\n    move_cursor_to(range[1] + 1, range[2] + 1)\r\n    feedkeys('v')\r\n    move_cursor_to(range[3] + 1, range[4])\r\n    feedkeys('o<c-g>')\r\n  end\r\nend\r\n```\r\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:36:26Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if vim.fn.mode() ~= 'i' then\n+      if vim.fn.mode() == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if vim.fn.mode() ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202677",
            "id": 1359202677,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8l1",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 263,
            "original_position": 267,
            "original_start_line": 249,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202677/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202677",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202827"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202827"
                }
            },
            "author_association": "MEMBER",
            "body": "Is there any downside to having it?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:38:25Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if vim.fn.mode() ~= 'i' then\n+      if vim.fn.mode() == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if vim.fn.mode() ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M.session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M.session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so cancel the session.\n+      M.cancel()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M.session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M.session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M.session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M.session = Session:init()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])\n+    elseif type == G.NodeType.Variable then\n+      --- @cast data vim.snippet.VariableData\n+      -- Try to get the variable's value.\n+      local value = resolve_variable(data.name, data.default and tostring(data.default) or '')\n+      if not value then\n+        -- Unknown variable, make this a tabstop and use the variable name as a placeholder.\n+        value = data.name\n+        local tabstop_indexes = vim.tbl_keys(tabstop_ranges)\n+        local index = math.max(unpack((#tabstop_indexes == 0 and { 0 }) or tabstop_indexes)) + 1\n+        add_tabstop(index, value)\n+      end\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Text then\n+      --- @cast data vim.snippet.TextData\n+      append_to_snippet(snippet_text, data.text)\n+    end\n+  end\n+\n+  -- $0, which defaults to the end of the snippet, defines the final cursor position.\n+  -- Make sure the snippet has exactly one of these.\n+  if vim.tbl_contains(vim.tbl_keys(tabstop_ranges), 0) then\n+    assert(#tabstop_ranges[0] == 1, 'Snippet has multiple $0 tabstops')\n+  else\n+    add_tabstop(0)\n+  end\n+\n+  -- Insert the snippet text.\n+  local cursor_row, cursor_col = cursor_pos()\n+  vim.api.nvim_buf_set_text(\n+    M.session.bufnr,\n+    cursor_row,\n+    cursor_col,\n+    cursor_row,\n+    cursor_col,\n+    remove_newlines(snippet_text)\n+  )\n+\n+  -- Create the tabstop extmarks.\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      M.session:add_tabstop(index, range)\n+    end\n+  end\n+\n+  -- Jump to the first tabstop.\n+  M.jump(1)\n+end\n+\n+--- @alias vim.snippet.Direction\n+--- | -1 # Previous\n+--- | 1 # Next\n+\n+--- Returns `true` if there is an active snippet which can be jumped in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+--- @return boolean\n+function M.jumpable(direction)\n+  if not M.active() or M.session:get_num_tabstops() == 0 then\n+    return false\n+  end\n+\n+  if direction == -1 then\n+    return M.session.current_tabstop.index > 1\n+  else\n+    return M.session.current_tabstop.index < M.session:get_num_tabstops()\n+  end\n+end\n+\n+--- Jumps (if possible) within the active snippet in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+function M.jump(direction)\n+  -- TODO: Not sure if we want to have this check or insist on the user to check `jumpable` first.\n+  if not M.jumpable(direction) then\n+    return\n+  end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202827",
            "id": 1359202827,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8oL",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 494,
            "original_position": 439,
            "original_start_line": 436,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202827/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202827",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202974"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202974"
                }
            },
            "author_association": "MEMBER",
            "body": "I think cancel is a good match, and it has the most uses across the codebase:\r\n\r\n```\r\n~/dev/neovim/neovim master\r\n‚Ü™  rg cancel | wc -l\r\n416\r\n\r\n~/dev/neovim/neovim master\r\n‚Ü™  rg discard | wc -l\r\n311\r\n\r\n~/dev/neovim/neovim master\r\n‚Ü™  rg unlink | wc -l\r\n39\r\n\r\n~/dev/neovim/neovim master\r\n‚Ü™  rg dispose | wc -l\r\n3\r\n```",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:39:39Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if vim.fn.mode() ~= 'i' then\n+      if vim.fn.mode() == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if vim.fn.mode() ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M.session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M.session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so cancel the session.\n+      M.cancel()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M.session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M.session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M.session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M.session = Session:init()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])\n+    elseif type == G.NodeType.Variable then\n+      --- @cast data vim.snippet.VariableData\n+      -- Try to get the variable's value.\n+      local value = resolve_variable(data.name, data.default and tostring(data.default) or '')\n+      if not value then\n+        -- Unknown variable, make this a tabstop and use the variable name as a placeholder.\n+        value = data.name\n+        local tabstop_indexes = vim.tbl_keys(tabstop_ranges)\n+        local index = math.max(unpack((#tabstop_indexes == 0 and { 0 }) or tabstop_indexes)) + 1\n+        add_tabstop(index, value)\n+      end\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Text then\n+      --- @cast data vim.snippet.TextData\n+      append_to_snippet(snippet_text, data.text)\n+    end\n+  end\n+\n+  -- $0, which defaults to the end of the snippet, defines the final cursor position.\n+  -- Make sure the snippet has exactly one of these.\n+  if vim.tbl_contains(vim.tbl_keys(tabstop_ranges), 0) then\n+    assert(#tabstop_ranges[0] == 1, 'Snippet has multiple $0 tabstops')\n+  else\n+    add_tabstop(0)\n+  end\n+\n+  -- Insert the snippet text.\n+  local cursor_row, cursor_col = cursor_pos()\n+  vim.api.nvim_buf_set_text(\n+    M.session.bufnr,\n+    cursor_row,\n+    cursor_col,\n+    cursor_row,\n+    cursor_col,\n+    remove_newlines(snippet_text)\n+  )\n+\n+  -- Create the tabstop extmarks.\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      M.session:add_tabstop(index, range)\n+    end\n+  end\n+\n+  -- Jump to the first tabstop.\n+  M.jump(1)\n+end\n+\n+--- @alias vim.snippet.Direction\n+--- | -1 # Previous\n+--- | 1 # Next\n+\n+--- Returns `true` if there is an active snippet which can be jumped in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+--- @return boolean\n+function M.jumpable(direction)\n+  if not M.active() or M.session:get_num_tabstops() == 0 then\n+    return false\n+  end\n+\n+  if direction == -1 then\n+    return M.session.current_tabstop.index > 1\n+  else\n+    return M.session.current_tabstop.index < M.session:get_num_tabstops()\n+  end\n+end\n+\n+--- Jumps (if possible) within the active snippet in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+function M.jump(direction)\n+  -- TODO: Not sure if we want to have this check or insist on the user to check `jumpable` first.\n+  if not M.jumpable(direction) then\n+    return\n+  end\n+\n+  -- Find the tabstop with the lowest range.\n+  local tabstops =\n+    M.session.tabstops[(M.session.current_tabstop.index + direction) % M.session:get_num_tabstops()]\n+  local dest = tabstops[1]\n+  for _, tabstop in ipairs(tabstops) do\n+    local dest_range, range = dest:get_range(), tabstop:get_range()\n+    if (range[1] < dest_range[1]) or (range[1] == dest_range[1] and range[2] < dest_range[2]) then\n+      dest = tabstop\n+    end\n+  end\n+\n+  -- Clear the autocommands so that we can move the cursor freely while selecting the tabstop.\n+  M._clear_autocmds()\n+\n+  M.session.current_tabstop = dest\n+  M._select_stop(dest)\n+\n+  -- Restore the autocommands.\n+  M._setup_autocmds()\n+end\n+\n+--- Returns `true` if there's an active snippet in the current buffer.\n+---\n+--- @return boolean\n+function M.active()\n+  return M.session ~= nil and M.session.bufnr == vim.api.nvim_get_current_buf()\n+end\n+\n+-- TODO: Use another name? discard? dispose? unlink? assassinate?\n+--- Cancels the current snippet.\n+function M.cancel()",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359202974",
            "id": 1359202974,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8qe",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 471,
            "original_position": 471,
            "original_start_line": 469,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677820969,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202974/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:40:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359202974",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359203315"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359203315"
                }
            },
            "author_association": "MEMBER",
            "body": "Oh, I had missed this:\r\n\r\n> since sometimes it does cancel the snippet session but it's also invoked when the snippet navigation is complete. Do we want to give it another name?\r\n\r\nIn that case, maybe `reset` could work?\r\n\r\nIt's also used quite often:\r\n\r\n```\r\n‚Ü™  rg reset | wc -l\r\n1160\r\n```",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T06:42:24Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if vim.fn.mode() ~= 'i' then\n+      if vim.fn.mode() == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if vim.fn.mode() ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M.session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M.session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so cancel the session.\n+      M.cancel()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M.session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M.session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M.session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M.session = Session:init()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])\n+    elseif type == G.NodeType.Variable then\n+      --- @cast data vim.snippet.VariableData\n+      -- Try to get the variable's value.\n+      local value = resolve_variable(data.name, data.default and tostring(data.default) or '')\n+      if not value then\n+        -- Unknown variable, make this a tabstop and use the variable name as a placeholder.\n+        value = data.name\n+        local tabstop_indexes = vim.tbl_keys(tabstop_ranges)\n+        local index = math.max(unpack((#tabstop_indexes == 0 and { 0 }) or tabstop_indexes)) + 1\n+        add_tabstop(index, value)\n+      end\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Text then\n+      --- @cast data vim.snippet.TextData\n+      append_to_snippet(snippet_text, data.text)\n+    end\n+  end\n+\n+  -- $0, which defaults to the end of the snippet, defines the final cursor position.\n+  -- Make sure the snippet has exactly one of these.\n+  if vim.tbl_contains(vim.tbl_keys(tabstop_ranges), 0) then\n+    assert(#tabstop_ranges[0] == 1, 'Snippet has multiple $0 tabstops')\n+  else\n+    add_tabstop(0)\n+  end\n+\n+  -- Insert the snippet text.\n+  local cursor_row, cursor_col = cursor_pos()\n+  vim.api.nvim_buf_set_text(\n+    M.session.bufnr,\n+    cursor_row,\n+    cursor_col,\n+    cursor_row,\n+    cursor_col,\n+    remove_newlines(snippet_text)\n+  )\n+\n+  -- Create the tabstop extmarks.\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      M.session:add_tabstop(index, range)\n+    end\n+  end\n+\n+  -- Jump to the first tabstop.\n+  M.jump(1)\n+end\n+\n+--- @alias vim.snippet.Direction\n+--- | -1 # Previous\n+--- | 1 # Next\n+\n+--- Returns `true` if there is an active snippet which can be jumped in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+--- @return boolean\n+function M.jumpable(direction)\n+  if not M.active() or M.session:get_num_tabstops() == 0 then\n+    return false\n+  end\n+\n+  if direction == -1 then\n+    return M.session.current_tabstop.index > 1\n+  else\n+    return M.session.current_tabstop.index < M.session:get_num_tabstops()\n+  end\n+end\n+\n+--- Jumps (if possible) within the active snippet in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+function M.jump(direction)\n+  -- TODO: Not sure if we want to have this check or insist on the user to check `jumpable` first.\n+  if not M.jumpable(direction) then\n+    return\n+  end\n+\n+  -- Find the tabstop with the lowest range.\n+  local tabstops =\n+    M.session.tabstops[(M.session.current_tabstop.index + direction) % M.session:get_num_tabstops()]\n+  local dest = tabstops[1]\n+  for _, tabstop in ipairs(tabstops) do\n+    local dest_range, range = dest:get_range(), tabstop:get_range()\n+    if (range[1] < dest_range[1]) or (range[1] == dest_range[1] and range[2] < dest_range[2]) then\n+      dest = tabstop\n+    end\n+  end\n+\n+  -- Clear the autocommands so that we can move the cursor freely while selecting the tabstop.\n+  M._clear_autocmds()\n+\n+  M.session.current_tabstop = dest\n+  M._select_stop(dest)\n+\n+  -- Restore the autocommands.\n+  M._setup_autocmds()\n+end\n+\n+--- Returns `true` if there's an active snippet in the current buffer.\n+---\n+--- @return boolean\n+function M.active()\n+  return M.session ~= nil and M.session.bufnr == vim.api.nvim_get_current_buf()\n+end\n+\n+-- TODO: Use another name? discard? dispose? unlink? assassinate?\n+--- Cancels the current snippet.\n+function M.cancel()",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359203315",
            "id": 1359203315,
            "in_reply_to_id": 1359202974,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RA8vz",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 471,
            "original_position": 471,
            "original_start_line": 469,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1677850035,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359203315/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T06:42:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359203315",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359233952"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359233952"
                }
            },
            "author_association": "MEMBER",
            "body": "I think `@nodoc` is The Way, at the moment.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T08:08:57Z",
            "diff_hunk": "@@ -3670,4 +3670,87 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+cancel()                                                    *snippet.cancel()*\n+    Cancels the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text.\n+\n+    Parameters: ~\n+      ‚Ä¢ {input}  (string)\n+\n+jump({direction})                                             *snippet.jump()*\n+    Jumps (if possible) within the active snippet in the given direction.\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  vim.snippet.Direction\n+\n+jumpable({direction})                                     *snippet.jumpable()*\n+    @alias vim.snippet.Direction | -1 # Previous | 1 # Next Returns `true` if\n+    there is an active snippet which can be jumped in the given direction.\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  vim.snippet.Direction\n+\n+    Return: ~\n+        (boolean)\n+\n+new({index}, {bufnr}, {range})                                 *snippet.new()*",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359233952",
            "id": 1359233952,
            "in_reply_to_id": 1359068313,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RBEOg",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 3708,
            "original_position": 39,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": null,
            "pull_request_review_id": 1677892705,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 1,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359233952/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T08:08:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359233952",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359481290"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359481290"
                }
            },
            "author_association": "MEMBER",
            "body": "Maybe `remove_newlines` isn't the best name. I use this utility function to transform input like `foo\\n\\nbar` to `{ 'foo', '', 'bar' }`, since I rely on the number of snippet lines to compute the tabstop positions and to clean the input for `nvim_buf_set_text`.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T16:59:50Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359481290",
            "id": 1359481290,
            "in_reply_to_id": 1359200714,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCAnK",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678227892,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359481290/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T16:59:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359481290",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359486968"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359486968"
                }
            },
            "author_association": "MEMBER",
            "body": "Your suspicion is correct :)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:02:32Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359486968",
            "id": 1359486968,
            "in_reply_to_id": 1359201179,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCB_4",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 126,
            "original_position": 126,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678234698,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359486968/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T17:02:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359486968",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359490121"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359490121"
                }
            },
            "author_association": "MEMBER",
            "body": "I still prefer @clason's suggestion of `exit`. I feel like `reset` doesn't imply that the snippet will be discarded entirely, instead of just reinitialized or something.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:03:59Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if vim.fn.mode() ~= 'i' then\n+      if vim.fn.mode() == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if vim.fn.mode() ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M.session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M.session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so cancel the session.\n+      M.cancel()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M.session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M.session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M.session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M.session = Session:init()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])\n+    elseif type == G.NodeType.Variable then\n+      --- @cast data vim.snippet.VariableData\n+      -- Try to get the variable's value.\n+      local value = resolve_variable(data.name, data.default and tostring(data.default) or '')\n+      if not value then\n+        -- Unknown variable, make this a tabstop and use the variable name as a placeholder.\n+        value = data.name\n+        local tabstop_indexes = vim.tbl_keys(tabstop_ranges)\n+        local index = math.max(unpack((#tabstop_indexes == 0 and { 0 }) or tabstop_indexes)) + 1\n+        add_tabstop(index, value)\n+      end\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Text then\n+      --- @cast data vim.snippet.TextData\n+      append_to_snippet(snippet_text, data.text)\n+    end\n+  end\n+\n+  -- $0, which defaults to the end of the snippet, defines the final cursor position.\n+  -- Make sure the snippet has exactly one of these.\n+  if vim.tbl_contains(vim.tbl_keys(tabstop_ranges), 0) then\n+    assert(#tabstop_ranges[0] == 1, 'Snippet has multiple $0 tabstops')\n+  else\n+    add_tabstop(0)\n+  end\n+\n+  -- Insert the snippet text.\n+  local cursor_row, cursor_col = cursor_pos()\n+  vim.api.nvim_buf_set_text(\n+    M.session.bufnr,\n+    cursor_row,\n+    cursor_col,\n+    cursor_row,\n+    cursor_col,\n+    remove_newlines(snippet_text)\n+  )\n+\n+  -- Create the tabstop extmarks.\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      M.session:add_tabstop(index, range)\n+    end\n+  end\n+\n+  -- Jump to the first tabstop.\n+  M.jump(1)\n+end\n+\n+--- @alias vim.snippet.Direction\n+--- | -1 # Previous\n+--- | 1 # Next\n+\n+--- Returns `true` if there is an active snippet which can be jumped in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+--- @return boolean\n+function M.jumpable(direction)\n+  if not M.active() or M.session:get_num_tabstops() == 0 then\n+    return false\n+  end\n+\n+  if direction == -1 then\n+    return M.session.current_tabstop.index > 1\n+  else\n+    return M.session.current_tabstop.index < M.session:get_num_tabstops()\n+  end\n+end\n+\n+--- Jumps (if possible) within the active snippet in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+function M.jump(direction)\n+  -- TODO: Not sure if we want to have this check or insist on the user to check `jumpable` first.\n+  if not M.jumpable(direction) then\n+    return\n+  end\n+\n+  -- Find the tabstop with the lowest range.\n+  local tabstops =\n+    M.session.tabstops[(M.session.current_tabstop.index + direction) % M.session:get_num_tabstops()]\n+  local dest = tabstops[1]\n+  for _, tabstop in ipairs(tabstops) do\n+    local dest_range, range = dest:get_range(), tabstop:get_range()\n+    if (range[1] < dest_range[1]) or (range[1] == dest_range[1] and range[2] < dest_range[2]) then\n+      dest = tabstop\n+    end\n+  end\n+\n+  -- Clear the autocommands so that we can move the cursor freely while selecting the tabstop.\n+  M._clear_autocmds()\n+\n+  M.session.current_tabstop = dest\n+  M._select_stop(dest)\n+\n+  -- Restore the autocommands.\n+  M._setup_autocmds()\n+end\n+\n+--- Returns `true` if there's an active snippet in the current buffer.\n+---\n+--- @return boolean\n+function M.active()\n+  return M.session ~= nil and M.session.bufnr == vim.api.nvim_get_current_buf()\n+end\n+\n+-- TODO: Use another name? discard? dispose? unlink? assassinate?\n+--- Cancels the current snippet.\n+function M.cancel()",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359490121",
            "id": 1359490121,
            "in_reply_to_id": 1359202974,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCCxJ",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 471,
            "original_position": 471,
            "original_start_line": 469,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678239105,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359490121/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:03:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359490121",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359491392"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359491392"
                }
            },
            "author_association": "MEMBER",
            "body": "Neh. I think it makes sense to keep it.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:04:38Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if vim.fn.mode() ~= 'i' then\n+      if vim.fn.mode() == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if vim.fn.mode() ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M.session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M.session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so cancel the session.\n+      M.cancel()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M.session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M.session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M.session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M.session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M.session = Session:init()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])\n+    elseif type == G.NodeType.Variable then\n+      --- @cast data vim.snippet.VariableData\n+      -- Try to get the variable's value.\n+      local value = resolve_variable(data.name, data.default and tostring(data.default) or '')\n+      if not value then\n+        -- Unknown variable, make this a tabstop and use the variable name as a placeholder.\n+        value = data.name\n+        local tabstop_indexes = vim.tbl_keys(tabstop_ranges)\n+        local index = math.max(unpack((#tabstop_indexes == 0 and { 0 }) or tabstop_indexes)) + 1\n+        add_tabstop(index, value)\n+      end\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Text then\n+      --- @cast data vim.snippet.TextData\n+      append_to_snippet(snippet_text, data.text)\n+    end\n+  end\n+\n+  -- $0, which defaults to the end of the snippet, defines the final cursor position.\n+  -- Make sure the snippet has exactly one of these.\n+  if vim.tbl_contains(vim.tbl_keys(tabstop_ranges), 0) then\n+    assert(#tabstop_ranges[0] == 1, 'Snippet has multiple $0 tabstops')\n+  else\n+    add_tabstop(0)\n+  end\n+\n+  -- Insert the snippet text.\n+  local cursor_row, cursor_col = cursor_pos()\n+  vim.api.nvim_buf_set_text(\n+    M.session.bufnr,\n+    cursor_row,\n+    cursor_col,\n+    cursor_row,\n+    cursor_col,\n+    remove_newlines(snippet_text)\n+  )\n+\n+  -- Create the tabstop extmarks.\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      M.session:add_tabstop(index, range)\n+    end\n+  end\n+\n+  -- Jump to the first tabstop.\n+  M.jump(1)\n+end\n+\n+--- @alias vim.snippet.Direction\n+--- | -1 # Previous\n+--- | 1 # Next\n+\n+--- Returns `true` if there is an active snippet which can be jumped in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+--- @return boolean\n+function M.jumpable(direction)\n+  if not M.active() or M.session:get_num_tabstops() == 0 then\n+    return false\n+  end\n+\n+  if direction == -1 then\n+    return M.session.current_tabstop.index > 1\n+  else\n+    return M.session.current_tabstop.index < M.session:get_num_tabstops()\n+  end\n+end\n+\n+--- Jumps (if possible) within the active snippet in the given direction.\n+---\n+--- @param direction vim.snippet.Direction\n+function M.jump(direction)\n+  -- TODO: Not sure if we want to have this check or insist on the user to check `jumpable` first.\n+  if not M.jumpable(direction) then\n+    return\n+  end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359491392",
            "id": 1359491392,
            "in_reply_to_id": 1359202827,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCDFA",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 494,
            "original_position": 439,
            "original_start_line": 436,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678240821,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359491392/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:04:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359491392",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359493410"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359493410"
                }
            },
            "author_association": "MEMBER",
            "body": "It would.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:15:57Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359493410",
            "id": 1359493410,
            "in_reply_to_id": 1359201357,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCDki",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 168,
            "original_position": 168,
            "original_start_line": 166,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678243326,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359493410/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:15:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359493410",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359494255"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494255"
                }
            },
            "author_association": "MEMBER",
            "body": "Yeah I think I'll just get rid of the `Session` class and move it's functionality to `M` as private bits.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:19:57Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359494255",
            "id": 1359494255,
            "in_reply_to_id": 1359202067,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCDxv",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 175,
            "original_position": 203,
            "original_start_line": 197,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678244349,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494255/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:19:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494255",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359494552"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494552"
                }
            },
            "author_association": "MEMBER",
            "body": "One thing to keep in mind is that we may want to allow plugins to hook into the \"expand and jump\" functionality -- maybe creating a Session would be one way?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:21:43Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359494552",
            "id": 1359494552,
            "in_reply_to_id": 1359202067,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCD2Y",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 175,
            "original_position": 203,
            "original_start_line": 197,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678244738,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494552/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:21:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494552",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359494993"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494993"
                }
            },
            "author_association": "MEMBER",
            "body": "That's a good point, it does allow for better extensibility in the future. I'll create session instances instead then.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:23:36Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359494993",
            "id": 1359494993,
            "in_reply_to_id": 1359202067,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCD9R",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 175,
            "original_position": 203,
            "original_start_line": 197,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678245423,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494993/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:23:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359494993",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359495693"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359495693"
                }
            },
            "author_association": "MEMBER",
            "body": "Maybe just `lines` then? ",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:27:41Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359495693",
            "id": 1359495693,
            "in_reply_to_id": 1359200714,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCEIN",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678246408,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359495693/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T17:27:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359495693",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359500711"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359500711"
                }
            },
            "author_association": "MEMBER",
            "body": "Good question. I initially tried that but for some reason that causes the cursor to end up at the end of the selection instead of the beginning. I used [`nvim-snippy`](https://github.com/dcampos/nvim-snippy/blob/5787f088c99c04309a8aa6363fd3ac9a5a26b780/lua/snippy/main.lua#L39-L53) as a reference to handle tabstop selection and this logic is taken from there.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:41:44Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359500711",
            "id": 1359500711,
            "in_reply_to_id": 1359202510,
            "line": 237,
            "node_id": "PRRC_kwDOAPphoM5RCFWn",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 237,
            "original_position": 242,
            "original_start_line": 238,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 237,
            "pull_request_review_id": 1678254982,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359500711/reactions"
            },
            "side": "RIGHT",
            "start_line": 233,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T17:41:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359500711",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359504982"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359504982"
                }
            },
            "author_association": "MEMBER",
            "body": "I'll name it `text_to_lines`. `lines` feels to variable-y.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T17:47:06Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359504982",
            "id": 1359504982,
            "in_reply_to_id": 1359200714,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RCGZW",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678260388,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359504982/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T17:47:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359504982",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359638941"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359638941"
                }
            },
            "author_association": "MEMBER",
            "body": "I mentioned this in its own bullet instead of putting it under LSP, but lemme know if you want to change that.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T20:35:38Z",
            "diff_hunk": "@@ -189,6 +189,8 @@ The following new APIs and features were added.\n \n ‚Ä¢ Added |:fclose| command.\n \n+‚Ä¢ Added |vim.snippet| for snippet expansion support.",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359638941",
            "id": 1359638941,
            "line": 192,
            "node_id": "PRRC_kwDOAPphoM5RCnGd",
            "original_commit_id": "b7cd2c79d39981fe99ba771edf5e7541b8295410",
            "original_line": 192,
            "original_position": 4,
            "original_start_line": null,
            "path": "runtime/doc/news.txt",
            "position": 4,
            "pull_request_review_id": 1678459440,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359638941/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-14T20:35:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359638941",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359639038"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359639038"
                }
            },
            "author_association": "MEMBER",
            "body": "I've left the requested comment.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-14T20:37:08Z",
            "diff_hunk": "@@ -0,0 +1,482 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Removes newlines from the given text.\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function remove_newlines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(remove_newlines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = remove_newlines(snippet)\n+  local placeholder_text = remove_newlines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+Tabstop.__index = Tabstop\n+\n+--- Creates a new tabstop.\n+---\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  local lines = vim.api.nvim_buf_get_lines(self.bufnr, range[1], range[3] + 1, false)\n+  lines[#lines] = lines[#lines]:sub(1, range[4])\n+  lines[1] = lines[1]:sub(range[2] + 1)\n+\n+  return table.concat(lines, '\\n')\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(\n+    self.bufnr,\n+    range[1],\n+    range[2],\n+    range[3],\n+    range[4],\n+    remove_newlines(text)\n+  )\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Initializes a new snippet session in the current buffer.\n+---\n+--- @return vim.snippet.Session\n+function Session:init()\n+  self.bufnr = vim.api.nvim_get_current_buf()\n+  self.tabstops = {}\n+  self.current_tabstop = Tabstop.new(0, self.bufnr, { 0, 0, 0, 0 })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- Adds a tabstop at the given index and spanning `range`.\n+---\n+--- @param index integer\n+--- @param range Range4\n+function Session:add_tabstop(index, range)\n+  self.tabstops[index] = self.tabstops[index] or {}\n+  table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359639038",
            "id": 1359639038,
            "in_reply_to_id": 1359202510,
            "line": 237,
            "node_id": "PRRC_kwDOAPphoM5RCnH-",
            "original_commit_id": "de47f404633dd871d4c13fbd180a23eee01a4cc5",
            "original_line": 237,
            "original_position": 242,
            "original_start_line": 238,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 237,
            "pull_request_review_id": 1678459574,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359639038/reactions"
            },
            "side": "RIGHT",
            "start_line": 233,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2023-10-14T20:37:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359639038",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1359844151"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359844151"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n--- @field private _session? vim.snippet.Session\r\n```\r\n\r\nTo make it clear that it's private for people who do things like `vim.print(vim.snippet)`",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-15T09:46:12Z",
            "diff_hunk": "@@ -0,0 +1,476 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(text_to_lines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  return {\n+    start_row,\n+    start_col,\n+    start_row + #placeholder_text - 1,\n+    start_col + #(placeholder_text[#placeholder_text] or ''),\n+  }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Returns the number of tabstop indexes in the snippet session.\n+---\n+--- @package\n+--- @return integer\n+function Session:get_num_tabstops()\n+  return #vim.tbl_keys(self.tabstops)\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private session? vim.snippet.Session",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1359844151",
            "id": 1359844151,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RDZM3",
            "original_commit_id": "b7cd2c79d39981fe99ba771edf5e7541b8295410",
            "original_line": 213,
            "original_position": 213,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1678762195,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359844151/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-15T09:46:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1359844151",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360184463"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360184463"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "couldn't we also add `TM_SELECTED_TEXT` whic is also in the spec by using the visual marks?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:43:47Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360184463",
            "id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REsSP",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679222550,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360184463/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:43:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360184463",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360187023"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187023"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "this looks to me like we just insert the first value of a choice. Is it planned to support actually allowing choices in a future pr or is this out of scope for core?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:47:02Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(text_to_lines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if mode ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M._session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M._session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M._session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so exit the session.\n+      M.exit()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M._session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M._session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M._session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M._session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+--- Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax\n+--- for the specification of valid input.\n+---\n+--- Tabstops are highlighted with hl-SnippetTabstop.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M._session = Session.new()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360187023",
            "id": 1360187023,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5REs6P",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 391,
            "original_position": 391,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1679226649,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187023/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:47:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187023",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360187158"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187158"
                }
            },
            "author_association": "MEMBER",
            "body": "I considered that but given that snippet expansion can only happen in <s>visual</s> insert mode, there won't be an active selection at that point. If we use marks then this would insert the last visual selection, and IMO most people are not expecting for that to be inserted in the snippet.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:47:09Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360187158",
            "id": 1360187158,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REs8W",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679226820,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187158/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:53:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187158",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360187501"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187501"
                }
            },
            "author_association": "MEMBER",
            "body": "Please read the roadmap I outlined in this PR's description.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:47:29Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Appends the given text to the snippet, taking care of indentation.\n+---\n+--- @param snippet string[]\n+--- @param text string|string[]\n+local function append_to_snippet(snippet, text)\n+  -- Get the base indentation based on the current line and the last line of the snippet.\n+  local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+  if #snippet > 0 then\n+    base_indent = base_indent .. (snippet[#snippet]:match('^%s*') or '') --- @type string\n+  end\n+\n+  local expand_tab = vim.api.nvim_get_option_value('expandtab', {})\n+  local lines = vim.iter.map(function(i, line)\n+    -- Replace tabs by spaces.\n+    if expand_tab then\n+      line = line:gsub('\\t', (' '):rep(vim.fn.shiftwidth())) --- @type string\n+    end\n+    -- Add the base indentation.\n+    if i > 1 then\n+      line = base_indent .. line\n+    end\n+    return line\n+  end, ipairs(text_to_lines(text)))\n+\n+  table.insert(snippet, table.concat(lines, '\\n'))\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if mode ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @private\n+function M._setup_autocmds()\n+  local group = vim.api.nvim_create_augroup(snippet_group, {})\n+\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = M._session.bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M._session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M._session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so exit the session.\n+      M.exit()\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = M._session.bufnr,\n+    callback = function()\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M._session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M._session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Clears the snippet autocommand group.\n+---\n+--- @private\n+function M._clear_autocmds()\n+  pcall(vim.api.nvim_clear_autocmds, { group = snippet_group, buffer = M._session.bufnr })\n+end\n+\n+--- Expands the given snippet text.\n+--- Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax\n+--- for the specification of valid input.\n+---\n+--- Tabstops are highlighted with hl-SnippetTabstop.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M._session = Session.new()\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Tabstop then\n+      --- @cast data vim.snippet.TabstopData\n+      add_tabstop(data.tabstop)\n+    elseif type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local value = tostring(data.value)\n+      add_tabstop(data.tabstop, value)\n+      append_to_snippet(snippet_text, value)\n+    elseif type == G.NodeType.Choice then\n+      --- @cast data vim.snippet.ChoiceData\n+      append_to_snippet(snippet_text, data.values[1])",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360187501",
            "id": 1360187501,
            "in_reply_to_id": 1360187023,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5REtBt",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 391,
            "original_position": 391,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1679227232,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187501/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:47:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360187501",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360188607"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360188607"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "> given that snippet expansion can only happen in visual mode\r\n\r\nWhy would that be the case?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:48:49Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360188607",
            "id": 1360188607,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REtS_",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679229043,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360188607/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:48:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360188607",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360189416"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360189416"
                }
            },
            "author_association": "MEMBER",
            "body": "Can you think of a case where it wouldn't?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:49:48Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360189416",
            "id": 1360189416,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REtfo",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679230333,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360189416/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:49:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360189416",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360191422"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360191422"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "you use completion which uses this api the hood and select an entry. You'd be in insert mode.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:52:13Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360191422",
            "id": 1360191422,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REt--",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679233628,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360191422/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:52:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360191422",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360192784"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360192784"
                }
            },
            "author_association": "MEMBER",
            "body": "ahh duh sorry, I brain farted. I meant to write insert mode all along. ",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:53:54Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360192784",
            "id": 1360192784,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REuUQ",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679236309,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360192784/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:53:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360192784",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360193721"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360193721"
                }
            },
            "author_association": "MEMBER",
            "body": "BTW I had brought this up in https://github.com/neovim/neovim/pull/25301#discussion_r1348178743.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T06:54:58Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360193721",
            "id": 1360193721,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REui5",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679237750,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360193721/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T06:54:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360193721",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360206943"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360206943"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "ü§î I also can't think about a case where you'd have a selection when expanding the snippet\r\nAnd I agree that just using the last selection likely wouldn't be expected behavior. The only thing you perhaps could do was adding a check for visual mode and the using the marks. (ig this would be the \"implement it, even if it makes no sense\" from clason)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:09:50Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360206943",
            "id": 1360206943,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RExxf",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679259306,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360206943/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:13:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360206943",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360209909"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360209909"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Actually I got a usecase.\r\nThis could be used e.g. for a \"surround with html tag\" function. You'd visually select something and then call the snippet function with `<$1:div>$TM_SELECTED_TEXT</$1>`. (not sure if the syntax is correct but just to give the idea)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:12:05Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360209909",
            "id": 1360209909,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REyf1",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679263413,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360209909/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:12:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360209909",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360210939"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360210939"
                }
            },
            "author_association": "MEMBER",
            "body": "Please remember the goal here: expansion of LSP snippet completion results _and nothing else_.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:13:00Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360210939",
            "id": 1360210939,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REyv7",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679264787,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360210939/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:13:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360210939",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360212506"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360212506"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "yes\r\nthis is about fully implementing the spec if possible (and without unexpected ux) which imo is doable with adding a check for visual mode. And additionaly to that I also gave an example where this might actually be useful. This wasn't intended as being a motivation for implementing it.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:14:44Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360212506",
            "id": 1360212506,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5REzIa",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679267451,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360212506/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:14:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360212506",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360218254"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360218254"
                }
            },
            "author_association": "MEMBER",
            "body": "Yes, but unless you can show a server that returns this _as a completion candidate_, it is not a relevant example in the context of this PR. Manually triggering snippet expansion is a **non-goal** here.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:20:49Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360218254",
            "id": 1360218254,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RE0iO",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679276736,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360218254/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:21:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360218254",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360242029"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360242029"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "üëç then this should be added to the \"yet to be implemented in future prs\" section imo since it's part of the spec, quite simple to implement afaict and actually has usecases with manual expansion",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:41:37Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360242029",
            "id": 1360242029,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RE6Vt",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679316798,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360242029/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:41:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360242029",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360250786"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360250786"
                }
            },
            "author_association": "MEMBER",
            "body": "No, because manual expansion is _not_ \"yet to be implemented\" in core. That will still be left to snippet plugins.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T07:48:15Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360250786",
            "id": 1360250786,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RE8ei",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679329106,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360250786/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T07:48:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360250786",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360282137"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360282137"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Is there any good reason to not implement this thing apart from \"there is no example where this is needed in completion items\"? It would be quite small (check if mode is visual, get visual selection) and would allow to support the full lsp spec.\r\nI don't see why you let snippet plugins rewrite their own expansion logic because of such a small thing just because it is more than you initially planned to support.\r\n\r\nBut in the end that's up to the core maintainers. I just write here from the perspective of a person that would perhaps use this functionality in a plugin. IMO the goal should be to support the full plugin spec if possible without it being too much effort and not just completion support.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T08:08:10Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360282137",
            "id": 1360282137,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RFEIZ",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679371334,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360282137/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T08:08:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360282137",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360285321"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360285321"
                }
            },
            "author_association": "MEMBER",
            "body": "Please keep your comments to the scope of this PR. There will be a separate discussion about how to best expose this to (actual) snippet plugins; you're welcome to give your input then.\r\n\r\n> But in the end that's up to the core maintainers.\r\n\r\nThank you for your understanding.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T08:10:59Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360285321",
            "id": 1360285321,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RFE6J",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679376373,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360285321/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T08:10:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360285321",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360289376"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360289376"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "feel free to mark this discussion as unrelated then.\r\nIs an issue or a discussion the better place for this?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T08:14:25Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360289376",
            "id": 1360289376,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RFF5g",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679382931,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360289376/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T08:14:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360289376",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1360298228"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360298228"
                }
            },
            "author_association": "MEMBER",
            "body": "Patience, grasshopper. Let @MariaSolOs finish this PR (and iron out any kinks found in testing) first.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-16T08:21:51Z",
            "diff_hunk": "@@ -0,0 +1,499 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1360298228",
            "id": 1360298228,
            "in_reply_to_id": 1360184463,
            "line": 53,
            "node_id": "PRRC_kwDOAPphoM5RFID0",
            "original_commit_id": "bafa4fec3ff38dd197bc730007dac01e8a45fd66",
            "original_line": 53,
            "original_position": 53,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 53,
            "pull_request_review_id": 1679396946,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 1,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360298228/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-16T08:21:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1360298228",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1361447211"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361447211"
                }
            },
            "author_association": "MEMBER",
            "body": "Not sure if this is the only capability change or if there's another completion capability I need to set.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-17T02:44:58Z",
            "diff_hunk": "@@ -738,11 +738,7 @@ function protocol.make_client_capabilities()\n       completion = {\n         dynamicRegistration = false,\n         completionItem = {\n-          -- Until we can actually expand snippet, move cursor and allow for true snippet experience,\n-          -- this should be disabled out of the box.\n-          -- However, users can turn this back on if they have a snippet plugin.\n-          snippetSupport = false,\n-\n+          snippetSupport = true,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1361447211",
            "id": 1361447211,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RJgkr",
            "original_commit_id": "75eb134cf4e86ff581a8dd90ca8c00fd22fc9486",
            "original_line": 741,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/protocol.lua",
            "position": null,
            "pull_request_review_id": 1681273851,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361447211/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-17T02:44:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361447211",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1361462465"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361462465"
                }
            },
            "author_association": "MEMBER",
            "body": "I'm now unsure if we should set this yet. First we need to replace `vim.lsp.util.parse_snippet` by `vim.snippet.expand`. This will create a new snippet session, and hence I think we should provide a default setup for snippet navigation.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-17T03:14:44Z",
            "diff_hunk": "@@ -738,11 +738,7 @@ function protocol.make_client_capabilities()\n       completion = {\n         dynamicRegistration = false,\n         completionItem = {\n-          -- Until we can actually expand snippet, move cursor and allow for true snippet experience,\n-          -- this should be disabled out of the box.\n-          -- However, users can turn this back on if they have a snippet plugin.\n-          snippetSupport = false,\n-\n+          snippetSupport = true,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1361462465",
            "id": 1361462465,
            "in_reply_to_id": 1361447211,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RJkTB",
            "original_commit_id": "75eb134cf4e86ff581a8dd90ca8c00fd22fc9486",
            "original_line": 741,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/protocol.lua",
            "position": null,
            "pull_request_review_id": 1681293568,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361462465/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-17T03:14:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361462465",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1361589662"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361589662"
                }
            },
            "author_association": "MEMBER",
            "body": "That's the one I was thinking of, but if there are still parts missing, we don't need to do it yet. I'll just keep mentioning this on PRs until we can :)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-17T06:53:23Z",
            "diff_hunk": "@@ -738,11 +738,7 @@ function protocol.make_client_capabilities()\n       completion = {\n         dynamicRegistration = false,\n         completionItem = {\n-          -- Until we can actually expand snippet, move cursor and allow for true snippet experience,\n-          -- this should be disabled out of the box.\n-          -- However, users can turn this back on if they have a snippet plugin.\n-          snippetSupport = false,\n-\n+          snippetSupport = true,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1361589662",
            "id": 1361589662,
            "in_reply_to_id": 1361447211,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RKDWe",
            "original_commit_id": "75eb134cf4e86ff581a8dd90ca8c00fd22fc9486",
            "original_line": 741,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/protocol.lua",
            "position": null,
            "pull_request_review_id": 1681490863,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361589662/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-17T06:53:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361589662",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1361594365"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361594365"
                }
            },
            "author_association": "MEMBER",
            "body": "Yeah I think we should do this in a later PR since I think it will require a larger change in `vim.lsp.util` (that might involve some discussion).",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-17T06:57:57Z",
            "diff_hunk": "@@ -738,11 +738,7 @@ function protocol.make_client_capabilities()\n       completion = {\n         dynamicRegistration = false,\n         completionItem = {\n-          -- Until we can actually expand snippet, move cursor and allow for true snippet experience,\n-          -- this should be disabled out of the box.\n-          -- However, users can turn this back on if they have a snippet plugin.\n-          snippetSupport = false,\n-\n+          snippetSupport = true,",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1361594365",
            "id": 1361594365,
            "in_reply_to_id": 1361447211,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RKEf9",
            "original_commit_id": "75eb134cf4e86ff581a8dd90ca8c00fd22fc9486",
            "original_line": 741,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/protocol.lua",
            "position": null,
            "pull_request_review_id": 1681498293,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361594365/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-17T06:57:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1361594365",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1362375196"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1362375196"
                }
            },
            "author_association": "MEMBER",
            "body": "Is there a reason for `M._` instead of having local functions? I first thought it is for testing, but that doesn't seem to be the case.\r\n\r\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-17T15:57:46Z",
            "diff_hunk": "@@ -0,0 +1,518 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1362375196",
            "id": 1362375196,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RNDIc",
            "original_commit_id": "a39cdab3729d3ce8cb4e5267af8fe959b73ff9e5",
            "original_line": 222,
            "original_position": 222,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1682755105,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1362375196/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-17T16:03:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1362375196",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1362703440"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1362703440"
                }
            },
            "author_association": "MEMBER",
            "body": "Just because I wanted to avoid passing some session state but I'll replace them with local functions.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-17T20:08:11Z",
            "diff_hunk": "@@ -0,0 +1,518 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = 'vim/snippet'\n+local snippet_ns = vim.api.nvim_create_namespace(snippet_group)\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @private\n+--- @param tabstop vim.snippet.Tabstop\n+function M._select_stop(tabstop)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1362703440",
            "id": 1362703440,
            "in_reply_to_id": 1362375196,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5ROTRQ",
            "original_commit_id": "a39cdab3729d3ce8cb4e5267af8fe959b73ff9e5",
            "original_line": 222,
            "original_position": 222,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1683278473,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1362703440/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-17T20:08:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1362703440",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367425298"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367425298"
                }
            },
            "author_association": "MEMBER",
            "body": "maybe mention very briefly: if not possible, it is safely ignored (instead of throwing an error, or something)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T19:38:24Z",
            "diff_hunk": "@@ -3670,4 +3670,61 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+exit()                                                        *snippet.exit()*\n+    Exits the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text. Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax for the specification of valid input.\n+\n+    Tabstops are highlighted with hl-SnippetTabstop.\n+\n+    Parameters: ~\n+      ‚Ä¢ {input}  (string)\n+\n+jump({direction})                                             *snippet.jump()*\n+    Jumps (if possible) within the active snippet in the given direction. You",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367425298",
            "id": 1367425298,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgUES",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 3695,
            "original_position": 26,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": null,
            "pull_request_review_id": 1690806216,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367425298/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T19:39:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367425298",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367433453"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367433453"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n    local expand_tab = vim.o.expandtab\n```\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T19:50:22Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @param tabstop vim.snippet.Tabstop\n+local function select_tabstop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if mode ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @param bufnr integer\n+local function setup_autocmds(bufnr)\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = snippet_group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M._session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M._session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so exit the session.\n+      M.exit()\n+      return true\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = snippet_group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = bufnr,\n+    callback = function()\n+      if not M.active() then\n+        return true\n+      end\n+\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M._session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M._session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Expands the given snippet text.\n+--- Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax\n+--- for the specification of valid input.\n+---\n+--- Tabstops are highlighted with hl-SnippetTabstop.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M._session = Session.new()\n+\n+  -- Get the placeholders we should use for each tabstop index.\n+  --- @type table<integer, string>\n+  local placeholders = {}\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local tabstop, value = data.tabstop, tostring(data.value)\n+      if placeholders[tabstop] and placeholders[tabstop] ~= value then\n+        error('Snippet has multiple placeholders for tabstop $' .. tabstop)\n+      else\n+        placeholders[tabstop] = value\n+      end\n+    end\n+  end\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  --- Appends the given text to the snippet, taking care of indentation.\n+  ---\n+  --- @param text string|string[]\n+  local function append_to_snippet(text)\n+    -- Get the base indentation based on the current line and the last line of the snippet.\n+    local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+    if #snippet_text > 0 then\n+      base_indent = base_indent .. (snippet_text[#snippet_text]:match('^%s*') or '') --- @type string\n+    end\n+\n+    local expand_tab = vim.api.nvim_get_option_value('expandtab', {})",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367433453",
            "id": 1367433453,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgWDt",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 373,
            "original_position": 373,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690819467,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367433453/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T19:56:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367433453",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367435820"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367435820"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n      vim.cmd.startinsert({ bang = range[4] >= #vim.api.nvim_get_current_line() })\n```\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T19:53:38Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @param tabstop vim.snippet.Tabstop\n+local function select_tabstop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367435820",
            "id": 1367435820,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgWos",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 251,
            "original_position": 251,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690819467,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367435820/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T19:56:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367435820",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367437774"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367437774"
                }
            },
            "author_association": "MEMBER",
            "body": "It's a standard convention to cache these indexes as:\n\n```lua\nlocal api, fn = vim.api, vim.fn\n```\n\nAnd use these throughout.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T19:56:24Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367437774",
            "id": 1367437774,
            "line": 9,
            "node_id": "PRRC_kwDOAPphoM5RgXHO",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 9,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 9,
            "pull_request_review_id": 1690819467,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367437774/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T19:56:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367437774",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367440673"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367440673"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\n  return vim.split(table.concat(text), '\\n', { plain = true })\n```\n",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:00:38Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367440673",
            "id": 1367440673,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgX0h",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690831239,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367440673/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:10:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367440673",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367443157"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367443157"
                }
            },
            "author_association": "MEMBER",
            "body": "It's also standard not to do that; it's up to you. ",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:04:22Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367443157",
            "id": 1367443157,
            "in_reply_to_id": 1367437774,
            "line": 9,
            "node_id": "PRRC_kwDOAPphoM5RgYbV",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 9,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 9,
            "pull_request_review_id": 1690835242,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367443157/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:04:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367443157",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367443248"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367443248"
                }
            },
            "author_association": "MEMBER",
            "body": "The else here is unnecessary since the if errors.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:04:30Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @param tabstop vim.snippet.Tabstop\n+local function select_tabstop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if mode ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @param bufnr integer\n+local function setup_autocmds(bufnr)\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = snippet_group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M._session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M._session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so exit the session.\n+      M.exit()\n+      return true\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = snippet_group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = bufnr,\n+    callback = function()\n+      if not M.active() then\n+        return true\n+      end\n+\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M._session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M._session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Expands the given snippet text.\n+--- Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax\n+--- for the specification of valid input.\n+---\n+--- Tabstops are highlighted with hl-SnippetTabstop.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M._session = Session.new()\n+\n+  -- Get the placeholders we should use for each tabstop index.\n+  --- @type table<integer, string>\n+  local placeholders = {}\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local tabstop, value = data.tabstop, tostring(data.value)\n+      if placeholders[tabstop] and placeholders[tabstop] ~= value then\n+        error('Snippet has multiple placeholders for tabstop $' .. tabstop)\n+      else",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367443248",
            "id": 1367443248,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgYcw",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 346,
            "original_position": 346,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690831239,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367443248/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:10:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367443248",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367448329"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367448329"
                }
            },
            "author_association": "MEMBER",
            "body": "It usually depends how many references there are. If there's not many, then it's obviously not worth doing.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:11:42Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367448329",
            "id": 1367448329,
            "in_reply_to_id": 1367437774,
            "line": 9,
            "node_id": "PRRC_kwDOAPphoM5RgZsJ",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 9,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 9,
            "pull_request_review_id": 1690843747,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367448329/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:11:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367448329",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367469885"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367469885"
                }
            },
            "author_association": "MEMBER",
            "body": "Could you please explain this suggestion?",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:43:59Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @param tabstop vim.snippet.Tabstop\n+local function select_tabstop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if mode ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @param bufnr integer\n+local function setup_autocmds(bufnr)\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = snippet_group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M._session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M._session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so exit the session.\n+      M.exit()\n+      return true\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = snippet_group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = bufnr,\n+    callback = function()\n+      if not M.active() then\n+        return true\n+      end\n+\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M._session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M._session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Expands the given snippet text.\n+--- Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax\n+--- for the specification of valid input.\n+---\n+--- Tabstops are highlighted with hl-SnippetTabstop.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M._session = Session.new()\n+\n+  -- Get the placeholders we should use for each tabstop index.\n+  --- @type table<integer, string>\n+  local placeholders = {}\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local tabstop, value = data.tabstop, tostring(data.value)\n+      if placeholders[tabstop] and placeholders[tabstop] ~= value then\n+        error('Snippet has multiple placeholders for tabstop $' .. tabstop)\n+      else\n+        placeholders[tabstop] = value\n+      end\n+    end\n+  end\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  --- Appends the given text to the snippet, taking care of indentation.\n+  ---\n+  --- @param text string|string[]\n+  local function append_to_snippet(text)\n+    -- Get the base indentation based on the current line and the last line of the snippet.\n+    local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+    if #snippet_text > 0 then\n+      base_indent = base_indent .. (snippet_text[#snippet_text]:match('^%s*') or '') --- @type string\n+    end\n+\n+    local expand_tab = vim.api.nvim_get_option_value('expandtab', {})",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367469885",
            "id": 1367469885,
            "in_reply_to_id": 1367433453,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Rge89",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 373,
            "original_position": 373,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690878930,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367469885/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:44:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367469885",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367471982"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367471982"
                }
            },
            "author_association": "MEMBER",
            "body": "Mostly it's just a lot shorter and easier to read.\n\nGenerally we prefer to use the vim.* ergonomic wrappers of the API where possible for the same reason. E.g. vim.cmd vs vim.api.nvim_cmd\n\nIt's also typed.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:47:16Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),\n+    '\\n'\n+  )\n+end\n+\n+--- Sets the tabstop's text.\n+---\n+--- @package\n+--- @param text string\n+function Tabstop:set_text(text)\n+  local range = self:get_range()\n+  vim.api.nvim_buf_set_text(self.bufnr, range[1], range[2], range[3], range[4], text_to_lines(text))\n+end\n+\n+--- @class vim.snippet.Session\n+--- @field bufnr integer\n+--- @field tabstops table<integer, vim.snippet.Tabstop[]>\n+--- @field current_tabstop vim.snippet.Tabstop\n+local Session = {}\n+\n+--- Creates a new snippet session in the current buffer.\n+---\n+--- @package\n+--- @return vim.snippet.Session\n+function Session.new()\n+  local bufnr = vim.api.nvim_get_current_buf()\n+  local self = setmetatable({\n+    bufnr = bufnr,\n+    tabstops = {},\n+    current_tabstop = Tabstop.new(0, bufnr, { 0, 0, 0, 0 }),\n+  }, { __index = Session })\n+\n+  return self\n+end\n+\n+--- Creates the session tabstops.\n+---\n+--- @package\n+--- @param tabstop_ranges table<integer, Range4[]>\n+function Session:set_tabstops(tabstop_ranges)\n+  for index, ranges in pairs(tabstop_ranges) do\n+    for _, range in ipairs(ranges) do\n+      self.tabstops[index] = self.tabstops[index] or {}\n+      table.insert(self.tabstops[index], Tabstop.new(index, self.bufnr, range))\n+    end\n+  end\n+end\n+\n+--- Returns the destination tabstop index when jumping in the given direction.\n+---\n+--- @package\n+--- @param direction vim.snippet.Direction\n+--- @return integer?\n+function Session:get_dest_index(direction)\n+  local tabstop_indexes = vim.tbl_keys(self.tabstops) --- @type integer[]\n+  table.sort(tabstop_indexes)\n+  for i, index in ipairs(tabstop_indexes) do\n+    if index == self.current_tabstop.index then\n+      local dest_index = tabstop_indexes[i + direction] --- @type integer?\n+      -- When jumping forwards, $0 is the last tabstop.\n+      if not dest_index and direction == 1 then\n+        dest_index = 0\n+      end\n+      -- When jumping backwards, make sure we don't think that $0 is the first tabstop.\n+      if dest_index == 0 and direction == -1 then\n+        dest_index = nil\n+      end\n+      return dest_index\n+    end\n+  end\n+end\n+\n+--- @class vim.snippet.Snippet\n+--- @field private _session? vim.snippet.Session\n+local M = { session = nil }\n+\n+--- Select the given tabstop range.\n+---\n+--- @param tabstop vim.snippet.Tabstop\n+local function select_tabstop(tabstop)\n+  --- @param keys string\n+  local function feedkeys(keys)\n+    keys = vim.api.nvim_replace_termcodes(keys, true, false, true)\n+    vim.api.nvim_feedkeys(keys, 'n', true)\n+  end\n+\n+  --- NOTE: We don't use `vim.api.nvim_win_set_cursor` here because it causes the cursor to end\n+  --- at the end of the selection instead of the start.\n+  ---\n+  --- @param row integer\n+  --- @param col integer\n+  local function move_cursor_to(row, col)\n+    local line = vim.fn.getline(row) --[[ @as string ]]\n+    col = math.max(vim.fn.strchars(line:sub(1, col)) - 1, 0)\n+    feedkeys(string.format('%sG0%s', row, string.rep('<Right>', col)))\n+  end\n+\n+  local range = tabstop:get_range()\n+  local mode = vim.fn.mode()\n+\n+  -- Move the cursor to the start of the tabstop.\n+  vim.api.nvim_win_set_cursor(0, { range[1] + 1, range[2] })\n+\n+  -- For empty and the final tabstop, start insert mode at the end of the range.\n+  if tabstop.index == 0 or (range[1] == range[3] and range[2] == range[4]) then\n+    if mode ~= 'i' then\n+      if mode == 's' then\n+        feedkeys('<Esc>')\n+      end\n+      vim.cmd({ cmd = 'startinsert', bang = range[4] >= #vim.api.nvim_get_current_line() })\n+    end\n+  else\n+    -- Else, select the tabstop's text.\n+    if mode ~= 'n' then\n+      feedkeys('<Esc>')\n+    end\n+    move_cursor_to(range[1] + 1, range[2] + 1)\n+    feedkeys('v')\n+    move_cursor_to(range[3] + 1, range[4])\n+    feedkeys('o<c-g>')\n+  end\n+end\n+\n+--- Sets up the necessary autocommands for snippet expansion.\n+---\n+--- @param bufnr integer\n+local function setup_autocmds(bufnr)\n+  vim.api.nvim_create_autocmd({ 'CursorMoved', 'CursorMovedI' }, {\n+    group = snippet_group,\n+    desc = 'Update snippet state when the cursor moves',\n+    buffer = bufnr,\n+    callback = function()\n+      -- Just update the tabstop in insert and select modes.\n+      if not vim.fn.mode():match('^[isS]') then\n+        return\n+      end\n+\n+      -- Update the current tabstop to be the one containing the cursor.\n+      local cursor_row, cursor_col = cursor_pos()\n+      for tabstop_index, tabstops in pairs(M._session.tabstops) do\n+        for _, tabstop in ipairs(tabstops) do\n+          local range = tabstop:get_range()\n+          if\n+            (cursor_row > range[1] or (cursor_row == range[1] and cursor_col >= range[2]))\n+            and (cursor_row < range[3] or (cursor_row == range[3] and cursor_col <= range[4]))\n+          then\n+            M._session.current_tabstop = tabstop\n+            if tabstop_index ~= 0 then\n+              return\n+            end\n+          end\n+        end\n+      end\n+\n+      -- The cursor is either not on a tabstop or we reached the end, so exit the session.\n+      M.exit()\n+      return true\n+    end,\n+  })\n+\n+  vim.api.nvim_create_autocmd({ 'TextChanged', 'TextChangedI' }, {\n+    group = snippet_group,\n+    desc = 'Update active tabstops when buffer text changes',\n+    buffer = bufnr,\n+    callback = function()\n+      if not M.active() then\n+        return true\n+      end\n+\n+      -- Sync the tabstops in the current group.\n+      local current_tabstop = M._session.current_tabstop\n+      local current_text = current_tabstop:get_text()\n+      for _, tabstop in ipairs(M._session.tabstops[current_tabstop.index]) do\n+        if tabstop.extmark_id ~= current_tabstop.extmark_id then\n+          tabstop:set_text(current_text)\n+        end\n+      end\n+    end,\n+  })\n+end\n+\n+--- Expands the given snippet text.\n+--- Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax\n+--- for the specification of valid input.\n+---\n+--- Tabstops are highlighted with hl-SnippetTabstop.\n+---\n+--- @param input string\n+function M.expand(input)\n+  local snippet = G.parse(input)\n+  local snippet_text = {}\n+\n+  M._session = Session.new()\n+\n+  -- Get the placeholders we should use for each tabstop index.\n+  --- @type table<integer, string>\n+  local placeholders = {}\n+  for _, child in ipairs(snippet.data.children) do\n+    local type, data = child.type, child.data\n+    if type == G.NodeType.Placeholder then\n+      --- @cast data vim.snippet.PlaceholderData\n+      local tabstop, value = data.tabstop, tostring(data.value)\n+      if placeholders[tabstop] and placeholders[tabstop] ~= value then\n+        error('Snippet has multiple placeholders for tabstop $' .. tabstop)\n+      else\n+        placeholders[tabstop] = value\n+      end\n+    end\n+  end\n+\n+  -- Keep track of tabstop nodes during expansion.\n+  --- @type table<integer, Range4[]>\n+  local tabstop_ranges = {}\n+\n+  --- @param index integer\n+  --- @param placeholder string?\n+  local function add_tabstop(index, placeholder)\n+    tabstop_ranges[index] = tabstop_ranges[index] or {}\n+    table.insert(tabstop_ranges[index], compute_tabstop_range(snippet_text, placeholder))\n+  end\n+\n+  --- Appends the given text to the snippet, taking care of indentation.\n+  ---\n+  --- @param text string|string[]\n+  local function append_to_snippet(text)\n+    -- Get the base indentation based on the current line and the last line of the snippet.\n+    local base_indent = vim.api.nvim_get_current_line():match('^%s*') or ''\n+    if #snippet_text > 0 then\n+      base_indent = base_indent .. (snippet_text[#snippet_text]:match('^%s*') or '') --- @type string\n+    end\n+\n+    local expand_tab = vim.api.nvim_get_option_value('expandtab', {})",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367471982",
            "id": 1367471982,
            "in_reply_to_id": 1367433453,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5Rgfdu",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 373,
            "original_position": 373,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690882307,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367471982/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:48:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367471982",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367478506"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367478506"
                }
            },
            "author_association": "MEMBER",
            "body": "As discussed in the chat: We don't seem to have an established convention yet so I'll leave it as is.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T20:56:46Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367478506",
            "id": 1367478506,
            "in_reply_to_id": 1367437774,
            "line": 9,
            "node_id": "PRRC_kwDOAPphoM5RghDq",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 9,
            "original_position": 9,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 9,
            "pull_request_review_id": 1690892780,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367478506/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T20:56:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367478506",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367483988"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367483988"
                }
            },
            "author_association": "MEMBER",
            "body": "Is `plain` needed in this case? I think it's only needed if you use characters like `%` that are used in pattern matching (that's my interpretation from reading the `string.find()` docs).",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T21:05:18Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367483988",
            "id": 1367483988,
            "in_reply_to_id": 1367440673,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgiZU",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690901801,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367483988/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T21:05:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367483988",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367486796"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367486796"
                }
            },
            "author_association": "MEMBER",
            "body": "It's not required no. I would _expect_ plain to allow string.find to short-circuit any pattern related logic.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-20T21:10:19Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n')",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367486796",
            "id": 1367486796,
            "in_reply_to_id": 1367440673,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5RgjFM",
            "original_commit_id": "40ffbb8af4ef4012353928726d96cc0c844dd239",
            "original_line": 65,
            "original_position": 65,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": null,
            "pull_request_review_id": 1690906256,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367486796/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-20T21:11:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367486796",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1367859678"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367859678"
                }
            },
            "author_association": "MEMBER",
            "body": "it's better add a pcall in there otherwise when delete a snippet will through an error `index out of bounds`",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-22T08:13:50Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n', { plain = true })\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1367859678",
            "id": 1367859678,
            "line": 142,
            "node_id": "PRRC_kwDOAPphoM5Rh-He",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 142,
            "original_position": 142,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 142,
            "pull_request_review_id": 1691391013,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367859678/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-22T08:13:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1367859678",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1368152978"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1368152978"
                }
            },
            "author_association": "MEMBER",
            "body": "I prefer to fix the bugs that would cause the error in the first place. I've already missed important issues because of `pcall`s making me unaware that they exist.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-10-23T05:43:27Z",
            "diff_hunk": "@@ -0,0 +1,535 @@\n+local G = require('vim.lsp._snippet_grammar')\n+local snippet_group = vim.api.nvim_create_augroup('vim/snippet', {})\n+local snippet_ns = vim.api.nvim_create_namespace('vim/snippet')\n+\n+--- Returns the 0-based cursor position.\n+---\n+--- @return integer, integer\n+local function cursor_pos()\n+  local cursor = vim.api.nvim_win_get_cursor(0)\n+  return cursor[1] - 1, cursor[2]\n+end\n+\n+--- Resolves variables (like `$name` or `${name:default}`) as follows:\n+--- - When a variable is unknown (i.e.: its name is not recognized in any of the cases below), return `nil`.\n+--- - When a variable isn't set, return its default (if any) or an empty string.\n+---\n+--- Note that in some cases, the default is ignored since it's not clear how to distinguish an empty\n+--- value from an unset value (e.g.: `TM_CURRENT_LINE`).\n+---\n+--- @param var string\n+--- @param default string\n+--- @return string?\n+local function resolve_variable(var, default)\n+  --- @param str string\n+  --- @return string\n+  local function expand_or_default(str)\n+    local expansion = vim.fn.expand(str) --[[@as string]]\n+    return expansion == '' and default or expansion\n+  end\n+\n+  if var == 'TM_SELECTED_TEXT' then\n+    -- Snippets are expanded in insert mode only, so there's no selection.\n+    return default\n+  elseif var == 'TM_CURRENT_LINE' then\n+    return vim.api.nvim_get_current_line()\n+  elseif var == 'TM_CURRENT_WORD' then\n+    return expand_or_default('<cword>')\n+  elseif var == 'TM_LINE_INDEX' then\n+    return tostring(vim.fn.line('.') - 1)\n+  elseif var == 'TM_LINE_NUMBER' then\n+    return tostring(vim.fn.line('.'))\n+  elseif var == 'TM_FILENAME' then\n+    return expand_or_default('%:t')\n+  elseif var == 'TM_FILENAME_BASE' then\n+    -- Not using '%:t:r' since we want to remove all extensions.\n+    local filename_base = expand_or_default('%:t'):gsub('%.[^%.]*$', '')\n+    return filename_base\n+  elseif var == 'TM_DIRECTORY' then\n+    return expand_or_default('%:p:h:t')\n+  elseif var == 'TM_FILEPATH' then\n+    return expand_or_default('%:p')\n+  end\n+\n+  -- Unknown variable.\n+  return nil\n+end\n+\n+--- Transforms the given text into an array of lines (so no line contains `\\n`).\n+---\n+--- @param text string|string[]\n+--- @return string[]\n+local function text_to_lines(text)\n+  text = type(text) == 'string' and { text } or text\n+  --- @cast text string[]\n+  return vim.split(table.concat(text), '\\n', { plain = true })\n+end\n+\n+--- Computes the 0-based position of a tabstop located at the end of `snippet` and spanning\n+--- `placeholder` (if given).\n+---\n+--- @param snippet string[]\n+--- @param placeholder string?\n+--- @return Range4\n+local function compute_tabstop_range(snippet, placeholder)\n+  local cursor_row, cursor_col = cursor_pos()\n+  local snippet_text = text_to_lines(snippet)\n+  local placeholder_text = text_to_lines(placeholder or '')\n+  local start_row = cursor_row + #snippet_text - 1\n+  local start_col = #(snippet_text[#snippet_text] or '')\n+\n+  -- Add the cursor's column offset to the first line.\n+  if start_row == cursor_row then\n+    start_col = start_col + cursor_col\n+  end\n+\n+  local end_row = start_row + #placeholder_text - 1\n+  local end_col = (start_row == end_row and start_col or 0)\n+    + #(placeholder_text[#placeholder_text] or '')\n+\n+  return { start_row, start_col, end_row, end_col }\n+end\n+\n+--- @class vim.snippet.Tabstop\n+--- @field extmark_id integer\n+--- @field index integer\n+--- @field bufnr integer\n+local Tabstop = {}\n+\n+--- Creates a new tabstop.\n+---\n+--- @package\n+--- @param index integer\n+--- @param bufnr integer\n+--- @param range Range4\n+--- @return vim.snippet.Tabstop\n+function Tabstop.new(index, bufnr, range)\n+  local extmark_id = vim.api.nvim_buf_set_extmark(bufnr, snippet_ns, range[1], range[2], {\n+    right_gravity = false,\n+    end_right_gravity = true,\n+    end_line = range[3],\n+    end_col = range[4],\n+    hl_group = 'SnippetTabstop',\n+  })\n+\n+  local self = setmetatable(\n+    { index = index, bufnr = bufnr, extmark_id = extmark_id },\n+    { __index = Tabstop }\n+  )\n+\n+  return self\n+end\n+\n+--- Returns the tabstop's range.\n+---\n+--- @package\n+--- @return Range4\n+function Tabstop:get_range()\n+  local mark =\n+    vim.api.nvim_buf_get_extmark_by_id(self.bufnr, snippet_ns, self.extmark_id, { details = true })\n+\n+  --- @diagnostic disable-next-line: undefined-field\n+  return { mark[1], mark[2], mark[3].end_row, mark[3].end_col }\n+end\n+\n+--- Returns the text spanned by the tabstop.\n+---\n+--- @package\n+--- @return string\n+function Tabstop:get_text()\n+  local range = self:get_range()\n+  return table.concat(\n+    vim.api.nvim_buf_get_text(self.bufnr, range[1], range[2], range[3], range[4], {}),",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1368152978",
            "id": 1368152978,
            "in_reply_to_id": 1367859678,
            "line": 142,
            "node_id": "PRRC_kwDOAPphoM5RjFuS",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 142,
            "original_position": 142,
            "original_start_line": null,
            "path": "runtime/lua/vim/snippet.lua",
            "position": 142,
            "pull_request_review_id": 1691742714,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1368152978/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-10-23T05:43:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1368152978",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1392948224"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1392948224"
                }
            },
            "author_association": "MEMBER",
            "body": "Is it not likely that we'll get a request for a `snippet.get()` in the future, which returns more info than merely a boolean (such as snippet \"id\" or position, idk)? If so perhaps we should rename this or at least change the return type, else it will be redundant.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T17:13:36Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1392948224",
            "id": 1392948224,
            "line": 3681,
            "node_id": "PRRC_kwDOAPphoM5TBrQA",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3681,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 12,
            "pull_request_review_id": 1730280019,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1392948224/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T17:13:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1392948224",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1392962785"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1392962785"
                }
            },
            "author_association": "MEMBER",
            "body": "Seems redundant with `active()`. If we [replace](https://github.com/neovim/neovim/pull/25301/files#r1392948224) `active` with `get(): {id: number, jumpable: boolean|nil}` then we could eliminate this.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T17:22:59Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+exit()                                                        *snippet.exit()*\n+    Exits the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text. Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax for the specification of valid input.\n+\n+    Tabstops are highlighted with hl-SnippetTabstop.\n+\n+    Parameters: ~\n+      ‚Ä¢ {input}  (string)\n+\n+jump({direction})                                             *snippet.jump()*\n+    Jumps within the active snippet in the given direction. If the jump isn't\n+    possible, the function call does nothing.\n+\n+    You can use this function to navigate a snippet as follows: >lua\n+        vim.keymap.set({ 'i', 's' }, '<Tab>', function()\n+           if vim.snippet.jumpable(1) then\n+             return '<cmd>lua vim.snippet.jump(1)<cr>'\n+           else\n+             return '<Tab>'\n+           end\n+         end, { expr = true })\n+<\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  (vim.snippet.Direction) Navigation direction. -1 for\n+                     previous, 1 for next.\n+\n+jumpable({direction})                                     *snippet.jumpable()*\n+    Returns `true` if there is an active snippet which can be jumped in the",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1392962785",
            "id": 1392962785,
            "line": 3713,
            "node_id": "PRRC_kwDOAPphoM5TBuzh",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3713,
            "original_position": 44,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 44,
            "pull_request_review_id": 1730305227,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1392962785/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T17:22:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1392962785",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1393260322"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393260322"
                }
            },
            "author_association": "MEMBER",
            "body": "I can see `snippet.get()` being part of a more mature version of the API that exposes relevant info for external libraries to build on top of. However I'm unsure of what details we'll be exposing.\r\n\r\n> If so perhaps we should rename this or at least change the return type, else it will be redundant.\r\n\r\n@justinmk I'm not fully understanding the suggestion (and the why) here.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T20:45:40Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1393260322",
            "id": 1393260322,
            "in_reply_to_id": 1392948224,
            "line": 3681,
            "node_id": "PRRC_kwDOAPphoM5TC3ci",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3681,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 12,
            "pull_request_review_id": 1730754078,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393260322/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T20:45:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393260322",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1393266300"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393266300"
                }
            },
            "author_association": "MEMBER",
            "body": "currently this just returns whether \"something is active\". If we instead have a `get()` that returns info about the active thing, then `active()` is redundant.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T20:50:27Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1393266300",
            "id": 1393266300,
            "in_reply_to_id": 1392948224,
            "line": 3681,
            "node_id": "PRRC_kwDOAPphoM5TC458",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3681,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 12,
            "pull_request_review_id": 1730762755,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393266300/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T20:50:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393266300",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1393273294"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393273294"
                }
            },
            "author_association": "MEMBER",
            "body": "Not redundant. Say the cursor is modifying the placeholder of the last tabstop. Then `vim.snippet.active()` returns true but `vim.snippet.jumpable(1)` does not.",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T20:55:00Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+exit()                                                        *snippet.exit()*\n+    Exits the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text. Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax for the specification of valid input.\n+\n+    Tabstops are highlighted with hl-SnippetTabstop.\n+\n+    Parameters: ~\n+      ‚Ä¢ {input}  (string)\n+\n+jump({direction})                                             *snippet.jump()*\n+    Jumps within the active snippet in the given direction. If the jump isn't\n+    possible, the function call does nothing.\n+\n+    You can use this function to navigate a snippet as follows: >lua\n+        vim.keymap.set({ 'i', 's' }, '<Tab>', function()\n+           if vim.snippet.jumpable(1) then\n+             return '<cmd>lua vim.snippet.jump(1)<cr>'\n+           else\n+             return '<Tab>'\n+           end\n+         end, { expr = true })\n+<\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  (vim.snippet.Direction) Navigation direction. -1 for\n+                     previous, 1 for next.\n+\n+jumpable({direction})                                     *snippet.jumpable()*\n+    Returns `true` if there is an active snippet which can be jumped in the",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1393273294",
            "id": 1393273294,
            "in_reply_to_id": 1392962785,
            "line": 3713,
            "node_id": "PRRC_kwDOAPphoM5TC6nO",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3713,
            "original_position": 44,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 44,
            "pull_request_review_id": 1730773194,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393273294/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T20:55:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393273294",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1393294858"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393294858"
                }
            },
            "author_association": "MEMBER",
            "body": "I see. I'm adding this to https://github.com/neovim/neovim/issues/25696 :)",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T21:10:25Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1393294858",
            "id": 1393294858,
            "in_reply_to_id": 1392948224,
            "line": 3681,
            "node_id": "PRRC_kwDOAPphoM5TC_4K",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3681,
            "original_position": 12,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 12,
            "pull_request_review_id": 1730808908,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393294858/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T21:10:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393294858",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/25301#discussion_r1393355836"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/25301"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393355836"
                }
            },
            "author_association": "MEMBER",
            "body": "Sorry, I meant it would be redundant if we have `get()`",
            "commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "created_at": "2023-11-14T21:58:47Z",
            "diff_hunk": "@@ -3670,4 +3670,63 @@ totable({f}, {...})                                       *vim.iter.totable()*\n     Return: ~\n         (table)\n \n+\n+==============================================================================\n+Lua module: vim.snippet                                          *vim.snippet*\n+\n+active()                                                    *snippet.active()*\n+    Returns `true` if there's an active snippet in the current buffer.\n+\n+    Return: ~\n+        (boolean)\n+\n+exit()                                                        *snippet.exit()*\n+    Exits the current snippet.\n+\n+expand({input})                                             *snippet.expand()*\n+    Expands the given snippet text. Refer to https://microsoft.github.io/language-server-protocol/specification/#snippet_syntax for the specification of valid input.\n+\n+    Tabstops are highlighted with hl-SnippetTabstop.\n+\n+    Parameters: ~\n+      ‚Ä¢ {input}  (string)\n+\n+jump({direction})                                             *snippet.jump()*\n+    Jumps within the active snippet in the given direction. If the jump isn't\n+    possible, the function call does nothing.\n+\n+    You can use this function to navigate a snippet as follows: >lua\n+        vim.keymap.set({ 'i', 's' }, '<Tab>', function()\n+           if vim.snippet.jumpable(1) then\n+             return '<cmd>lua vim.snippet.jump(1)<cr>'\n+           else\n+             return '<Tab>'\n+           end\n+         end, { expr = true })\n+<\n+\n+    Parameters: ~\n+      ‚Ä¢ {direction}  (vim.snippet.Direction) Navigation direction. -1 for\n+                     previous, 1 for next.\n+\n+jumpable({direction})                                     *snippet.jumpable()*\n+    Returns `true` if there is an active snippet which can be jumped in the",
            "html_url": "https://github.com/neovim/neovim/pull/25301#discussion_r1393355836",
            "id": 1393355836,
            "in_reply_to_id": 1392962785,
            "line": 3713,
            "node_id": "PRRC_kwDOAPphoM5TDOw8",
            "original_commit_id": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
            "original_line": 3713,
            "original_position": 44,
            "original_start_line": null,
            "path": "runtime/doc/lua.txt",
            "position": 44,
            "pull_request_review_id": 1730890453,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393355836/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2023-11-14T21:58:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1393355836",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "MEMBER",
            "body": "If this is in `vim.snippet` that implies this is a general interface (like `vim.diagnostics`), not dependent on LSP?\r\n\r\nWhat is the format for defining snippets? I have the sense that LuaSnip's snippet format is hard to work with. ",
            "created_at": "2023-09-22T12:15:27Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1731316986",
            "id": 1731316986,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5nMcz6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1731316986/reactions"
            },
            "updated_at": "2023-09-22T12:15:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1731316986",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "LuaSnip supports quite a few different ways of defining snippets. But the format which is hard to work with which you talk about is definitely out of scope for a minimal api. It's not that bad to work with if you got used to it and also really powerful.\r\nBut since this api has to be able to expand lsp snippets I'd expect it to use the [lsp snippet syntax](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#snippet_syntax). Afaict by looking at the tests this is also the case. So I guess you define your snippets just as simple strings (which I don't like to be honest but don't see an easy way around).",
            "created_at": "2023-09-22T12:51:50Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1731363101",
            "id": 1731363101,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5nMoEd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1731363101/reactions"
            },
            "updated_at": "2023-09-22T12:51:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1731363101",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> If this is in vim.snippet that implies this is a general interface (like vim.diagnostics), not dependent on LSP?\r\n\r\nThis is a (future) discussion on the form of the public API for external snippet plugins. Let me briefly summarize the state of play:\r\n\r\n1. We need snippet _expansion_ as this is part of the LSP specs (completion items may be snippets), and we are committed to implementing the full spec.\r\n2. Expansion (keeping track of placeholders, moving between them, and replacing them with typed text) is a basic component of _every_ snippet plugin, so it makes sense to expose that to reduce duplication.\r\n3. The [snippet _format_ is defined by the spec](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#snippet_syntax), so is indeed LSP specific. However, it has become a kind of *lingua franca* for snippets, so most editors and plugins support this (possibly in addition to their own, more powerful format) -- and we certainly don't want to invent yet another, internal, format. This justifies having this outside the `lsp` module. \r\n4. Snippet _libraries_ (defining your own snippets or installing collections of them from the internet) is definitely out of scope for us and left to snippet plugins to do however they see fit. This applies doubly to LuaSnips.\r\n\r\n",
            "created_at": "2023-09-22T13:33:10Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1731428833",
            "id": 1731428833,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5nM4Hh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 14,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 14,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1731428833/reactions"
            },
            "updated_at": "2023-09-22T13:34:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1731428833",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I'm not 100% sure about the name of vim.snippet.cancel, since sometimes it does cancel the snippet session but it's also invoked when the snippet navigation is complete. Do we want to give it another name?\r\n\r\n`detach` has precedents in our API (though it has the same problem as `cancel`: does not quite have the connotation of \"successful completion\"). An alternative would be `exit`, which is also used in one or two places.",
            "created_at": "2023-10-13T08:49:15Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1761151964",
            "id": 1761151964,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5o-Qvc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1761151964/reactions"
            },
            "updated_at": "2023-10-13T08:49:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1761151964",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> `detach` has precedents in our API (though it has the same problem as `cancel`: does not quite have the connotation of \"successful completion\"). An alternative would be `exit`, which is also used in one or two places.\r\n\r\nI like `exit`. I'll wait for more people to weigh in though.\r\n\r\n",
            "created_at": "2023-10-13T22:26:52Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1762315535",
            "id": 1762315535,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pCs0P",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1762315535/reactions"
            },
            "updated_at": "2023-10-19T22:54:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1762315535",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Alright, I'm satisfied with the current functionality so I'm marking this as ready for review. <s>I'm still missing tests and documentation (also need #25611 to get merged first)</s>, but I want to start getting some feedback here :)\r\n\r\nEDIT: Done with docs and tests!",
            "created_at": "2023-10-13T22:29:08Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1762316995",
            "id": 1762316995,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pCtLD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1762316995/reactions"
            },
            "updated_at": "2023-10-19T08:25:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1762316995",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Note to self: Add a highlight group for tabstops.",
            "created_at": "2023-10-15T06:15:43Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1763288017",
            "id": 1763288017,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pGaPR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763288017/reactions"
            },
            "updated_at": "2023-10-19T08:27:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763288017",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Just tried to integrate this in nvim-lsp-compl and it looks like there are some issues with some multi-line snippets.\r\n\r\nFor example, `method` snippet from eclipse.jdt.ls:\r\n\r\n```\r\n${1|public,protected,private|}${2| , static |}${3:void} ${4:name}(${5}) {\r\n^I${0}\r\n}\r\n```\r\n\r\nResulted in:\r\n\r\n```\r\nsnippet.lua:439: attempt to index local 'tabstops' (a nil value)\r\n```\r\n\r\nOr on a snippet to override a base class method:\r\n\r\n```\r\n@Override\r\npublic Plan visitClose(AnalyzedClose close, PlannerContext context) {\r\n    ${0:// TODO Auto-generated method stub\r\n    return super.visitClose(close, context);}\r\n}\r\n```\r\n\r\nResulted in:\r\n\r\n\r\n```\r\nsnippet.lua:135: Invalid 'end_col': out of range\r\n```\r\n\r\n\r\nSome other multi-line snippets I tried worked fine (like `fori`). Also couldn't find any with luals that didn't work.\r\n",
            "created_at": "2023-10-15T09:26:13Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1763333282",
            "id": 1763333282,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pGlSi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763333282/reactions"
            },
            "updated_at": "2023-10-19T08:27:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763333282",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> For example, `method` snippet from eclipse.jdt.ls:\r\n> \r\n> ```\r\n> ${1|public,protected,private|}${2| , static |}${3:void} ${4:name}(${5}) {\r\n> ^I${0}\r\n> }\r\n> ```\r\n> \r\n> Resulted in:\r\n> \r\n> ```\r\n> snippet.lua:439: attempt to index local 'tabstops' (a nil value)\r\n> ```\r\n\r\nNice catch, this was because the implementation assumed that tabstop indexes were consecutive, but this isn't true for choice nodes since we currently treat them as text by inserting the first option.\r\n\r\n> Or on a snippet to override a base class method:\r\n> \r\n> ```\r\n> @Override\r\n> public Plan visitClose(AnalyzedClose close, PlannerContext context) {\r\n>     ${0:// TODO Auto-generated method stub\r\n>     return super.visitClose(close, context);}\r\n> }\r\n> ```\r\n> Resulted in:\r\n> \r\n> snippet.lua:135: Invalid 'end_col': out of range\r\n\r\nAhh, I had not correctly computed the offset for multiline placeholders.\r\n\r\nBoth of these should be fixed with [the latest update](https://github.com/neovim/neovim/compare/b7cd2c79d39981fe99ba771edf5e7541b8295410..ba703898b4d60ed52577a284a7e15658e564e43b).",
            "created_at": "2023-10-15T21:58:37Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1763515080",
            "id": 1763515080,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pHRrI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763515080/reactions"
            },
            "updated_at": "2023-10-19T08:25:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763515080",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Note to self: Add a highlight group for tabstops.\r\n\r\nFor now I'll just expose the `hl_group` used when creating tabstop extmarks. Open to suggestions about making anything else configurable.",
            "created_at": "2023-10-15T22:23:59Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1763521011",
            "id": 1763521011,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pHTHz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763521011/reactions"
            },
            "updated_at": "2023-10-19T08:25:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763521011",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "_This_ PR should enable snippet capabilities when done, though ;)",
            "created_at": "2023-10-16T07:14:36Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1763867705",
            "id": 1763867705,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pInw5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763867705/reactions"
            },
            "updated_at": "2023-10-16T07:14:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763867705",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I've been test driving this with some basic snippets and most things seems to be working great. The only glitch I noticed is that with something like\r\n```\r\nvim.snippet.expand([[for (${1:int} ${2:x} = ${3:0}; $2 < ${4:N}; $2++) {\r\n\t$0\r\n}]])\r\n```\r\nthe `$2` are not synchronized until this tabstop is edited (i e empty spaces are shown instead of `x` ). If this is intentional behavior then fine (because this is how LSP's dialect is expected to work), but the initial copying of the default value is how TextMate-style snippets have worked as far as I can remember. ",
            "created_at": "2023-10-16T16:19:41Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1764835720",
            "id": 1764835720,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pMUGI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764835720/reactions"
            },
            "updated_at": "2023-10-19T08:24:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764835720",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> the `$2` are not synchronized until this tabstop is edited (i e empty spaces are shown instead of `x` ).\r\n\r\n@bfredl Thanks for testing. That's not intentional, I'm currently just replacing placeholders if the node has one (so your example _should_ have placeholders if the `$2`s are replaced with `${2:x}`), but I'm not considering if any other node with the same index has one. I will add this functionality.",
            "created_at": "2023-10-16T16:51:56Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1764886827",
            "id": 1764886827,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pMgkr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764886827/reactions"
            },
            "updated_at": "2023-10-19T08:24:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764886827",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Probably enough for now to just copy any default to later default-less placeholders, if that makes implementation simpler.\r\n\r\n(So `\"$1 ${1:foo} $1 ${1:bar} $1\"` would expand to `<empty> foo foo bar bar`; I believe the overwhelming majority of snippets found in the wild will be of the form `${1:foo} $1 $1 ...`, and it's enough to make these behave as expected.)",
            "created_at": "2023-10-16T16:55:29Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1764892746",
            "id": 1764892746,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pMiBK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764892746/reactions"
            },
            "updated_at": "2023-10-19T08:24:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764892746",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Probably enough for now to just copy any default to later default-less placeholders, if that makes implementation simpler.\r\n> \r\n> (So `\"$1 ${1:foo} $1 ${1:bar} $1\"` would expand to `<empty> foo foo bar bar`; I believe the overwhelming majority of snippets found in the wild will be of the form `${1:foo} $1 $1 ...`, and it's enough to make these behave as expected.)\r\n\r\nI don't think that will make the implementation easier because I'm visiting the tabstops using the tree that the parser returned (which might not always correspond to the sequential order).\r\nI'm not anticipating for the implementation to be tricky though.",
            "created_at": "2023-10-16T17:29:18Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1764945768",
            "id": 1764945768,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pMu9o",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764945768/reactions"
            },
            "updated_at": "2023-10-19T08:24:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1764945768",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@bfredl Your example should work now (fix [here](https://github.com/neovim/neovim/compare/bafa4fec3ff38dd197bc730007dac01e8a45fd66..9bc9bf90dd721686727f746a9bcab5e2d180484f)).",
            "created_at": "2023-10-16T23:46:29Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1765438260",
            "id": 1765438260,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pOnM0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1765438260/reactions"
            },
            "updated_at": "2023-10-19T08:24:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1765438260",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> @bfredl Your example should work now (fix [here](https://github.com/neovim/neovim/compare/bafa4fec3ff38dd197bc730007dac01e8a45fd66..9bc9bf90dd721686727f746a9bcab5e2d180484f)).\r\n\r\nWorks great now, thanks!",
            "created_at": "2023-10-17T17:54:27Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1766896189",
            "id": 1766896189,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pULI9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1766896189/reactions"
            },
            "updated_at": "2023-10-19T08:23:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1766896189",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@mfussenegger the jumping should be fixed [here](https://github.com/neovim/neovim/compare/a39cdab3729d3ce8cb4e5267af8fe959b73ff9e5..e9c4e3f06b69075393c54933b44480ff69bb72c6).",
            "created_at": "2023-10-17T20:15:36Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1767101297",
            "id": 1767101297,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pU9Nx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1767101297/reactions"
            },
            "updated_at": "2023-10-19T08:23:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1767101297",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think this PR is ready. May I start getting some thumbs up please :) ?",
            "created_at": "2023-10-18T19:39:07Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1769201987",
            "id": 1769201987,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pc-FD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 12,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 12,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1769201987/reactions"
            },
            "updated_at": "2023-10-18T19:39:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1769201987",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> @mfussenegger the jumping should be fixed [here](https://github.com/neovim/neovim/compare/a39cdab3729d3ce8cb4e5267af8fe959b73ff9e5..e9c4e3f06b69075393c54933b44480ff69bb72c6).\r\n\r\nIt still doesn't work for me. Maybe I'm doing something wrong?\r\n\r\nWith `minimal.lua`:\r\n\r\n```lua\r\nvim.keymap.set({\"i\", \"s\"}, \"<Tab>\", function()\r\n  if vim.snippet.jumpable(1) then\r\n    vim.snippet.jump(1)\r\n    return \"\"\r\n  else\r\n    return \"<Tab>\"\r\n  end\r\nend, { expr = true })\r\n\r\nvim.keymap.set(\"i\", \"<c-l>\", function()\r\n  vim.snippet.expand(\"function $1($2)\\n\\t$0\\nend\")\r\nend)\r\n```\r\n\r\nAnd `nvim --clean -u minimal.lua`, typing `<ctrl-l>` followed by `<tab>` doesn't move the next placeholder\r\n",
            "created_at": "2023-10-19T06:23:45Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1770139829",
            "id": 1770139829,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pgjC1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1770139829/reactions"
            },
            "updated_at": "2023-10-19T08:24:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1770139829",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@mfussenegger I think something is happening with `expr = true`. If I change that config to:\r\n\r\n```lua\r\nvim.keymap.set({\"i\", \"s\"}, \"<Tab>\", function() vim.snippet.jump(1) end, {})\r\nvim.keymap.set({\"i\", \"s\"}, \"<S-Tab>\", function() vim.snippet.jump(-1) end, {})\r\n\r\nvim.keymap.set(\"i\", \"<c-l>\", function()\r\n  vim.snippet.expand(\"function $1($2)\\n\\t$0\\nend\")\r\nend)\r\n```\r\n\r\nthen I cannot repro it.",
            "created_at": "2023-10-19T06:33:04Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1770149874",
            "id": 1770149874,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5pglfy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1770149874/reactions"
            },
            "updated_at": "2023-10-19T08:24:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1770149874",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "is it needed to have the exact same example two times right below the other one?\r\nperhaps you could add sth like \"for an example look at <link to other help tag>\"",
            "created_at": "2023-10-20T08:02:51Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1772268774",
            "id": 1772268774,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5poqzm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1772268774/reactions"
            },
            "updated_at": "2023-10-20T08:22:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1772268774",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/81827001?v=4",
                "events_url": "https://api.github.com/users/max397574/events{/privacy}",
                "followers_url": "https://api.github.com/users/max397574/followers",
                "following_url": "https://api.github.com/users/max397574/following{/other_user}",
                "gists_url": "https://api.github.com/users/max397574/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/max397574",
                "id": 81827001,
                "login": "max397574",
                "node_id": "MDQ6VXNlcjgxODI3MDAx",
                "organizations_url": "https://api.github.com/users/max397574/orgs",
                "received_events_url": "https://api.github.com/users/max397574/received_events",
                "repos_url": "https://api.github.com/users/max397574/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/max397574/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/max397574/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/max397574"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> is it needed to have the exact same example two times right below the other one?\r\n> perhaps you could add sth like \"for an example look at \"\r\n\r\nWhen you hover over a function it‚Äôs nice for the documentation to include all the necessary information. It would be annoying to hover over one of these just to read ‚Äúplease refer to the other function‚Äù.",
            "created_at": "2023-10-20T08:07:04Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1772274449",
            "id": 1772274449,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5posMR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1772274449/reactions"
            },
            "updated_at": "2023-10-20T15:14:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1772274449",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> > I'm not 100% sure about the name of vim.snippet.cancel, since sometimes it does cancel the snippet session but it's also invoked when the snippet navigation is complete. Do we want to give it another name?\r\n> \r\n> `detach` has precedents in our API (though it has the same problem as `cancel`: does not quite have the connotation of \"successful completion\"). An alternative would be `exit`, which is also used in one or two places.\r\n\r\nSounds like `done()` would fit very well. And `done()` is likely to be used in future features (e.g. \"structured concurrency\" tasks https://github.com/neovim/neovim/issues/19624 ). ",
            "created_at": "2023-11-14T17:16:07Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1810726215",
            "id": 1810726215,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5r7X1H",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810726215/reactions"
            },
            "updated_at": "2023-11-14T17:16:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810726215",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Sounds like `done()` would fit very well. And `done()` is likely to be used in future features (e.g. \"structured concurrency\" tasks #19624 ).\r\n\r\nIdk I feel like `done` suggests that all tabstops were visited, despite that we want to also use the function for cancelling the snippet midway through tabstop navigation.\r\n\r\nI haven't carefully read the entire discussion in #19624, but it seems that such `done()` method would return a boolean indicating whether snippet navigation is complete/interrupted? If so, that's not what `vim.snippet.exit()` does, which actually performs such cancellation.",
            "created_at": "2023-11-14T20:52:54Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1811260469",
            "id": 1811260469,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5r9aQ1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1811260469/reactions"
            },
            "updated_at": "2023-11-14T20:52:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1811260469",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "\r\n> I haven't carefully read the entire discussion in #19624 ... that's not what `vim.snippet.exit()` does, which actually performs such cancellation.\r\n\r\n`done()` on a task would mark the task as done.\r\n",
            "created_at": "2023-11-14T21:57:32Z",
            "html_url": "https://github.com/neovim/neovim/pull/25301#issuecomment-1811426462",
            "id": 1811426462,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
            "node_id": "IC_kwDOAPphoM5r-Cye",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1811426462/reactions"
            },
            "updated_at": "2023-11-14T21:57:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1811426462",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/25301/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/25301/commits",
    "created_at": "2023-09-22T03:49:20Z",
    "diff_url": "https://github.com/neovim/neovim/pull/25301.diff",
    "draft": false,
    "head": {
        "label": "MariaSolOs:snippets",
        "ref": "snippets",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/MariaSolOs/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/MariaSolOs/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/MariaSolOs/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/MariaSolOs/neovim/branches{/branch}",
            "clone_url": "https://github.com/MariaSolOs/neovim.git",
            "collaborators_url": "https://api.github.com/repos/MariaSolOs/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/MariaSolOs/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/MariaSolOs/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/MariaSolOs/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/MariaSolOs/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/MariaSolOs/neovim/contributors",
            "created_at": "2023-08-05T17:10:58Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/MariaSolOs/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/MariaSolOs/neovim/downloads",
            "events_url": "https://api.github.com/repos/MariaSolOs/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/MariaSolOs/neovim/forks",
            "full_name": "MariaSolOs/neovim",
            "git_commits_url": "https://api.github.com/repos/MariaSolOs/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/MariaSolOs/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/MariaSolOs/neovim/git/tags{/sha}",
            "git_url": "git://github.com/MariaSolOs/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/MariaSolOs/neovim/hooks",
            "html_url": "https://github.com/MariaSolOs/neovim",
            "id": 675070403,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/MariaSolOs/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/MariaSolOs/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/MariaSolOs/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/MariaSolOs/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/MariaSolOs/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/MariaSolOs/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/MariaSolOs/neovim/merges",
            "milestones_url": "https://api.github.com/repos/MariaSolOs/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOKDzBww",
            "notifications_url": "https://api.github.com/repos/MariaSolOs/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/MariaSolOs/neovim/pulls{/number}",
            "pushed_at": "2023-11-14T05:25:30Z",
            "releases_url": "https://api.github.com/repos/MariaSolOs/neovim/releases{/id}",
            "size": 224338,
            "ssh_url": "git@github.com:MariaSolOs/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/MariaSolOs/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/MariaSolOs/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/MariaSolOs/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/MariaSolOs/neovim/subscription",
            "svn_url": "https://github.com/MariaSolOs/neovim",
            "tags_url": "https://api.github.com/repos/MariaSolOs/neovim/tags",
            "teams_url": "https://api.github.com/repos/MariaSolOs/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/MariaSolOs/neovim/git/trees{/sha}",
            "updated_at": "2023-08-09T04:34:06Z",
            "url": "https://api.github.com/repos/MariaSolOs/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "d2c6d7a1ad14840078b65bba8c18d0626f136d62",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
            "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
            "followers_url": "https://api.github.com/users/MariaSolOs/followers",
            "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
            "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/MariaSolOs",
            "id": 62502207,
            "login": "MariaSolOs",
            "node_id": "MDQ6VXNlcjYyNTAyMjA3",
            "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
            "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
            "repos_url": "https://api.github.com/users/MariaSolOs/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/MariaSolOs"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/25301",
    "id": 1525897868,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25301",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "locked": false,
    "merge_commit_sha": "f1775da07fe48da629468bcfcc2a8a6c4c3f40ed",
    "merged_at": "2023-10-21T06:51:27Z",
    "milestone": null,
    "node_id": "PR_kwDOAPphoM5a81qM",
    "number": 25301,
    "patch_url": "https://github.com/neovim/neovim/pull/25301.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/25301/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/d2c6d7a1ad14840078b65bba8c18d0626f136d62",
    "title": "feat(lsp): snippet API",
    "updated_at": "2023-11-14T21:58:48Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/25301",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
        "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
        "followers_url": "https://api.github.com/users/MariaSolOs/followers",
        "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
        "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/MariaSolOs",
        "id": 62502207,
        "login": "MariaSolOs",
        "node_id": "MDQ6VXNlcjYyNTAyMjA3",
        "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
        "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
        "repos_url": "https://api.github.com/users/MariaSolOs/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/MariaSolOs"
    }
}
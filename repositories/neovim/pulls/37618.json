{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/37618/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37618/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/37618"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/37618"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37618/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37618"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/400fa10c2f639abafb5f603f5de001fc26c2932c"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6562,
            "forks_count": 6562,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 2079,
            "open_issues_count": 2079,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2026-02-03T03:16:17Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 368582,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 96189,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2026-02-03T03:16:22Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 96189,
            "watchers_count": 96189,
            "web_commit_signoff_required": false
        },
        "sha": "1906da52dbc9876046ec9866a5aae25309d7587e",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "Problem: No concise way to perform more kinds of one-shot delated actions. Like on event trigger.\r\n\r\nOne of the use cases is \"lazy loading\" plugins with `vim.pack`. Although plugins themselves should optimize their code to not eagerly load scripts (like during startup), it does not cover *all* performance overhead introduced by loading a plugin. The act of increasing 'runtimepath' itself can have consequences for performance. This is especially visible on slow machines or with 50+ plugin count.\r\n\r\nSolution: Expand `vim.defer_fn` behavior to allow custom `when` conditions describing when to execute the function.\r\n\r\nWith this, \"lazy loading\" can be done like this:\r\n\r\n```lua\r\nvim.defer_fn(function()\r\n  vim.pack.add({ 'https://github.com/nvim-mini/mini.completion' })\r\n  require('mini.completion').setup()\r\nend, 'event:InsertEnter')\r\n\r\nvim.defer_fn(function()\r\n  vim.pack.add({ 'https://github.com/mfussenegger/nvim-ansible' })\r\nend, 'filetype:yaml')\r\n```\r\n\r\n---\r\n\r\nThis is my attempt at [addressing lazy loading for `vim.pack`](https://github.com/neovim/neovim/issues/35562#issuecomment-3240097852). Although I fully agree that plugins can do better at not eagerly loading their code, but the fact itself of loading a plugin can affect overall performance. [I did some benchmarks](https://echasnovski.com/blog/2026-01-27-how-many-neovim-plugins-is-too-many.html) and although it doesn't look like much, on slow machine startup effects can be worse while runtime performance overhead can quickly accumulate. So there has to be some reasonably convenient way for users to defer loading plugins.\r\n\r\nI think expanding the behavior of `defer_fn` for some common cases of \"one-shot deferred execution\" is a reasonable functionality in itself. It just so happens to also be very useful for lazy loading with `vim.pack`.\r\n\r\nThe only theoretical downside here is that it has certain \"home cooked DSL\" signs. However, if it serves its purpose and solves actual problems, I see no problem with this.\r\n\r\n---\r\n\r\nIn this PR I went with expanding `vim.defer_fn`, but I think a better solution here is a redesign of it in the form of a new utility function.\r\n\r\nI fancy something like this: `vim.later(when, f, opts)`. Placing `when` as first argument makes it more readable with StyLua formatting of functions, while `opts` is reserved for future.\r\n\r\nUsages can then be like `vim.later('delay:100', f)`, `vim.later('event:InsertEnter', f)`, etc.\r\n\r\nOther `when` formats might also be beneficial. Like:\r\n- `cmd:MyCmd` to load immediately when detecting user command `MyCmd` in action.\r\n- `keymap:n=<Space>f` to load on mapping execution.\r\n- `soon` to load soon but not immediately (like `vim.schedule` but with guaranteed order preservation).",
    "closed_at": null,
    "comment_data": [],
    "comment_regular_data": [
        {
            "author_association": "MEMBER",
            "body": "I am sorry, but how is this different from defining an autocommand for those events, except for a new custom DSL? If it's about fast events/scheduling, wouldn't it be cleaner (and more broadly useful) to add an option to `nvim_create_autocommand` that executes the callback with the desired wrapping?",
            "created_at": "2026-01-29T17:49:11Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819257786",
            "id": 3819257786,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jpT-6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819257786/reactions"
            },
            "updated_at": "2026-01-29T17:49:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819257786",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I am sorry, but how is this different from defining an autocommand for those events, except for a new custom DSL?\r\n\r\nHere:\r\n\r\n> So there has to be some reasonably convenient way for users to defer loading plugins.\r\n> \r\n> I think expanding the behavior of `defer_fn` for some common cases of \"one-shot deferred execution\" is a reasonable functionality in itself. It just so happens to also be very useful for lazy loading with `vim.pack`.\r\n\r\nAn `event:` is one of the ways to specify the condition. And the result is (much) more readable and understandable:\r\n\r\n```lua\r\n-- Now\r\nvim.api.nvim_create_autocmd({ 'InsertEnter', 'CmdlineEnter' }, { callback = function()\r\n  f()\r\n  return true\r\nend, nested = true })\r\n\r\n-- With this PR\r\nvim.defer_fn(f, 'event:InsertEnter,CmdlineEnter')\r\n```\r\n\r\nPlus it opens a possibility for other types of conditions:\r\n- `filetype:ft1,ft2` - basically an `event:FileType~ft1,ft2` but with extra handling of filetype related side effects.\r\n- And others:\r\n> * `cmd:MyCmd` to load immediately when detecting user command `MyCmd` in action.\r\n> \r\n> * `keymap:n=<Space>f` to load on mapping execution.\r\n> \r\n> * `soon` to load soon but not immediately (like `vim.schedule` but with guaranteed order preservation).\r\n\r\nAll of them are not trivial one-two-three-liners to add.",
            "created_at": "2026-01-29T18:20:07Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819406642",
            "id": 3819406642,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jp4Uy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 3,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819406642/reactions"
            },
            "updated_at": "2026-01-29T18:20:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819406642",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "So this (currently) _is_ just a convenience wrapper for defining autocommands. (We already have `vim.on_key()`.)\r\n\r\nAnyway, I don't want to argue; I was unsure and wanted clarification, which I have now received.",
            "created_at": "2026-01-29T18:23:14Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819423098",
            "id": 3819423098,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jp8V6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819423098/reactions"
            },
            "updated_at": "2026-01-29T18:33:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819423098",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> So this (currently) _is_ just a convenience wrapper for defining autocommands. (We already have `vim.on_key()`.)\r\n\r\nAlthough what it already can do is not trivial convenience wrappers, it is a start to showcase the design. Which is future compatible for more complicated stuff.\r\n\r\nAnd `vim.on_key()` has nothing to do with autocommands.\r\n\r\n> I feel quite bad about shoving this into `vim.defer_fn()` -- which already serves a very different purpose -- just because of the similarity in name.\r\n\r\nAnd its current purpose is to be a wrapper for three commands which is a subject of the same \"Why is this a thing? Isn't creating a timer already an easy thing to do?\". This at least makes it more worthwhile without breaking backward compatibility.\r\n\r\nAnd the name more or less perfectly describes what is intended to be done here: defer execution of the function until some condition is met. Now it is only \"when certain time passes\", but it can be more.\r\n\r\nAs also mentioned in the original comment, creating a new `vim.later` that would (soft) deprecate `vim.defer_fn` seems like a cleaner choice to me. But improving `defer_fn` is a good choice also.",
            "created_at": "2026-01-29T18:34:04Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819537803",
            "id": 3819537803,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jqYWL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 1,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819537803/reactions"
            },
            "updated_at": "2026-01-29T18:34:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819537803",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I had planned to stay quiet after this, but _if_ this should be added and you need to distinguish the type of the second argument anyway, a table would be much cleaner than a magic string (and allow combining conditions, like `{ event = 'VeryPacked', time = 1000 }` meaning defer until event or time, whichever comes first).",
            "created_at": "2026-01-29T18:56:32Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819667581",
            "id": 3819667581,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jq4B9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819667581/reactions"
            },
            "updated_at": "2026-01-29T18:56:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819667581",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> An event: is one of the ways to specify the condition. And the result is (much) more readable and understandable:\r\n\r\nHaving to learn an additional API is not necessarily more readable or understandable. I'd say it's often the opposite due to our Human memory limitations. Especially if it involves an entire new string based custom DSL like you're proposing with `event:FileType~ft1,ft2`.\r\n\r\nYour example of now vs. this PR is imho a good example why this doesn't improve ergonomics enough to outweight the \"yet another API\" point.",
            "created_at": "2026-01-29T19:05:55Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819721842",
            "id": 3819721842,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jrFRy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819721842/reactions"
            },
            "updated_at": "2026-01-29T19:05:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819721842",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Having to learn an additional API is not necessarily more readable or understandable. I'd say it's often the opposite due to our Human memory limitations.\r\n> ...\r\n> Your example of now vs. this PR is imho a good example why this doesn't improve ergonomics enough to outweight the \"yet another API\" point.\r\n\r\nThat is a point of view of already being familiar with how to use `vim.api.nvim_create_autocmd()`. And it might be a reasonable angle for plugin developers, but for Neovim users it *has proved* to be a difficult thing to understand because of its verbosity and complexity.\r\n\r\nHaving a concise Lua-first way to create a one-shot autocommand is very valuable in configs for people who won't ever need to use it beyond that. My educated guess here is that this is a significant portion of people. ",
            "created_at": "2026-01-29T19:46:49Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3819916681",
            "id": 3819916681,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jr02J",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 1,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819916681/reactions"
            },
            "updated_at": "2026-01-29T19:46:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3819916681",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> but for Neovim users it has proved to be a difficult thing to understand because of its verbosity and complexity.\r\n\r\nWhere did you get the information that a) it proved to be difficult and b) that it's due to its verbosity?\r\nThe complexity looking at the two variants in isolation is not that different. Both have a function call. Both use higher order functions. One uses tables, the other string-encoded options.\r\n\r\nFor people with a working luals setup the current `nvim_create_autocmd` even completes the available events. The version in this PR doesn't have that - and adding it would require another large enum type definition and would break down with the pattern syntax.\r\n\r\n> Having a concise Lua-first way to create a one-shot autocommand is very valuable in configs for people who won't ever need to use it beyond that.\r\n\r\nI don't think we should encourage _any_ use of lazy loading for beginners. Especially those who don't want to go further. Using the wrong events can subtly break plugins in ways that are difficult to debug. This should _only_ be done by people with a good understanding of when autocmd events fire, and what requirements plugins have. Given that anything < 100ms is perceived as pretty much instant, telling beginners to lazy load plugins is in most cases bad advice.\r\n\r\n\r\nFor the people past the beginner phase, or those who want to learn more, we'd need to consider the different learning and discovery journeys. E.g. say they happen to see this new `defer_fn` or `later` variant somewhere and look into the docs to learn more. They'd be pointed to `autocmd-pattern` which includes vimL `:autocmd BufRead` examples. That would likely be confusing. If they then search for something like \"autocmd neovim lua\" they'd likely run into `nvim_create_autocmd` and begin to wonder what the difference between that and `defer_fn`/`later` is.\r\n\r\nOr if they happen to encounter autocmd first, it's unlikely they'd even find the `defer_fn`/`later`.\r\n\r\nThis is *raising* complexity if looking at the full picture.\r\n",
            "created_at": "2026-01-29T21:03:27Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3820321880",
            "id": 3820321880,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jtXxY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 5,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 6,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3820321880/reactions"
            },
            "updated_at": "2026-01-29T21:03:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3820321880",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Another problem with this PR is that it makes the return type of `vim.defer_fn()` more complicated. Especially if you use a \"home cooked DSL\" with `event:`, `cmd:` etc., in which case I don't think you can get type inference to work properly even with `@overload`.",
            "created_at": "2026-01-29T23:32:52Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3820931545",
            "id": 3820931545,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jvsnZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 4,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3820931545/reactions"
            },
            "updated_at": "2026-01-29T23:46:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3820931545",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Since this API is specifically geared toward `vim.pack`, I believe it would be more intuitive to place it under the `vim.pack` namespace if we have this requirement.\r\n\r\nFor example, the following structure might be better:\r\n\r\n```lua\r\nvim.pack.defer_add({ 'https://github.com/nvim-mini/mini.completion' }, {\r\n  callback = function()\r\n    require('mini.completion').setup()\r\n  end, \r\n  event = 'InsertEnter'\r\n})\r\n\r\nvim.pack.defer_add({ 'https://github.com/mfussenegger/nvim-ansible' }, {\r\n  callback = function()\r\n    -- Logic for adding the package\r\n  end, \r\n  filetype = 'yaml'\r\n})\r\n\r\n```\r\n\r\nJust for reference, my main point is that since we already have a general-purpose API like `autocmd`, there doesn't seem to be a strong reason to specialize an existing API while still keeping it labeled as \"general.\"\r\n\r\nI’m a bit skeptical whether the target user for this change (those who might not use `autocmd` manually) would recognize that this API is specifically designed for lazy loading if it isn't explicitly linked to `vim.pack`. Furthermore, keeping this functionality within the `vim.pack` namespace would be beneficial for future updates and maintenance.",
            "created_at": "2026-01-30T06:06:19Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3822036291",
            "id": 3822036291,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7jz6VD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 4,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3822036291/reactions"
            },
            "updated_at": "2026-01-30T06:06:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3822036291",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Using the wrong events can subtly break plugins in ways that are difficult to debug. \r\n\r\nCase in point, the example:\r\n\r\n```\r\nvim.defer_fn(function()\r\n  vim.pack.add({ 'https://github.com/mfussenegger/nvim-ansible' })\r\nend, 'filetype:yaml')\r\n```\r\n\r\nIs breaking the ftdetect mechanism from nvim-ansible.\r\n`vim.pack.defer_add` has the same problems: Lazy loading is a footgun and it would duplicate API. \r\n",
            "created_at": "2026-01-30T06:48:30Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3822148580",
            "id": 3822148580,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j0Vvk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 1,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3822148580/reactions"
            },
            "updated_at": "2026-01-30T06:50:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3822148580",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Where did you get the information that a) it proved to be difficult and b) that it's due to its verbosity?\r\n\r\n1) I try to look at what people have trouble with understanding about Neovim and how to use it; and 2) I was one of those people who for the longest time dragged on using `vim.api` methods for autocommands because of how verbose and convoluted they are.\r\n\r\n> I don't think we should encourage _any_ use of lazy loading for beginners.\r\n> ...\r\n> Given that anything < 100ms is perceived as pretty much instant, telling beginners to lazy load plugins is in most cases bad advice.\r\n\r\nThe fact that not lazy loading plugins can results in less than 100ms startup time \"in most cases\" is not close to reality. Most people who report this kind of times use 'lazy.nvim'... which does some hacky lazy loading. Having 300-500 ms on Windows or old machines is not uncommon. Sure, it is not enough to make a couple of tea in the process, but still can be optimized.\r\n\r\nProviding an easier way to do a necessary thing is valuable. There is a reason you don't see `vim.api.nvim_set_option_value('expandtab', true, { scope = 'global' })` in configs, there are only `vim.o.expandtab = true`. The same thing with `vim.api.nvim_buf_set_keymap()` and `vim.keymap.set()`. Although both cases have \"yet another API point\" and \"raise complexity if looking at the full picture.\"\r\n\r\n> Another problem with this PR is that it makes the return type of `vim.defer_fn()` more complicated.\r\n\r\nYeah, I don't like that either. Returning anything here, even for current `defer_fn`, is a bit too much in my opinion. That's why I pointed about a possibility for a new function, which I am totally okay with.\r\n\r\n> I’m a bit skeptical whether the target user for this change (those who might not use `autocmd` manually) would recognize that this API is specifically designed for lazy loading if it isn't explicitly linked to `vim.pack`. Furthermore, keeping this functionality within the `vim.pack` namespace would be beneficial for future updates and maintenance.\r\n\r\nAnd I don't think promoting lazy loading plugins is a good idea either. Otherwise it would have been a part of `vim.pack.add()` plugin spec. But at least acknowledging and providing tools for a simple lazy loading with a strong wording like \"Use only if you have performance issues\" is a good idea in my eyes.\r\n\r\n> Case in point, the example:\r\n> \r\n> ```\r\n> vim.defer_fn(function()\r\n>   vim.pack.add({ 'https://github.com/mfussenegger/nvim-ansible' })\r\n> end, 'filetype:yaml')\r\n> ```\r\n> \r\n> Is breaking the ftdetect mechanism from nvim-ansible.\r\n\r\n@mfussenegger, the only case in point here is that this claim is too confident at how unverified it is. At least by skimming the PR's code. The example *does* respect 'ftdetect' and is provided *specifically* to illustrate that.\r\n",
            "created_at": "2026-01-30T09:55:50Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3822849448",
            "id": 3822849448,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j3A2o",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3822849448/reactions"
            },
            "updated_at": "2026-01-30T09:55:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3822849448",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> the only case in point here is that this claim is too confident at how unverified it is. At least by skimming the PR's code. The example does respect 'ftdetect' and is provided specifically to illustrate that.\r\n\r\nSorry I could've been more verbose and maybe \"breaking\" is too harsh. But it does subtly change the behavior because it relies on a `yaml` FileType firing first before it fires the second `yaml.ansible`.\r\n\r\nE.g. if having a `filetype/yaml.lua` with a\r\n\r\n```\r\nif vim.bo.filetype:find(\"ansible\") then\r\n  return\r\nend\r\n```\r\n\r\nThis would no longer work. In my case that would end up starting yaml-language-server in addition to only ansible-ls.\r\nThat's different behavior than if you did a `vim.pack.add` without any lazy loading involved.\r\n\r\n\r\n> Providing an easier way to do a necessary thing is valuable. There is a reason you don't see vim.api.nvim_set_option_value('expandtab', true, { scope = 'global' }) in configs, there are only vim.o.expandtab = true. The same thing with vim.api.nvim_buf_set_keymap() and vim.keymap.set()\r\n\r\nAren't you kinda moving the goalpost from lazy loading being something that's discouraged, but maybe a necessary evil, to it needing to be as ergonomic as common operations like setting options and keymaps?\r\n\r\n(And `vim.o`/`vim.opt` specifically had caused discussions & regrets because of the duplication we have now. We were too quick with that. That said. I agree that in that case some ergonomic improvement over the API version is justified given how common it is. The keymap case is less clear to me, because of the little gap between the two versions. If I remember right the API compatibility and not being able to change rhs to `string|func` played a factor there? Since then the API contract was also relaxed a bit. But also sort of irrelevant for this discussion here)",
            "created_at": "2026-01-30T11:15:18Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823176287",
            "id": 3823176287,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j4Qpf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823176287/reactions"
            },
            "updated_at": "2026-01-30T11:16:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823176287",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> But it does subtly change the behavior because it relies on a `yaml` FileType firing first before it fires the second `yaml.ansible`.\r\n> \r\n> E.g. if having a `filetype/yaml.lua` with a\r\n> \r\n> ```\r\n> if vim.bo.filetype:find(\"ansible\") then\r\n>   return\r\n> end\r\n> ```\r\n> \r\n> This would no longer work. In my case that would end up starting yaml-language-server in addition to only ansible-ls. That's different behavior than if you did a `vim.pack.add` without any lazy loading involved.\r\n\r\nYes, indeed. I've tested and with `defer_fn` the 'after/ftplugin/yaml.lua' is sourced with both `yaml` and `yaml.ansible`. Currently three times (`yaml`, `yaml.ansible`, `yaml.ansible`), but it can be fixed to be `yaml` - `yaml.ansible`. Without deferring it is only `yaml.ansible`.\r\n\r\nI am not sure how big of an issue it is, but I guess it is a (relatively small, in my opinion) price to pay for a better performance here and can be documented. As long as necessary scripts are still triggered as expected, this looks workable to me.\r\n\r\n> Aren't you kinda moving the goalpost from lazy loading being something that's discouraged, but maybe a necessary evil, to it needing to be as ergonomic as common operations like setting options and keymaps?\r\n\r\nI don't see a contradiction in it being discouraged and suggested to be used only if needed, while still striving to make it more user friendly for ones who will need it. Not everybody is happy to study the intricacies of why they need to `return true` from the callback or add `nested = true`.\r\n\r\n---\r\n\r\nOne of the cases I have in mind is that without any plugin lazy loading having any sort of dedicated \"language pack\" plugins is basically a no go. For a capable text editor, eagerly loading all language plugins that *might* be useful adds a lot of overhead. Both startup and runtime.",
            "created_at": "2026-01-30T11:44:17Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823281822",
            "id": 3823281822,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j4qae",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 1,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823281822/reactions"
            },
            "updated_at": "2026-01-30T11:44:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823281822",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Do not like this kind of change. The main reason I switched from Vimscript to Lua was to avoid this kind of unclear, ad-hoc syntax, like `foo:b,fss:c`, where colons and commas are used to separate key-value pairs. This style is hard to read, prone to typos, and difficult to maintain.\r\n\r\nIn contrast, using explicit Lua tables is much clearer and more readable:\r\n\r\nEDIT:\r\n\r\nand why this function need to call `filetype detect` and reload ftplugin? it will make thing slow.",
            "created_at": "2026-01-30T12:41:26Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823569445",
            "id": 3823569445,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j5wol",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823569445/reactions"
            },
            "updated_at": "2026-01-30T12:49:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823569445",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13142418?v=4",
                "events_url": "https://api.github.com/users/wsdjeg/events{/privacy}",
                "followers_url": "https://api.github.com/users/wsdjeg/followers",
                "following_url": "https://api.github.com/users/wsdjeg/following{/other_user}",
                "gists_url": "https://api.github.com/users/wsdjeg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wsdjeg",
                "id": 13142418,
                "login": "wsdjeg",
                "node_id": "MDQ6VXNlcjEzMTQyNDE4",
                "organizations_url": "https://api.github.com/users/wsdjeg/orgs",
                "received_events_url": "https://api.github.com/users/wsdjeg/received_events",
                "repos_url": "https://api.github.com/users/wsdjeg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wsdjeg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wsdjeg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wsdjeg",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> ... and why this function need to call `filetype detect` and reload ftplugin? it will make thing slow.\r\n\r\nPlease read couple of comments of discussion right above your comment. It is a dedicated way to account for adding filetype-specfic actions inside of a callback. Like making 'ftdetect' and 'ftplugin 'scripts available. ",
            "created_at": "2026-01-30T12:51:48Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823605783",
            "id": 3823605783,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j55gX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823605783/reactions"
            },
            "updated_at": "2026-01-30T12:51:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823605783",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> > ... and why this function need to call `filetype detect` and reload ftplugin? it will make thing slow.\r\n> \r\n> Please read couple of comments of discussion right above your comment. It is a dedicated way to account for adding filetype-specfic actions inside of a callback. Like making 'ftdetect' and 'ftplugin 'scripts available.\r\n\r\nHowever, this method may cause unnecessary files to be read and executed repeatedly, which can slow down the code.",
            "created_at": "2026-01-30T13:01:09Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823638362",
            "id": 3823638362,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j6Bda",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823638362/reactions"
            },
            "updated_at": "2026-01-30T13:01:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823638362",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13142418?v=4",
                "events_url": "https://api.github.com/users/wsdjeg/events{/privacy}",
                "followers_url": "https://api.github.com/users/wsdjeg/followers",
                "following_url": "https://api.github.com/users/wsdjeg/following{/other_user}",
                "gists_url": "https://api.github.com/users/wsdjeg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wsdjeg",
                "id": 13142418,
                "login": "wsdjeg",
                "node_id": "MDQ6VXNlcjEzMTQyNDE4",
                "organizations_url": "https://api.github.com/users/wsdjeg/orgs",
                "received_events_url": "https://api.github.com/users/wsdjeg/received_events",
                "repos_url": "https://api.github.com/users/wsdjeg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wsdjeg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wsdjeg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wsdjeg",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> However, this method may cause unnecessary files to be read and executed repeatedly, which can slow down the code.\r\n\r\nPlease, read the documentation and the code. The extra filetype detection and plugin source is done only for buffers that match target filetypes and *only once* after callback is executed. Those actions are necessary to do at least once, so this is as optimal as it gets.",
            "created_at": "2026-01-30T13:16:45Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823701298",
            "id": 3823701298,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j6Q0y",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823701298/reactions"
            },
            "updated_at": "2026-01-30T13:16:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823701298",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> > However, this method may cause unnecessary files to be read and executed repeatedly, which can slow down the code.\r\n> \r\n> Please, read the documentation and the code. The extra filetype detection and plugin source is done only for buffers that match target filetypes and _only once_ after callback is executed. Those actions are necessary to do at least once, so this is as optimal as it gets.\r\n\r\nThere should be an option to control whether already-triggered FileType events are taken into account.\r\nOtherwise, this behavior becomes inconsistent with how regular autocmds work in Neovim.\r\nIn other words, it is unclear whether this feature is supposed to listen to FileType events that have already happened.\r\nIf it does, that would be different from the standard autocmd semantics, where only future events are handled.\r\n\r\n> cmd:MyCmd to load immediately when detecting user command MyCmd in action.\r\n\r\n\r\nthis should be in scope of vim.pack, and how do you implement this feature, if it is to create a new command to trigger the function and run cmd again. It is can be use to lazy load definde cmd, but If cmd already exists, there is a risk that it will be overwritten.\r\n\r\nsame as `keymap:`\r\n\r\n**EDIT：**\r\n\r\nThis is a summary of all my statements.：\r\n\r\n1. String-based DSL instead of structured Lua data\r\nConditions like event:InsertEnter,CmdlineEnter introduce an ad-hoc syntax that is harder to read, easy to mistype, and difficult to extend. It goes against the main benefit of using Lua: clear, structured configuration with tables.\r\n\r\n2. It overloads and changes the meaning of vim.defer_fn()\r\nvim.defer_fn() currently means “run after a time delay”. Extending it to mean “run when some arbitrary condition is met” mixes unrelated concepts and blurs the original API semantics.\r\n\r\n3. It hides fragile and complex behavior behind a simple helper\r\nThe real use case is plugin lazy loading, which is known to be subtle and error-prone. A concise wrapper makes it look safe, while it can easily change event order, filetype handling, and plugin behavior.\r\n\r\n4. It breaks existing autocmd semantics\r\nSupporting filetype: requires re-running filetype detection and ftplugins for existing buffers, which is fundamentally different from normal autocmd behavior that only reacts to future events.\r\n\r\n5. It duplicates existing APIs and worsens discoverability\r\nNeovim already has nvim_create_autocmd() and vim.on_key(). Adding another overlapping mechanism increases API surface and makes it harder to understand which API should be used.\r\n\r\n6. It is unfriendly to tooling and type checking\r\nA string DSL cannot be properly completed or validated by Lua language servers, increasing the risk of silent mistakes.\r\n\r\n",
            "created_at": "2026-01-30T13:57:23Z",
            "html_url": "https://github.com/neovim/neovim/pull/37618#issuecomment-3823896497",
            "id": 3823896497,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
            "node_id": "IC_kwDOAPphoM7j7Aex",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 1,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823896497/reactions"
            },
            "updated_at": "2026-01-30T14:07:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3823896497",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13142418?v=4",
                "events_url": "https://api.github.com/users/wsdjeg/events{/privacy}",
                "followers_url": "https://api.github.com/users/wsdjeg/followers",
                "following_url": "https://api.github.com/users/wsdjeg/following{/other_user}",
                "gists_url": "https://api.github.com/users/wsdjeg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wsdjeg",
                "id": 13142418,
                "login": "wsdjeg",
                "node_id": "MDQ6VXNlcjEzMTQyNDE4",
                "organizations_url": "https://api.github.com/users/wsdjeg/orgs",
                "received_events_url": "https://api.github.com/users/wsdjeg/received_events",
                "repos_url": "https://api.github.com/users/wsdjeg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wsdjeg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wsdjeg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wsdjeg",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37618/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/37618/commits",
    "created_at": "2026-01-29T15:58:25Z",
    "diff_url": "https://github.com/neovim/neovim/pull/37618.diff",
    "draft": false,
    "head": {
        "label": "echasnovski:flexible-defer",
        "ref": "flexible-defer",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/echasnovski/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/echasnovski/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/echasnovski/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/echasnovski/neovim/branches{/branch}",
            "clone_url": "https://github.com/echasnovski/neovim.git",
            "collaborators_url": "https://api.github.com/repos/echasnovski/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/echasnovski/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/echasnovski/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/echasnovski/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/echasnovski/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/echasnovski/neovim/contributors",
            "created_at": "2021-12-02T09:43:59Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/echasnovski/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/echasnovski/neovim/downloads",
            "events_url": "https://api.github.com/repos/echasnovski/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/echasnovski/neovim/forks",
            "full_name": "echasnovski/neovim",
            "git_commits_url": "https://api.github.com/repos/echasnovski/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/echasnovski/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/echasnovski/neovim/git/tags{/sha}",
            "git_url": "git://github.com/echasnovski/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/echasnovski/neovim/hooks",
            "html_url": "https://github.com/echasnovski/neovim",
            "id": 434162461,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/echasnovski/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/echasnovski/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/echasnovski/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/echasnovski/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/echasnovski/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/echasnovski/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/echasnovski/neovim/merges",
            "milestones_url": "https://api.github.com/repos/echasnovski/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOGeDLHQ",
            "notifications_url": "https://api.github.com/repos/echasnovski/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/echasnovski/neovim/pulls{/number}",
            "pushed_at": "2026-02-02T20:35:05Z",
            "releases_url": "https://api.github.com/repos/echasnovski/neovim/releases{/id}",
            "size": 356891,
            "ssh_url": "git@github.com:echasnovski/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/echasnovski/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/echasnovski/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/echasnovski/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/echasnovski/neovim/subscription",
            "svn_url": "https://github.com/echasnovski/neovim",
            "tags_url": "https://api.github.com/repos/echasnovski/neovim/tags",
            "teams_url": "https://api.github.com/repos/echasnovski/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/echasnovski/neovim/git/trees{/sha}",
            "updated_at": "2026-02-02T15:48:17Z",
            "url": "https://api.github.com/repos/echasnovski/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "400fa10c2f639abafb5f603f5de001fc26c2932c",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
            "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
            "followers_url": "https://api.github.com/users/echasnovski/followers",
            "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
            "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/echasnovski",
            "id": 24854248,
            "login": "echasnovski",
            "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
            "organizations_url": "https://api.github.com/users/echasnovski/orgs",
            "received_events_url": "https://api.github.com/users/echasnovski/received_events",
            "repos_url": "https://api.github.com/users/echasnovski/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/echasnovski",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/37618",
    "id": 3224078250,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37618",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        }
    ],
    "locked": false,
    "merge_commit_sha": "5645a023176e21a6af77fc9fb61b9c5d1b4e1876",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM7AK4eq",
    "number": 37618,
    "patch_url": "https://github.com/neovim/neovim/pull/37618.patch",
    "requested_reviewers": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        }
    ],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/37618/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/400fa10c2f639abafb5f603f5de001fc26c2932c",
    "title": "feat(lua): make `vim.defer_fn` handle more execution conditions",
    "updated_at": "2026-02-01T16:24:04Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/37618",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
        "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
        "followers_url": "https://api.github.com/users/echasnovski/followers",
        "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
        "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/echasnovski",
        "id": 24854248,
        "login": "echasnovski",
        "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
        "organizations_url": "https://api.github.com/users/echasnovski/orgs",
        "received_events_url": "https://api.github.com/users/echasnovski/received_events",
        "repos_url": "https://api.github.com/users/echasnovski/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/echasnovski",
        "user_view_type": "public"
    }
}
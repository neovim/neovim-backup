{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/35167/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/35167/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/35167"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/35167"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/35167/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/35167"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/756b5763c5cdd65932835d3e11c5a7f59db797f0"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6262,
            "forks_count": 6262,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1971,
            "open_issues_count": 1971,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-08-19T00:45:15Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 338530,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 92074,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-08-19T01:56:33Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 92074,
            "watchers_count": 92074,
            "web_commit_signoff_required": false
        },
        "sha": "e6e1e71abfff582b69cc265a85db7cf1ac0fa0c2",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "This is a follow up change for #35061 \r\nI tested some more cases to see if I missed something and how to fix it and came up with this draft\r\n\r\n## Examples\r\n\r\n1. `:lua vim.snippet.expand('Test $2$1')`\r\n2. enter `one`\r\n3. press `<Tab>`\r\n4. enter `two`\r\n\r\nThe expected outcome would be `Test twoone` but instead we get an error when pressing `<Tab>`\r\n\r\n1. `:lua vim.snippet.expand('$1 $1$2)`\r\n2. enter `one`\r\n3. press `<Tab>`\r\n4. enter `two`\r\n\r\nThe expected outcome would be `one onetwo` but instead we get an error when pressing `<Tab>`\r\n\r\nThe error is always:\r\n```\r\nError in TextChanged Autocommands for \"<buffer=1>\":\r\nLua callback: runtime/lua/vim/snippet.lua:151: start_col must be less than or equal to end_col\r\n[...]\r\n```\r\n\r\n> Using placeholders for the tabstops fixes both example issues\r\n\r\n## Explanation\r\n\r\nThere are more examples that can be made, all related to directly adjacent tabstops that do not have a placeholder. The reason for these errors roots in the configuration for `right_gravity` and `end_right_gravity`: Non-current tabstops have `right_gravity` set to `true` and `end_right_gravity` set to `false` (which is actually the \"fix\" I introduced in #35061 for other reasons). When both `col` and `end_col` are equal (tabstop without placeholder) and we insert text at this position, `col` will move, but `end_col` will not. This results in an \"invalid\" state (see also #35099) which leads to the error.\r\n\r\nThis PR solves this issue by checking the position of every tabstop in the snippet. Non-current tabstops directly before a current tabstop are \"locked\" (`right_gravity` & `end_right_gravity` set to `false`), while others are set to be moved around freely (`right_gravity` & `end_right_gravity` set to `true`). Since the number of tabstops in a snippet will (probably) never be too high looping through all of them on every jump should not impact performance significantly. \r\n\r\nHowever I am aware that the problem and my examples are very artificial and most probably never occur like this in actual usage, so I am hesitant if a fix for this is even necessary. Looking for feedback regarding this concern.\r\n\r\n> Please note that there are not tests yet and probably issue with the linting since I first want to discuss the changes and adapt for possible requests.",
    "closed_at": "2025-08-13T18:51:44Z",
    "comment_data": [],
    "comment_regular_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "@MariaSolOs would you have a look into this proposal?",
            "created_at": "2025-08-06T08:41:39Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3158291535",
            "id": 3158291535,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM68P7RP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3158291535/reactions"
            },
            "updated_at": "2025-08-06T08:41:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3158291535",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> @MariaSolOs would you have a look into this proposal?\r\n\r\nIs this ready for review? I normally don't look at drafts :) ",
            "created_at": "2025-08-09T01:57:53Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3169640888",
            "id": 3169640888,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM687OG4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3169640888/reactions"
            },
            "updated_at": "2025-08-09T01:57:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3169640888",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@MariaSolOs yes this is ready for a review from my end. Please note that I have not written any tests yet, but I will do so if these changes are considered for merging",
            "created_at": "2025-08-09T20:57:08Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3172093229",
            "id": 3172093229,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM69Ek0t",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3172093229/reactions"
            },
            "updated_at": "2025-08-09T20:57:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3172093229",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I have added some test cases for this change now. \r\nThere are two points to note:\r\n- The test cases are very \"artificial\" as I could not think of any fitting \"real world\" example. I am open for any suggestions here\r\n- I also wanted to test duplicate placeholders, but that never worked. I also realized that there is no test for this, so maybe this is not possible in the testing environment? \r\n\r\n```lua\r\n  it('handles directly adjacent tabstops (mixed order)', function()\r\n    -- this does work\r\n    test_expand_success({ '${3:three}${1:-one}${2:-two} $3$1$2' }, { 'three-one-two three-one-two' })\r\n\r\n    feed('1')\r\n    feed('<Tab>')\r\n    poke_eventloop()\r\n    feed('2')\r\n    feed('<Tab>')\r\n    poke_eventloop()\r\n    feed('3')\r\n    feed('<Tab>')\r\n    poke_eventloop()\r\n\r\n    -- this does NOT work\r\n    -- actual value is: \"312 three-one-two'\r\n    eq({ '312 312' }, buf_lines(0))\r\n  end)\r\n```",
            "created_at": "2025-08-12T13:21:49Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3179323223",
            "id": 3179323223,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM69gJ9X",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3179323223/reactions"
            },
            "updated_at": "2025-08-12T13:21:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3179323223",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> * The test cases are very \"artificial\" as I could not think of any fitting \"real world\" example. I am open for any suggestions here\r\n\r\nThat's fine. In the future we can add regression tests if we notice that there's a missing case in the test suite.\r\n\r\n> * I also wanted to test duplicate placeholders, but that never worked. I also realized that there is no test for this, so maybe this is not possible in the testing environment?\r\n\r\nThat's intentional. For each tabstop index we expect all nodes to have the same placeholder: https://github.com/neovim/neovim/blob/35be59cc7b8d39f91b70aa57eaa09dc9b4636806/runtime/lua/vim/snippet.lua#L438-L440",
            "created_at": "2025-08-13T00:43:01Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3181805907",
            "id": 3181805907,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM69poFT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3181805907/reactions"
            },
            "updated_at": "2025-08-13T00:43:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3181805907",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "There is a misunderstanding :sweat_smile:  What I meant to test in my example was the case were you have the same tabstop referenced multiple times in a snippet **without** them having different placeholders. When you expand the snippet and type for one of them the text should be inserted for all places:\r\n\r\n![snippet_multiple_tabstops](https://github.com/user-attachments/assets/cd3b9c7a-031e-45fc-bcd9-96195d1231ae)\r\n\r\nBut testing this in a functional test does not work as the text is only ever inserted for the first tabstop occasion while the others just keep their placeholder text.\r\n\r\nIf you run the test example from my previous [comment](https://github.com/neovim/neovim/pull/35167#issuecomment-3179323223) the output is:\r\n```\r\nExpected objects to be the same.\r\nPassed in:\r\n(table: 0x7f4b4e7dfe48) {\r\n *[1] = '312 three-one-two' }\r\nExpected:\r\n(table: 0x7f4b4e812b18) {\r\n *[1] = '312 312' }\r\n```\r\n",
            "created_at": "2025-08-13T04:25:44Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3182130619",
            "id": 3182130619,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM69q3W7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3182130619/reactions"
            },
            "updated_at": "2025-08-13T04:25:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3182130619",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> What I meant to test in my example was the case were you have the same tabstop referenced multiple times in a snippet **without** them having different placeholders\r\n\r\nBut this isn't the case for this snippet: `${3:three}${1:-one}${2:-two} $3$1$2`. For each index only one tabstop has a placeholder.\r\n\r\nIsn't [this test](https://github.com/neovim/neovim/blob/35be59cc7b8d39f91b70aa57eaa09dc9b4636806/test/functional/lua/snippet_spec.lua#L145-L149) checking for what you're referring to?",
            "created_at": "2025-08-13T06:40:42Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3182378182",
            "id": 3182378182,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM69rzzG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3182378182/reactions"
            },
            "updated_at": "2025-08-13T06:40:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3182378182",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Isn't [this test](https://github.com/neovim/neovim/blob/35be59cc7b8d39f91b70aa57eaa09dc9b4636806/test/functional/lua/snippet_spec.lua#L145-L149) checking for what you're referring to?\r\n\r\nI completely missed this one. Thanks for pointing this out. That actually helped refine the issue I found\r\n\r\n> But this isn't the case for this snippet: `${3:three}${1:-one}${2:-two} $3$1$2`. For each index only one tabstop has a placeholder.\r\n\r\nIf there is only one placeholder and the other tabstops of the same index do not have any placeholder, then this placeholder should be used for all of them. At least that is how it currently works in neovim and also in the tests. It stops working in the tests (and only there) when the tabstops are directly adjacent.\r\n\r\nThis test works:\r\n```lua\r\n  it('works', function()\r\n    -- here is a space between the tabstops\r\n    test_expand_success({ '${1:one} $1' }, { 'one one' })\r\n    feed('111')\r\n    eq({ '111 111' }, buf_lines(0))\r\n  end)\r\n```\r\n\r\nThis test doesn't:\r\n```lua\r\n  it('not working', function()\r\n    -- here is no space between the tabstops\r\n    test_expand_success({ '${1:one}$1' }, { 'oneone' })\r\n    feed('111')\r\n    -- fails here, actual value: '111one'\r\n    eq({ '111111' }, buf_lines(0))\r\n  end)\r\n```\r\n\r\nHowever manually executing (`:lua vim.snippets.expand('...')`) both snippets in neovim works perfectly fine using this branch. So while this branch fixes this \"issue\" this particular fix is not reflected in the tests. Do you have any idea how that can be? Maybe related to how the tests are run?\r\n\r\n",
            "created_at": "2025-08-13T13:34:44Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3183956135",
            "id": 3183956135,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM69x1Cn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3183956135/reactions"
            },
            "updated_at": "2025-08-13T13:34:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3183956135",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> However manually executing (`:lua vim.snippets.expand('...')`) both snippets in neovim works perfectly fine using this branch. So while this branch fixes this \"issue\" this particular fix is not reflected in the tests. Do you have any idea how that can be? Maybe related to how the tests are run?\r\n\r\nI see, thank you for explaining the problem better.\r\n\r\nI think it's fine to leave this case untested for now given that we have \"similar enough\" tests that check for related scenarios. This PR contains a good fix and I don't want to block it because of a weird behavior in our tests.\r\n\r\nMerging now!",
            "created_at": "2025-08-13T18:51:40Z",
            "html_url": "https://github.com/neovim/neovim/pull/35167#issuecomment-3185097382",
            "id": 3185097382,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
            "node_id": "IC_kwDOAPphoM692Lqm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3185097382/reactions"
            },
            "updated_at": "2025-08-13T18:51:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3185097382",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/35167/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/35167/commits",
    "created_at": "2025-08-05T07:48:38Z",
    "diff_url": "https://github.com/neovim/neovim/pull/35167.diff",
    "draft": false,
    "head": {
        "label": "TheBlob42:snippet-fix-gravity",
        "ref": "snippet-fix-gravity",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/TheBlob42/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/TheBlob42/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/TheBlob42/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/TheBlob42/neovim/branches{/branch}",
            "clone_url": "https://github.com/TheBlob42/neovim.git",
            "collaborators_url": "https://api.github.com/repos/TheBlob42/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/TheBlob42/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/TheBlob42/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/TheBlob42/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/TheBlob42/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/TheBlob42/neovim/contributors",
            "created_at": "2025-07-23T06:56:27Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/TheBlob42/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/TheBlob42/neovim/downloads",
            "events_url": "https://api.github.com/repos/TheBlob42/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/TheBlob42/neovim/forks",
            "full_name": "TheBlob42/neovim",
            "git_commits_url": "https://api.github.com/repos/TheBlob42/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/TheBlob42/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/TheBlob42/neovim/git/tags{/sha}",
            "git_url": "git://github.com/TheBlob42/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/TheBlob42/neovim/hooks",
            "html_url": "https://github.com/TheBlob42/neovim",
            "id": 1024731673,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/TheBlob42/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/TheBlob42/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/TheBlob42/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/TheBlob42/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/TheBlob42/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/TheBlob42/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/TheBlob42/neovim/merges",
            "milestones_url": "https://api.github.com/repos/TheBlob42/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOPRQqGQ",
            "notifications_url": "https://api.github.com/repos/TheBlob42/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/TheBlob42/neovim/pulls{/number}",
            "pushed_at": "2025-08-18T09:44:02Z",
            "releases_url": "https://api.github.com/repos/TheBlob42/neovim/releases{/id}",
            "size": 328010,
            "ssh_url": "git@github.com:TheBlob42/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/TheBlob42/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/TheBlob42/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/TheBlob42/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/TheBlob42/neovim/subscription",
            "svn_url": "https://github.com/TheBlob42/neovim",
            "tags_url": "https://api.github.com/repos/TheBlob42/neovim/tags",
            "teams_url": "https://api.github.com/repos/TheBlob42/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/TheBlob42/neovim/git/trees{/sha}",
            "updated_at": "2025-08-18T08:12:01Z",
            "url": "https://api.github.com/repos/TheBlob42/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "756b5763c5cdd65932835d3e11c5a7f59db797f0",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
            "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
            "followers_url": "https://api.github.com/users/TheBlob42/followers",
            "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
            "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/TheBlob42",
            "id": 6849129,
            "login": "TheBlob42",
            "node_id": "MDQ6VXNlcjY4NDkxMjk=",
            "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
            "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
            "repos_url": "https://api.github.com/users/TheBlob42/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/TheBlob42",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/35167",
    "id": 2720248330,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35167",
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 6207355257,
            "name": "snippet",
            "node_id": "LA_kwDOAPphoM8AAAABcfy5eQ",
            "url": "https://api.github.com/repos/neovim/neovim/labels/snippet"
        }
    ],
    "locked": false,
    "merge_commit_sha": "6f904cfef15b06473710977d3656e67ef3a930d0",
    "merged_at": "2025-08-13T18:51:44Z",
    "milestone": null,
    "node_id": "PR_kwDOAPphoM6iI7IK",
    "number": 35167,
    "patch_url": "https://github.com/neovim/neovim/pull/35167.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/35167/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/756b5763c5cdd65932835d3e11c5a7f59db797f0",
    "title": "fix(snippet): adjacent tabstops without placeholders",
    "updated_at": "2025-08-13T18:51:44Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/35167",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
        "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
        "followers_url": "https://api.github.com/users/TheBlob42/followers",
        "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
        "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/TheBlob42",
        "id": 6849129,
        "login": "TheBlob42",
        "node_id": "MDQ6VXNlcjY4NDkxMjk=",
        "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
        "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
        "repos_url": "https://api.github.com/users/TheBlob42/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/TheBlob42",
        "user_view_type": "public"
    }
}
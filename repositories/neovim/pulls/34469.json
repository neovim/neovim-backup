{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/34469/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/34469/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/34469"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/34469"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/34469/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/b17ff3b138b014b5486fad0382675eaa7b3b7d13"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6134,
            "forks_count": 6134,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1965,
            "open_issues_count": 1965,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2025-06-17T02:49:56Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 328511,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 90375,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2025-06-17T02:36:18Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 90375,
            "watchers_count": 90375,
            "web_commit_signoff_required": false
        },
        "sha": "76d213efbee8e6857b3aa397827fa8756a327430",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "To address #31453, I plan to try introducing more OOP design. My planned roadmap is:\r\n\r\n- Refactor `_folding_range.lua` into an OOP design by adding the `FRProvider` class (this PR);\r\n- Compare `STHighlighter` in `semantic_token.lua`, extract the overlapping logic with `FRProvider` (mainly lifecycle-related), and create a common parent class, tentatively named `FeatureProvider` or `Provider`;\r\n- With the common parent class, some new features can be provided, such as displaying which `FeatureProvider`s are enabled, in which buffers, which clients have enabled them, and the current version or of the displayed data via `:checkhealth vim.lsp`;\r\n- More refactoring, such as refactoring `inlay_hint.lua`, or re-implementing old features, such as `codelens.lua`;\r\n\r\nThis PR does not add any new explicit logic but fixes #34202, because the non-nil assertion issue mentioned in that issue can be avoided with this kind of OOP design. Therefore, I think this PR is ready to be merged, even if the shared superclass approach was not eventually used.",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146331268"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146331268"
                }
            },
            "author_association": "MEMBER",
            "body": "I think it still makes sense to \"namespace\" the class name with `vim.lsp.folding_range`.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T01:07:40Z",
            "diff_hunk": "@@ -5,8 +5,11 @@ local api = vim.api\n \n local M = {}\n \n----@class (private) vim.lsp.folding_range.BufState\n+---@class (private) FRProvider",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146331268",
            "id": 2146331268,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7mqE",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 8,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2926954567,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146331268/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T01:12:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146331268",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146334251"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146334251"
                }
            },
            "author_association": "MEMBER",
            "body": "We can make the definition of `FRProvider` the type annotation in line 29 instead of having a separate type definition.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T01:09:51Z",
            "diff_hunk": "@@ -5,8 +5,11 @@ local api = vim.api\n \n local M = {}\n \n----@class (private) vim.lsp.folding_range.BufState\n+---@class (private) FRProvider",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146334251",
            "id": 2146334251,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7nYr",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 8,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2926954567,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146334251/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T01:12:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146334251",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146336481"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146336481"
                }
            },
            "author_association": "MEMBER",
            "body": "Why inline the handler? I found it cleaner to have a separate function.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T01:10:59Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146336481",
            "id": 2146336481,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7n7h",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 144,
            "original_position": 121,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2926954567,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146336481/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T01:12:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146336481",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146338215"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146338215"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n  self:reset()\r\n```",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T01:12:20Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)\n+        self:handle_results({ [ctx.client_id] = { err = err, result = result } }, ctx)\n+      end,\n+      self.bufnr\n+    )\n     return\n   end\n \n-  if not next(vim.lsp.get_clients({ bufnr = bufnr, method = ms.textDocument_foldingRange })) then\n+  if\n+    not next(vim.lsp.get_clients({ bufnr = self.bufnr, method = ms.textDocument_foldingRange }))\n+  then\n     return\n   end\n \n-  vim.lsp.buf_request_all(bufnr, ms.textDocument_foldingRange, params, multi_handler)\n+  vim.lsp.buf_request_all(self.bufnr, ms.textDocument_foldingRange, params, function(...)\n+    self:handle_results(...)\n+  end)\n end\n \n--- NOTE:\n--- `bufstate` and event hooks are interdependent:\n--- * `bufstate` needs event hooks for correctness.\n--- * event hooks require the previous `bufstate` for updates.\n--- Since they are manually created and destroyed,\n--- we ensure their lifecycles are always synchronized.\n---\n--- TODO(ofseed):\n--- 1. Implement clearing `bufstate` and event hooks\n---    when no clients in the buffer support the corresponding method.\n--- 2. Then generalize this state management to other LSP modules.\n-local augroup_setup = api.nvim_create_augroup('nvim.lsp.folding_range.setup', {})\n-\n---- Initialize `bufstate` and event hooks, then request folding ranges.\n---- Manage their lifecycle within this function.\n+function FRProvider:reset()\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}\n+end\n+\n+--- Initialize `provider` and event hooks, then request folding ranges.\n ---@param bufnr integer\n----@return vim.lsp.folding_range.BufState?\n-local function setup(bufnr)\n-  if not api.nvim_buf_is_loaded(bufnr) then\n-    return\n-  end\n+---@return FRProvider\n+function FRProvider.new(bufnr)\n+  local self = setmetatable({}, { __index = FRProvider })\n+  self.bufnr = bufnr\n+  self.augroup = api.nvim_create_augroup('nvim.lsp.folding_range:' .. bufnr, { clear = true })\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146338215",
            "id": 2146338215,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7oWn",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 180,
            "original_position": 179,
            "original_start_line": 177,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2926954567,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146338215/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-06-14T01:12:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146338215",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146412813"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146412813"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I might not have understood your point? The `FRProvider` on line 29 is a metatable, not an instance of `FRProvider`, so it cannot have fields like `bufnr` or `augroup`; it can only have a static field like `active`.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:01:29Z",
            "diff_hunk": "@@ -5,8 +5,11 @@ local api = vim.api\n \n local M = {}\n \n----@class (private) vim.lsp.folding_range.BufState\n+---@class (private) FRProvider",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146412813",
            "id": 2146412813,
            "in_reply_to_id": 2146334251,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_76kN",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 8,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927164928,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146412813/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T04:01:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146412813",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146426876"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146426876"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I inlined it to reduce the number of methods in `FRProvider`. This interface has two handlers, one is `lsp.Handler` and the other is `lsp.MultiHandler`. The original `handler` only transformed the parameters into a form suitable for `multi_handler`, so I inlined it.\r\n\r\nAdditionally, I have longer-term but still uncertain plans for the handler functions. If I successfully continue advancing my plan to implement LSP features based on inheritance (see the roadmap above), I will treat functions like `self:handle_result` methods of the parent class serving as interfaces, with subclasses implementing them. This would be an internal-only interface replacement of the previous and deprecated `vim.lsp.handler`.\r\n\r\nThe main purpose of this approach is that if we want to support `partialResultParams`, we will need a third type of handler beyond `lsp.Handler` and `lsp.MultiHandler`, for example, one called `partialHandler`. This handler differs from the previous two in that it is unlikely to be implemented as a pure function, which is why I plan to introduce OOP. Any related ideas are welcome.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:17:47Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146426876",
            "id": 2146426876,
            "in_reply_to_id": 2146336481,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_79_8",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 144,
            "original_position": 121,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927179678,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146426876/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T04:17:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146426876",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146427529"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146427529"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I was also hesitant about whether to use `reset` here, and in the end, I didn't because I planned to make `reset` a general interface (`vim.lsp.semantic_token` also has a `self:reset()`). Maybe I should apply this suggestion first and make changes later when needed?",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:21:24Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)\n+        self:handle_results({ [ctx.client_id] = { err = err, result = result } }, ctx)\n+      end,\n+      self.bufnr\n+    )\n     return\n   end\n \n-  if not next(vim.lsp.get_clients({ bufnr = bufnr, method = ms.textDocument_foldingRange })) then\n+  if\n+    not next(vim.lsp.get_clients({ bufnr = self.bufnr, method = ms.textDocument_foldingRange }))\n+  then\n     return\n   end\n \n-  vim.lsp.buf_request_all(bufnr, ms.textDocument_foldingRange, params, multi_handler)\n+  vim.lsp.buf_request_all(self.bufnr, ms.textDocument_foldingRange, params, function(...)\n+    self:handle_results(...)\n+  end)\n end\n \n--- NOTE:\n--- `bufstate` and event hooks are interdependent:\n--- * `bufstate` needs event hooks for correctness.\n--- * event hooks require the previous `bufstate` for updates.\n--- Since they are manually created and destroyed,\n--- we ensure their lifecycles are always synchronized.\n---\n--- TODO(ofseed):\n--- 1. Implement clearing `bufstate` and event hooks\n---    when no clients in the buffer support the corresponding method.\n--- 2. Then generalize this state management to other LSP modules.\n-local augroup_setup = api.nvim_create_augroup('nvim.lsp.folding_range.setup', {})\n-\n---- Initialize `bufstate` and event hooks, then request folding ranges.\n---- Manage their lifecycle within this function.\n+function FRProvider:reset()\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}\n+end\n+\n+--- Initialize `provider` and event hooks, then request folding ranges.\n ---@param bufnr integer\n----@return vim.lsp.folding_range.BufState?\n-local function setup(bufnr)\n-  if not api.nvim_buf_is_loaded(bufnr) then\n-    return\n-  end\n+---@return FRProvider\n+function FRProvider.new(bufnr)\n+  local self = setmetatable({}, { __index = FRProvider })\n+  self.bufnr = bufnr\n+  self.augroup = api.nvim_create_augroup('nvim.lsp.folding_range:' .. bufnr, { clear = true })\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146427529",
            "id": 2146427529,
            "in_reply_to_id": 2146338215,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7-KJ",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 180,
            "original_position": 179,
            "original_start_line": 177,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927180310,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146427529/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-06-14T04:21:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146427529",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146431733"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146431733"
                }
            },
            "author_association": "MEMBER",
            "body": "nvm I was not reading the diff correctly and I had not noticed that this was already the annotation for the table I was referring to. Ignore my comment.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:36:39Z",
            "diff_hunk": "@@ -5,8 +5,11 @@ local api = vim.api\n \n local M = {}\n \n----@class (private) vim.lsp.folding_range.BufState\n+---@class (private) FRProvider",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146431733",
            "id": 2146431733,
            "in_reply_to_id": 2146334251,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7_L1",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 8,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927186028,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146431733/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T04:36:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146431733",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146431828"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146431828"
                }
            },
            "author_association": "MEMBER",
            "body": "I don't see why `reset()` being general affects the fact that you can call the function here instead of duplicating the implementation.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:37:36Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)\n+        self:handle_results({ [ctx.client_id] = { err = err, result = result } }, ctx)\n+      end,\n+      self.bufnr\n+    )\n     return\n   end\n \n-  if not next(vim.lsp.get_clients({ bufnr = bufnr, method = ms.textDocument_foldingRange })) then\n+  if\n+    not next(vim.lsp.get_clients({ bufnr = self.bufnr, method = ms.textDocument_foldingRange }))\n+  then\n     return\n   end\n \n-  vim.lsp.buf_request_all(bufnr, ms.textDocument_foldingRange, params, multi_handler)\n+  vim.lsp.buf_request_all(self.bufnr, ms.textDocument_foldingRange, params, function(...)\n+    self:handle_results(...)\n+  end)\n end\n \n--- NOTE:\n--- `bufstate` and event hooks are interdependent:\n--- * `bufstate` needs event hooks for correctness.\n--- * event hooks require the previous `bufstate` for updates.\n--- Since they are manually created and destroyed,\n--- we ensure their lifecycles are always synchronized.\n---\n--- TODO(ofseed):\n--- 1. Implement clearing `bufstate` and event hooks\n---    when no clients in the buffer support the corresponding method.\n--- 2. Then generalize this state management to other LSP modules.\n-local augroup_setup = api.nvim_create_augroup('nvim.lsp.folding_range.setup', {})\n-\n---- Initialize `bufstate` and event hooks, then request folding ranges.\n---- Manage their lifecycle within this function.\n+function FRProvider:reset()\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}\n+end\n+\n+--- Initialize `provider` and event hooks, then request folding ranges.\n ---@param bufnr integer\n----@return vim.lsp.folding_range.BufState?\n-local function setup(bufnr)\n-  if not api.nvim_buf_is_loaded(bufnr) then\n-    return\n-  end\n+---@return FRProvider\n+function FRProvider.new(bufnr)\n+  local self = setmetatable({}, { __index = FRProvider })\n+  self.bufnr = bufnr\n+  self.augroup = api.nvim_create_augroup('nvim.lsp.folding_range:' .. bufnr, { clear = true })\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146431828",
            "id": 2146431828,
            "in_reply_to_id": 2146338215,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_7_NU",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 180,
            "original_position": 179,
            "original_start_line": 177,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927186177,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146431828/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-06-14T04:37:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146431828",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146438743"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146438743"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Oh, you are right. Even though it is general, the logic of this `reset()` remains the same.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:43:10Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)\n+        self:handle_results({ [ctx.client_id] = { err = err, result = result } }, ctx)\n+      end,\n+      self.bufnr\n+    )\n     return\n   end\n \n-  if not next(vim.lsp.get_clients({ bufnr = bufnr, method = ms.textDocument_foldingRange })) then\n+  if\n+    not next(vim.lsp.get_clients({ bufnr = self.bufnr, method = ms.textDocument_foldingRange }))\n+  then\n     return\n   end\n \n-  vim.lsp.buf_request_all(bufnr, ms.textDocument_foldingRange, params, multi_handler)\n+  vim.lsp.buf_request_all(self.bufnr, ms.textDocument_foldingRange, params, function(...)\n+    self:handle_results(...)\n+  end)\n end\n \n--- NOTE:\n--- `bufstate` and event hooks are interdependent:\n--- * `bufstate` needs event hooks for correctness.\n--- * event hooks require the previous `bufstate` for updates.\n--- Since they are manually created and destroyed,\n--- we ensure their lifecycles are always synchronized.\n---\n--- TODO(ofseed):\n--- 1. Implement clearing `bufstate` and event hooks\n---    when no clients in the buffer support the corresponding method.\n--- 2. Then generalize this state management to other LSP modules.\n-local augroup_setup = api.nvim_create_augroup('nvim.lsp.folding_range.setup', {})\n-\n---- Initialize `bufstate` and event hooks, then request folding ranges.\n---- Manage their lifecycle within this function.\n+function FRProvider:reset()\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}\n+end\n+\n+--- Initialize `provider` and event hooks, then request folding ranges.\n ---@param bufnr integer\n----@return vim.lsp.folding_range.BufState?\n-local function setup(bufnr)\n-  if not api.nvim_buf_is_loaded(bufnr) then\n-    return\n-  end\n+---@return FRProvider\n+function FRProvider.new(bufnr)\n+  local self = setmetatable({}, { __index = FRProvider })\n+  self.bufnr = bufnr\n+  self.augroup = api.nvim_create_augroup('nvim.lsp.folding_range:' .. bufnr, { clear = true })\n+  self.client_ranges = {}\n+  self.row_level = {}\n+  self.row_kinds = {}\n+  self.row_text = {}",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146438743",
            "id": 2146438743,
            "in_reply_to_id": 2146338215,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_8A5X",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 180,
            "original_position": 179,
            "original_start_line": 177,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927194884,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146438743/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2025-06-14T04:43:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146438743",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/34469#discussion_r2146441708"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/34469"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146441708"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I think it is quite convincing when someone points out that the behavior after inlining is not clear enough. I have reverted it to the original form, that is, as a separate function.",
            "commit_id": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
            "created_at": "2025-06-14T04:57:36Z",
            "diff_hunk": "@@ -108,119 +104,112 @@ local function schedule_foldupdate(bufnr)\n end\n \n ---@param results table<integer,{err: lsp.ResponseError?, result: lsp.FoldingRange[]?}>\n----@type lsp.MultiHandler\n-local function multi_handler(results, ctx)\n-  local bufnr = assert(ctx.bufnr)\n+---@param ctx lsp.HandlerContext\n+function FRProvider:handle_results(results, ctx)\n   -- Handling responses from outdated buffer only causes performance overhead.\n-  if util.buf_versions[bufnr] ~= ctx.version then\n+  if util.buf_versions[self.bufnr] ~= ctx.version then\n     return\n   end\n \n-  local bufstate = assert(bufstates[bufnr])\n   for client_id, result in pairs(results) do\n     if result.err then\n       log.error(result.err)\n     else\n-      bufstate.client_ranges[client_id] = result.result\n+      self.client_ranges[client_id] = result.result\n     end\n   end\n-  bufstate.version = ctx.version\n+  self.version = ctx.version\n \n+  self:renew()\n   if api.nvim_get_mode().mode:match('^i') then\n     -- `foldUpdate()` is guarded in insert mode.\n-    schedule_foldupdate(bufnr)\n+    schedule_foldupdate(self.bufnr)\n   else\n-    foldupdate(bufnr)\n+    foldupdate(self.bufnr)\n   end\n end\n \n----@param result lsp.FoldingRange[]?\n----@type lsp.Handler\n-local function handler(err, result, ctx)\n-  multi_handler({ [ctx.client_id] = { err = err, result = result } }, ctx)\n-end\n-\n --- Request `textDocument/foldingRange` from the server.\n --- `foldupdate()` is scheduled once after the request is completed.\n----@param bufnr integer\n ---@param client? vim.lsp.Client The client whose server supports `foldingRange`.\n-local function request(bufnr, client)\n+function FRProvider:request(client)\n   ---@type lsp.FoldingRangeParams\n-  local params = { textDocument = util.make_text_document_params(bufnr) }\n+  local params = { textDocument = util.make_text_document_params(self.bufnr) }\n \n   if client then\n-    client:request(ms.textDocument_foldingRange, params, handler, bufnr)\n+    client:request(\n+      ms.textDocument_foldingRange,\n+      params,\n+      ---@param result lsp.FoldingRange[]?\n+      function(err, result, ctx)",
            "html_url": "https://github.com/neovim/neovim/pull/34469#discussion_r2146441708",
            "id": 2146441708,
            "in_reply_to_id": 2146336481,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5_8Bns",
            "original_commit_id": "d5fb6e28e6c17a4041196e60e9a2d836fe57135b",
            "original_line": 144,
            "original_position": 121,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/_folding_range.lua",
            "position": null,
            "pull_request_review_id": 2927198344,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146441708/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2025-06-14T04:57:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/2146441708",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34469/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/34469/commits",
    "created_at": "2025-06-12T13:37:03Z",
    "diff_url": "https://github.com/neovim/neovim/pull/34469.diff",
    "draft": false,
    "head": {
        "label": "ofseed:refactor-folding-provider",
        "ref": "refactor-folding-provider",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/ofseed/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/ofseed/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/ofseed/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/ofseed/neovim/branches{/branch}",
            "clone_url": "https://github.com/ofseed/neovim.git",
            "collaborators_url": "https://api.github.com/repos/ofseed/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/ofseed/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/ofseed/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/ofseed/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/ofseed/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/ofseed/neovim/contributors",
            "created_at": "2021-11-30T18:13:03Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/ofseed/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/ofseed/neovim/downloads",
            "events_url": "https://api.github.com/repos/ofseed/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/ofseed/neovim/forks",
            "full_name": "ofseed/neovim",
            "git_commits_url": "https://api.github.com/repos/ofseed/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/ofseed/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/ofseed/neovim/git/tags{/sha}",
            "git_url": "git://github.com/ofseed/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/ofseed/neovim/hooks",
            "html_url": "https://github.com/ofseed/neovim",
            "id": 433537354,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/ofseed/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/ofseed/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/ofseed/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/ofseed/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/ofseed/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/ofseed/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/ofseed/neovim/merges",
            "milestones_url": "https://api.github.com/repos/ofseed/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOGddBSg",
            "notifications_url": "https://api.github.com/repos/ofseed/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/ofseed/neovim/pulls{/number}",
            "pushed_at": "2025-06-14T04:54:55Z",
            "releases_url": "https://api.github.com/repos/ofseed/neovim/releases{/id}",
            "size": 319776,
            "ssh_url": "git@github.com:ofseed/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/ofseed/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/ofseed/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/ofseed/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/ofseed/neovim/subscription",
            "svn_url": "https://github.com/ofseed/neovim",
            "tags_url": "https://api.github.com/repos/ofseed/neovim/tags",
            "teams_url": "https://api.github.com/repos/ofseed/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/ofseed/neovim/git/trees{/sha}",
            "updated_at": "2025-06-13T02:08:24Z",
            "url": "https://api.github.com/repos/ofseed/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "b17ff3b138b014b5486fad0382675eaa7b3b7d13",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
            "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
            "followers_url": "https://api.github.com/users/ofseed/followers",
            "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
            "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/ofseed",
            "id": 61115159,
            "login": "ofseed",
            "node_id": "MDQ6VXNlcjYxMTE1MTU5",
            "organizations_url": "https://api.github.com/users/ofseed/orgs",
            "received_events_url": "https://api.github.com/users/ofseed/received_events",
            "repos_url": "https://api.github.com/users/ofseed/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/ofseed",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/34469",
    "id": 2587397620,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34469",
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "changes that are not features or bugfixes",
            "id": 106949155,
            "name": "refactor",
            "node_id": "MDU6TGFiZWwxMDY5NDkxNTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/refactor"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "F3A62E",
            "default": false,
            "description": "community: Google Summer of Code project",
            "id": 834483397,
            "name": "gsoc",
            "node_id": "MDU6TGFiZWw4MzQ0ODMzOTc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/gsoc"
        }
    ],
    "locked": false,
    "merge_commit_sha": "a66a3369023bba99448fe9bbcade65097322d960",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM6aOI30",
    "number": 34469,
    "patch_url": "https://github.com/neovim/neovim/pull/34469.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/34469/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/b17ff3b138b014b5486fad0382675eaa7b3b7d13",
    "title": "refactor(lsp): migrate LSP folding to an oop design",
    "updated_at": "2025-06-14T04:57:37Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/34469",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
        "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
        "followers_url": "https://api.github.com/users/ofseed/followers",
        "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
        "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ofseed",
        "id": 61115159,
        "login": "ofseed",
        "node_id": "MDQ6VXNlcjYxMTE1MTU5",
        "organizations_url": "https://api.github.com/users/ofseed/orgs",
        "received_events_url": "https://api.github.com/users/ofseed/received_events",
        "repos_url": "https://api.github.com/users/ofseed/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ofseed",
        "user_view_type": "public"
    }
}
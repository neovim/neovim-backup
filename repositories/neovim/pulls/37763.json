{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/37763/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37763/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/37763"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/37763"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37763/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/37763"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/38f40cbd5b5437f71c9a307b0c01d130b33b03ac"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 6587,
            "forks_count": 6587,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_pull_requests": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 2031,
            "open_issues_count": 2031,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim",
                "user_view_type": "public"
            },
            "private": false,
            "pull_request_creation_policy": "all",
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2026-02-17T03:34:12Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 369888,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 96478,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2026-02-17T03:34:17Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 96478,
            "watchers_count": 96478,
            "web_commit_signoff_required": false
        },
        "sha": "7720e52a0b4aa973540934ab6dcf4703dbde3b9f",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim",
            "user_view_type": "public"
        }
    },
    "body": "## Problem:\r\nCurrently, we recommend always inserting text above prompt-line in promptbuffer. This can be done useing the `:` mark. However, although we recommend it this way it can sometimes get confusing how to do it best.\r\n\r\n## Solution:\r\nProvide a dedicated api to append text to prompt buffer. This is a quite common necessity for things useing prompt-buffer. So making a simpler api makes sense.\r\n\r\n**Signature**\r\n```vim\r\n prompt_appendbuffer({buf}, {text})\r\n```\r\n\r\n**Example code**\r\n```lua\r\nlocal buf = vim.api.nvim_get_current_buf()\r\nlocal function winsert(str)\r\n  vim.fn.prompt_appendbuffer(buf, vim.split(\"Entered \"..str, \"\\n\"))\r\nend\r\n\r\nvim.fn.prompt_setprompt(buf, '> ')\r\nvim.fn.prompt_setcallback(buf, winsert)\r\nvim.bo[buf].buftype = 'prompt'\r\n```\r\n\r\nOriginal idea from https://github.com/vim/vim/issues/19245#issuecomment-3803677434\r\n\r\nfix #37114",
    "closed_at": null,
    "comment_data": [],
    "comment_regular_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "cc @justinmk @puremourning ",
            "created_at": "2026-02-07T07:59:54Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3863899450",
            "id": 3863899450,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mTm06",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3863899450/reactions"
            },
            "updated_at": "2026-02-07T07:59:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3863899450",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13149513?v=4",
                "events_url": "https://api.github.com/users/shadmansaleh/events{/privacy}",
                "followers_url": "https://api.github.com/users/shadmansaleh/followers",
                "following_url": "https://api.github.com/users/shadmansaleh/following{/other_user}",
                "gists_url": "https://api.github.com/users/shadmansaleh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shadmansaleh",
                "id": 13149513,
                "login": "shadmansaleh",
                "node_id": "MDQ6VXNlcjEzMTQ5NTEz",
                "organizations_url": "https://api.github.com/users/shadmansaleh/orgs",
                "received_events_url": "https://api.github.com/users/shadmansaleh/received_events",
                "repos_url": "https://api.github.com/users/shadmansaleh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shadmansaleh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shadmansaleh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shadmansaleh",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "It seems like it will always append new line to before the prompt?",
            "created_at": "2026-02-07T10:39:07Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864121380",
            "id": 3864121380,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mUdAk",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864121380/reactions"
            },
            "updated_at": "2026-02-07T10:39:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864121380",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> It seems like it will always append new line to before the prompt?\r\n\r\nYeah, that's the plan. Fine access through `:` mark is still available. It just makes the common case easier.",
            "created_at": "2026-02-07T14:29:08Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864605855",
            "id": 3864605855,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mWTSf",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864605855/reactions"
            },
            "updated_at": "2026-02-07T14:29:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864605855",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13149513?v=4",
                "events_url": "https://api.github.com/users/shadmansaleh/events{/privacy}",
                "followers_url": "https://api.github.com/users/shadmansaleh/followers",
                "following_url": "https://api.github.com/users/shadmansaleh/following{/other_user}",
                "gists_url": "https://api.github.com/users/shadmansaleh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shadmansaleh",
                "id": 13149513,
                "login": "shadmansaleh",
                "node_id": "MDQ6VXNlcjEzMTQ5NTEz",
                "organizations_url": "https://api.github.com/users/shadmansaleh/orgs",
                "received_events_url": "https://api.github.com/users/shadmansaleh/received_events",
                "repos_url": "https://api.github.com/users/shadmansaleh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shadmansaleh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shadmansaleh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shadmansaleh",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Then your new API only save plugin a single line of code. Is it worth it then?",
            "created_at": "2026-02-07T14:46:43Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864632459",
            "id": 3864632459,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mWZyL",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864632459/reactions"
            },
            "updated_at": "2026-02-07T14:46:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864632459",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I think it's worth it. It's a better API and more consistent and discoverable than a mark and easily checked for with exists etc ",
            "created_at": "2026-02-07T16:00:08Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864746404",
            "id": 3864746404,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mW1mk",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864746404/reactions"
            },
            "updated_at": "2026-02-07T16:00:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864746404",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10584846?v=4",
                "events_url": "https://api.github.com/users/puremourning/events{/privacy}",
                "followers_url": "https://api.github.com/users/puremourning/followers",
                "following_url": "https://api.github.com/users/puremourning/following{/other_user}",
                "gists_url": "https://api.github.com/users/puremourning/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/puremourning",
                "id": 10584846,
                "login": "puremourning",
                "node_id": "MDQ6VXNlcjEwNTg0ODQ2",
                "organizations_url": "https://api.github.com/users/puremourning/orgs",
                "received_events_url": "https://api.github.com/users/puremourning/received_events",
                "repos_url": "https://api.github.com/users/puremourning/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/puremourning/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/puremourning/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/puremourning",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "No, I am meaning it should be more powerful, handles more use cases. Prompt buffer is meant to be used with job, and I can't recall a rule that says a job will always stream a full line for each chunk. So I think by default it should try concat the output to the existing output line before adding a new line.\r\n\r\nFor example consider the following prompt buffer\r\n```\r\n> Nice to meet you!\r\nNice \r\n>\r\n```\r\nIf I run `call prompt_appendbuffer(bufnr(\"%\"), \"to meet you too!\\nMy name is John\")`, the buffer should become\r\n```\r\n> Nice to meet you!\r\nNice to meet you too!\r\nMy name is John\r\n>\r\n```\r\ninstead of\r\n```\r\n> Nice to meet you!\r\nNice \r\nto meet you too!\r\nMy name is John\r\n>\r\n```\r\nWith my suggestion, for people who need to add a new line they just need to add a `\\n` before the text. But with current state of the PR, users cannot concat first line of new text to existing output, without having to go back to using mark\r\n\r\nBtw, I will propose function name `prompt_addoutput` instead of `prompt_appendbuffer`. `appendbuffer` sounds like you are trying to add a buffer to something else. Even if it means \"append to buffer\", it will typically be understood as \"append to the end of the buffer\", not \"append before the current prompt\". Moreover `add` is one of the recommended verbs according to [:h dev-name-common](https://neovim.io/doc/user/dev.html#dev-name-common) (while `append` isn't). And `output` faces `input`, which already exists in `prompt_getinput()`.",
            "created_at": "2026-02-07T16:09:37Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864758817",
            "id": 3864758817,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mW4oh",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864758817/reactions"
            },
            "updated_at": "2026-02-07T16:40:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864758817",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Then your new API only save plugin a single line of code. Is it worth it then?\r\n\r\nYeah it's light wrapper around a line of code. But it's still worth it in my opinion because\r\n1. It's basically needed by everything using prompt-buffer\r\n2. The best way to do it is not directly obvious (the fact that you need to append before a mark or before last line in previous case the -1 part is not obvious)\r\n3. It gives us more control if we need to change things in future. For example if we already had something like this before we could just add multi-line support without breaking current plugins codes.\r\n\r\n>  Prompt buffer is meant to be used with job, and I can't recall a rule that says a job will always stream a full line for each chunk.\r\n\r\nI'm not sure which rule are you talking about. Can you give a test code? As far as I remember job-apis in neovim and vim are different. And I think there's an option in neovims one to buffer job outputs. In plugin code the plugin can also just buffer the last line instead of sending partial lines to prompt_appendbuffer. The shell example code in the nvim docs seem to work fine\r\n\r\n```lua\r\n    local shell_job\r\n\r\n    -- Handles a line of user input.\r\n    local function on_submit(text)\r\n      -- Send the text to the shell with Enter appended.\r\n      vim.api.nvim_chan_send(shell_job, text .. \"\\n\")\r\n    end\r\n\r\n    -- Handles output from the shell.\r\n    local function on_output(_, msg, _)\r\n      -- Add shell output above the prompt.\r\n      local buf = vim.api.nvim_get_current_buf()\r\n      vim.fn.prompt_appendbuffer(buf, msg)\r\n    end\r\n\r\n    -- Handles the shell exit.\r\n    local function on_exit(_, _, _)\r\n      vim.cmd(\"quit!\")\r\n    end\r\n\r\n    -- Start a shell in the background.\r\n    shell_job = vim.fn.jobstart({ \"/bin/sh\" }, {\r\n      on_stdout = on_output,\r\n      on_stderr = on_output,\r\n      on_exit = on_exit,\r\n    })\r\n\r\n    vim.cmd(\"new\")\r\n    vim.bo.buftype = \"prompt\"\r\n    local buf = vim.api.nvim_get_current_buf()\r\n    vim.fn.prompt_setcallback(buf, on_submit)\r\n    vim.fn.prompt_setprompt(buf, \"shell command: \")\r\n\r\n    -- Start accepting shell commands.\r\n    vim.cmd(\"startinsert\")\r\n```\r\n\r\n> btw, I will propose function name prompt_addoutput instead of prompt_appendbuffer. appendbuffer sounds like you are trying to add a buffer to something else. Even if it means \"append to buffer\", it will typically be understood as \"append to the end of the buffer\", not \"append before the current prompt\". Moreover add is one of the recommended verbs according to [:h dev-name-common](https://neovim.io/doc/user/dev.html#dev-name-common) (while append isn't). And output faces input, which already exists in prompt_getinput()\r\n\r\nI don't have strong feelings about the name. I guess I'd like to hear what other people think about it. But prompt_appendbuffer works for me. In case of prompt buffer we expect line before prompt-line to be limit where programatic text should be inserted. So in that case appending to buffer means appending there. And I think `dev-name-common` doc is for neovim-api, the `nvim_*` functions. Not sure if they apply to vim functions. Would like comment from others on it. I'm fine with both names.\r\n\r\n",
            "created_at": "2026-02-07T17:12:28Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864870423",
            "id": 3864870423,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mXT4X",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864870423/reactions"
            },
            "updated_at": "2026-02-07T17:12:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864870423",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13149513?v=4",
                "events_url": "https://api.github.com/users/shadmansaleh/events{/privacy}",
                "followers_url": "https://api.github.com/users/shadmansaleh/followers",
                "following_url": "https://api.github.com/users/shadmansaleh/following{/other_user}",
                "gists_url": "https://api.github.com/users/shadmansaleh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shadmansaleh",
                "id": 13149513,
                "login": "shadmansaleh",
                "node_id": "MDQ6VXNlcjEzMTQ5NTEz",
                "organizations_url": "https://api.github.com/users/shadmansaleh/orgs",
                "received_events_url": "https://api.github.com/users/shadmansaleh/received_events",
                "repos_url": "https://api.github.com/users/shadmansaleh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shadmansaleh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shadmansaleh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shadmansaleh",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I'm not sure which rule are you talking about.\r\n\r\nWhich is why I literally said there is no such rule\r\n\r\n> Can you give a test code. The shell example code in the nvim docs seem to work fine\r\n\r\nNo, it doesn't work fine with the following shell program\r\n```bash\r\necho \"Hello world\" | while IFS= read -r -n1 c; do\r\n  printf \"%s\" \"$c\"\r\n  sleep 0.1\r\ndone\r\n```\r\nSave it to a file (e.g test.sh), then run it in both a real terminal buffer and the prompt buffer, you'll see the outputs are very different.\r\n\r\nThe example is silly, but it can demonstrates a problem that will happen with almost all LLM jobs (like ACP CLI). As the idea of multi-line input was originally made with LLM chat buffer in mind, I think this needs to be supported by `appendbuffer`",
            "created_at": "2026-02-07T17:36:00Z",
            "html_url": "https://github.com/neovim/neovim/pull/37763#issuecomment-3864914750",
            "id": 3864914750,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
            "node_id": "IC_kwDOAPphoM7mXes-",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864914750/reactions"
            },
            "updated_at": "2026-02-07T17:39:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3864914750",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster",
                "user_view_type": "public"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37763/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/37763/commits",
    "created_at": "2026-02-07T06:40:05Z",
    "diff_url": "https://github.com/neovim/neovim/pull/37763.diff",
    "draft": true,
    "head": {
        "label": "shadmansaleh:feat/prompt/prompt_appendbuffer",
        "ref": "feat/prompt/prompt_appendbuffer",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/shadmansaleh/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/shadmansaleh/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/shadmansaleh/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/shadmansaleh/neovim/branches{/branch}",
            "clone_url": "https://github.com/shadmansaleh/neovim.git",
            "collaborators_url": "https://api.github.com/repos/shadmansaleh/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/shadmansaleh/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/shadmansaleh/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/shadmansaleh/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/shadmansaleh/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/shadmansaleh/neovim/contributors",
            "created_at": "2021-03-16T15:07:33Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/shadmansaleh/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/shadmansaleh/neovim/downloads",
            "events_url": "https://api.github.com/repos/shadmansaleh/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/shadmansaleh/neovim/forks",
            "full_name": "shadmansaleh/neovim",
            "git_commits_url": "https://api.github.com/repos/shadmansaleh/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/shadmansaleh/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/shadmansaleh/neovim/git/tags{/sha}",
            "git_url": "git://github.com/shadmansaleh/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_pull_requests": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/shadmansaleh/neovim/hooks",
            "html_url": "https://github.com/shadmansaleh/neovim",
            "id": 348391941,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/shadmansaleh/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/shadmansaleh/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/shadmansaleh/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/shadmansaleh/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/shadmansaleh/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/shadmansaleh/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/shadmansaleh/neovim/merges",
            "milestones_url": "https://api.github.com/repos/shadmansaleh/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkzNDgzOTE5NDE=",
            "notifications_url": "https://api.github.com/repos/shadmansaleh/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13149513?v=4",
                "events_url": "https://api.github.com/users/shadmansaleh/events{/privacy}",
                "followers_url": "https://api.github.com/users/shadmansaleh/followers",
                "following_url": "https://api.github.com/users/shadmansaleh/following{/other_user}",
                "gists_url": "https://api.github.com/users/shadmansaleh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shadmansaleh",
                "id": 13149513,
                "login": "shadmansaleh",
                "node_id": "MDQ6VXNlcjEzMTQ5NTEz",
                "organizations_url": "https://api.github.com/users/shadmansaleh/orgs",
                "received_events_url": "https://api.github.com/users/shadmansaleh/received_events",
                "repos_url": "https://api.github.com/users/shadmansaleh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shadmansaleh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shadmansaleh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shadmansaleh",
                "user_view_type": "public"
            },
            "private": false,
            "pull_request_creation_policy": "all",
            "pulls_url": "https://api.github.com/repos/shadmansaleh/neovim/pulls{/number}",
            "pushed_at": "2026-02-16T06:11:43Z",
            "releases_url": "https://api.github.com/repos/shadmansaleh/neovim/releases{/id}",
            "size": 358227,
            "ssh_url": "git@github.com:shadmansaleh/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/shadmansaleh/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/shadmansaleh/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/shadmansaleh/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/shadmansaleh/neovim/subscription",
            "svn_url": "https://github.com/shadmansaleh/neovim",
            "tags_url": "https://api.github.com/repos/shadmansaleh/neovim/tags",
            "teams_url": "https://api.github.com/repos/shadmansaleh/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/shadmansaleh/neovim/git/trees{/sha}",
            "updated_at": "2026-02-15T15:16:48Z",
            "url": "https://api.github.com/repos/shadmansaleh/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "38f40cbd5b5437f71c9a307b0c01d130b33b03ac",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/13149513?v=4",
            "events_url": "https://api.github.com/users/shadmansaleh/events{/privacy}",
            "followers_url": "https://api.github.com/users/shadmansaleh/followers",
            "following_url": "https://api.github.com/users/shadmansaleh/following{/other_user}",
            "gists_url": "https://api.github.com/users/shadmansaleh/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/shadmansaleh",
            "id": 13149513,
            "login": "shadmansaleh",
            "node_id": "MDQ6VXNlcjEzMTQ5NTEz",
            "organizations_url": "https://api.github.com/users/shadmansaleh/orgs",
            "received_events_url": "https://api.github.com/users/shadmansaleh/received_events",
            "repos_url": "https://api.github.com/users/shadmansaleh/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/shadmansaleh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shadmansaleh/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/shadmansaleh",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/37763",
    "id": 3257167604,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37763",
    "labels": [],
    "locked": false,
    "merge_commit_sha": "d185140dc516707009769986345ec8d152ebf975",
    "merged_at": null,
    "milestone": null,
    "node_id": "PR_kwDOAPphoM7CJG70",
    "number": 37763,
    "patch_url": "https://github.com/neovim/neovim/pull/37763.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/37763/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/38f40cbd5b5437f71c9a307b0c01d130b33b03ac",
    "title": "feat(prompt): prompt_appendbuffer() appends to prompt buffer",
    "updated_at": "2026-02-12T23:26:27Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/37763",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/13149513?v=4",
        "events_url": "https://api.github.com/users/shadmansaleh/events{/privacy}",
        "followers_url": "https://api.github.com/users/shadmansaleh/followers",
        "following_url": "https://api.github.com/users/shadmansaleh/following{/other_user}",
        "gists_url": "https://api.github.com/users/shadmansaleh/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/shadmansaleh",
        "id": 13149513,
        "login": "shadmansaleh",
        "node_id": "MDQ6VXNlcjEzMTQ5NTEz",
        "organizations_url": "https://api.github.com/users/shadmansaleh/orgs",
        "received_events_url": "https://api.github.com/users/shadmansaleh/received_events",
        "repos_url": "https://api.github.com/users/shadmansaleh/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/shadmansaleh/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/shadmansaleh/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/shadmansaleh",
        "user_view_type": "public"
    }
}
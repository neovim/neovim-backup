{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nThe documentation in `:help shell-powershell` should be updated to work correctly for majority of Windows/powershell users.\nhttps://github.com/neovim/neovim/blob/afdad5c76ec5a5ad1c3e3d21d168ed3d9349ba8c/runtime/doc/options.txt#L5226-L5232\n\nThis issues is intended to break out the part of the discussion in #32504  around the shell option values in the documentation for powershell into a more general issue and hopefully get feedback from other Windows/Powershell users about what these reccommended settings should be.\n\nFor non-windows/non-powershell users, I want to add the additional context about the two versions of powershell. \n- \"Windows Powershell\" is the default version of powershell on windows with last version being 5.1. The command to run it is \"powershell\". \n- \"PowerShell Core\" is the cross-platform version of powershell and it currently goes up to version 7.5. The command to run it is \"pwsh\". \n\nMany Windows users install PowerShell Core to get the latest features which is why `:help shell-powershell`  has the line `let &shell = executable('pwsh') ? 'pwsh' : 'powershell'`. The recommended settings in `:help shell-powershell` should ideally be valid for both versions.\n\nIssues with current documentation:\n- The `Remove-Alias -Force -ErrorAction SilentlyContinue tee;` part of `shellcmdflag`  causes an error for the `tee` usage in `shellpipe`. There are two solutions either remove the `Remove-Alias -Force -ErrorAction SilentlyContinue tee;` or replace the `tee` alias with it's command `Tee-Object`. Ideally both should be done.\n- The ` $PSStyle.OutputRendering=''plaintext'';` part of the shellcmdflag does not work on the default version of powershell of 5.1. I don't know what the intent was behind setting this value so I don't now if this should be entirely removed from the docs or not. At a minimum this should be noted so that users of the defualt 5.1 version don't use a shellcmdflag that causes errors. \n- IMO, most users probably don't need their powershell profile to run during shell commands started by neovim so the docs should probably mention that the user may want to add `-NoProfile` to the shellcmdflag option if they have a slow powershell profile. \n\nMaking the above changes it would look something like this:\n```vimscript\nlet &shell = executable('pwsh') ? 'pwsh' : 'powershell'\nlet &shellcmdflag = '-NoLogo -NoProfile -NonInteractive -ExecutionPolicy RemoteSigned -Command [Console]::InputEncoding=[Console]::OutputEncoding=[System.Text.UTF8Encoding]::new();$PSDefaultParameterValues[''Out-File:Encoding'']=''utf8'';'\nlet &shellredir = '2>&1 | %%{ \"$_\" } | Out-File %s; exit $LastExitCode'\nlet &shellpipe  = '2>&1 | %%{ \"$_\" } | Tee-Object %s; exit $LastExitCode'\nset shellquote= shellxquote=\n```\n\nLastly, my personal config has used for a long time the lua version of the options I found from https://github.com/akinsho/toggleterm.nvim/wiki/Tips-and-Tricks. Those options do solve the issues listed above and are imo easier to read.\nIf we went with that version the docs would become: \n```vimscript\nlet &shell = executable('pwsh') ? 'pwsh' : 'powershell'\nlet &shellcmdflag = '-NoLogo -NoProfile -ExecutionPolicy RemoteSigned -Command [Console]::InputEncoding=[Console]::OutputEncoding=[System.Text.Encoding]::UTF8;'\nlet &shellredir = '-RedirectStandardOutput %s -NoNewWindow -Wait'\nlet &shellpipe = '2>&1 | Out-File -Encoding UTF8 %s; exit $LastExitCode'\nset shellquote= shellxquote=\n```\n\n\n\n### Expected behavior\n\nThe documentation in `:help shell-powershell` should list shell option values that work for the majority of powershell users regardless of which version for powershell they use.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "PR welcome, but please check the git history for this option and the related PR discussions to ensure that it doesn't regress the previous changes (or explain why they are worth regressing). This doc has seen a lot of changes because of various quirks that were noticed. It's not clear to me whether those previous changes were actually worthwhile or if they just complicated things.",
            "created_at": "2025-03-16T12:45:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/32921#issuecomment-2727376693",
            "id": 2727376693,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/32921",
            "node_id": "IC_kwDOAPphoM6ikHc1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2727376693/reactions"
            },
            "updated_at": "2025-03-16T12:45:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2727376693",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/32921/comments",
    "created_at": "2025-03-15T20:03:53Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/32921/events",
    "html_url": "https://github.com/neovim/neovim/issues/32921",
    "id": 2922503238,
    "labels": [
        {
            "color": "c5def5",
            "default": true,
            "description": "",
            "id": 84744038,
            "name": "documentation",
            "node_id": "MDU6TGFiZWw4NDc0NDAzOA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/documentation"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/32921/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6uMdxG",
    "number": 32921,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 2,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/32921/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/32921/timeline",
    "title": "Update documentation for `:help shell-powershell`",
    "updated_at": "2025-03-16T12:45:45Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/32921",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/51029315?v=4",
        "events_url": "https://api.github.com/users/crwebb85/events{/privacy}",
        "followers_url": "https://api.github.com/users/crwebb85/followers",
        "following_url": "https://api.github.com/users/crwebb85/following{/other_user}",
        "gists_url": "https://api.github.com/users/crwebb85/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/crwebb85",
        "id": 51029315,
        "login": "crwebb85",
        "node_id": "MDQ6VXNlcjUxMDI5MzE1",
        "organizations_url": "https://api.github.com/users/crwebb85/orgs",
        "received_events_url": "https://api.github.com/users/crwebb85/received_events",
        "repos_url": "https://api.github.com/users/crwebb85/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/crwebb85/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/crwebb85/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/crwebb85",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Neovim version (nvim -v)\r\n\r\nNVIM v0.8.0-dev-1093-g982fef601\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nyes\r\n\r\n### Operating system/version\r\n\r\nArchLinux\r\n\r\n### Terminal name/version\r\n\r\nAlacritty\r\n\r\n### $TERM environment variable\r\n\r\nalacritty\r\n\r\n### Installation\r\n\r\nbuild from repo\r\n\r\n### How to reproduce the issue\r\n\r\ncat `mini.vim`\r\n```vim\r\nset noexpandtab\r\nset list\r\nset listchars=tab:>-\r\n\r\nhi! NonText ctermfg=red\r\nhi! SpecialKey ctermfg=red\r\nhi! OnlyBgAttrHl ctermbg=green\r\nhi! BothFgBgAttrHl ctermbg=green ctermfg=black\r\ncall matchadd('OnlyBgAttrHl', '^\\s\\+echom \"hello\"')\r\ncall matchadd('BothFgBgAttrHl', '^\\s\\+echom \"world\"')\r\nnorm! G\r\ncall feedkeys(\"o\\<Tab>echom \\\"hello\\\"\\<Esc>\")\r\ncall feedkeys(\"o\\<Tab>echom \\\"world\\\"\\<Esc>\")\r\n```\r\n\r\n1. `nvim -u NONE +'so' mini.vim`\r\n\r\n### Expected behavior\r\n\r\n![image](https://user-images.githubusercontent.com/17562139/190531057-26958d02-b3ed-4b7f-9f3a-a140752f24cb.png)\r\n\r\n### Actual behavior\r\n\r\n![image](https://user-images.githubusercontent.com/17562139/190531036-53cdd133-3827-4179-ab68-8cebd1673c48.png)\r\n\r\nRelated issue: https://github.com/neovim/neovim/issues/4946\r\n\r\nThe expected behavior is patched by:\r\n```diff\r\ndiff --git a/src/nvim/drawline.c b/src/nvim/drawline.c\r\nindex 9de8b9996..992a5db0c 100644\r\n--- a/src/nvim/drawline.c\r\n+++ b/src/nvim/drawline.c\r\n@@ -2176,8 +2176,9 @@ int win_line(win_T *wp, linenr_T lnum, int startrow, int endrow, bool nochange,\r\n     }\r\n \r\n     // Don't override visual selection highlighting.\r\n-    if (n_attr > 0 && draw_state == WL_LINE && !search_attr_from_match) {\r\n-      char_attr = hl_combine_attr(char_attr, extra_attr);\r\n+    if (n_attr > 0 && draw_state == WL_LINE) {\r\n+      char_attr = search_attr_from_match ? hl_combine_attr(extra_attr, char_attr)\r\n+                                         : hl_combine_attr(char_attr, extra_attr);\r\n     }\r\n \r\n     // Handle the case where we are in column 0 but not on the first\r\n```\r\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "BTW, `nvim_buf_set_extmark` like expected behavior, but it's buffer related. I need a window related highlighting but keep fg attr for listchars.",
            "created_at": "2022-09-16T00:30:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/20208#issuecomment-1248785059",
            "id": 1248785059,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/20208",
            "node_id": "IC_kwDOAPphoM5KbvKj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1248785059/reactions"
            },
            "updated_at": "2022-09-16T00:30:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1248785059",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/17562139?v=4",
                "events_url": "https://api.github.com/users/kevinhwang91/events{/privacy}",
                "followers_url": "https://api.github.com/users/kevinhwang91/followers",
                "following_url": "https://api.github.com/users/kevinhwang91/following{/other_user}",
                "gists_url": "https://api.github.com/users/kevinhwang91/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kevinhwang91",
                "id": 17562139,
                "login": "kevinhwang91",
                "node_id": "MDQ6VXNlcjE3NTYyMTM5",
                "organizations_url": "https://api.github.com/users/kevinhwang91/orgs",
                "received_events_url": "https://api.github.com/users/kevinhwang91/received_events",
                "repos_url": "https://api.github.com/users/kevinhwang91/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kevinhwang91/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kevinhwang91/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kevinhwang91",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "thanks, can you send a PR?",
            "created_at": "2022-09-16T22:57:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/20208#issuecomment-1249922859",
            "id": 1249922859,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/20208",
            "node_id": "IC_kwDOAPphoM5KgE8r",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1249922859/reactions"
            },
            "updated_at": "2022-09-16T22:57:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1249922859",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Shouldn't this be done also for Folded?",
            "created_at": "2022-09-26T13:18:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/20208#issuecomment-1258030105",
            "id": 1258030105,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/20208",
            "node_id": "IC_kwDOAPphoM5K_AQZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1258030105/reactions"
            },
            "updated_at": "2022-09-26T13:18:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1258030105",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/36300441?v=4",
                "events_url": "https://api.github.com/users/rebelot/events{/privacy}",
                "followers_url": "https://api.github.com/users/rebelot/followers",
                "following_url": "https://api.github.com/users/rebelot/following{/other_user}",
                "gists_url": "https://api.github.com/users/rebelot/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rebelot",
                "id": 36300441,
                "login": "rebelot",
                "node_id": "MDQ6VXNlcjM2MzAwNDQx",
                "organizations_url": "https://api.github.com/users/rebelot/orgs",
                "received_events_url": "https://api.github.com/users/rebelot/received_events",
                "repos_url": "https://api.github.com/users/rebelot/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rebelot/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rebelot/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rebelot",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/20208/comments",
    "created_at": "2022-09-16T00:25:59Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/20208/events",
    "html_url": "https://github.com/neovim/neovim/issues/20208",
    "id": 1375238972,
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1786207367,
            "name": "highlight",
            "node_id": "MDU6TGFiZWwxNzg2MjA3MzY3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/highlight"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/20208/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5R-Hs8",
    "number": 20208,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/20208/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/20208/timeline",
    "title": "listchar highlighting should combine the highlighting of matchs",
    "updated_at": "2025-01-19T11:48:59Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/20208",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/17562139?v=4",
        "events_url": "https://api.github.com/users/kevinhwang91/events{/privacy}",
        "followers_url": "https://api.github.com/users/kevinhwang91/followers",
        "following_url": "https://api.github.com/users/kevinhwang91/following{/other_user}",
        "gists_url": "https://api.github.com/users/kevinhwang91/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kevinhwang91",
        "id": 17562139,
        "login": "kevinhwang91",
        "node_id": "MDQ6VXNlcjE3NTYyMTM5",
        "organizations_url": "https://api.github.com/users/kevinhwang91/orgs",
        "received_events_url": "https://api.github.com/users/kevinhwang91/received_events",
        "repos_url": "https://api.github.com/users/kevinhwang91/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kevinhwang91/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kevinhwang91/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kevinhwang91",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\nThe background kind of terminal emulator can affect the result of a startup. In particular, it can lead to legacy syntax highlight groups being cleared after startup if terminal background is light. This results into no visible highlight until the explicit `:edit`.\n\n### Steps to reproduce\n\n1. Create the 'init-cs.lua' lua with the single line `vim.cmd('colorscheme default')`. It seems to be reproducible with any color scheme which has `:hi clear` at the beginning.\n2. Create a test 'nginx.conf' file with a single line `user  www www;`.\n3. Have terminal background be light and execute `nvim --clean -u init-cs.lua -- nginx.conf`. The word `user` is not highlighted. The output of `:Inspect` is `ngxDirective` (i.e. seems to be cleared). It becomes highlighted after `:edit`.\n    3.a Have terminal background be dark and execute `nvim --clean -u init-cs.lua -- nginx.conf`. The word `user` is highlighted. The output of `:Inspect` is `ngxDirective links to Function`.\n\nThis seems to be a combination of the following aspects:\n1. [Guessing and setting the 'background'](https://github.com/neovim/neovim/blob/b459bf5961fd6bbd7c887d9c3751ff5dbbdcf55d/runtime/lua/vim/_defaults.lua#L720) during startup. Light background leads to setting `vim.o.background = 'light'`, which resources the color scheme, which leads to `:hi clear`. I.e. *it seems* that the effect of this guessing occurs *after* legacy syntax is applied.\n2. The syntax for 'nginx' defines highlight groups [via pure linking](https://github.com/neovim/neovim/blob/b459bf5961fd6bbd7c887d9c3751ff5dbbdcf55d/runtime/syntax/nginx.vim#L2310-L2342), i.e. not `hi def link`. As highlight groups are not default, they are not restored after `:hi clear`. Although using `hi def link` in legacy syntax is more common, there are non trivial amount of cases where `hi link` is used.\n\nMy guess would be that the 2. is the \"main\" culprit. Changing `hi link` to `hi def link` fixes the issue.\n\nBut some aspect of 1. can still be at play here. Maybe somehow postponing legacy syntax effect until after 'background' is guessed is possible? Or maybe on top of [setting 'background'](https://github.com/neovim/neovim/blob/b459bf5961fd6bbd7c887d9c3751ff5dbbdcf55d/runtime/lua/vim/_defaults.lua#L816) there can be some sort of syntax update (maybe `:syntax reset`, not sure).\n\n### Expected behavior\n\nBackground color of terminal emulator should not affect whether some highlight groups are defined or not.\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-1459+g0791594101\n\n### Vim (not Nvim) behaves the same?\n\nNo\n\n### Operating system/version\n\nEndeavourOS Linux x86_64, 6.17.1-arch1-1\n\n### Terminal name/version\n\nGhostty 1.2.0-arch1\n\n### $TERM environment variable\n\nxterm-ghostty\n\n### Installation\n\nAppimage",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Same as #36210. Depending on which has more useful info, please close one of them as duplicate.",
            "created_at": "2025-10-16T16:06:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/36211#issuecomment-3411614205",
            "id": 3411614205,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36211",
            "node_id": "IC_kwDOAPphoM7LWRn9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3411614205/reactions"
            },
            "updated_at": "2025-10-16T16:06:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3411614205",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Related vim/vim#18505",
            "created_at": "2025-10-17T00:48:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/36211#issuecomment-3413390945",
            "id": 3413390945,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36211",
            "node_id": "IC_kwDOAPphoM7LdDZh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3413390945/reactions"
            },
            "updated_at": "2025-10-17T00:48:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3413390945",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/36211/comments",
    "created_at": "2025-10-16T16:04:56Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/36211/events",
    "html_url": "https://github.com/neovim/neovim/issues/36211",
    "id": 3522535736,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim defaults for options, colorscheme/theme, autocmds/events, etc.",
            "id": 103777064,
            "name": "defaults",
            "node_id": "MDU6TGFiZWwxMDM3NzcwNjQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/defaults"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "startup, shutdown, attach, detach",
            "id": 870629450,
            "name": "lifecycle",
            "node_id": "MDU6TGFiZWw4NzA2Mjk0NTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lifecycle"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/36211/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7R9aE4",
    "number": 36211,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 1,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/36211/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/36211/timeline",
    "title": "Light terminal background can affect legacy syntax highlighting after startup",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-10-17T00:48:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/36211",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
        "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
        "followers_url": "https://api.github.com/users/echasnovski/followers",
        "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
        "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/echasnovski",
        "id": 24854248,
        "login": "echasnovski",
        "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
        "organizations_url": "https://api.github.com/users/echasnovski/orgs",
        "received_events_url": "https://api.github.com/users/echasnovski/received_events",
        "repos_url": "https://api.github.com/users/echasnovski/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/echasnovski",
        "user_view_type": "public"
    }
}
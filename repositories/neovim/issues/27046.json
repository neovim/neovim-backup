{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nFrom few days I get crashes when updating the buffer e.g. undo. \r\n\r\n```cpp\r\n#0  __pthread_kill_implementation (threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0) at ./nptl/pthread_kill.c:44\r\n#1  0x00007fea9eef315f in __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\r\n#2  0x00007fea9eea5472 in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\r\n#3  0x00007fea9ee8f4b2 in __GI_abort () at ./stdlib/abort.c:79\r\n#4  0x00007fea9ee8f3d5 in __assert_fail_base (fmt=0x7fea9f003dc8 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\", assertion=assertion@entry=0x5565767fe960 \"buf->b_signcols.count[width - 1] >= 0\",\r\n    file=file@entry=0x5565767fe748 \".../src/nvim/decoration.c\", line=line@entry=848, function=function@entry=0x55657679f310 <__PRETTY_FUNCTION__.1.lto_priv.8> \"buf_signcols_count_range\") at ./assert/assert.c:92\r\n#5  0x00007fea9ee9e3a2 in __assert_fail (assertion=assertion@entry=0x5565767fe960 \"buf->b_signcols.count[width - 1] >= 0\", file=file@entry=0x5565767fe748 \".../src/nvim/decoration.c\", line=line@entry=848,\r\n    function=function@entry=0x55657679f310 <__PRETTY_FUNCTION__.1.lto_priv.8> \"buf_signcols_count_range\") at ./assert/assert.c:101\r\n#6  0x00005565764923be in buf_signcols_count_range (buf=0x55657a5cb7f0, row1=20, row2=20, add=-1, clear=kFalse) at .../src/nvim/decoration.c:848\r\n#7  0x000055657648f9c0 in buf_remove_decor_sh (buf=buf@entry=0x55657a5cb7f0, row1=row1@entry=20, row2=row2@entry=20, sh=sh@entry=0x556578824ac0) at .../src/nvim/decoration.c:258\r\n#8  0x000055657648fa46 in buf_decor_remove (buf=0x55657a5cb7f0, row1=20, row2=20, decor=..., free=true) at .../src/nvim/decoration.c:227\r\n#9  0x0000556576516e98 in extmark_del (buf=buf@entry=0x55657a5cb7f0, itr=itr@entry=0x7fff47f5d040, key=..., restore=restore@entry=true) at .../src/nvim/extmark.c:153\r\n#10 0x0000556576517558 in extmark_clear (buf=0x55657a5cb7f0, ns_id=53, l_row=0, l_col=<optimized out>, u_row=2147483646, u_col=2147483647) at .../src/nvim/extmark.c:189\r\n#11 0x0000556576444f04 in nvim_buf_clear_namespace (buffer=<optimized out>, ns_id=53, line_start=0, line_end=2147483647, err=0x7fff47f5d190) at .../src/nvim/api/extmark.c:973\r\n#12 0x0000556576429c02 in nlua_api_nvim_buf_clear_namespace (lstate=0x7fea8a4ac5f0) at .../build/src/nvim/auto/lua_api_c_bindings.generated.c:2922\r\n#13 0x0000556576726ed6 in lj_BC_FUNCC ()\r\n#14 0x0000556576727d32 in lj_ff_coroutine_resume ()\r\n#15 0x00005565767132a5 in lua_pcall (L=L@entry=0x7fea9ee47380, nargs=nargs@entry=0, nresults=nresults@entry=0, errfunc=errfunc@entry=-2) at lj_api.c:1121\r\n#16 0x000055657654d077 in nlua_pcall (lstate=lstate@entry=0x7fea9ee47380, nargs=nargs@entry=0, nresults=nresults@entry=0) at .../src/nvim/lua/executor.c:172\r\n#17 0x0000556576550cbc in nlua_schedule_event (argv=<optimized out>) at .../src/nvim/lua/executor.c:367\r\n#18 0x0000556576639898 in state_handle_k_event () at .../src/nvim/state.c:119\r\n#19 0x00005565765a1c99 in nv_event (cap=0x7fff47f5d460) at .../src/nvim/normal.c:6613\r\n#20 0x000055657659d9d1 in normal_execute (state=0x7fff47f5d3f0, key=<optimized out>) at .../src/nvim/normal.c:1227\r\n#21 0x000055657663973b in state_enter (s=0x7fff47f5d3f0) at .../src/nvim/state.c:101\r\n#22 0x000055657659735d in normal_enter (cmdwin=<optimized out>, noexmode=<optimized out>) at .../src/nvim/normal.c:516\r\n#23 0x00005565765601bd in main (argc=2, argv=<optimized out>) at .../src/nvim/main.c:651\r\n```\r\n\r\n@luukvbaal it looks like from https://github.com/neovim/neovim/commit/967c7abde3c6fa3210a4920a5848a54dc913d851#diff-6e7593afe2030cd8628b9a5a900e49accd4a9d7f3ff4b73ee022f06b4bd0f237R848\r\n\r\n### Steps to reproduce\r\n\r\nAt the moment I have no idea how to reproduce this bug. I use statuscol nvim on branch 0.10 with \r\n```lua\r\nlocal builtin = require('statuscol.builtin')\r\nrequire('statuscol').setup({\r\n  relculright = true,\r\n  segments = {\r\n    {\r\n      text = {builtin.foldfunc},\r\n      condition = {true},\r\n      click = 'v:lua.ScFa',\r\n    },\r\n    {\r\n      sign = {namespace = {'gitsigns*'}, maxwidth = 1, colwidth = 1, auto = true},\r\n      click = 'v:lua.ScSa',\r\n    },\r\n    {\r\n      sign = {namespace = {'arctgx.diagnostic.signs/diagnostic/signs'}, maxwidth = 2, colwidth = 2, auto = true},\r\n      click = 'v:lua.ScSa'\r\n    },\r\n    {\r\n      sign = {name = {'Dap.*'}, maxwidth = 2, colwidth = 2, auto = true},\r\n      click = 'v:lua.ScLa'\r\n    },\r\n    {\r\n      sign = {name = {'.*'}, maxwidth = 1, colwidth = 1, auto = true},\r\n      click = 'v:lua.ScSa'\r\n    },\r\n    {text = {builtin.lnumfunc, ' '}, click = 'v:lua.ScLa',},\r\n  },\r\n  ft_ignore = {\r\n    'NvimTree',\r\n  },\r\n})\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo crash\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-2104+gfd2ed024c\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\n-\r\n\r\n### Operating system/version\r\n\r\nDebian Sid\r\n\r\n### Terminal name/version\r\n\r\nalacritty 0.13.1\r\n\r\n### $TERM environment variable\r\n\r\nalacritty\r\n\r\n### Installation\r\n\r\nfrom repo",
    "closed_at": "2024-02-23T12:37:12Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Possibly a side effect of #26898 ",
            "created_at": "2024-01-16T16:57:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1894141687",
            "id": 1894141687,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w5k73",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894141687/reactions"
            },
            "updated_at": "2024-01-16T16:57:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894141687",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Config for diagnostics include unicode chars:\r\n```lua\r\nvim.diagnostic.config({\r\n  virtual_text = false,\r\n  underline = false,\r\n  float = {\r\n    border = 'rounded',\r\n  },\r\n  signs = {\r\n    text = {\r\n      [vim.diagnostic.severity.ERROR] = '',\r\n      [vim.diagnostic.severity.WARN] = '⚠',\r\n      [vim.diagnostic.severity.INFO] = '',\r\n      [vim.diagnostic.severity.HINT] = '󰌶',\r\n    },\r\n  },\r\n})\r\n\r\nlocal ns = vim.api.nvim_create_namespace('arctgx.diagnostic.signs')\r\nlocal origSignsHandler = vim.diagnostic.handlers.signs\r\n\r\n-- from :help diagnostic-handlers-example\r\nvim.diagnostic.handlers.signs = {\r\n  show = function (_, bufnr, _, opts)\r\n    local diagnostics = vim.diagnostic.get(bufnr)\r\n\r\n    local maxSeverityPerLine = {}\r\n    for _, d in pairs(diagnostics) do\r\n      local m = maxSeverityPerLine[d.lnum]\r\n      if not m or d.severity < m.severity then\r\n        maxSeverityPerLine[d.lnum] = d\r\n      end\r\n    end\r\n\r\n    local filteredDiagnostics = vim.tbl_values(maxSeverityPerLine)\r\n    origSignsHandler.show(ns, bufnr, filteredDiagnostics, opts)\r\n  end,\r\n  hide = function (_, bufnr)\r\n    if vim.api.nvim_buf_is_valid(bufnr) then\r\n      origSignsHandler.hide(ns, bufnr)\r\n    end\r\n  end,\r\n}\r\n```",
            "created_at": "2024-01-16T16:57:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1894141929",
            "id": 1894141929,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w5k_p",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894141929/reactions"
            },
            "updated_at": "2024-01-16T16:57:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894141929",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Possibly a side effect of #26898\r\n\r\nyes, I quoted it above too.",
            "created_at": "2024-01-16T16:58:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1894143311",
            "id": 1894143311,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w5lVP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894143311/reactions"
            },
            "updated_at": "2024-01-16T16:58:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894143311",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "A repro would be nice. The undo/redo part is tricky but I haven't hit the assert myself. \r\n\r\nI think it is worthwhile to keep trying to make the approach in #26898 work. The fact that `b_signcols.count` is decremented below 0 indicates an error in keeping track of the number of lines with a certain number of signs. In the meantime we could merge #27047, which might resolve the problem.\r\n\r\nDiagnostics/statuscol configs are irrelevant, this is just about keeping track of the placed signs.",
            "created_at": "2024-01-16T17:09:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1894163343",
            "id": 1894163343,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w5qOP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894163343/reactions"
            },
            "updated_at": "2024-01-20T14:48:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894163343",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I'll try to catch it in my free time. I don't get this failure very often and sometimes it's not easy to remember what edition has been made right before crash :wink: ",
            "created_at": "2024-01-16T17:21:52Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1894183366",
            "id": 1894183366,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w5vHG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894183366/reactions"
            },
            "updated_at": "2024-01-16T17:21:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1894183366",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "NONE",
            "body": "Same issue here. With Noice installed, it happens every time I do `:S<crashes immediately>`",
            "created_at": "2024-01-17T06:39:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1895088351",
            "id": 1895088351,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w9MDf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1895088351/reactions"
            },
            "updated_at": "2024-01-17T06:39:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1895088351",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/21299126?v=4",
                "events_url": "https://api.github.com/users/b0o/events{/privacy}",
                "followers_url": "https://api.github.com/users/b0o/followers",
                "following_url": "https://api.github.com/users/b0o/following{/other_user}",
                "gists_url": "https://api.github.com/users/b0o/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/b0o",
                "id": 21299126,
                "login": "b0o",
                "node_id": "MDQ6VXNlcjIxMjk5MTI2",
                "organizations_url": "https://api.github.com/users/b0o/orgs",
                "received_events_url": "https://api.github.com/users/b0o/received_events",
                "repos_url": "https://api.github.com/users/b0o/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/b0o/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/b0o/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/b0o"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I haven't had any such crash with Noice so far and cannot reproduce it that way. Maybe configuration matters here. ",
            "created_at": "2024-01-17T10:15:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1895500130",
            "id": 1895500130,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w-wli",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1895500130/reactions"
            },
            "updated_at": "2024-01-17T10:15:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1895500130",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "```lua\r\nlocal function setupNoice()\r\n  require('noice').setup({\r\n    messages = {\r\n      view = 'mini',\r\n      view_search = false,\r\n      view_error = 'mini',\r\n      view_warn = 'mini',\r\n    },\r\n    notify = {\r\n      enabled = true,\r\n      view = 'mini',\r\n    },\r\n    lsp = {\r\n      override = {},\r\n      signature = {\r\n        enabled = false,\r\n        auto_open = {\r\n          enabled = true,\r\n          trigger = true,\r\n          luasnip = true,\r\n          throttle = 50,\r\n        },\r\n        view = nil, \r\n      hover = {\r\n        enabled = false,\r\n        view = nil,\r\n        opts = {},\r\n      },\r\n    },\r\n    views = {\r\n      mini = {\r\n        timeout = 5000,\r\n      },\r\n    },\r\n    presets = {\r\n      lsp_doc_border = true,\r\n    },\r\n  })\r\nend\r\n```",
            "created_at": "2024-01-17T10:18:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1895504143",
            "id": 1895504143,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5w-xkP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1895504143/reactions"
            },
            "updated_at": "2024-01-17T10:18:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1895504143",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Same issue here. With Noice installed, it happens every time I do `:S<crashes immediately>`\r\n\r\nIs this still true? If so, are you able to produce a minimal config that shows the issue? I've tried to reproduce with noice but couldn't.\r\n\r\nAnd @przepompownia have you hit the assert after #27047?",
            "created_at": "2024-01-20T14:50:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1902119100",
            "id": 1902119100,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5xYAi8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902119100/reactions"
            },
            "updated_at": "2024-01-20T14:50:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902119100",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Since #27047 I haven't this crash anymore. It's good moment to close this issue. Thanks @luukvbaal ",
            "created_at": "2024-01-20T15:49:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1902141514",
            "id": 1902141514,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5xYGBK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902141514/reactions"
            },
            "updated_at": "2024-01-20T15:49:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902141514",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I was just hit by the same crash (same stacktrace) again (when doing undo). NVIM v0.10.0-dev-2139+g0c7ad223f; the equivalent base commit is fa9a85ae4 (the latest master which includes #27047).",
            "created_at": "2024-01-20T23:25:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1902386474",
            "id": 1902386474,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5xZB0q",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902386474/reactions"
            },
            "updated_at": "2024-01-20T23:25:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902386474",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Found a semi-reliable reproducer, I'll look into it.",
            "created_at": "2024-01-21T00:33:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1902462764",
            "id": 1902462764,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5xZUcs",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902462764/reactions"
            },
            "updated_at": "2024-01-21T00:37:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1902462764",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "NONE",
            "body": "Same error over here",
            "created_at": "2024-01-24T21:20:02Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1908935248",
            "id": 1908935248,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5xyApQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1908935248/reactions"
            },
            "updated_at": "2024-01-24T21:23:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1908935248",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/86387828?v=4",
                "events_url": "https://api.github.com/users/Armadillidiid/events{/privacy}",
                "followers_url": "https://api.github.com/users/Armadillidiid/followers",
                "following_url": "https://api.github.com/users/Armadillidiid/following{/other_user}",
                "gists_url": "https://api.github.com/users/Armadillidiid/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Armadillidiid",
                "id": 86387828,
                "login": "Armadillidiid",
                "node_id": "MDQ6VXNlcjg2Mzg3ODI4",
                "organizations_url": "https://api.github.com/users/Armadillidiid/orgs",
                "received_events_url": "https://api.github.com/users/Armadillidiid/received_events",
                "repos_url": "https://api.github.com/users/Armadillidiid/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Armadillidiid/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Armadillidiid/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Armadillidiid"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Today I got this failure on master before merging #27122. Let's observe nvim with that fix for some time. ",
            "created_at": "2024-02-01T18:48:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1921997101",
            "id": 1921997101,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM5yj1kt",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1921997101/reactions"
            },
            "updated_at": "2024-02-01T18:48:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1921997101",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hi, I'm encountering the issue with the latest nightly release (video below). I attempted to reproduce it in my configuration, but it seems to be quite random. However, I experimented with LazyVim distro and found a pattern that can almost reproduce it.\r\n\r\nI'm still working on minimizing the reproducible code, and I'll likely post it here tomorrow.\r\n\r\n```sh\r\nNVIM v0.10.0-dev-2397+ga9f578b7a\r\nBuild type: RelWithDebInfo\r\nLuaJIT 2.1.1707061634\r\n```\r\n\r\nhttps://github.com/neovim/neovim/assets/105807570/c65a752b-b60a-4596-a93c-de1ffa60178a\r\n\r\n\r\n",
            "created_at": "2024-02-20T05:04:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1953493443",
            "id": 1953493443,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM50b_HD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1953493443/reactions"
            },
            "updated_at": "2024-02-20T05:04:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1953493443",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/105807570?v=4",
                "events_url": "https://api.github.com/users/bassamsdata/events{/privacy}",
                "followers_url": "https://api.github.com/users/bassamsdata/followers",
                "following_url": "https://api.github.com/users/bassamsdata/following{/other_user}",
                "gists_url": "https://api.github.com/users/bassamsdata/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bassamsdata",
                "id": 105807570,
                "login": "bassamsdata",
                "node_id": "U_kgDOBk5-0g",
                "organizations_url": "https://api.github.com/users/bassamsdata/orgs",
                "received_events_url": "https://api.github.com/users/bassamsdata/received_events",
                "repos_url": "https://api.github.com/users/bassamsdata/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bassamsdata/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bassamsdata/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bassamsdata"
            }
        },
        {
            "author_association": "NONE",
            "body": "Alright, here is the reproducible code for this issue:\r\n\r\nSteps to reproduce it:\r\n\r\n1. Execute the following commands in your terminal:\r\n```sh\r\nmkdir ~/.config/min_sign\r\ncd ~/.config/min_sign\r\ntouch init.lua\r\n```\r\n\r\n2. Add the following code to the `init.lua` file then `NVIM_APPNAME=min_sign nvim`:\r\n\r\n<details>\r\n\r\n```lua\r\nlocal lazypath = vim.fn.stdpath(\"data\") .. \"/lazy/lazy.nvim\"\r\nif not vim.loop.fs_stat(lazypath) then\r\n\tvim.fn.system({\r\n\t\t\"git\",\r\n\t\t\"clone\",\r\n\t\t\"--filter=blob:none\",\r\n\t\t\"https://github.com/folke/lazy.nvim.git\",\r\n\t\t\"--branch=stable\", -- latest stable release\r\n\t\tlazypath,\r\n\t})\r\nend\r\nvim.opt.rtp:prepend(lazypath)\r\n\r\n\r\n-- this is from LazyVim distro (simplified version similar to statuscol plugin)\r\n-- https://github.com/LazyVim/LazyVim/blob/a50f92f7550fb6e9f21c0852e6cb190e6fcd50f5/lua/lazyvim/util/ui.lua\r\nlocal function get_signs(buf, lnum)\r\n\t-- Get regular signs\r\n\tlocal signs = {}\r\n\r\n\tif vim.fn.has(\"nvim-0.10\") == 0 then\r\n\t\t-- Only needed for Neovim <0.10\r\n\t\t-- Newer versions include legacy signs in nvim_buf_get_extmarks\r\n\t\tfor _, sign in ipairs(vim.fn.sign_getplaced(buf, { group = \"*\", lnum = lnum })[1].signs) do\r\n\t\t\tlocal ret = vim.fn.sign_getdefined(sign.name)[1]\r\n\t\t\tif ret then\r\n\t\t\t\tret.priority = sign.priority\r\n\t\t\t\tsigns[#signs + 1] = ret\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\n\r\n\t-- Get extmark signs\r\n\tlocal extmarks = vim.api.nvim_buf_get_extmarks(\r\n\t\tbuf,\r\n\t\t-1,\r\n\t\t{ lnum - 1, 0 },\r\n\t\t{ lnum - 1, -1 },\r\n\t\t{ details = true, type = \"sign\" }\r\n\t)\r\n\tfor _, extmark in pairs(extmarks) do\r\n\t\tsigns[#signs + 1] = {\r\n\t\t\tname = extmark[4].sign_hl_group or \"\",\r\n\t\t\ttext = extmark[4].sign_text,\r\n\t\t\ttexthl = extmark[4].sign_hl_group,\r\n\t\t\tpriority = extmark[4].priority,\r\n\t\t}\r\n\tend\r\n\r\n\t-- Sort by priority\r\n\ttable.sort(signs, function(a, b)\r\n\t\treturn (a.priority or 0) < (b.priority or 0)\r\n\tend)\r\n\r\n\treturn signs\r\nend\r\n\r\nlocal function get_mark(buf, lnum)\r\n\tlocal marks = vim.fn.getmarklist(buf)\r\n\tvim.list_extend(marks, vim.fn.getmarklist())\r\n\tfor _, mark in ipairs(marks) do\r\n\t\tif mark.pos[1] == buf and mark.pos[2] == lnum and mark.mark:match(\"[a-zA-Z]\") then\r\n\t\t\treturn { text = mark.mark:sub(2), texthl = \"DiagnosticHint\" }\r\n\t\tend\r\n\tend\r\nend\r\n\r\nlocal function icon(sign, len)\r\n\tsign = sign or {}\r\n\tlen = len or 2\r\n\tlocal text = vim.fn.strcharpart(sign.text or \"\", 0, len) ---@type string\r\n\ttext = text .. string.rep(\" \", len - vim.fn.strchars(text))\r\n\treturn sign.texthl and (\"%#\" .. sign.texthl .. \"#\" .. text .. \"%*\") or text\r\nend\r\n\r\nlocal function foldtext()\r\n\tlocal start_line = vim.api.nvim_buf_get_lines(0, vim.v.foldstart - 1, vim.v.foldstart, false)[1]\r\n\tlocal end_line = vim.api.nvim_buf_get_lines(0, vim.v.foldend - 1, vim.v.foldend, false)[1]\r\n\r\n\t-- Replace tabs with spaces\r\n\tstart_line = start_line:gsub(\"\\t\", string.rep(\" \", vim.bo.tabstop))\r\n\r\n\t-- Trim whitespace\r\n\tend_line = end_line:gsub(\"^%s*(.-)%s*$\", \"%1\")\r\n\r\n\treturn start_line .. \" ... \" .. end_line\r\nend\r\n\r\nfunction Statuscolumn()\r\n\tlocal win = vim.g.statusline_winid\r\n\tlocal buf = vim.api.nvim_win_get_buf(win)\r\n\tlocal is_file = vim.bo[buf].buftype == \"\"\r\n\tlocal show_signs = vim.wo[win].signcolumn ~= \"no\"\r\n\r\n\tlocal components = { \"\", \"\", \"\" } -- left, middle, right\r\n\r\n\tif show_signs then\r\n\t\t-- -@type Sign?,Sign?,Sign?\r\n\t\tlocal left, right, fold\r\n\t\tfor _, s in ipairs(get_signs(buf, vim.v.lnum)) do\r\n\t\t\tif s.name and s.name:find(\"GitSign\") then\r\n\t\t\t\tright = s\r\n\t\t\telse\r\n\t\t\t\tleft = s\r\n\t\t\tend\r\n\t\tend\r\n\t\tif vim.v.virtnum ~= 0 then\r\n\t\t\tleft = nil\r\n\t\tend\r\n\t\tvim.api.nvim_win_call(win, function()\r\n\t\t\tif vim.fn.foldclosed(vim.v.lnum) >= 0 then\r\n\t\t\t\tfold = {\r\n\t\t\t\t\ttext = vim.opt.fillchars:get().foldclose or \"\",\r\n\t\t\t\t\ttexthl = \"Folded\",\r\n\t\t\t\t}\r\n\t\t\tend\r\n\t\tend)\r\n\t\t-- Left: mark or non-git sign\r\n\t\tcomponents[1] = icon(get_mark(buf, vim.v.lnum) or left)\r\n\t\t-- Right: fold icon or git sign (only if file)\r\n\t\tcomponents[3] = is_file and icon(fold or right) or \"\"\r\n\tend\r\n\r\n\t-- Numbers in Neovim are weird\r\n\t-- They show when either number or relativenumber is true\r\n\tlocal is_num = vim.wo[win].number\r\n\tlocal is_relnum = vim.wo[win].relativenumber\r\n\tif (is_num or is_relnum) and vim.v.virtnum == 0 then\r\n\t\tif vim.v.relnum == 0 then\r\n\t\t\tcomponents[2] = is_num and \"%l\" or \"%r\" -- the current line\r\n\t\telse\r\n\t\t\tcomponents[2] = is_relnum and \"%r\" or \"%l\" -- other lines\r\n\t\tend\r\n\t\tcomponents[2] = \"%=\" .. components[2] .. \" \" -- right align\r\n\tend\r\n\r\n\treturn table.concat(components, \"\")\r\nend\r\n\r\n-- TODO: this is important\r\nvim.opt.statuscolumn = [[%!v:lua.Statuscolumn()]]\r\n\r\n-- we need mini.hipatterns to add icons as sign text\r\nrequire(\"lazy\").setup({\r\n\t{\r\n\t\t\"echasnovski/mini.hipatterns\",\r\n\t\tconfig = function()\r\n\t\t\tlocal mini_hipatterns = require(\"mini.hipatterns\")\r\n\t\t\tif mini_hipatterns then\r\n\t\t\t\tlocal keywords = { \"NOTE\", \"BUG\", \"LOVE\", \"TODO\", \"TEST\", \"FIX\" }\r\n\t\t\t\tlocal icons = { \"󱑴\", \"󱑬\", \"󱑭\", \"󱑯\", \"󱑱\" }\r\n\t\t\t\tlocal highlighters = {}\r\n\t\t\t\tfor _, keyword in ipairs(keywords) do\r\n\t\t\t\t\tlocal lowerKeyword = string.lower(keyword)\r\n\t\t\t\t\thighlighters[lowerKeyword] = {\r\n\t\t\t\t\t\tpattern = string.format(\"%s:\", keyword),\r\n\t\t\t\t\t\tgroup = \"IncSearch\",\r\n\t\t\t\t\t\textmark_opts = {\r\n\t\t\t\t\t\t\tsign_text = icons[_],\r\n\t\t\t\t\t\t\tsign_hl_group = \"IncSearch\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t\thighlighters[string.format(\"%s_trail\", lowerKeyword)] = {\r\n\t\t\t\t\t\tpattern = string.format(\"%s: ()%%S+.*()\", keyword),\r\n\t\t\t\t\t\tgroup = \"IncSearch\",\r\n\t\t\t\t\t}\r\n\t\t\t\tend\r\n\r\n\t\t\t\tmini_hipatterns.setup({ highlighters = highlighters })\r\n\t\t\tend\r\n\t\tend,\r\n\t},\r\n}, {})\r\n\r\nvim.wo.number = true\r\nvim.o.undofile = true\r\nvim.wo.signcolumn = \"yes\"\r\nvim.o.termguicolors = true\r\n\r\n```\r\n</details>\r\n\r\n4. Edit the file `:e init.lua`.\r\n5. Enter insert mode and write multiple TODOs in different lines (around 5 or six with multiple lines).\r\n6. Visual select all those TODOs and delete them all at once.\r\n7. The issue should occur.\r\n\r\nNote1: If the issue doesn't occur, try writing multiple far away TODOs and then visually selecting and deleting them.\r\n\r\nNote2: If the highlight doesn't have an sign text icon like `FIX:`, the issue won't happen. For example, writing `FIX: sometext` which doesn't have a sign text icon will not trigger the issue.\r\n\r\nNote3: The code section may seem lengthy, but it comprises only two main parts:\r\nOne: The LazyVim distro's minimal/simple implementation of statuscol, resembling the statuscol plugin.\r\nSecond: Mini.hipatterns plugin, responsible for adding sign text icons and highlights.\r\n\r\nNote4: in my own configuration, it doesn't happen like this, but it was so random, when sometimes I try to comment out some highlighted text that has icon sign text.\r\n\r\nI apologize for the non-perfect minimal repro, considering the randomness of this issue, this is the best I could do.\r\n\r\nhttps://github.com/neovim/neovim/assets/105807570/63d2c647-261b-4343-aa67-d39cf3ce4027\r\n\r\n\r\n(video shows that if only a couple of TODOs are deleted, the issue won't occur, but if multiple are deleted, it will happen).\r\n\r\nLet me know if you need further clarification.",
            "created_at": "2024-02-20T19:56:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1954956587",
            "id": 1954956587,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM50hkUr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954956587/reactions"
            },
            "updated_at": "2024-02-20T19:56:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954956587",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/105807570?v=4",
                "events_url": "https://api.github.com/users/bassamsdata/events{/privacy}",
                "followers_url": "https://api.github.com/users/bassamsdata/followers",
                "following_url": "https://api.github.com/users/bassamsdata/following{/other_user}",
                "gists_url": "https://api.github.com/users/bassamsdata/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bassamsdata",
                "id": 105807570,
                "login": "bassamsdata",
                "node_id": "U_kgDOBk5-0g",
                "organizations_url": "https://api.github.com/users/bassamsdata/orgs",
                "received_events_url": "https://api.github.com/users/bassamsdata/received_events",
                "repos_url": "https://api.github.com/users/bassamsdata/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bassamsdata/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bassamsdata/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bassamsdata"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks @bassamsdata, I was able to reproduce. In the repro, immediately after deleting, more (paired) signs than actually present in the buffer are counted in the marktree iteration:\r\nhttps://github.com/neovim/neovim/blob/9bb046d1be5aa9ba0482b2cad050b286d4b78978/src/nvim/decoration.c#L800-L824\r\n\r\nThus incorrectly incrementing `b_signcols.count[<wrong>]`. After the deletion, when a callback deletes a sign, the correct number of signs is counted, and `b_signcols.count[<correct>]` is decremented below 0.\r\n\r\nI'm not sure if this is a bug in the marktree state/API after deleting, or if its used incorrectly @bfredl.",
            "created_at": "2024-02-21T03:06:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1955793606",
            "id": 1955793606,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM50kwrG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1955793606/reactions"
            },
            "updated_at": "2024-02-21T12:49:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1955793606",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Here is a test case which shows an unexpected amount of signs in the screen state and crashes upon deleting a sign.\r\n\r\n```lua\r\n  it('correct number of signs after deleting text(#27046)', function()\r\n    command('call setline(1, [\"foo\"]->repeat(31))')\r\n    api.nvim_buf_set_extmark(0, ns, 0, 0, {end_row = 0, sign_text = 'S1'})\r\n    api.nvim_buf_set_extmark(0, ns, 0, 0, {end_row = 0, end_col = 3, hl_group = 'Error'})\r\n    api.nvim_buf_set_extmark(0, ns, 9, 0, {end_row = 9,  sign_text = 'S2'})\r\n    api.nvim_buf_set_extmark(0, ns, 9, 0, {end_row = 9, end_col = 3, hl_group = 'Error'})\r\n    api.nvim_buf_set_extmark(0, ns, 19, 0, {end_row = 19, sign_text = 'S3'})\r\n    api.nvim_buf_set_extmark(0, ns, 19, 0, {end_row = 19, end_col = 3, hl_group = 'Error'})\r\n    api.nvim_buf_set_extmark(0, ns, 29, 0, {end_row = 29, sign_text = 'S4'})\r\n    api.nvim_buf_set_extmark(0, ns, 29, 0, {end_row = 29, end_col = 3, hl_group = 'Error'})\r\n    api.nvim_buf_set_extmark(0, ns, 30, 0, {end_row = 30, sign_text = 'S5'})\r\n    api.nvim_buf_set_extmark(0, ns, 30, 0, {end_row = 30, end_col = 3, hl_group = 'Error'})\r\n    command('0d29')\r\n\r\n    screen:expect{grid=[[\r\n      S1S3S4{4:^foo}                                 |\r\n      S5{1:      }{4:foo}                                 |\r\n      {2:~                                                 }|*7\r\n      29 fewer lines                                    |\r\n    ]]}\r\n    api.nvim_buf_clear_namespace(0, ns, 0, -1)\r\n  end)\r\n```",
            "created_at": "2024-02-21T12:30:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1956548488",
            "id": 1956548488,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM50no-I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1956548488/reactions"
            },
            "updated_at": "2024-02-21T12:57:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1956548488",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks to all of you for investigating what happened here. ",
            "created_at": "2024-02-23T21:07:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/27046#issuecomment-1961989996",
            "id": 1961989996,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27046",
            "node_id": "IC_kwDOAPphoM508Zds",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1961989996/reactions"
            },
            "updated_at": "2024-02-23T21:07:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1961989996",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        }
    ],
    "comments": 19,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27046/comments",
    "created_at": "2024-01-16T16:50:20Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27046/events",
    "html_url": "https://github.com/neovim/neovim/issues/27046",
    "id": 2084427221,
    "labels": [
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "extmarks, decorations, virtual text, namespaces",
            "id": 1680119719,
            "name": "extmarks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/extmarks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27046/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 301,
        "created_at": "2023-02-02T14:11:43Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
            "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
            "followers_url": "https://api.github.com/users/bfredl/followers",
            "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
            "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/bfredl",
            "id": 1363104,
            "login": "bfredl",
            "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
            "organizations_url": "https://api.github.com/users/bfredl/orgs",
            "received_events_url": "https://api.github.com/users/bfredl/received_events",
            "repos_url": "https://api.github.com/users/bfredl/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/bfredl"
        },
        "description": "",
        "due_on": "2024-04-01T07:00:00Z",
        "html_url": "https://github.com/neovim/neovim/milestone/36",
        "id": 8997654,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/36/labels",
        "node_id": "MI_kwDOAPphoM4AiUsW",
        "number": 36,
        "open_issues": 132,
        "state": "open",
        "title": "0.10",
        "updated_at": "2024-02-26T17:33:18Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/36"
    },
    "node_id": "I_kwDOAPphoM58PdXV",
    "number": 27046,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 3,
        "-1": 0,
        "confused": 0,
        "eyes": 2,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 5,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27046/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27046/timeline",
    "title": "Assertion `buf->b_signcols.count[width - 1] >= 0` failed",
    "updated_at": "2024-02-23T21:07:17Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27046",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
        "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
        "followers_url": "https://api.github.com/users/przepompownia/followers",
        "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
        "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/przepompownia",
        "id": 11404453,
        "login": "przepompownia",
        "node_id": "MDQ6VXNlcjExNDA0NDUz",
        "organizations_url": "https://api.github.com/users/przepompownia/orgs",
        "received_events_url": "https://api.github.com/users/przepompownia/received_events",
        "repos_url": "https://api.github.com/users/przepompownia/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/przepompownia"
    }
}
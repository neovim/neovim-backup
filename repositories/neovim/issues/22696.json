{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nLinematch and diffget do not work correctly together. I use diffget to resolve merge conflicts, and with this new diffopt option, I'm not getting the expected behavior.\r\n\r\n\r\nSince merging is a complicated mess, I tried to record what I mean in a 17second gif: \r\n\r\n![not working as I expected](https://user-images.githubusercontent.com/31679231/225777696-224cf679-eaa6-404a-8a6e-75c3782a0f21.gif)\r\n\r\n\r\n### Steps to reproduce\r\n\r\nGenerally:\r\n\r\n1. Have a merge conflict and start with `nvim -d`\r\n2. Set diffopt+=linematch:50\r\n3. Try to use :diffget <buffer num/name>\r\n\r\nI see that diffget does not resolve a merge conflict as I expected.\r\n\r\n### Expected behavior\r\n\r\nWith the default options of diffopt, using diffget with `nvim -d`, I can resolve merge conflicts, but not with linematch appened to diffopt.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.9.0-dev-2446+g995196c61-dirty\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNo, as linematch is not implmented yet: https://github.com/vim/vim/pull/9661\r\n\r\n### Operating system/version\r\n\r\nmacOS 13.2.1\r\n\r\n### Terminal name/version\r\n\r\nkitty\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbrew\r\n\r\nrelated to #14537 and perhaps  #20931",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "@jwhite510. Do you know why this might be?",
            "created_at": "2023-03-17T09:50:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/22696#issuecomment-1473553721",
            "id": 1473553721,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22696",
            "node_id": "IC_kwDOAPphoM5X1KU5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1473553721/reactions"
            },
            "updated_at": "2023-03-17T09:50:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1473553721",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@SeniorMars \r\n@lewis6991 \r\nSorry, I did not see this until now\r\n\r\nlinematch with diffget looks like it's working as I'd expect.\r\n\r\nAs the differences are more granular, the 'diffget' and 'diffput' operations\r\nbehave accordingly.\r\n\r\nThe difference when it comes to 'diffget' and 'diffput' operations is that this\r\nconflict is no longer treated as a single diff, it is now 6 diffs, stacked on\r\ntop of each other\r\n```\r\n  BUFFER 1   BUFFER 2   BUFFER 3  BUFFER 4\r\n----------------------------------------------\r\n           |           |       |<<<<<< HEAD     DIFF 1\r\n-----------|-----------|-------|--------------\r\nrabbits    |           |       |rabbits         DIFF 2\r\nlions      |           |       |lions\r\n-----------|-----------|-------|--------------\r\nsalamanders|salamanders|       |salamanders     DIFF 3\r\n-----------|-----------|-------|--------------\r\n           |           |       |======          DIFF 4\r\n-----------|-----------|-------|--------------\r\n           |           |Monkeys|Monkeys         DIFF 5\r\n-----------|-----------|-------|--------------\r\n\t   |           |       | >>>>>> monkey  DIFF 6\r\n----------------------------------------------\r\n```\r\nwhen you have the cursor in buffer 4 and call a :diffget from buffer 3, it is getting\r\nit, and it is non existent, so you see that just the '<<<<< HEAD' is erased.\r\n\r\nI believe the behaviour you are looking for can be obtained by first visually\r\nselecting the entire conflict (buffer 4 in my diagram), and then typing\r\n:diffget buffer 3\r\n\r\nlike this:\r\n\r\n:'<,'>diffget ...\r\n\r\nso that diffget will be applied to each diff (all 6) in the visual selection\r\n\r\nwhen you disable linematch, the entire thing is one diff, and diffget will get\r\nthe whole content because it is just one diff, you don't have to visually\r\nselect it\r\n",
            "created_at": "2023-04-12T12:33:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/22696#issuecomment-1505197091",
            "id": 1505197091,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22696",
            "node_id": "IC_kwDOAPphoM5Zt3wj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1505197091/reactions"
            },
            "updated_at": "2023-04-12T12:33:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1505197091",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/32371757?v=4",
                "events_url": "https://api.github.com/users/jwhite510/events{/privacy}",
                "followers_url": "https://api.github.com/users/jwhite510/followers",
                "following_url": "https://api.github.com/users/jwhite510/following{/other_user}",
                "gists_url": "https://api.github.com/users/jwhite510/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jwhite510",
                "id": 32371757,
                "login": "jwhite510",
                "node_id": "MDQ6VXNlcjMyMzcxNzU3",
                "organizations_url": "https://api.github.com/users/jwhite510/orgs",
                "received_events_url": "https://api.github.com/users/jwhite510/received_events",
                "repos_url": "https://api.github.com/users/jwhite510/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jwhite510/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jwhite510/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jwhite510",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I'm here from using `git mergetool` with `nvimdiff`. Now `diffopt` includes `linematch:40` as a default in 0.11, it's broken for the reasons explained above.\n\nWould it make sense to disable this default if using `nvim` in `nvimdiff`? I'm not actually sure how git defines nvimdiff since it [does not seem to pass the `-d` arg](https://vi.stackexchange.com/questions/45083/check-for-diff-mode-while-using-git-mergetool).\n\nWith manual override:\n\n```\n[mergetool \"nvimdiff\"]\n    cmd = nvim -d -c '4wincmd w | wincmd J' \\\"$LOCAL\\\" \\\"$BASE\\\" \\\"$REMOTE\\\" \\\"$MERGED\\\"\n```\n\nand in init.lua:\n\n```\nif vim.opt.diff:get() then\n  vim.o.diffopt = 'internal,filler,closeoff'\nend\n```\n\nI have fixed this in my config but I imagine more people will encounter this as 0.11 deploys.\n\nedit: could also add `-c \\\"set diffopt-=linematch:40\\\"` to nvimdiff override and nothing in init.lua.",
            "created_at": "2025-04-11T10:43:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/22696#issuecomment-2796545495",
            "id": 2796545495,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22696",
            "node_id": "IC_kwDOAPphoM6mr-XX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796545495/reactions"
            },
            "updated_at": "2025-04-11T10:51:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796545495",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1886746?v=4",
                "events_url": "https://api.github.com/users/tuna-f1sh/events{/privacy}",
                "followers_url": "https://api.github.com/users/tuna-f1sh/followers",
                "following_url": "https://api.github.com/users/tuna-f1sh/following{/other_user}",
                "gists_url": "https://api.github.com/users/tuna-f1sh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tuna-f1sh",
                "id": 1886746,
                "login": "tuna-f1sh",
                "node_id": "MDQ6VXNlcjE4ODY3NDY=",
                "organizations_url": "https://api.github.com/users/tuna-f1sh/orgs",
                "received_events_url": "https://api.github.com/users/tuna-f1sh/received_events",
                "repos_url": "https://api.github.com/users/tuna-f1sh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tuna-f1sh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tuna-f1sh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tuna-f1sh",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Looking at git source, a the `-c \\\"set diffopt-=linematch:40\\\"` could be added to https://github.com/git/git/blob/485f5f863615e670fd97ae40af744e14072cfe18/mergetools/vimdiff#L491. Would get messy if the nvim default changes again though.\n\nI guess open to debate where this should be fixed. I would learn towards keeping it compatible with vim so in nvim. I'm not sure how to tell when the git nvimdiff script is calling `nvim` though. I don't see anything obvious in https://github.com/git/git/blob/485f5f863615e670fd97ae40af744e14072cfe18/mergetools/vimdiff#L375",
            "created_at": "2025-04-11T12:46:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/22696#issuecomment-2796819324",
            "id": 2796819324,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22696",
            "node_id": "IC_kwDOAPphoM6mtBN8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796819324/reactions"
            },
            "updated_at": "2025-04-11T12:46:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796819324",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1886746?v=4",
                "events_url": "https://api.github.com/users/tuna-f1sh/events{/privacy}",
                "followers_url": "https://api.github.com/users/tuna-f1sh/followers",
                "following_url": "https://api.github.com/users/tuna-f1sh/following{/other_user}",
                "gists_url": "https://api.github.com/users/tuna-f1sh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tuna-f1sh",
                "id": 1886746,
                "login": "tuna-f1sh",
                "node_id": "MDQ6VXNlcjE4ODY3NDY=",
                "organizations_url": "https://api.github.com/users/tuna-f1sh/orgs",
                "received_events_url": "https://api.github.com/users/tuna-f1sh/received_events",
                "repos_url": "https://api.github.com/users/tuna-f1sh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tuna-f1sh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tuna-f1sh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tuna-f1sh",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22696/comments",
    "created_at": "2023-03-16T23:57:08Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22696/events",
    "html_url": "https://github.com/neovim/neovim/issues/22696",
    "id": 1628479861,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim defaults for options, colorscheme/theme, autocmds/events, etc.",
            "id": 103777064,
            "name": "defaults",
            "node_id": "MDU6TGFiZWwxMDM3NzcwNjQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/defaults"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 3010934759,
            "name": "diff",
            "node_id": "MDU6TGFiZWwzMDEwOTM0NzU5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/diff"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "configuration, settings",
            "id": 4242493821,
            "name": "options",
            "node_id": "LA_kwDOAPphoM7831F9",
            "url": "https://api.github.com/repos/neovim/neovim/labels/options"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22696/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 726,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 630,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-07-07T03:51:31Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM5hEKF1",
    "number": 22696,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 3,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 3,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22696/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22696/timeline",
    "title": "Linematch, diffopt, and diffget/put not working as expected.",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:38:03Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22696",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/31679231?v=4",
        "events_url": "https://api.github.com/users/SeniorMars/events{/privacy}",
        "followers_url": "https://api.github.com/users/SeniorMars/followers",
        "following_url": "https://api.github.com/users/SeniorMars/following{/other_user}",
        "gists_url": "https://api.github.com/users/SeniorMars/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/SeniorMars",
        "id": 31679231,
        "login": "SeniorMars",
        "node_id": "MDQ6VXNlcjMxNjc5MjMx",
        "organizations_url": "https://api.github.com/users/SeniorMars/orgs",
        "received_events_url": "https://api.github.com/users/SeniorMars/received_events",
        "repos_url": "https://api.github.com/users/SeniorMars/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/SeniorMars/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SeniorMars/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/SeniorMars",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nIf `init.vim` or other initialization code causes a popup with a blocking user input, then the colorscheme is not properly applied. The behaviour is different depending on which colorscheme one uses and the default colorscheme does not work as expected.\n\nSee related discussions and threads here:\n\n* https://github.com/lervag/vimtex/discussions/3173\n* https://github.com/lervag/vimtex/issues/3183 (I believe this is related, but not sure)\n\n### Steps to reproduce\n\nRun `nvim --clean -u test.vim` with the following `test.vim` input:\n\n```vim\nsyntax enable\n\nfunction! Select(list) abort\n  let l:content = ['prompt', '']\n  let l:i = 0\n  for l:x in a:list\n    let l:i += 1\n    call add(l:content, printf('%d: %s', l:i, type(l:x) == v:t_dict ? l:x.name : l:x))\n  endfor\n\n  let l:content = map(\n        \\ [''] + deepcopy(l:content),\n        \\ { _, x -> empty(x) ? x : repeat(' ', 1) . x }\n        \\)\n\n  \" Create and fill the buffer\n  let l:bufnr = nvim_create_buf(v:false, v:true)\n  call nvim_buf_set_lines(l:bufnr, 0, -1, v:false, l:content)\n  call nvim_buf_set_option(l:bufnr, 'buftype', 'nofile')\n\n  \" Create popup window\n  let l:winopts = #{\n        \\ width: 30,\n        \\ height: 10,\n        \\ style: \"minimal\",\n        \\ noautocmd: v:true,\n        \\ relative: 'win',\n        \\ row: (winheight(0) - 10)/3,\n        \\ col: (winwidth(0) - 30)/2\n        \\}\n  call nvim_open_win(l:bufnr, v:true, l:winopts)\n  redraw!\n\n  let l:value = [-1, '']\n  while v:true\n    try\n      let l:length = len(a:list)\n      let l:choice = nr2char(getchar())\n\n      if l:choice !~# '\\d' | continue | endif\n      let l:choice -= 1\n\n      if l:choice >= 0 && l:choice < l:length\n        let l:value = [l:choice, a:list[l:choice]]\n        break\n      endif\n    endtry\n  endwhile\n\n  close\n  call nvim_buf_delete(l:bufnr, #{force: v:true})\n\n  return l:value\nendfunction\n\n\"colorscheme vim\n\nechom Select(['hello', 'world'])\n```\n\n### Expected behavior\n\nThe popup after `:echom Select...` should be drawn with the expected background and colors applied. This does work as expected if one runs e.g. `:echom Select([1, 2])` after neovim has started properly.\n\nThe expected behaviour _is_ observed (more or less) if we use the `vim` colorscheme, and most of the other colorschemes. However, it seems that only parts of the highlighting rules are loaded.\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-545+gcb4559bc32\n\n### Vim (not Nvim) behaves the same?\n\nNot relevant: We rely on neovim only APIs.\n\n### Operating system/version\n\nArch Linux\n\n### Terminal name/version\n\nwezterm 20240203-110809-5046fc22\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nneovim-git from AUR",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "I tested in different terminals. In xterm and rxvt-unicode the behaviour is the same. In Kitty, the popup is not even displayed (typing 1 or 2 will close the popup and let neovim fully load). Subsequent calls of the `Select` function works as expected. But the behaviour with Kitty confirms that the present issue is directly relevant also for https://github.com/lervag/vimtex/issues/3183.",
            "created_at": "2025-06-15T18:18:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/34516#issuecomment-2974484947",
            "id": 2974484947,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34516",
            "node_id": "IC_kwDOAPphoM6xSwnT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2974484947/reactions"
            },
            "updated_at": "2025-06-15T18:18:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2974484947",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/998898?v=4",
                "events_url": "https://api.github.com/users/lervag/events{/privacy}",
                "followers_url": "https://api.github.com/users/lervag/followers",
                "following_url": "https://api.github.com/users/lervag/following{/other_user}",
                "gists_url": "https://api.github.com/users/lervag/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lervag",
                "id": 998898,
                "login": "lervag",
                "node_id": "MDQ6VXNlcjk5ODg5OA==",
                "organizations_url": "https://api.github.com/users/lervag/orgs",
                "received_events_url": "https://api.github.com/users/lervag/received_events",
                "repos_url": "https://api.github.com/users/lervag/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lervag/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lervag/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lervag",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Related #25377",
            "created_at": "2025-06-16T03:01:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/34516#issuecomment-2974964266",
            "id": 2974964266,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34516",
            "node_id": "IC_kwDOAPphoM6xUloq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2974964266/reactions"
            },
            "updated_at": "2025-06-16T03:01:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2974964266",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34516/comments",
    "created_at": "2025-06-15T18:10:10Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34516/events",
    "html_url": "https://github.com/neovim/neovim/issues/34516",
    "id": 3147906836,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 113026979,
            "name": "ui",
            "node_id": "MDU6TGFiZWwxMTMwMjY5Nzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "startup, shutdown, attach, detach",
            "id": 870629450,
            "name": "lifecycle",
            "node_id": "MDU6TGFiZWw4NzA2Mjk0NTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lifecycle"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34516/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 283,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 328,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-06-16T11:54:24Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM67oT8U",
    "number": 34516,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34516/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34516/timeline",
    "title": "Colorscheme not applied when expected if a popup with blocking input is opened during init.vim",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-16T11:54:24Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34516",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/998898?v=4",
        "events_url": "https://api.github.com/users/lervag/events{/privacy}",
        "followers_url": "https://api.github.com/users/lervag/followers",
        "following_url": "https://api.github.com/users/lervag/following{/other_user}",
        "gists_url": "https://api.github.com/users/lervag/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lervag",
        "id": 998898,
        "login": "lervag",
        "node_id": "MDQ6VXNlcjk5ODg5OA==",
        "organizations_url": "https://api.github.com/users/lervag/orgs",
        "received_events_url": "https://api.github.com/users/lervag/received_events",
        "repos_url": "https://api.github.com/users/lervag/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lervag/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lervag/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lervag",
        "user_view_type": "public"
    }
}
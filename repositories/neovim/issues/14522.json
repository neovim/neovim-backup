{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "<!-- Before reporting: search existing issues and check the FAQ. -->\r\n\r\n- `nvim --version`: : NVIM v0.5.0-dev+1302-g8a93d1028\r\n\r\n### Steps to reproduce using `nvim -u NORC`\r\n\r\n```\r\n\" s.vim\r\nfunction MyDiff()\r\n  \" Circumvent https://github.com/neovim/neovim/blob/1186f7dd96b054d6a653685089fc845a8f5d2f27/src/nvim/diff.c#L985-L992\r\n  if match(readfile(v:fname_in),\"line1\") != -1\r\n    silent execute \"!diff \" . v:fname_in . \" \" . v:fname_new . \" > \" . v:fname_out\r\n  else\r\n    silent execute \"!cat eddiff \" . \" > \" . v:fname_out\r\n  endif\r\nendfunction\r\nset diffexpr=MyDiff()\r\n```\r\n```\r\n# eddiff\r\n1d0\r\n< 2021-05-01 Entry #1\r\n1a1\r\n> 2021-05-02 Entry #2\r\n2d1\r\n< 2021-05-03 Entry #3\r\n```\r\n```\r\n# left.txt\r\n2021-05-01 Entry #1\r\n2021-05-03 Entry #3\r\n```\r\n```\r\n# right.txt\r\n2021-05-02 Entry #2\r\n```\r\n\r\n```\r\nnvim -u NORC -O left.txt right.txt\r\n:source s.vim\r\n:windo diffthis\r\n```\r\n\r\n### Actual behaviour\r\n![grafik](https://user-images.githubusercontent.com/722385/117581748-b59bcb00-b0fe-11eb-94cb-627e7d1dec7c.png)\r\n\r\n\r\n### Expected behaviour\r\n\r\nThe hungs should be sorted by date in vim's display:\r\n```\r\n2021-05-01 Entry #1  |\r\n                     | 2021-05-02 Entry #2 \r\n2021-05-03 Entry #3  |\r\n```\r\n\r\n### Notes\r\n\r\nIf this expected behaviour is unconvincing, then I can produce even worse cases where valid ed hunks lead to surprising behaviours.\r\n\r\nThe problem is that Neovim doesn't seem to correctly handle Ed hunks that are adjacent to each other, that is, Neovim would only correctly handle the diff as:\r\n\r\n```\r\n1,2c1\r\n< 2021-05-01 Entry #1\r\n< 2021-05-03 Entry #3\r\n---\r\n> 2021-05-02 Entry #2\r\n```\r\n\r\nUnfortunately, that expectation prevents some potentially valid inputs that would give more information about the hunk order and granularity.\r\n\r\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Part of the problem is as follows. Vim's diff code assumes that diff hunks have at least one line of separation between them, however, vim does not validate that the external diff file it consumes satisfies that property.\r\n\r\nThen when [`diff_check`](https://github.com/neovim/neovim/blob/1186f7dd96b054d6a653685089fc845a8f5d2f27/src/nvim/diff.c#L1741-L1754) outputs how to treat each line, it goes wrong, because of that assumption.\r\n\r\n",
            "created_at": "2021-05-24T07:45:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/14522#issuecomment-846843696",
            "id": 846843696,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14522",
            "node_id": "MDEyOklzc3VlQ29tbWVudDg0Njg0MzY5Ng==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/846843696/reactions"
            },
            "updated_at": "2021-05-24T07:45:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/846843696",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/722385?v=4",
                "events_url": "https://api.github.com/users/gregorias/events{/privacy}",
                "followers_url": "https://api.github.com/users/gregorias/followers",
                "following_url": "https://api.github.com/users/gregorias/following{/other_user}",
                "gists_url": "https://api.github.com/users/gregorias/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gregorias",
                "id": 722385,
                "login": "gregorias",
                "node_id": "MDQ6VXNlcjcyMjM4NQ==",
                "organizations_url": "https://api.github.com/users/gregorias/orgs",
                "received_events_url": "https://api.github.com/users/gregorias/received_events",
                "repos_url": "https://api.github.com/users/gregorias/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gregorias/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gregorias/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gregorias",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/14522/comments",
    "created_at": "2021-05-09T17:49:02Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/14522/events",
    "html_url": "https://github.com/neovim/neovim/issues/14522",
    "id": 882598889,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 3010934759,
            "name": "diff",
            "node_id": "MDU6TGFiZWwzMDEwOTM0NzU5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/diff"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/14522/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4ODI1OTg4ODk=",
    "number": 14522,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/14522/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/14522/timeline",
    "title": "Neovim doesn't correctly handle ed-style diffs",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:36:01Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/14522",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/722385?v=4",
        "events_url": "https://api.github.com/users/gregorias/events{/privacy}",
        "followers_url": "https://api.github.com/users/gregorias/followers",
        "following_url": "https://api.github.com/users/gregorias/following{/other_user}",
        "gists_url": "https://api.github.com/users/gregorias/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gregorias",
        "id": 722385,
        "login": "gregorias",
        "node_id": "MDQ6VXNlcjcyMjM4NQ==",
        "organizations_url": "https://api.github.com/users/gregorias/orgs",
        "received_events_url": "https://api.github.com/users/gregorias/received_events",
        "repos_url": "https://api.github.com/users/gregorias/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gregorias/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gregorias/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gregorias",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nRecently, Neovim implemented DEC mode 2031 so that the terminal theme (dark/light) would remain synchronized with the outer terminal.\n\nThis works, but doesn't propagate to any application running within Neovim's embedded terminal, including nested Neovim instances.\n\ncc: @gpanders\n\n### Expected behavior\n\nApplications within the embedded terminal should be able to enable mode 2031 and receive notifications when the background color of Neovim (or the outer terminal) change, and these applications should be able to query the foreground/background color.",
    "closed_at": "2025-01-14T14:19:00Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
        "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
        "followers_url": "https://api.github.com/users/gpanders/followers",
        "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
        "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gpanders",
        "id": 8965202,
        "login": "gpanders",
        "node_id": "MDQ6VXNlcjg5NjUyMDI=",
        "organizations_url": "https://api.github.com/users/gpanders/orgs",
        "received_events_url": "https://api.github.com/users/gpanders/received_events",
        "repos_url": "https://api.github.com/users/gpanders/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gpanders",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "You can define a `OptionSet background` event handler which uses `nvim_chan_send()` to send a sequence to the `:terminal` buffer. Perhaps Nvim should do that by default (whenever 'background' is set). That would also make this work implicitly for GUIs, colorschemes, etc., that set 'bg'.\n\nIf Nvim did this only when its host-terminal sent a theme event, that would introduce a feature gap for Nvim GUIs.",
            "created_at": "2024-12-20T10:53:52Z",
            "html_url": "https://github.com/neovim/neovim/issues/31652#issuecomment-2556762851",
            "id": 2556762851,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31652",
            "node_id": "IC_kwDOAPphoM6YZRrj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2556762851/reactions"
            },
            "updated_at": "2024-12-20T11:00:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2556762851",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@justinmk, I'm not sure it can be done with `nvim_chan_send()`. The sequence should only be sent to the terminal if the application running within the terminal enabled mode 2031. And it should probably be done as a response to a change of the 'bg' setting, regardless of whether or not 'bg' was updated because the host terminal notified nvim for a theme update.",
            "created_at": "2025-01-07T09:54:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/31652#issuecomment-2574853791",
            "id": 2574853791,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31652",
            "node_id": "IC_kwDOAPphoM6ZeSaf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2574853791/reactions"
            },
            "updated_at": "2025-01-07T09:54:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2574853791",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/216638?v=4",
                "events_url": "https://api.github.com/users/jonathanslenders/events{/privacy}",
                "followers_url": "https://api.github.com/users/jonathanslenders/followers",
                "following_url": "https://api.github.com/users/jonathanslenders/following{/other_user}",
                "gists_url": "https://api.github.com/users/jonathanslenders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jonathanslenders",
                "id": 216638,
                "login": "jonathanslenders",
                "node_id": "MDQ6VXNlcjIxNjYzOA==",
                "organizations_url": "https://api.github.com/users/jonathanslenders/orgs",
                "received_events_url": "https://api.github.com/users/jonathanslenders/received_events",
                "repos_url": "https://api.github.com/users/jonathanslenders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jonathanslenders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jonathanslenders",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The sequence should only be sent to the terminal if the application running within the terminal enabled mode 2031. \n\n`:help TermRequest`\n\n> And it should probably be done as a response to a change of the 'bg' setting\n\nHandle the `OptionSet background` event as I mentioned.",
            "created_at": "2025-01-07T12:29:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/31652#issuecomment-2575162589",
            "id": 2575162589,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31652",
            "node_id": "IC_kwDOAPphoM6Zfdzd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2575162589/reactions"
            },
            "updated_at": "2025-01-07T12:29:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2575162589",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> > The sequence should only be sent to the terminal if the application running within the terminal enabled mode 2031.\n> \n> `:help TermRequest`\n> \n\nThis won't work today since TermRequest only fires for OSC and DSC commands, while enabling a DEC mode is a CSI command.\n\nvterm has an option to call a callback for \"unknown\" CSIs, which we could quite easily hook up to TermRequest. The only difficulty there is documenting what exactly is an \"unknown\" CSI (the short answer is basically, \"whatever vterm doesn't handle itself\" but that's not very useful).\n\nEDIT: Ah actually it looks like vterm _does_ handle the DECSET/DECRESET command, so using TermRequest here would be a lot more complex. Let me look into this and see how we can propagate this.\n\nhttps://github.com/neovim/neovim/pull/31916 will make this possible with TermRequest. We can leave this issue open to track adding this as a default autocommand.\n\n",
            "created_at": "2025-01-08T16:39:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/31652#issuecomment-2578127646",
            "id": 2578127646,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31652",
            "node_id": "IC_kwDOAPphoM6Zqxse",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2578127646/reactions"
            },
            "updated_at": "2025-01-08T17:19:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2578127646",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31652/comments",
    "created_at": "2024-12-20T10:36:55Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31652/events",
    "html_url": "https://github.com/neovim/neovim/issues/31652",
    "id": 2752444263,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31652/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6kDvdn",
    "number": 31652,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31652/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31652/timeline",
    "title": ":terminal doesn't propagate DEC mode 2031 (for reporting dark/light mode)",
    "updated_at": "2025-01-17T15:33:20Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31652",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/216638?v=4",
        "events_url": "https://api.github.com/users/jonathanslenders/events{/privacy}",
        "followers_url": "https://api.github.com/users/jonathanslenders/followers",
        "following_url": "https://api.github.com/users/jonathanslenders/following{/other_user}",
        "gists_url": "https://api.github.com/users/jonathanslenders/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jonathanslenders",
        "id": 216638,
        "login": "jonathanslenders",
        "node_id": "MDQ6VXNlcjIxNjYzOA==",
        "organizations_url": "https://api.github.com/users/jonathanslenders/orgs",
        "received_events_url": "https://api.github.com/users/jonathanslenders/received_events",
        "repos_url": "https://api.github.com/users/jonathanslenders/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jonathanslenders/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jonathanslenders",
        "user_view_type": "public"
    }
}
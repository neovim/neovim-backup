{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Neovim version (nvim -v)\r\n\r\nNVIM v0.6.0-dev+463-g68b2a9e56\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nN/A (pretty sure the pathing code diverged a long time ago)\r\n\r\n### Operating system/version\r\n\r\nWidnows 10\r\n\r\n### Terminal name/version\r\n\r\nWindows Termianal\r\n\r\n### $TERM environment variable\r\n\r\nN/A\r\n\r\n### Installation\r\n\r\nsource build\r\n\r\n### How to reproduce the issue\r\n\r\n```lua\r\nfile_location = os.getenv('TEMP')\r\n\r\nlocal file_1 = file_location .. \"\\\\file_1.txt\"\r\nlocal buffer_1 = vim.fn.bufadd(file_1)\r\nprint(vim.api.nvim_buf_get_name(buffer_1))\r\n\r\nlocal drive_letter = string.sub(file_location, 1, 1)\r\nlocal tail = string.sub(file_location, 2)\r\nlocal perturbed_path = string.lower(drive_letter) .. tail\r\nlocal file_2 = perturbed_path .. \"\\\\file_2.txt\"\r\n\r\nlocal buffer_2 = vim.fn.bufadd(file_2)\r\nprint(vim.api.nvim_buf_get_name(buffer_2))\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nvim.api.nvim_buf_get_name should show consistent capitalization for drive letters on windows regardless of the input to buf_add (which based on the code seems like it depends more on bufadd behavior than buf_get_name)\r\n\r\n### Actual behavior\r\n\r\n```\r\nC:\\Users\\michael\\AppData\\Local\\Temp\\file_1.txt\r\nc:\\Users\\michael\\AppData\\Local\\Temp\\file_2.txt\r\n```",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Does this bug also apply to Vim and Nvim's `bufname()`?",
            "created_at": "2021-11-16T03:36:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/16331#issuecomment-969815712",
            "id": 969815712,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16331",
            "node_id": "IC_kwDOAPphoM45zjag",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/969815712/reactions"
            },
            "updated_at": "2021-11-16T03:36:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/969815712",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "yes, the behavior depends on bufadd, not buf_get_name/bufname",
            "created_at": "2021-11-16T03:40:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/16331#issuecomment-969820528",
            "id": 969820528,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16331",
            "node_id": "IC_kwDOAPphoM45zklw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/969820528/reactions"
            },
            "updated_at": "2021-11-16T03:40:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/969820528",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I don't think this is a neovim (or vim) bug. If `'fileignorecase'` is set properly, [`path_fnamecmp()`](https://github.com/neovim/neovim/blob/c0efe49e78eca3a17a5934cc283199122d081467/src/nvim/path.c#L331) will handle those differences properly. I think that is why `bufadd` does not do capitalization.",
            "created_at": "2021-11-17T11:13:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/16331#issuecomment-971475542",
            "id": 971475542,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16331",
            "node_id": "IC_kwDOAPphoM4554pW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/971475542/reactions"
            },
            "updated_at": "2021-11-17T11:13:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/971475542",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11682285?v=4",
                "events_url": "https://api.github.com/users/erw7/events{/privacy}",
                "followers_url": "https://api.github.com/users/erw7/followers",
                "following_url": "https://api.github.com/users/erw7/following{/other_user}",
                "gists_url": "https://api.github.com/users/erw7/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/erw7",
                "id": 11682285,
                "login": "erw7",
                "node_id": "MDQ6VXNlcjExNjgyMjg1",
                "organizations_url": "https://api.github.com/users/erw7/orgs",
                "received_events_url": "https://api.github.com/users/erw7/received_events",
                "repos_url": "https://api.github.com/users/erw7/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/erw7/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/erw7/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/erw7",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I guess the question is should it then. Currently when we want to compare on the lua side we have to sanitize the drive letter capitalization (which, to be fair, is trivial to do), because buf_get_name returns different values depending on the call to buff_add. I'm just not sure this behavior is intuitive\r\n\r\nsee: \r\n* https://github.com/neovim/nvim-lspconfig/issues/1168",
            "created_at": "2021-11-19T15:10:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/16331#issuecomment-974153509",
            "id": 974153509,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16331",
            "node_id": "IC_kwDOAPphoM46EGcl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/974153509/reactions"
            },
            "updated_at": "2021-11-19T15:10:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/974153509",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I am having the same issue. Different results for different files.\r\n`-- c:\\Users\\hasan\\dotfiles\\nvim\\lua\\options.lua\r\n -- C:\\Users\\hasan\\dotfiles\\nvim\\init.lua\r\n`",
            "created_at": "2022-01-25T10:43:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/16331#issuecomment-1021049794",
            "id": 1021049794,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16331",
            "node_id": "IC_kwDOAPphoM482_vC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1021049794/reactions"
            },
            "updated_at": "2022-01-25T10:43:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1021049794",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38243998?v=4",
                "events_url": "https://api.github.com/users/hasansujon786/events{/privacy}",
                "followers_url": "https://api.github.com/users/hasansujon786/followers",
                "following_url": "https://api.github.com/users/hasansujon786/following{/other_user}",
                "gists_url": "https://api.github.com/users/hasansujon786/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hasansujon786",
                "id": 38243998,
                "login": "hasansujon786",
                "node_id": "MDQ6VXNlcjM4MjQzOTk4",
                "organizations_url": "https://api.github.com/users/hasansujon786/orgs",
                "received_events_url": "https://api.github.com/users/hasansujon786/received_events",
                "repos_url": "https://api.github.com/users/hasansujon786/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hasansujon786/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hasansujon786/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hasansujon786",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Was there any headway into fixing this?  Does it even need fixing?  As I see it, this shouldn't cause any problem.  Sure, `bufadd()` doesn't capitalize drive letter, where is the problem in that?  It's not like when you call `buffadd()` again with the same filename, but this time with different case of drive letter, it opens a new buffer.  No, `bufadd()` behaves sensibly.  It doesn't add a new buffer, even if the second call to `buffadd()` had a different case of drive letter.\r\n\r\nFunny aside: command prompt doesn't sanitize drive letters either.  If you do `cd /d c:\\`, the prompt shows lowercase \"c.\"  If you do `cd /d C:\\`, the prompt shows uppercase \"C.\"  No one cares.",
            "created_at": "2023-03-22T15:28:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/16331#issuecomment-1479781291",
            "id": 1479781291,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16331",
            "node_id": "IC_kwDOAPphoM5YM6ur",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1479781291/reactions"
            },
            "updated_at": "2023-03-22T15:28:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1479781291",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/32037751?v=4",
                "events_url": "https://api.github.com/users/3N4N/events{/privacy}",
                "followers_url": "https://api.github.com/users/3N4N/followers",
                "following_url": "https://api.github.com/users/3N4N/following{/other_user}",
                "gists_url": "https://api.github.com/users/3N4N/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/3N4N",
                "id": 32037751,
                "login": "3N4N",
                "node_id": "MDQ6VXNlcjMyMDM3NzUx",
                "organizations_url": "https://api.github.com/users/3N4N/orgs",
                "received_events_url": "https://api.github.com/users/3N4N/received_events",
                "repos_url": "https://api.github.com/users/3N4N/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/3N4N/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/3N4N/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/3N4N",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/16331/comments",
    "created_at": "2021-11-16T03:28:58Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/16331/events",
    "html_url": "https://github.com/neovim/neovim/issues/16331",
    "id": 1054401088,
    "labels": [
        {
            "color": "d4c5f9",
            "default": false,
            "description": null,
            "id": 109461219,
            "name": "platform:windows",
            "node_id": "MDU6TGFiZWwxMDk0NjEyMTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:windows"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/16331/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM4-2OJA",
    "number": 16331,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/16331/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/16331/timeline",
    "title": "bufadd does not sanitize windows drive letter capitalization",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:38:01Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/16331",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
        "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
        "followers_url": "https://api.github.com/users/mjlbach/followers",
        "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
        "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mjlbach",
        "id": 13316262,
        "login": "mjlbach",
        "node_id": "MDQ6VXNlcjEzMzE2MjYy",
        "organizations_url": "https://api.github.com/users/mjlbach/orgs",
        "received_events_url": "https://api.github.com/users/mjlbach/received_events",
        "repos_url": "https://api.github.com/users/mjlbach/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mjlbach",
        "user_view_type": "public"
    }
}
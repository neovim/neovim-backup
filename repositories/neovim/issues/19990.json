{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Neovim version (nvim -v)\r\n\r\nv0.8.0-dev-972-g1dcaa75a6\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNo, Vim 9.0.246\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Terminal name/version\r\n\r\nkitty 0.25.2\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbuild from repo\r\n\r\n### How to reproduce the issue\r\n\r\n1. Run `nvim --clean`\r\n2. Source the following script:\r\n```vim\r\nfunc Foo()\r\n  eval 1\r\nendfunc\r\n\r\nbreakadd expr abs(0)\r\ncall Foo()\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo segfault\r\n\r\n### Actual behavior\r\n\r\nSegfault\r\n```\r\n**/src/nvim/hashtab.c:133:21: runtime error: applying zero offset to null pointer\r\n    #0 0x560b3e845f37 in hash_lookup **/src/nvim/hashtab.c:133:21\r\n    #1 0x560b3e846edc in hash_find_len **/src/nvim/hashtab.c:107:10\r\n    #2 0x560b3e392c1b in find_var_in_ht **/src/nvim/eval.c:7297:20\r\n    #3 0x560b3e352b20 in find_var **/src/nvim/eval.c:7246:27\r\n    #4 0x560b3e5551e3 in deref_func_name **/src/nvim/eval/userfunc.c:375:25\r\n    #5 0x560b3e3c19b4 in eval_func **/src/nvim/eval.c:2222:15\r\n    #6 0x560b3e3b8c4c in eval7 **/src/nvim/eval.c:3099:15\r\n    #7 0x560b3e3b448b in eval6 **/src/nvim/eval.c:2779:7\r\n    #8 0x560b3e3b1ba2 in eval5 **/src/nvim/eval.c:2612:7\r\n    #9 0x560b3e3b05e0 in eval4 **/src/nvim/eval.c:2512:7\r\n    #10 0x560b3e3afb02 in eval3 **/src/nvim/eval.c:2441:7\r\n    #11 0x560b3e35b812 in eval2 **/src/nvim/eval.c:2382:7\r\n    #12 0x560b3e34b2e4 in eval1 **/src/nvim/eval.c:2318:7\r\n    #13 0x560b3e348eb0 in eval0 **/src/nvim/eval.c:2279:9\r\n    #14 0x560b3e34cedf in eval_expr **/src/nvim/eval.c:943:7\r\n    #15 0x560b3e20d5b7 in eval_expr_no_emsg **/src/nvim/debugger.c:473:24\r\n    #16 0x560b3e20c7ea in debuggy_find **/src/nvim/debugger.c:786:28\r\n    #17 0x560b3e20b91b in dbg_find_breakpoint **/src/nvim/debugger.c:723:10\r\n    #18 0x560b3e55bfdd in call_user_func **/src/nvim/eval/userfunc.c:866:20\r\n    #19 0x560b3e55a8df in call_func **/src/nvim/eval/userfunc.c:1564:11\r\n    #20 0x560b3e556da5 in get_func_tv **/src/nvim/eval/userfunc.c:476:11\r\n    #21 0x560b3e58c2cb in ex_call **/src/nvim/eval/userfunc.c:2984:9\r\n    #22 0x560b3e666ab2 in execute_cmd0 **/src/nvim/ex_docmd.c:1587:7\r\n    #23 0x560b3e643c61 in do_one_cmd **/src/nvim/ex_docmd.c:2236:7\r\n    #24 0x560b3e633d93 in do_cmdline **/src/nvim/ex_docmd.c:580:20\r\n    #25 0x560b3f04f356 in do_source **/src/nvim/runtime.c:2030:5\r\n    #26 0x560b3f04aa2d in cmd_source **/src/nvim/runtime.c:1612:14\r\n    #27 0x560b3f04a5ad in ex_source **/src/nvim/runtime.c:1620:3\r\n    #28 0x560b3e666ab2 in execute_cmd0 **/src/nvim/ex_docmd.c:1587:7\r\n    #29 0x560b3e643c61 in do_one_cmd **/src/nvim/ex_docmd.c:2236:7\r\n    #30 0x560b3e633d93 in do_cmdline **/src/nvim/ex_docmd.c:580:20\r\n    #31 0x560b3ecc6dab in nv_colon **/src/nvim/normal.c:4052:20\r\n    #32 0x560b3ecb3135 in normal_execute **/src/nvim/normal.c:1172:3\r\n    #33 0x560b3f2c429e in state_enter **/src/nvim/state.c:88:26\r\n    #34 0x560b3ec848d0 in normal_enter **/src/nvim/normal.c:471:3\r\n    #35 0x560b3e9ba706 in main **/src/nvim/main.c:583:3\r\n    #36 0x7f7421dcb2cf  (/usr/lib/libc.so.6+0x232cf) (BuildId: 9c28cfc869012ebbd43cdb0f1eebcd14e1b8bdd8)\r\n    #37 0x7f7421dcb389 in __libc_start_main (/usr/lib/libc.so.6+0x23389) (BuildId: 9c28cfc869012ebbd43cdb0f1eebcd14e1b8bdd8)\r\n    #38 0x560b3dd4fde4 in _start /build/glibc/src/glibc/csu/../sysdeps/x86_64/start.S:115\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior **/src/nvim/hashtab.c:133:21 in \r\n```",
    "closed_at": "2025-12-02T00:04:56Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Vim versions before v8.2.0149 also had this segfault.",
            "created_at": "2022-08-29T12:24:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/19990#issuecomment-1230215730",
            "id": 1230215730,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/19990",
            "node_id": "IC_kwDOAPphoM5JU5oy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1230215730/reactions"
            },
            "updated_at": "2022-08-29T12:24:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1230215730",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "This is happening with any breakadd expr call on my system",
            "created_at": "2022-08-29T20:24:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/19990#issuecomment-1230822781",
            "id": 1230822781,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/19990",
            "node_id": "IC_kwDOAPphoM5JXN19",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1230822781/reactions"
            },
            "updated_at": "2022-08-29T20:24:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1230822781",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/74346877?v=4",
                "events_url": "https://api.github.com/users/hazeled/events{/privacy}",
                "followers_url": "https://api.github.com/users/hazeled/followers",
                "following_url": "https://api.github.com/users/hazeled/following{/other_user}",
                "gists_url": "https://api.github.com/users/hazeled/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hazeled",
                "id": 74346877,
                "login": "hazeled",
                "node_id": "MDQ6VXNlcjc0MzQ2ODc3",
                "organizations_url": "https://api.github.com/users/hazeled/orgs",
                "received_events_url": "https://api.github.com/users/hazeled/received_events",
                "repos_url": "https://api.github.com/users/hazeled/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hazeled/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hazeled/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hazeled",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The issue seems to be in the src/nvim/hashtab.c:133 as the stack trace reported early in this issue.\n the line dereferenciate a pointer that happen to be NULL\n\n```c\nif (hi->hi_key == NULL) \n```\n\nif hi is NULL, like in the case of this seg fault than the crash happen. \nfor some reason we reach this point we the hashtable not initialized :\n\n```c\n typedef struct {\n  9   hash_T ht_mask;        ///< mask used for hash value\n  8                          ///< (nr of items in array is \"ht_mask\" + 1)\n  7   size_t ht_used;        ///< number of items used\n  6   size_t ht_filled;      ///< number of items used or removed\n  5   int ht_changed;        ///< incremented when adding or removing an item\n  4   int ht_locked;         ///< counter for hash_lock()\n  3   hashitem_T *ht_array;  ///< points to the array, allocated when it's\n  2                          ///< not \"ht_smallarray\"\n  1   hashitem_T ht_smallarray[HT_INIT_SIZE];  ///< initial array\n61  } hashtab_T;\n```\n\n\nthe struct field hashitem_T *ht_array it is not initialized yo point to the smallarray field, so when the prgram execute this:\n```c\n hashitem_T *hi = &ht->ht_array[idx];\n```\nwhich happen before the if(hi->h_key == NULL) hi it is NULL causing the operation -> to generate a SIGSEGV\n\ni did some digging, and the bt in gdb show this:\n\n<img width=\"1914\" height=\"992\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/1ce697b5-6295-4bbc-9190-7249d7a620ea\" />\n\nthe stack trace in number 3 , function find_var from file src/nvim/eval/vars.c line 2400\nthe test :\n ```c\n if (ht == NULL) {      \n        return NULL;              \n   }   \n```\nmight be not complete, cause the ht might not be NULL and at the same time not being initialized, having some fields set to NULL, \n\nI will debug it more, these days to see where is the root of the problem.\nhopefully this is helpful.\n\n",
            "created_at": "2025-11-27T05:39:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/19990#issuecomment-3584288406",
            "id": 3584288406,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/19990",
            "node_id": "IC_kwDOAPphoM7Vo-aW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3584288406/reactions"
            },
            "updated_at": "2025-11-27T05:39:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3584288406",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/69109614?v=4",
                "events_url": "https://api.github.com/users/LorenzoPiombini/events{/privacy}",
                "followers_url": "https://api.github.com/users/LorenzoPiombini/followers",
                "following_url": "https://api.github.com/users/LorenzoPiombini/following{/other_user}",
                "gists_url": "https://api.github.com/users/LorenzoPiombini/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/LorenzoPiombini",
                "id": 69109614,
                "login": "LorenzoPiombini",
                "node_id": "MDQ6VXNlcjY5MTA5NjE0",
                "organizations_url": "https://api.github.com/users/LorenzoPiombini/orgs",
                "received_events_url": "https://api.github.com/users/LorenzoPiombini/received_events",
                "repos_url": "https://api.github.com/users/LorenzoPiombini/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/LorenzoPiombini/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/LorenzoPiombini/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/LorenzoPiombini",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Iâ€™ve opened a PR that fixes this issue: #36724 ",
            "created_at": "2025-11-30T14:00:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/19990#issuecomment-3592572913",
            "id": 3592572913,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/19990",
            "node_id": "IC_kwDOAPphoM7WIk_x",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3592572913/reactions"
            },
            "updated_at": "2025-11-30T14:00:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3592572913",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/69109614?v=4",
                "events_url": "https://api.github.com/users/LorenzoPiombini/events{/privacy}",
                "followers_url": "https://api.github.com/users/LorenzoPiombini/followers",
                "following_url": "https://api.github.com/users/LorenzoPiombini/following{/other_user}",
                "gists_url": "https://api.github.com/users/LorenzoPiombini/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/LorenzoPiombini",
                "id": 69109614,
                "login": "LorenzoPiombini",
                "node_id": "MDQ6VXNlcjY5MTA5NjE0",
                "organizations_url": "https://api.github.com/users/LorenzoPiombini/orgs",
                "received_events_url": "https://api.github.com/users/LorenzoPiombini/received_events",
                "repos_url": "https://api.github.com/users/LorenzoPiombini/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/LorenzoPiombini/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/LorenzoPiombini/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/LorenzoPiombini",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/19990/comments",
    "created_at": "2022-08-29T00:25:30Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/19990/events",
    "html_url": "https://github.com/neovim/neovim/issues/19990",
    "id": 1353517195,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c7def8",
            "default": false,
            "description": "",
            "id": 109899557,
            "name": "vimscript",
            "node_id": "MDU6TGFiZWwxMDk4OTk1NTc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/vimscript"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/19990/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5QrQiL",
    "number": 19990,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/19990/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/19990/timeline",
    "title": "Segfault with :breakadd expr",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-12-02T00:04:56Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/19990",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    }
}
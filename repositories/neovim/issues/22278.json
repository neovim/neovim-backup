{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nIf I open a particular file in neovim, scroll to the very last line, dismiss the onscreen keyboard, and then pull the keyboard back up again, neovim segfaults. Consistently. I eliminated my configs as a cause.\r\n\r\nI haven't been able to reproduce this on a PC, because I don't know what would have the equivalent effect of raising and lowering a onscreen keyboard. I don't yet know if neovim or termux or both are responsible.\r\n\r\nIt looks like the bug is caused by the last line being wrapped and partially offscreen. So your terminal dimensions have to allow that.\r\n\r\n### Steps to reproduce\r\n\r\nUse the *onscreen keyboard* for this.\r\n\r\n1. Get termux's dimensions to one of 35 cols × 14 lines, or 33 cols × 13 lines. This is with the keyboard open. There may be other dimensions which cause the segfault, but I confirmed these.\r\n2. Paste into termux: `curl -s https://termbin.com/2q2fq | nvim -u NONE -c \"set linebreak\"`\r\n3. Type `G$` (move the cursor to the end of the last line in the file)\r\n4. Dismiss the onscreen keyboard (open the side menu and hit \"keyboard\")\r\n5. Bring the onscreen keyboard back up (repeat prior step). Neovim should segfault immediately.\r\n\r\n### Expected behavior\r\n\r\nIt shouldn't segfault.\r\n\r\n### Neovim version (nvim -v)\r\n\r\n0.8.3\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno, vim 9.0\r\n\r\n### Operating system/version\r\n\r\nAndroid 10\r\n\r\n### Terminal name/version\r\n\r\ntermux 0.118.0\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nsystem package manager (the `pkg` command in termux)\r\n\r\nEDIT: Added terminal sizes to \"steps to reproduce\".",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "The terminal dimensions where I get segfaults are 35 cols × 14 lines, or 33 cols × 13 lines.\r\n",
            "created_at": "2023-02-16T06:00:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432570394",
            "id": 1432570394,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VY0oa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432570394/reactions"
            },
            "updated_at": "2023-02-16T06:00:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432570394",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/16908019?v=4",
                "events_url": "https://api.github.com/users/beelzebielsk/events{/privacy}",
                "followers_url": "https://api.github.com/users/beelzebielsk/followers",
                "following_url": "https://api.github.com/users/beelzebielsk/following{/other_user}",
                "gists_url": "https://api.github.com/users/beelzebielsk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/beelzebielsk",
                "id": 16908019,
                "login": "beelzebielsk",
                "node_id": "MDQ6VXNlcjE2OTA4MDE5",
                "organizations_url": "https://api.github.com/users/beelzebielsk/orgs",
                "received_events_url": "https://api.github.com/users/beelzebielsk/received_events",
                "repos_url": "https://api.github.com/users/beelzebielsk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/beelzebielsk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/beelzebielsk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/beelzebielsk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Backtrace:\r\n```\r\n                #0  0x000055bc86876f4a ui_comp_grid_scroll (nvim + 0x2baf4a)\r\n                #1  0x000055bc86876fcc ui_call_grid_scroll (nvim + 0x2bafcc)\r\n                #2  0x000055bc8673a938 grid_del_lines (nvim + 0x17e938)\r\n                #3  0x000055bc86813124 win_scroll_lines (nvim + 0x257124)\r\n                #4  0x000055bc8679c721 curs_columns (nvim + 0x1e0721)\r\n                #5  0x000055bc8679c824 validate_cursor (nvim + 0x1e0824)\r\n                #6  0x000055bc8679c15f update_topline (nvim + 0x1e015f)\r\n                #7  0x000055bc866aa071 screen_resize (nvim + 0xee071)\r\n                #8  0x000055bc868727f9 ui_refresh (nvim + 0x2b67f9)\r\n                #9  0x000055bc86665f14 nvim_ui_try_resize (nvim + 0xa9f14)\r\n                #10 0x000055bc8665ccfc handle_nvim_ui_try_resize (nvim + 0xa0cfc)\r\n                #11 0x000055bc867a06bd request_event (nvim + 0x1e46bd)\r\n                #12 0x000055bc866f3ec0 multiqueue_oneshot_event (nvim + 0x137ec0)\r\n                #13 0x000055bc868444fd state_handle_k_event (nvim + 0x2884fd)\r\n                #14 0x000055bc867acfc6 nv_event (nvim + 0x1f0fc6)\r\n                #15 0x000055bc867a99f6 normal_execute (nvim + 0x1ed9f6)\r\n                #16 0x000055bc86844394 state_enter (nvim + 0x288394)\r\n                #17 0x000055bc867a1fec normal_enter (nvim + 0x1e5fec)\r\n                #18 0x000055bc86633abf main (nvim + 0x77abf)\r\n                #19 0x00007f13ef153790 n/a (libc.so.6 + 0x23790)\r\n                #20 0x00007f13ef15384a __libc_start_main (libc.so.6 + 0x2384a)\r\n                #21 0x000055bc8662f045 _start (nvim + 0x73045)\r\n```\r\nASAN log:\r\n```\r\n=================================================================\r\n==53977==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60b000002518 at pc 0x56027b17fb23 bp 0x7ffed08f52d0 sp 0x7ffed08f52c8\r\nREAD of size 8 at 0x60b000002518 thread T0\r\n    #0 0x56027b17fb22 in grid_del_lines **/src/nvim/grid.c:893:45\r\n    #1 0x56027b9983bf in win_scroll_lines **/src/nvim/screen.c:405:5\r\n    #2 0x56027b553938 in curs_columns **/src/nvim/move.c:910:5\r\n    #3 0x56027b549b46 in validate_cursor **/src/nvim/move.c:525:5\r\n    #4 0x56027b53cdb1 in update_topline **/src/nvim/move.c:338:7\r\n    #5 0x56027abfe25f in screen_resize **/src/nvim/drawscreen.c:358:9\r\n    #6 0x56027bdba12b in ui_refresh **/src/nvim/ui.c:215:3\r\n    #7 0x56027a96cba6 in nvim_ui_try_resize **/src/nvim/api/ui.c:279:3\r\n    #8 0x56027a8e9243 in handle_nvim_ui_try_resize **/build/src/nvim/auto/api/private/dispatch_wrappers.generated.h:4266:3\r\n    #9 0x56027b5897aa in request_event **/src/nvim/msgpack_rpc/channel.c:359:19\r\n    #10 0x56027af09497 in multiqueue_oneshot_event **/src/nvim/event/multiqueue.c:274:7\r\n    #11 0x56027bbf2d79 in state_handle_k_event **/src/nvim/state.c:117:7\r\n    #12 0x56027b61bce9 in nv_event **/src/nvim/normal.c:6621:3\r\n    #13 0x56027b5e1038 in normal_execute **/src/nvim/normal.c:1200:3\r\n    #14 0x56027bbf2b47 in state_enter **/src/nvim/state.c:99:26\r\n    #15 0x56027b5c48b0 in normal_enter **/src/nvim/normal.c:498:3\r\n    #16 0x56027a74ddaa in main **/src/nvim/main.c:633:3\r\n    #17 0x7f99eaa9178f  (/usr/lib/libc.so.6+0x2378f) (BuildId: 4a4bec3d95a1804443e852958fe59ed461135ce9)\r\n    #18 0x7f99eaa91849 in __libc_start_main (/usr/lib/libc.so.6+0x23849) (BuildId: 4a4bec3d95a1804443e852958fe59ed461135ce9)\r\n    #19 0x56027a64dd54 in _start (**/build/bin/nvim+0xb93d54) (BuildId: f237ce6975decc426a607765962213e4036271e7)\r\n\r\n0x60b000002518 is located 0 bytes to the right of 104-byte region [0x60b0000024b0,0x60b000002518)\r\nallocated by thread T0 here:\r\n    #0 0x56027a7052e9 in malloc (**/build/bin/nvim+0xc4b2e9) (BuildId: f237ce6975decc426a607765962213e4036271e7)\r\n    #1 0x56027b4b8366 in try_malloc **/src/nvim/memory.c:88:15\r\n    #2 0x56027b4b853c in xmalloc **/src/nvim/memory.c:122:15\r\n    #3 0x56027b178201 in grid_alloc **/src/nvim/grid.c:665:21\r\n    #4 0x56027abfbe07 in default_grid_alloc **/src/nvim/drawscreen.c:186:3\r\n    #5 0x56027abfd9c3 in screen_resize **/src/nvim/drawscreen.c:293:10\r\n    #6 0x56027bdba12b in ui_refresh **/src/nvim/ui.c:215:3\r\n    #7 0x56027a96cba6 in nvim_ui_try_resize **/src/nvim/api/ui.c:279:3\r\n    #8 0x56027a8e9243 in handle_nvim_ui_try_resize **/build/src/nvim/auto/api/private/dispatch_wrappers.generated.h:4266:3\r\n    #9 0x56027b5897aa in request_event **/src/nvim/msgpack_rpc/channel.c:359:19\r\n    #10 0x56027af09497 in multiqueue_oneshot_event **/src/nvim/event/multiqueue.c:274:7\r\n    #11 0x56027bbf2d79 in state_handle_k_event **/src/nvim/state.c:117:7\r\n    #12 0x56027b61bce9 in nv_event **/src/nvim/normal.c:6621:3\r\n    #13 0x56027b5e1038 in normal_execute **/src/nvim/normal.c:1200:3\r\n    #14 0x56027bbf2b47 in state_enter **/src/nvim/state.c:99:26\r\n    #15 0x56027b5c48b0 in normal_enter **/src/nvim/normal.c:498:3\r\n    #16 0x56027a74ddaa in main **/src/nvim/main.c:633:3\r\n    #17 0x7f99eaa9178f  (/usr/lib/libc.so.6+0x2378f) (BuildId: 4a4bec3d95a1804443e852958fe59ed461135ce9)\r\n\r\nSUMMARY: AddressSanitizer: heap-buffer-overflow **/src/nvim/grid.c:893:45 in grid_del_lines\r\nShadow bytes around the buggy address:\r\n  0x0c167fff8450: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c167fff8460: fd fd fa fa fa fa fa fa fa fa fd fd fd fd fd fd\r\n  0x0c167fff8470: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa\r\n  0x0c167fff8480: fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa\r\n  0x0c167fff8490: fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00\r\n=>0x0c167fff84a0: 00 00 00[fa]fa fa fa fa fa fa fa fa 00 00 00 00\r\n  0x0c167fff84b0: 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa\r\n  0x0c167fff84c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c167fff84d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c167fff84e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c167fff84f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07 \r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==53977==ABORTING\r\n```",
            "created_at": "2023-02-16T06:16:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432582977",
            "id": 1432582977,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VY3tB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432582977/reactions"
            },
            "updated_at": "2023-02-16T06:19:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432582977",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Script to reproduce:\r\n```lua\r\nvim.fn.termopen({ vim.v.progpath, '-u', 'NONE', '-i', 'NONE', '-c', 'set linebreak' })\r\nvim.defer_fn(function()\r\n  vim.fn.jobresize(vim.bo.channel, 35, 14)\r\n  vim.defer_fn(function()\r\n    vim.fn.chansend(vim.bo.channel, 'i' .. [[\r\nx xxx xxxxxxxx xx xxx xxx xxxxxx xxxx x xxxxx xxx xxxxxxx x xxx xxxx xxxxxx xxx xxxxxxxxxx xxxxx xxxxx xx xxxxxx xxx xx xxxxxx\r\n\r\nxxxxx xxxxx xxxxx xx xxxxx xxxxxx xx xxxxx xxxxxxx xxx xxxxxx xx xxxxx xxxx xxxx xxxxxx xxxx xxxx xxxxxx xx xxxxxx xxxx xx xxx xxxx xxxxx xxxxx xxxx xxxxx xxxxxxxx xx xx xxxxx xxxx xxxxx xxxx xxxxxxxxx xx xxxx xxx xxxxx xxx xxxx xxx xxxxx xxxx xx xxxxxx xxx xxxx xxxx xxx xxxx xxxx xx xxxx xxxxx x xxxx xxx xxxxx xxxxxxxxxxxxx x xxxxxxxxxxxxxxx xxxxxxx x xxxxx xxxxx x xxx xxxxxx xx xxxxxxxx xxxx xxxxx]] .. '\\027')\r\n    vim.defer_fn(function()\r\n      vim.fn.jobresize(vim.bo.channel, 35, 21)\r\n      vim.defer_fn(function()\r\n        vim.fn.jobresize(vim.bo.channel, 35, 13)\r\n      end, 1000)\r\n    end, 1000)\r\n  end, 1000)\r\nend, 1000)\r\n```",
            "created_at": "2023-02-16T07:07:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432622138",
            "id": 1432622138,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VZBQ6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432622138/reactions"
            },
            "updated_at": "2023-02-16T07:07:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432622138",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This seems to fix the problem:\r\n```diff\r\ndiff --git a/src/nvim/drawscreen.c b/src/nvim/drawscreen.c\r\nindex 0ac522059..f392477f4 100644\r\n--- a/src/nvim/drawscreen.c\r\n+++ b/src/nvim/drawscreen.c\r\n@@ -232,6 +232,7 @@ void screenclear(void)\r\n     if (wp->w_floating) {\r\n       wp->w_redr_type = UPD_CLEAR;\r\n     }\r\n+    win_grid_alloc(wp);\r\n   }\r\n   if (must_redraw == UPD_CLEAR) {\r\n     must_redraw = UPD_NOT_VALID;  // no need to clear again\r\n```",
            "created_at": "2023-02-16T07:32:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432643647",
            "id": 1432643647,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VZGg_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432643647/reactions"
            },
            "updated_at": "2023-02-16T07:32:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432643647",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Test case:\r\n```lua\r\nit('', function()\r\n  screen:try_resize(35, 14)\r\n  command('set laststatus=2 linebreak')\r\n  insert([[\r\n    x xxx xxxxxxxx xx xxx xxx xxxxxx xxxx x xxxxx xxx xxxxxxx x xxx xxxx xxxxxx xxx xxxxxxxxxx xxxxx xxxxx xx xxxxxx xxx xx xxxxxx\r\n\r\n    xxxxx xxxxx xxxxx xx xxxxx xxxxxx xx xxxxx xxxxxxx xxx xxxxxx xx xxxxx xxxx xxxx xxxxxx xxxx xxxx xxxxxx xx xxxxxx xxxx xx xxx xxxx xxxxx xxxxx xxxx xxxxx xxxxxxxx xx xx xxxxx xxxx xxxxx xxxx xxxxxxxxx xx xxxx xxx xxxxx xxx xxxx xxx xxxxx xxxx xx xxxxxx xxx xxxx xxxx xxx xxxx xxxx xx xxxx xxxxx x xxxx xxx xxxxx xxxxxxxxxxxxx x xxxxxxxxxxxxxxx xxxxxxx x xxxxx xxxxx x xxx xxxxxx xx xxxxxxxx xxxx xxxxx]])\r\n  screen:try_resize(35, 21)\r\n  screen:try_resize(35, 13)\r\n  assert_alive()\r\nend)\r\n```",
            "created_at": "2023-02-16T07:51:52Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432660401",
            "id": 1432660401,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VZKmx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432660401/reactions"
            },
            "updated_at": "2023-02-16T07:51:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432660401",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The solution above doesn't work for the case where there is a more prompt:\r\n```lua\r\nvim.fn.termopen({ vim.v.progpath, '-u', 'NONE', '-i', 'NONE', '-c', 'set linebreak' })\r\nvim.defer_fn(function()\r\n  vim.fn.jobresize(vim.bo.channel, 35, 14)\r\n  vim.defer_fn(function()\r\n    vim.fn.chansend(vim.bo.channel, 'i' .. [[\r\nx xxx xxxxxxxx xx xxx xxx xxxxxx xxxx x xxxxx xxx xxxxxxx x xxx xxxx xxxxxx xxx xxxxxxxxxx xxxxx xxxxx xx xxxxxx xxx xx xxxxxx\r\n\r\nxxxxx xxxxx xxxxx xx xxxxx xxxxxx xx xxxxx xxxxxxx xxx xxxxxx xx xxxxx xxxx xxxx xxxxxx xxxx xxxx xxxxxx xx xxxxxx xxxx xx xxx xxxx xxxxx xxxxx xxxx xxxxx xxxxxxxx xx xx xxxxx xxxx xxxxx xxxx xxxxxxxxx xx xxxx xxx xxxxx xxx xxxx xxx xxxxx xxxx xx xxxxxx xxx xxxx xxxx xxx xxxx xxxx xx xxxx xxxxx x xxxx xxx xxxxx xxxxxxxxxxxxx x xxxxxxxxxxxxxxx xxxxxxx x xxxxx xxxxx x xxx xxxxxx xx xxxxxxxx xxxx xxxxx]] .. '\\027')\r\n    vim.defer_fn(function()\r\n      vim.fn.jobresize(vim.bo.channel, 35, 21)\r\n      vim.defer_fn(function()\r\n        vim.fn.chansend(vim.bo.channel, ':hi\\r')\r\n        vim.defer_fn(function()\r\n          vim.fn.jobresize(vim.bo.channel, 35, 13)\r\n          vim.defer_fn(function()\r\n            vim.fn.chansend(vim.bo.channel, 'q')\r\n          end, 1000)\r\n        end, 1000)\r\n      end, 1000)\r\n    end, 1000)\r\n  end, 1000)\r\nend, 1000)\r\n```",
            "created_at": "2023-02-16T08:30:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432702130",
            "id": 1432702130,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VZUyy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432702130/reactions"
            },
            "updated_at": "2023-02-16T08:30:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432702130",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This fixes the case above:\r\n```diff\r\ndiff --git a/src/nvim/drawscreen.c b/src/nvim/drawscreen.c\r\nindex 0ac522059..3760e4256 100644\r\n--- a/src/nvim/drawscreen.c\r\n+++ b/src/nvim/drawscreen.c\r\n@@ -306,6 +306,10 @@ void screen_resize(int width, int height)\r\n \r\n     RedrawingDisabled--;\r\n \r\n+    FOR_ALL_WINDOWS_IN_TAB(wp, curtab) {\r\n+      win_grid_alloc(wp);\r\n+    }\r\n+\r\n     // Do not apply autocommands more than 3 times to avoid an endless loop\r\n     // in case applying autocommands always changes Rows or Columns.\r\n     if (++retry_count > 3) {\r\n```",
            "created_at": "2023-02-16T08:42:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432715672",
            "id": 1432715672,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VZYGY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432715672/reactions"
            },
            "updated_at": "2023-02-16T08:42:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432715672",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This crash can also apply to windows in another tabpage:\r\n```lua\r\nit('', function()\r\n  screen:try_resize(35, 14)\r\n  command('set laststatus=2 linebreak')\r\n  insert([[\r\n    x xxx xxxxxxxx xx xxx xxx xxxxxx xxxx x xxxxx xxx xxxxxxx x xxx xxxx xxxxxx xxx xxxxxxxxxx xxxxx xxxxx xx xxxxxx xxx xx xxxxxx\r\n\r\n    xxxxx xxxxx xxxxx xx xxxxx xxxxxx xx xxxxx xxxxxxx xxx xxxxxx xx xxxxx xxxx xxxx xxxxxx xxxx xxxx xxxxxx xx xxxxxx xxxx xx xxx xxxx xxxxx xxxxx xxxx xxxxx xxxxxxxx xx xx xxxxx xxxx xxxxx xxxx xxxxxxxxx xx xxxx xxx xxxxx xxx xxxx xxx xxxxx xxxx xx xxxxxx xxx xxxx xxxx xxx xxxx xxxx xx xxxx xxxxx x xxxx xxx xxxxx xxxxxxxxxxxxx x xxxxxxxxxxxxxxx xxxxxxx x xxxxx xxxxx x xxx xxxxxx xx xxxxxxxx xxxx xxxxx]])\r\n  screen:try_resize(35, 21)\r\n  command('tabnew')\r\n  screen:try_resize(35, 13)\r\n  exec_lua([[\r\n    vim.cmd.tabprev()\r\n    vim.wo.signcolumn = 'yes'\r\n  ]])\r\n  assert_alive()\r\nend)\r\n```\r\nSo the fix above isn't the correct fix either.",
            "created_at": "2023-02-16T09:52:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/22278#issuecomment-1432812063",
            "id": 1432812063,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22278",
            "node_id": "IC_kwDOAPphoM5VZvof",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432812063/reactions"
            },
            "updated_at": "2023-02-16T09:52:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1432812063",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 8,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22278/comments",
    "created_at": "2023-02-16T05:59:09Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22278/events",
    "html_url": "https://github.com/neovim/neovim/issues/22278",
    "id": 1587071838,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 113026979,
            "name": "ui",
            "node_id": "MDU6TGFiZWwxMTMwMjY5Nzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains minimal reproducing steps",
            "id": 435851959,
            "name": "has:repro",
            "node_id": "MDU6TGFiZWw0MzU4NTE5NTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:repro"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22278/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 0,
        "created_at": "2024-05-16T14:11:54Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/43",
        "id": 11063573,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/43/labels",
        "node_id": "MI_kwDOAPphoM4AqNEV",
        "number": 43,
        "open_issues": 32,
        "state": "open",
        "title": "0.12",
        "updated_at": "2025-02-02T00:25:39Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/43"
    },
    "node_id": "I_kwDOAPphoM5emMte",
    "number": 22278,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22278/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22278/timeline",
    "title": "Neovim segfaults on termux when dismissing and raising onscreen keyboard",
    "updated_at": "2025-02-02T00:10:49Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22278",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/16908019?v=4",
        "events_url": "https://api.github.com/users/beelzebielsk/events{/privacy}",
        "followers_url": "https://api.github.com/users/beelzebielsk/followers",
        "following_url": "https://api.github.com/users/beelzebielsk/following{/other_user}",
        "gists_url": "https://api.github.com/users/beelzebielsk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/beelzebielsk",
        "id": 16908019,
        "login": "beelzebielsk",
        "node_id": "MDQ6VXNlcjE2OTA4MDE5",
        "organizations_url": "https://api.github.com/users/beelzebielsk/orgs",
        "received_events_url": "https://api.github.com/users/beelzebielsk/received_events",
        "repos_url": "https://api.github.com/users/beelzebielsk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/beelzebielsk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/beelzebielsk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/beelzebielsk",
        "user_view_type": "public"
    }
}
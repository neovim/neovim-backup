{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nThe Neovim terminal ([nvim_terminal_emulator](https://neovim.io/doc/user/nvim_terminal_emulator.html)) is awesome. Combined with plugins such as [vim-slime](https://github.com/jpalardy/vim-slime), it enables powerful IDE-like functionality.\r\n\r\nI think the Nvim terminal would be even better if it allowed for a fully \"modifiable\" mode whereby the normal mode commands work inside the terminal buffer, more akin to the [Emacs terminal](https://www.gnu.org/software/emacs/manual/html_node/emacs/Terminal-emulator.html). Perhaps this could be implemented by \"separating\" the shell process from the Neovim terminal buffer in which it displayed, such that the buffer becomes more like a regular vim buffer (including normal mode commands) with the added feature that it is capable of sending anything typed into the prompt back to the shell process (automatically updating the buffer with any output).\r\n\r\nAs far as I know, the current Nvim terminal does not allow for any normal mode edits to the command prompt. For example, pressing `dw` in a terminal buffer will not work (if one has `:set modifiable`, then `dw` will work on any text *prior to the command prompt*, but not on the command prompt itself, where it is most needed). Likewise, the normal mode and terminal mode cursors are distinct, meaning that if I exit from terminal mode to normal mode, move the cursor backwards by a couple of words, and enter terminal mode again, the cursor will return to the position from which I exited terminal mode, essentially \"forgetting\" any movement that happened in normal mode. \r\n\r\nI do realize that I can activate vi mode in the terminal itself, and this is indeed my current workflow. However, this is suboptimal since it requires navigating through 2 different normal modes, the Nvim normal mode and the terminal vi normal mode, which are not exactly the same and can throw off one's muscle memory.\r\n\r\n### Expected behavior\r\n\r\nIt would be awesome if `:set modifiable` made the terminal behave more like any other Nvim buffer, with fully integrated normal and terminal modes. In other words, it should allow for arbitrary normal mode commands, including on the command prompt. So if I exit to normal mode, press `dw`, and return to terminal mode, a word should have been deleted. In addition, if I exit to normal mode, press `b`, and return to terminal mode, the cursor should now stand one word back from the original position (note this would allow effective navigation of the command prompt using plugins such as [easymotion](https://github.com/easymotion/vim-easymotion)). When in terminal mode, pressing Enter should still allow me to execute commands, and the buffer should automatically update with any new lines from the terminal output.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Linking to a similar proposal from a few years back: #8805",
            "created_at": "2023-05-16T01:41:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-1548842646",
            "id": 1548842646,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM5cUXaW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1548842646/reactions"
            },
            "updated_at": "2023-05-16T01:41:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1548842646",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24964845?v=4",
                "events_url": "https://api.github.com/users/egr95/events{/privacy}",
                "followers_url": "https://api.github.com/users/egr95/followers",
                "following_url": "https://api.github.com/users/egr95/following{/other_user}",
                "gists_url": "https://api.github.com/users/egr95/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/egr95",
                "id": 24964845,
                "login": "egr95",
                "node_id": "MDQ6VXNlcjI0OTY0ODQ1",
                "organizations_url": "https://api.github.com/users/egr95/orgs",
                "received_events_url": "https://api.github.com/users/egr95/received_events",
                "repos_url": "https://api.github.com/users/egr95/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/egr95/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/egr95/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/egr95",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I'm still thinking the approach in https://github.com/neovim/neovim/issues/8805#issuecomment-409940181 might be best:\r\n\r\n> start with a basic adapter like:\r\n> \r\n> * copy the last line of the :terminal buffer to a new, temporary, editable floating window\r\n> * delete the shell prompt line: send `ctrl-u` or `<bs><bs><bs>...` (or `ctrl-c` in cmd.exe)\r\n>   * guess the shell prompt \"prefix\" by comparing the state after clearing the prompt line\r\n> * send the user's edited line back to the terminal job (shell)\r\n\r\n",
            "created_at": "2023-06-05T13:53:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-1576850696",
            "id": 1576850696,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM5d_NUI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1576850696/reactions"
            },
            "updated_at": "2023-06-05T13:55:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1576850696",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> [...] such that the buffer becomes more like a regular vim buffer (including normal mode commands)\r\n\r\nAll lines above the current prompt line are history, which is the output of commands that have been executed. So treating it as a regular Vim buffer would be a little strange since there is no point to change the log/output of sent commands. So I more like the way quoted by justinmk. (Except that I'm still thinking about whether making it a floating window would be necessary for users. For example, if I want to copy some text from an existing Vim buffer, then I cannot use `wincmd hjkl` to jump back to the floating window. `wincmd p` only works for the first jump.)\r\n\r\nRegarding editing the current (possibly multi-line) prompt for a terminal emulator, I fully support the idea.",
            "created_at": "2023-06-05T14:39:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-1576931677",
            "id": 1576931677,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM5d_hFd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 5,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 5,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1576931677/reactions"
            },
            "updated_at": "2023-06-05T14:47:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1576931677",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24765272?v=4",
                "events_url": "https://api.github.com/users/nyngwang/events{/privacy}",
                "followers_url": "https://api.github.com/users/nyngwang/followers",
                "following_url": "https://api.github.com/users/nyngwang/following{/other_user}",
                "gists_url": "https://api.github.com/users/nyngwang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nyngwang",
                "id": 24765272,
                "login": "nyngwang",
                "node_id": "MDQ6VXNlcjI0NzY1Mjcy",
                "organizations_url": "https://api.github.com/users/nyngwang/orgs",
                "received_events_url": "https://api.github.com/users/nyngwang/received_events",
                "repos_url": "https://api.github.com/users/nyngwang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nyngwang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nyngwang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nyngwang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Agreed it would be much more important to enable normal-mode edits on the command prompt than on the history (the current Nvim terminal unfortunately only allowing for the latter but not the former).\r\n\r\nI am not familiar with the Nvim internals, but the approach proposed by justinmk seems very reasonable to me. Not sure if any additional tweaking would be needed in order to support multi-line commands as well.",
            "created_at": "2023-06-12T11:55:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-1587181582",
            "id": 1587181582,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM5emngO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1587181582/reactions"
            },
            "updated_at": "2023-06-12T12:37:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1587181582",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24964845?v=4",
                "events_url": "https://api.github.com/users/egr95/events{/privacy}",
                "followers_url": "https://api.github.com/users/egr95/followers",
                "following_url": "https://api.github.com/users/egr95/following{/other_user}",
                "gists_url": "https://api.github.com/users/egr95/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/egr95",
                "id": 24964845,
                "login": "egr95",
                "node_id": "MDQ6VXNlcjI0OTY0ODQ1",
                "organizations_url": "https://api.github.com/users/egr95/orgs",
                "received_events_url": "https://api.github.com/users/egr95/received_events",
                "repos_url": "https://api.github.com/users/egr95/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/egr95/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/egr95/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/egr95",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Adding a link to a plugin that I just came across, which provides a neat solution to some of the above issues: [term-edit.nvim](https://github.com/chomosuke/term-edit.nvim).",
            "created_at": "2023-07-23T02:59:03Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-1646732268",
            "id": 1646732268,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM5iJyPs",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1646732268/reactions"
            },
            "updated_at": "2023-07-23T02:59:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1646732268",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24964845?v=4",
                "events_url": "https://api.github.com/users/egr95/events{/privacy}",
                "followers_url": "https://api.github.com/users/egr95/followers",
                "following_url": "https://api.github.com/users/egr95/following{/other_user}",
                "gists_url": "https://api.github.com/users/egr95/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/egr95",
                "id": 24964845,
                "login": "egr95",
                "node_id": "MDQ6VXNlcjI0OTY0ODQ1",
                "organizations_url": "https://api.github.com/users/egr95/orgs",
                "received_events_url": "https://api.github.com/users/egr95/received_events",
                "repos_url": "https://api.github.com/users/egr95/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/egr95/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/egr95/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/egr95",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Maybe we just need two APIs for this,\n\n* nvim_term_get_input(terminal_job_id)\n* nvim_term_set_input(terminal_job_id, input)\n",
            "created_at": "2025-10-13T09:16:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-3396577216",
            "id": 3396577216,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM7Kc6fA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3396577216/reactions"
            },
            "updated_at": "2025-10-13T09:16:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3396577216",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/288207?v=4",
                "events_url": "https://api.github.com/users/brookhong/events{/privacy}",
                "followers_url": "https://api.github.com/users/brookhong/followers",
                "following_url": "https://api.github.com/users/brookhong/following{/other_user}",
                "gists_url": "https://api.github.com/users/brookhong/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brookhong",
                "id": 288207,
                "login": "brookhong",
                "node_id": "MDQ6VXNlcjI4ODIwNw==",
                "organizations_url": "https://api.github.com/users/brookhong/orgs",
                "received_events_url": "https://api.github.com/users/brookhong/received_events",
                "repos_url": "https://api.github.com/users/brookhong/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brookhong/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brookhong/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brookhong",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@brookhong maybe, but that would be done as a channel API, not terminal-specific I think. And it's already possible to listen to the terminal channel given by the `&channel` buffer-local option.\n\nActually, how is your proposal going to solve this? The handler would need to understand the underlying process. Did you try `buftype=prompt` buffers?",
            "created_at": "2025-10-13T15:26:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-3397986610",
            "id": 3397986610,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM7KiSky",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3397986610/reactions"
            },
            "updated_at": "2025-10-13T15:27:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3397986610",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Just had a try by running zsh in a prompt buffer. Command line editing almost works with some exceptions such as `u`, but it does not work perfectly as a real terminal, since it needs a thorough callback function to handle I/O. Prompt buffer can be a good choice for prompt implementation of customized/lightweight shells in Neovim, but it does not work well with a complete external shell like bash/zsh at least for now.\n\nFor terminal buffer, I also prefer your approach above:\n\n> * copy the last line of the :terminal buffer to a new, temporary, editable floating window\n> * delete the shell prompt line: send `ctrl-u` or `<bs><bs><bs>...` (or `ctrl-c` in cmd.exe)\n>\n>   * guess the shell prompt \"prefix\" by comparing the state after clearing the prompt line\n> * send the user's edited line back to the terminal job (shell)\n\nBut it's not enough to copy only the last line, since for a long command input, it will be split into multiple lines in a terminal buffer. That's why we need an API `nvim_term_get_input` to get input, which can also avoid the trouble in Lua of handling different prompts based on user preferences / from different shells.\n\nTo set user edited content back to the terminal, currently we can use `vim.fn.chansend(terminal_job_id, \"\\x15\"..user_edited_content)`, but I'm not sure `\\x15` (which is `Ctrl-u`) works well for all shells. That's why we need `nvim_term_set_input`.\n",
            "created_at": "2025-10-14T01:14:51Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-3399601333",
            "id": 3399601333,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM7Kocy1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3399601333/reactions"
            },
            "updated_at": "2025-10-14T04:21:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3399601333",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/288207?v=4",
                "events_url": "https://api.github.com/users/brookhong/events{/privacy}",
                "followers_url": "https://api.github.com/users/brookhong/followers",
                "following_url": "https://api.github.com/users/brookhong/following{/other_user}",
                "gists_url": "https://api.github.com/users/brookhong/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brookhong",
                "id": 288207,
                "login": "brookhong",
                "node_id": "MDQ6VXNlcjI4ODIwNw==",
                "organizations_url": "https://api.github.com/users/brookhong/orgs",
                "received_events_url": "https://api.github.com/users/brookhong/received_events",
                "repos_url": "https://api.github.com/users/brookhong/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brookhong/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brookhong/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brookhong",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> since it needs a thorough callback function to handle I/O. ... but it does not work well with a complete external shell like bash/zsh at least for now.\n\nHow is that situation going to change in a terminal buffer running a shell process? `nvim_term_get_input` doesn't know anything about how the underlying shell (or whatever) process treats the input.\n\n> But it's not enough to copy only the last line, since for a long command input, it will be split into multiple lines in a terminal buffer.\n\nI did not say the last line.\n\nAnyway, this can probably be handled by emitting some sort of OSC sequence.",
            "created_at": "2025-10-14T04:21:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-3400057361",
            "id": 3400057361,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM7KqMIR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3400057361/reactions"
            },
            "updated_at": "2025-10-14T04:21:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3400057361",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I've been iterating on top of https://github.com/xb-bx/editable-term.nvim (mentioned in https://github.com/neovim/neovim/issues/8563#issuecomment-2802019894) with the intention of eventually opening a PR to Neovim in order to upstream it, and I've found some rough edges with the approach, even though it's almost all the way there. So, I wanted to receive some feedback on my proposal/findings before opening a PR proper.\n\nMy current version of `editable-term.lua` is https://github.com/TheLeoP/nvim-config/blob/bae7e8cd7eb6220e92174d7507145a465d562249/lua/personal/editable-term.lua#L1-L278 and all of my finding are on comments on that same file, some of the most significant are\n\n> Intercepting the `c` operator in `ModeChanged` does not work with empty regions (e.g. `ci\"` with the text `grep \"\"`) because the marks `[` and `]` return {0, 0}. TextYankPost can be used to compute the change ourselves and make this work with empty regions, but it wouldn't work when using the blackhole register.\n\n> The problem with empty ranges includes plugins workarounds like on mini.ai or targets.vim, but for a different reason. Their workaround is to insert a single space in the empty region, visually select it and allow only operators like `c` or `d` (because they'll be able to delete the space)\n\n> `TextChanged` gets retriggered by the changes made on `chansend()`, so we need to ignore it for a small amount of time\n\n> `TextChanged` gets triggered on terminal reflow, which may happen when opening a new window on a split or even on `q:`\n\nMy previous version of `editable-term.lua` (https://github.com/TheLeoP/nvim-config/blob/b07e6593afb9ba1d13b89e1cb1090d51f35a9dfc/lua/personal/editable-term.lua#L1-L266) didn't handle correctly `c` nor `d` when using the blackhole register, but it did handle empty regions with the `c` operator because it was computing the change itself inside of the `TetxYankPost` autocmd.\n\nAnother finding that I forgot to add to the file is that some shells have some kind of autosuggestion behavior where additional text will be shown in the prompt while typing (usually in a grayish shade), but will be discarded unless the user explicitly accepts it. Since Neovim has no way of distinguishing between the command typed by the user and the text suggested by the shell, my approach has been to add a configuration for a key to clean the autosuggestion and default it to an empty string.\n\nMy main modifications in top of the original editable-term.nvim are\n\n- correct handling of multibyte chars\n- handling prompts spanning multiple visual lines\n- handling changes made while using the blackhole register\n- drop support for pattern based prompt matching (at least in a first implementation) to simplify the code, relying solely in the OSC133 escape sequence (which, btw, seems to use `utf` indexing instead of `byte` indexing)\n\nI'm open to any kind of feedback, but I'll also try to create a PR later this week.\n\n@justinmk",
            "created_at": "2025-12-11T20:42:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-3643708670",
            "id": 3643708670,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM7ZLpT-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3643708670/reactions"
            },
            "updated_at": "2025-12-11T20:42:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3643708670",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/53507599?v=4",
                "events_url": "https://api.github.com/users/TheLeoP/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheLeoP/followers",
                "following_url": "https://api.github.com/users/TheLeoP/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheLeoP/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheLeoP",
                "id": 53507599,
                "login": "TheLeoP",
                "node_id": "MDQ6VXNlcjUzNTA3NTk5",
                "organizations_url": "https://api.github.com/users/TheLeoP/orgs",
                "received_events_url": "https://api.github.com/users/TheLeoP/received_events",
                "repos_url": "https://api.github.com/users/TheLeoP/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheLeoP/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheLeoP/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheLeoP",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "That seems like more evidence that [this approach](https://github.com/neovim/neovim/issues/23645#issuecomment-1576850696) is the most sane. Then the only \"messy part\" is (1) getting the line from the shell, and (2) updating/overwriting it. The ctrl-u approach is the \"dumb\" solution, and can always be replaced with a smart solution later. No other magic or hacks are needed, just show a normal buffer in a floatwin, then some keymap \"submits\" it.\n",
            "created_at": "2025-12-11T21:01:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/23645#issuecomment-3643761998",
            "id": 3643761998,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23645",
            "node_id": "IC_kwDOAPphoM7ZL2VO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3643761998/reactions"
            },
            "updated_at": "2025-12-11T21:02:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3643761998",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 11,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23645/comments",
    "created_at": "2023-05-16T01:08:49Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23645/events",
    "html_url": "https://github.com/neovim/neovim/issues/23645",
    "id": 1711051415,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23645/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5l_JKX",
    "number": 23645,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 16,
        "-1": 0,
        "confused": 0,
        "eyes": 5,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 21,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23645/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23645/timeline",
    "title": "\"modifiable\" terminal emulator (i.e., enable normal mode commands in terminal buffers)",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-12-11T21:02:47Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23645",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24964845?v=4",
        "events_url": "https://api.github.com/users/egr95/events{/privacy}",
        "followers_url": "https://api.github.com/users/egr95/followers",
        "following_url": "https://api.github.com/users/egr95/following{/other_user}",
        "gists_url": "https://api.github.com/users/egr95/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/egr95",
        "id": 24964845,
        "login": "egr95",
        "node_id": "MDQ6VXNlcjI0OTY0ODQ1",
        "organizations_url": "https://api.github.com/users/egr95/orgs",
        "received_events_url": "https://api.github.com/users/egr95/received_events",
        "repos_url": "https://api.github.com/users/egr95/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/egr95/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/egr95/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/egr95",
        "user_view_type": "public"
    }
}
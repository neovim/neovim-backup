{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nHi,\r\n\r\nI am working for a large software company. Our codebase is remote, and mounted locally on the workstations. We also have various automation tools which pick up changes to the files and perform build, test, deployment, etc.\r\n\r\nEver since Neovim 0.10+, there appeared quite annoying behavior in this workflow. When you save the file in Neovim, our automation tools first pick up a change to the file having no contents (as if the file was written completely empty), the build/test fails, and only on the second attempt it succeeds.\r\n\r\nI have debugged this problem and traced the root cause to writing extended attributes from Neovim. If I run `strace` on Neovim 0.9+ vs any commit after 0.10+, then I see the difference of making various xattr calls in Neovim 0.10.+ (see strace output attached below). Since there are many attributes to set, the file write operation is also significantly slower (although that is still tolerable).\r\n\r\nI have also verified in a local build that if I remove the calls to [os_copy_xattr](https://github.com/neovim/neovim/blob/69553f7bf55c060733553d96a068c1104c885bce/src/nvim/os/fs.c#L790), then the issue disappears. \r\n\r\nDo you think it would be possible to add a configuration option to disable the handling of extended attributes?\r\n\r\nHere is the output of `strace -e trace=file --decode-fds=path -p xxx` showing a single \":w\" call. Note that file names and attribute names are masked. See the block of xattr calls in the middle of the trace.\r\n\r\n```\r\n# These calls are \r\nstatx(AT_FDCWD</masked>, \"/masked/filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"/masked/filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"/masked/filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\naccess(\"/masked/filename.cc\", W_OK) = 0\r\nstatx(AT_FDCWD</masked>, \"/masked/filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\naccess(\"filename.cc\", W_OK) = 0\r\nstatx(AT_FDCWD</masked>, \"filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"filename.cc\", AT_STATX_SYNC_AS_STAT|AT_SYMLINK_NOFOLLOW, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"masked/4913\", AT_STATX_SYNC_AS_STAT|AT_SYMLINK_NOFOLLOW, STATX_ALL, 0x7ffd0fa2f500) = -1 ENOENT (No such file or directory)\r\nopenat(AT_FDCWD</masked>, \"masked/4913\", O_WRONLY|O_CREAT|O_EXCL|O_NOFOLLOW|O_CLOEXEC, 0100664) = 16</masked/masked/4913>\r\nstatx(AT_FDCWD</masked>, \"masked/4913\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=0, ...}) = 0\r\nunlink(\"masked/4913\") = 0\r\nstatx(AT_FDCWD</masked>, \"filename.cc~\", AT_STATX_SYNC_AS_STAT, STATX_ALL, 0x7ffd0fa2f6e0) = -1 ENOENT (No such file or directory)\r\nstatx(AT_FDCWD</masked>, \"filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14205, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"filename.cc~\", AT_STATX_SYNC_AS_STAT, STATX_ALL, 0x7ffd0fa2f380) = -1 ENOENT (No such file or directory)\r\nunlink(\"filename.cc~\") = -1 ENOENT (No such file or directory)\r\nrename(\"filename.cc\", \"filename.cc~\") = 0\r\nopenat(AT_FDCWD</masked>, \"filename.cc\", O_WRONLY|O_CREAT|O_TRUNC|O_CLOEXEC, 0664) = 16</masked/filename.cc>\r\n\r\n# These calls are made only in Neovim 0.10+\r\nlistxattr(\"filename.cc~\", NULL, 0) = 122\r\nlistxattr(\"filename.cc~\", \"masked\"..., 122) = 122\r\ngetxattr(\"filename.cc~\", \"masked\", NULL, 0) = 103\r\ngetxattr(\"filename.cc~\", \"masked\", NULL, 0) = 32\r\ngetxattr(\"filename.cc~\", \"masked\", NULL, 0) = 16\r\ngetxattr(\"filename.cc~\", \"masked\", NULL, 0) = 36\r\ngetxattr(\"filename.cc~\", \"masked\", NULL, 0) = 64\r\ngetxattr(\"filename.cc~\", \"masked\", NULL, 0) = 60\r\ngetxattr(\"filename.cc~\", \"masked\", \"masked\"..., 103) = 103\r\nsetxattr(\"filename.cc\", \"masked\", \"masked\"..., 103, 0) = -1 EOPNOTSUPP (Operation not supported)\r\ngetxattr(\"filename.cc~\", \"masked\", \"...\", 103) = 32\r\nsetxattr(\"filename.cc\", \"masked\", \"...\", 32, 0) = -1 EOPNOTSUPP (Operation not supported)\r\ngetxattr(\"filename.cc~\", \"masked\", \"...\", 103) = 16\r\nsetxattr(\"filename.cc\", \"masked\", \"...\", 16, 0) = -1 EOPNOTSUPP (Operation not supported)\r\ngetxattr(\"filename.cc~\", \"masked\", \"...\"..., 103) = 36\r\nsetxattr(\"filename.cc\", \"masked\", \"...\"..., 36, 0) = -1 EOPNOTSUPP (Operation not supported)\r\ngetxattr(\"filename.cc~\", \"masked\", \"...\"..., 103) = 64\r\nsetxattr(\"filename.cc\", \"masked\", \"...\"..., 64, 0) = -1 EOPNOTSUPP (Operation not supported)\r\ngetxattr(\"filename.cc~\", \"masked\", \"//masked\"..., 103) = 60\r\nsetxattr(\"filename.cc\", \"masked\", \"//masked\"..., 60, 0) = -1 EOPNOTSUPP (Operation not supported)\r\n# End of Neovim xattr calls\r\n\r\nstatx(AT_FDCWD</masked>, \"filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14206, ...}) = 0\r\nstatx(AT_FDCWD</masked>, \"filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14206, ...}) = 0\r\nchmod(\"filename.cc\", 0100664) = 0\r\nstatx(AT_FDCWD</masked>, \"/masked/filename.cc\", AT_STATX_SYNC_AS_STAT, STATX_ALL, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0664, stx_size=14206, ...}) = 0\r\nunlink(\"filename.cc~\") = 0\r\n```\r\n\r\n### Expected behavior\r\n\r\nMake it possible to disable copying of extended attributes via a configuration option.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Does this happen in Vim 9.1+? If yes, it may be better to open such a request for Vim as well.",
            "created_at": "2024-09-28T23:24:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/30562#issuecomment-2381021964",
            "id": 2381021964,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30562",
            "node_id": "IC_kwDOAPphoM6N64MM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2381021964/reactions"
            },
            "updated_at": "2024-09-28T23:25:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2381021964",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "NONE",
            "body": "Yes, thanks, the same issue exists in Vim 9.1+. Filed https://github.com/vim/vim/issues/15765 as well.",
            "created_at": "2024-09-29T08:19:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/30562#issuecomment-2381257858",
            "id": 2381257858,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30562",
            "node_id": "IC_kwDOAPphoM6N7xyC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2381257858/reactions"
            },
            "updated_at": "2024-09-29T08:19:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2381257858",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/16953692?v=4",
                "events_url": "https://api.github.com/users/defr0std/events{/privacy}",
                "followers_url": "https://api.github.com/users/defr0std/followers",
                "following_url": "https://api.github.com/users/defr0std/following{/other_user}",
                "gists_url": "https://api.github.com/users/defr0std/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/defr0std",
                "id": 16953692,
                "login": "defr0std",
                "node_id": "MDQ6VXNlcjE2OTUzNjky",
                "organizations_url": "https://api.github.com/users/defr0std/orgs",
                "received_events_url": "https://api.github.com/users/defr0std/received_events",
                "repos_url": "https://api.github.com/users/defr0std/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/defr0std/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/defr0std/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/defr0std"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30562/comments",
    "created_at": "2024-09-28T22:12:42Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30562/events",
    "html_url": "https://github.com/neovim/neovim/issues/30562",
    "id": 2554539116,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "performance, latency, cpu/memory usage",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "upstream issue that must be fixed in Vim first",
            "id": 2639399975,
            "name": "needs:vim-patch",
            "node_id": "MDU6TGFiZWwyNjM5Mzk5OTc1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:vim-patch"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "file metadata/attributes, filenames, path manipulation",
            "id": 3386070083,
            "name": "filesystem",
            "node_id": "LA_kwDOAPphoM7J01RD",
            "url": "https://api.github.com/repos/neovim/neovim/labels/filesystem"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30562/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 649,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 589,
        "state": "open",
        "title": "backlog",
        "updated_at": "2024-09-30T17:10:20Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM6YQyxs",
    "number": 30562,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30562/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30562/timeline",
    "title": "Option to disable writing extended attributes",
    "updated_at": "2024-09-29T09:09:15Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30562",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/16953692?v=4",
        "events_url": "https://api.github.com/users/defr0std/events{/privacy}",
        "followers_url": "https://api.github.com/users/defr0std/followers",
        "following_url": "https://api.github.com/users/defr0std/following{/other_user}",
        "gists_url": "https://api.github.com/users/defr0std/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/defr0std",
        "id": 16953692,
        "login": "defr0std",
        "node_id": "MDQ6VXNlcjE2OTUzNjky",
        "organizations_url": "https://api.github.com/users/defr0std/orgs",
        "received_events_url": "https://api.github.com/users/defr0std/received_events",
        "repos_url": "https://api.github.com/users/defr0std/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/defr0std/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/defr0std/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/defr0std"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Neovim version (nvim -v)\r\n\r\nNVIM v0.7.0\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNo\r\n\r\n### Operating system/version\r\n\r\nWindows 10 20H2 19044.1645\r\n\r\n### Terminal name/version\r\n\r\nWindows Terminal 1.12.10732.0\r\n\r\n### $TERM environment variable\r\n\r\nempty\r\n\r\n### Installation\r\n\r\nchocolatey\r\n\r\n### How to reproduce the issue\r\n\r\n```\r\nnvim --clean\r\n```\r\n\r\nEdit so buffer contains two lines: \"abc\" and \"def\"\r\n\r\n```\r\n:lua vim.region(0, {0, 0}, {1, 1}, '^V', true)\r\n```\r\n\r\nNote the '^V' is the actual ctrl-v character, not the two characters '^' and 'V'.\r\n\r\n### Expected behavior\r\n\r\nThe function succeeds\r\n\r\n### Actual behavior\r\n\r\nThe function fails with the error below:\r\n\r\n```\r\nE5108: Error executing lua vim/_editor.lua:347: attempt to perform arithmetic on a string value\r\nstack traceback:\r\n        vim/_editor.lua:347: in function 'region'\r\n        [string \":lua\"]:1: in main chunk\r\n```\r\n\r\nThis seems to come from the line `c2 = c1 + regtype:sub(2)` in `vim.region`. It apparently expects a number to come after the '^V'. This seems to be allowed by `:h setreg()`, but here there are a couple problems:\r\n\r\n1. The number isn't treated as optional.\r\n2. The string isn't converted to a number before adding it to `c1`.\r\n\r\nThis seems similar to #17140, which was closed as external.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "After looking into it a bit more, the issue seems to be specifically that the number isn't treated as optional. Lua successfully adds numbers with strings that can be converted to numbers. If the number is provided, it works properly. That's how `vim.highlight.on_yank` does it.\r\n\r\nAlso, no longer think it's similar to #17140.",
            "created_at": "2022-04-17T23:55:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/18154#issuecomment-1100971032",
            "id": 1100971032,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18154",
            "node_id": "IC_kwDOAPphoM5Bn3wY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1100971032/reactions"
            },
            "updated_at": "2022-04-17T23:57:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1100971032",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2928612?v=4",
                "events_url": "https://api.github.com/users/binyomen/events{/privacy}",
                "followers_url": "https://api.github.com/users/binyomen/followers",
                "following_url": "https://api.github.com/users/binyomen/following{/other_user}",
                "gists_url": "https://api.github.com/users/binyomen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/binyomen",
                "id": 2928612,
                "login": "binyomen",
                "node_id": "MDQ6VXNlcjI5Mjg2MTI=",
                "organizations_url": "https://api.github.com/users/binyomen/orgs",
                "received_events_url": "https://api.github.com/users/binyomen/received_events",
                "repos_url": "https://api.github.com/users/binyomen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/binyomen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/binyomen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/binyomen",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I have the same issue. Did you manage to fix it somehow? Is it maybe at least possible to suppress this error? It makes my NeoVim freeze for a while.",
            "created_at": "2022-08-30T09:08:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/18154#issuecomment-1231384307",
            "id": 1231384307,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18154",
            "node_id": "IC_kwDOAPphoM5JZW7z",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1231384307/reactions"
            },
            "updated_at": "2022-08-30T09:08:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1231384307",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24566904?v=4",
                "events_url": "https://api.github.com/users/pchabros/events{/privacy}",
                "followers_url": "https://api.github.com/users/pchabros/followers",
                "following_url": "https://api.github.com/users/pchabros/following{/other_user}",
                "gists_url": "https://api.github.com/users/pchabros/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/pchabros",
                "id": 24566904,
                "login": "pchabros",
                "node_id": "MDQ6VXNlcjI0NTY2OTA0",
                "organizations_url": "https://api.github.com/users/pchabros/orgs",
                "received_events_url": "https://api.github.com/users/pchabros/received_events",
                "repos_url": "https://api.github.com/users/pchabros/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/pchabros/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pchabros/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/pchabros",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I did something [like this](https://github.com/binyomen/dotfiles/blob/95325129a61829a75b79b76c2847b9528bd57606/vim/vimrc_lua/util.lua#L172-L199) in my config as a hacky workaround:\r\n\r\n```lua\r\n-- We need to finagle the input of vim.highlight.range a bit due to\r\n-- https://github.com/neovim/neovim/issues/18154 and\r\n-- https://github.com/neovim/neovim/issues/18155.\r\nif visual_char == 'V' then\r\n    start[2] = 0\r\n    finish[2] = 9999999\r\nelseif visual_char == t'<c-v>' then\r\n    visual_char = reg.regtype\r\nend\r\n\r\nvim.highlight.range(\r\n    0 --[[bufnr]],\r\n    namespace,\r\n    group,\r\n    start,\r\n    finish,\r\n    {regtype = visual_char, inclusive = true}\r\n)\r\n```\r\n\r\nBasically to get rid of the error make sure there's a width value in the `regtype` attribute. I get this from a registry table passed in to the function.",
            "created_at": "2022-08-30T09:15:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/18154#issuecomment-1231392582",
            "id": 1231392582,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18154",
            "node_id": "IC_kwDOAPphoM5JZY9G",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1231392582/reactions"
            },
            "updated_at": "2022-08-30T09:16:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1231392582",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2928612?v=4",
                "events_url": "https://api.github.com/users/binyomen/events{/privacy}",
                "followers_url": "https://api.github.com/users/binyomen/followers",
                "following_url": "https://api.github.com/users/binyomen/following{/other_user}",
                "gists_url": "https://api.github.com/users/binyomen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/binyomen",
                "id": 2928612,
                "login": "binyomen",
                "node_id": "MDQ6VXNlcjI5Mjg2MTI=",
                "organizations_url": "https://api.github.com/users/binyomen/orgs",
                "received_events_url": "https://api.github.com/users/binyomen/received_events",
                "repos_url": "https://api.github.com/users/binyomen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/binyomen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/binyomen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/binyomen",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/18154/comments",
    "created_at": "2022-04-17T23:17:00Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/18154/events",
    "html_url": "https://github.com/neovim/neovim/issues/18154",
    "id": 1206509472,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/18154/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5H6d-g",
    "number": 18154,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/18154/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/18154/timeline",
    "title": "vim.region errors on block regtype",
    "updated_at": "2025-01-19T11:36:31Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/18154",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2928612?v=4",
        "events_url": "https://api.github.com/users/binyomen/events{/privacy}",
        "followers_url": "https://api.github.com/users/binyomen/followers",
        "following_url": "https://api.github.com/users/binyomen/following{/other_user}",
        "gists_url": "https://api.github.com/users/binyomen/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/binyomen",
        "id": 2928612,
        "login": "binyomen",
        "node_id": "MDQ6VXNlcjI5Mjg2MTI=",
        "organizations_url": "https://api.github.com/users/binyomen/orgs",
        "received_events_url": "https://api.github.com/users/binyomen/received_events",
        "repos_url": "https://api.github.com/users/binyomen/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/binyomen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/binyomen/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/binyomen",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\n\n    Error executing lua callback: /usr/local/share/nvim/runtime/lua/vim/lsp/sync.lua:142: attempt to get length of local 'prev_line' (a nil value)\n    stack traceback:\n            /usr/local/share/nvim/runtime/lua/vim/lsp/sync.lua:142: in function 'compute_start_range'\n            /usr/local/share/nvim/runtime/lua/vim/lsp/sync.lua:390: in function 'compute_diff'\n            ...local/share/nvim/runtime/lua/vim/lsp/_changetracking.lua:106: in function 'incremental_changes'\n            ...local/share/nvim/runtime/lua/vim/lsp/_changetracking.lua:311: in function 'send_changes_for_group'\n            ...local/share/nvim/runtime/lua/vim/lsp/_changetracking.lua:348: in function 'send_changes'\n            /usr/local/share/nvim/runtime/lua/vim/lsp.lua:869: in function </usr/local/share/nvim/runtime/lua/vim/lsp.lua:863>\n\n\n\nRelated: https://github.com/neovim/neovim/issues/33142\n\n\n\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\n\nDon't have exact steps. Try using lsp-driven autocompletion in a `buftype=prompt` buffer.\n\n### Expected behavior\n\nlsp module should never fail in this way. It should check that buffers/windows are valid before trying to operate on them.\n\n### Nvim version (nvim -v)\n\n0.12\n\n### Language server name/version\n\nany\n\n### Operating system/version\n\nmacos\n\n### Log file\n\n_No response_",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Hi, I am getting a similar error message when using `:AvanteEdit` on a block of code that begins with file first line (I think). It does not happen with neovim 0.10.4, is reproducible every time with 0.11.0. Thank you.\n\n```\nError executing vim.schedule lua callback: ...cal/share/nvim/lazy/avante.nvim/lua/avante/selection.lua:164: Vim:Error executing lua callback\n: ...unwrapped-0.11.0/share/nvim/runtime/lua/vim/lsp/sync.lua:195: attempt to get length of local 'prev_line' (a nil value)\nstack traceback:\n        ...unwrapped-0.11.0/share/nvim/runtime/lua/vim/lsp/sync.lua:195: in function 'compute_end_range'\n        ...unwrapped-0.11.0/share/nvim/runtime/lua/vim/lsp/sync.lua:401: in function 'compute_diff'\n        ....11.0/share/nvim/runtime/lua/vim/lsp/_changetracking.lua:106: in function 'incremental_changes'\n        ....11.0/share/nvim/runtime/lua/vim/lsp/_changetracking.lua:311: in function 'send_changes_for_group'\n        ....11.0/share/nvim/runtime/lua/vim/lsp/_changetracking.lua:348: in function 'send_changes'\n        ...ovim-unwrapped-0.11.0/share/nvim/runtime/lua/vim/lsp.lua:869: in function <...ovim-unwrapped-0.11.0/share/nvim/runtime/lua/vim/ls\np.lua:863>\n        [C]: in function 'nvim_buf_set_lines'\n        ...cal/share/nvim/lazy/avante.nvim/lua/avante/selection.lua:164: in function ''\n        vim/_editor.lua: in function <vim/_editor.lua:0>\nstack traceback:\n        [C]: in function 'nvim_buf_set_lines'\n        ...cal/share/nvim/lazy/avante.nvim/lua/avante/selection.lua:164: in function ''\n        vim/_editor.lua: in function <vim/_editor.lua:0>\n```",
            "created_at": "2025-04-02T10:59:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-2772202181",
            "id": 2772202181,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM6lPHLF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2772202181/reactions"
            },
            "updated_at": "2025-04-02T10:59:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2772202181",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15679217?v=4",
                "events_url": "https://api.github.com/users/Kamilcuk/events{/privacy}",
                "followers_url": "https://api.github.com/users/Kamilcuk/followers",
                "following_url": "https://api.github.com/users/Kamilcuk/following{/other_user}",
                "gists_url": "https://api.github.com/users/Kamilcuk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Kamilcuk",
                "id": 15679217,
                "login": "Kamilcuk",
                "node_id": "MDQ6VXNlcjE1Njc5MjE3",
                "organizations_url": "https://api.github.com/users/Kamilcuk/orgs",
                "received_events_url": "https://api.github.com/users/Kamilcuk/received_events",
                "repos_url": "https://api.github.com/users/Kamilcuk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Kamilcuk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Kamilcuk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Kamilcuk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@Kamilcuk are you using `vim.lsp.config` / `vim.lsp.enable` ? I'm wondering if this correlates with that.",
            "created_at": "2025-04-02T12:21:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-2772391999",
            "id": 2772391999,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM6lP1g_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2772391999/reactions"
            },
            "updated_at": "2025-04-02T12:22:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2772391999",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "In Neovim 0.11, this error occurs whenever a swap file is present for the active buffer. Deleting the swap file fixes the error.",
            "created_at": "2025-04-17T18:56:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-2813783479",
            "id": 2813783479,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM6ntu23",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 4,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2813783479/reactions"
            },
            "updated_at": "2025-04-17T18:56:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2813783479",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13303?v=4",
                "events_url": "https://api.github.com/users/jrasanen/events{/privacy}",
                "followers_url": "https://api.github.com/users/jrasanen/followers",
                "following_url": "https://api.github.com/users/jrasanen/following{/other_user}",
                "gists_url": "https://api.github.com/users/jrasanen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jrasanen",
                "id": 13303,
                "login": "jrasanen",
                "node_id": "MDQ6VXNlcjEzMzAz",
                "organizations_url": "https://api.github.com/users/jrasanen/orgs",
                "received_events_url": "https://api.github.com/users/jrasanen/received_events",
                "repos_url": "https://api.github.com/users/jrasanen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jrasanen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jrasanen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jrasanen",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> are you using vim.lsp.config / vim.lsp.enable ? \n\nyes",
            "created_at": "2025-04-17T22:11:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-2814115295",
            "id": 2814115295,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM6nu_3f",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2814115295/reactions"
            },
            "updated_at": "2025-04-17T22:11:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2814115295",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15679217?v=4",
                "events_url": "https://api.github.com/users/Kamilcuk/events{/privacy}",
                "followers_url": "https://api.github.com/users/Kamilcuk/followers",
                "following_url": "https://api.github.com/users/Kamilcuk/following{/other_user}",
                "gists_url": "https://api.github.com/users/Kamilcuk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Kamilcuk",
                "id": 15679217,
                "login": "Kamilcuk",
                "node_id": "MDQ6VXNlcjE1Njc5MjE3",
                "organizations_url": "https://api.github.com/users/Kamilcuk/orgs",
                "received_events_url": "https://api.github.com/users/Kamilcuk/received_events",
                "repos_url": "https://api.github.com/users/Kamilcuk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Kamilcuk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Kamilcuk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Kamilcuk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@justinmk Hey, I've observed the issue described by @Kamilcuk as well (currently on nightly), calling:\n\n```\n:lua vim.api.nvim_buf_set_lines(0, 0, 0, false, {})\n```\n\non empty file with single line explodes on the assert\n\nhttps://github.com/neovim/neovim/blob/a0d94ac4692a046e88850d512112754c4b8d7013/runtime/lua/vim/lsp/sync.lua#L192-L195\n",
            "created_at": "2025-08-08T16:12:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-3168464763",
            "id": 3168464763,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM682u97",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3168464763/reactions"
            },
            "updated_at": "2025-08-08T16:13:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3168464763",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8431097?v=4",
                "events_url": "https://api.github.com/users/Robitx/events{/privacy}",
                "followers_url": "https://api.github.com/users/Robitx/followers",
                "following_url": "https://api.github.com/users/Robitx/following{/other_user}",
                "gists_url": "https://api.github.com/users/Robitx/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Robitx",
                "id": 8431097,
                "login": "Robitx",
                "node_id": "MDQ6VXNlcjg0MzEwOTc=",
                "organizations_url": "https://api.github.com/users/Robitx/orgs",
                "received_events_url": "https://api.github.com/users/Robitx/received_events",
                "repos_url": "https://api.github.com/users/Robitx/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Robitx/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Robitx/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Robitx",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Unless you have steps to repro with `nvim --clean`, don't bother with \"me too\" comments.",
            "created_at": "2025-08-08T21:50:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-3169387794",
            "id": 3169387794,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM686QUS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3169387794/reactions"
            },
            "updated_at": "2025-08-08T21:50:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3169387794",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Literally the comment above this one says to stop posting \"me too\" comments. Read the room, people.",
            "created_at": "2025-08-19T14:54:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-3201095346",
            "id": 3201095346,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM6-zNay",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3201095346/reactions"
            },
            "updated_at": "2025-08-19T14:54:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3201095346",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Is there any workaround until the bug gets fixed?",
            "created_at": "2025-11-03T12:59:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-3480404395",
            "id": 3480404395,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM7PcsGr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3480404395/reactions"
            },
            "updated_at": "2025-11-03T13:10:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3480404395",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4207230?v=4",
                "events_url": "https://api.github.com/users/uroybd/events{/privacy}",
                "followers_url": "https://api.github.com/users/uroybd/followers",
                "following_url": "https://api.github.com/users/uroybd/following{/other_user}",
                "gists_url": "https://api.github.com/users/uroybd/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/uroybd",
                "id": 4207230,
                "login": "uroybd",
                "node_id": "MDQ6VXNlcjQyMDcyMzA=",
                "organizations_url": "https://api.github.com/users/uroybd/orgs",
                "received_events_url": "https://api.github.com/users/uroybd/received_events",
                "repos_url": "https://api.github.com/users/uroybd/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/uroybd/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/uroybd/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/uroybd",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "This type of issues will come more and more as we use more agentic ai ,  the situation of having an external process modifying buffers that you have opened in nvim.",
            "created_at": "2025-11-07T11:53:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-3502126615",
            "id": 3502126615,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM7QvjYX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3502126615/reactions"
            },
            "updated_at": "2025-11-07T11:53:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3502126615",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4983875?v=4",
                "events_url": "https://api.github.com/users/bechampion/events{/privacy}",
                "followers_url": "https://api.github.com/users/bechampion/followers",
                "following_url": "https://api.github.com/users/bechampion/following{/other_user}",
                "gists_url": "https://api.github.com/users/bechampion/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bechampion",
                "id": 4983875,
                "login": "bechampion",
                "node_id": "MDQ6VXNlcjQ5ODM4NzU=",
                "organizations_url": "https://api.github.com/users/bechampion/orgs",
                "received_events_url": "https://api.github.com/users/bechampion/received_events",
                "repos_url": "https://api.github.com/users/bechampion/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bechampion/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bechampion/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bechampion",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I've worked with claude for a bit to come up with a \"fix\" obvs this needs testing and what not \n```\ndiff --git a/runtime/lua/vim/lsp/sync.lua b/runtime/lua/vim/lsp/sync.lua\nindex 36a94d5fba..9783b7856f 100644\n--- a/runtime/lua/vim/lsp/sync.lua\n+++ b/runtime/lua/vim/lsp/sync.lua\n@@ -133,8 +133,14 @@ local function compute_start_range(\n     return { line_idx = firstline, byte_idx = 1, char_idx = 1 }\n   end\n \n-  local prev_line = assert(prev_lines[firstline])\n-  local curr_line = assert(curr_lines[firstline])\n+  -- Bounds check: ensure prev_lines and curr_lines have the required indices\n+  if not prev_lines or not prev_lines[firstline] or not curr_lines or not curr_lines[firstline] then\n+    -- If we can't get the lines, return a safe default\n+    return { line_idx = firstline, byte_idx = 1, char_idx = 1 }\n+  end\n+\n+  local prev_line = prev_lines[firstline]\n+  local curr_line = curr_lines[firstline]\n \n   -- Iterate across previous and current line containing first change\n   -- to find the first different byte.\n@@ -192,12 +198,17 @@ local function compute_end_range(\n   -- A special case for the following `firstline == new_lastline` case where lines are deleted.\n   -- Even if the buffer has become empty, nvim behaves as if it has an empty line with eol.\n   if #curr_lines == 1 and curr_lines[1] == '' then\n-    local prev_line = assert(prev_lines[lastline - 1])\n-    return {\n-      line_idx = lastline - 1,\n-      byte_idx = #prev_line + 1,\n-      char_idx = str_utfindex(prev_line, position_encoding) + 1,\n-    }, { line_idx = 1, byte_idx = 1, char_idx = 1 }\n+    if prev_lines and prev_lines[lastline - 1] then\n+      local prev_line = prev_lines[lastline - 1]\n+      return {\n+        line_idx = lastline - 1,\n+        byte_idx = #prev_line + 1,\n+        char_idx = str_utfindex(prev_line, position_encoding) + 1,\n+      }, { line_idx = 1, byte_idx = 1, char_idx = 1 }\n+    else\n+      -- Fallback if prev_line doesn't exist\n+      return { line_idx = lastline - 1, byte_idx = 1, char_idx = 1 }, { line_idx = 1, byte_idx = 1, char_idx = 1 }\n+    end\n   end\n   -- If firstline == new_lastline, the first change occurred on a line that was deleted.\n   -- In this case, the last_byte...\n@@ -222,8 +233,13 @@ local function compute_end_range(\n   local prev_line_idx = lastline - 1\n   local curr_line_idx = new_lastline - 1\n \n-  local prev_line = assert(prev_lines[lastline - 1])\n-  local curr_line = assert(curr_lines[new_lastline - 1])\n+  -- Bounds check for last lines\n+  if not prev_lines or not prev_lines[lastline - 1] or not curr_lines or not curr_lines[new_lastline - 1] then\n+    return { line_idx = lastline - 1, byte_idx = 1, char_idx = 1 }, { line_idx = new_lastline - 1, byte_idx = 1, char_idx = 1 }\n+  end\n+\n+  local prev_line = prev_lines[lastline - 1]\n+  local curr_line = curr_lines[new_lastline - 1]\n \n   local prev_line_length = #prev_line\n   local curr_line_length = #curr_line\n``` \n48 hours in , so far so good\n",
            "created_at": "2025-11-10T15:05:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/33224#issuecomment-3512251269",
            "id": 3512251269,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33224",
            "node_id": "IC_kwDOAPphoM7RWLOF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3512251269/reactions"
            },
            "updated_at": "2025-11-10T15:05:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3512251269",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4983875?v=4",
                "events_url": "https://api.github.com/users/bechampion/events{/privacy}",
                "followers_url": "https://api.github.com/users/bechampion/followers",
                "following_url": "https://api.github.com/users/bechampion/following{/other_user}",
                "gists_url": "https://api.github.com/users/bechampion/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bechampion",
                "id": 4983875,
                "login": "bechampion",
                "node_id": "MDQ6VXNlcjQ5ODM4NzU=",
                "organizations_url": "https://api.github.com/users/bechampion/orgs",
                "received_events_url": "https://api.github.com/users/bechampion/received_events",
                "repos_url": "https://api.github.com/users/bechampion/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bechampion/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bechampion/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bechampion",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 10,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/33224/comments",
    "created_at": "2025-03-31T13:59:31Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/33224/events",
    "html_url": "https://github.com/neovim/neovim/issues/33224",
    "id": 2960592572,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/33224/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 1,
        "created_at": "2025-11-02T23:16:37Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
            "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
            "followers_url": "https://api.github.com/users/zeertzjq/followers",
            "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
            "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zeertzjq",
            "id": 35768171,
            "login": "zeertzjq",
            "node_id": "MDQ6VXNlcjM1NzY4MTcx",
            "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
            "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
            "repos_url": "https://api.github.com/users/zeertzjq/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zeertzjq",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/54",
        "id": 14032334,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/54/labels",
        "node_id": "MI_kwDOAPphoM4A1h3O",
        "number": 54,
        "open_issues": 19,
        "state": "open",
        "title": "0.11.6",
        "updated_at": "2025-11-10T03:11:14Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/54"
    },
    "node_id": "I_kwDOAPphoM6wdw68",
    "number": 33224,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 7,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 7,
        "url": "https://api.github.com/repos/neovim/neovim/issues/33224/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/33224/timeline",
    "title": "LSP: nil reference in `compute_start_range`",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-11-10T15:05:17Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/33224",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    }
}
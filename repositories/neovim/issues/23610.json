{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nThe winbar is currently sent as part of the main window. This makes it impossible to implement smooth scrolling using the ui protocol when Winbar is enabled. The winbar should stay in place when scrolling, but we don't know which lines are affected, so it would scroll with the rest of the window, and then finally probably snap into the right location when the screen is updated.\r\n\r\nFor more information see some of the reports in my PR for Neovide here https://github.com/neovide/neovide/pull/1790\n\n### Expected behavior\n\nIf winbar had its own window id, like all the other windows, like tabbars, status bars, command line and so on this would not be a problem.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I don't think we want a separate window id for \"widgets\" as part of the window grid. What we need to supply the full information to the UI how many cells on the top, left, right, and bottom are being used as fixed areas instead of the main scrolling text (currently only top may be non-zero as only winbar is rendered this way, but there might be native support for more widgets later).",
            "created_at": "2023-12-22T09:08:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/23610#issuecomment-1867430580",
            "id": 1867430580,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23610",
            "node_id": "IC_kwDOAPphoM5vTrq0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1867430580/reactions"
            },
            "updated_at": "2023-12-22T09:08:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1867430580",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@bfredl, I was going to propose something like that myself, when I have more time to think about it, as the native floating window borders are also broken in the same way in Neovide. But there have been much fewer reports about it, since very few plugins actually use that feature.\r\n\r\nBut I have been busy with finally getting things ready for a new Neovide release. And one of the things is a very hacky way to get it working with the current released neovim version.\r\n* https://github.com/neovide/neovide/pull/2165\r\n\r\nMy solution is based on detecting the highlight groups, which are in no way guaranteed, but that's the only information we have currently. So, with that a line with only float borders is considered a top or bottom border, and so is any line with at least one winbar highlight.\r\n\r\nThere's also the problem that the `ext_hlstate` only reports the names of the final highlight group in case of links, so another hack had to be done to work around that:\r\nhttps://github.com/neovide/neovide/pull/2165/files#diff-96e67d744565c0dc461711b437b734a4d58cdc3ddac82c61fe7d722db3573f9bR106-R121\r\n\r\nThere are a couple of things that I think are documented wrong about the `hl_state`, and indicated so by comments in that PR.",
            "created_at": "2023-12-22T10:39:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/23610#issuecomment-1867527380",
            "id": 1867527380,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23610",
            "node_id": "IC_kwDOAPphoM5vUDTU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1867527380/reactions"
            },
            "updated_at": "2023-12-22T10:39:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1867527380",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9946255?v=4",
                "events_url": "https://api.github.com/users/fredizzimo/events{/privacy}",
                "followers_url": "https://api.github.com/users/fredizzimo/followers",
                "following_url": "https://api.github.com/users/fredizzimo/following{/other_user}",
                "gists_url": "https://api.github.com/users/fredizzimo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/fredizzimo",
                "id": 9946255,
                "login": "fredizzimo",
                "node_id": "MDQ6VXNlcjk5NDYyNTU=",
                "organizations_url": "https://api.github.com/users/fredizzimo/orgs",
                "received_events_url": "https://api.github.com/users/fredizzimo/received_events",
                "repos_url": "https://api.github.com/users/fredizzimo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/fredizzimo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/fredizzimo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/fredizzimo"
            }
        },
        {
            "author_association": "NONE",
            "body": "@bfredl @fredizzimo \r\nI am a developer of another GUI, goneovim, and have a similar problem regarding winbar and smooth scrolling.\r\n\r\nInstead of using a method of detecting `winbar` by highlighting groups of content, goneovim has a mechanism for handling this problem, which handles whether or not the top line is excluded from the scrolling range depending on whether or not the `winbar` option has some value in it.\r\n\r\nThis method has been confirmed to work reasonably well, but there is one problem. \r\nIt may take a long time to get the options from individual windows. I have not been able to determine the cause of this problem, but I have confirmed that in configurations where this problem occurs, there is a delay in the opening of float windows that is not negligible to the user's experience. \r\nAlso, if the top content is expanded to be richer in the future, this approach will break down because the UI does not know how much area needs to be fixed.\r\n\r\nI also believe that Neovim itself should be corrected in this case.",
            "created_at": "2023-12-23T06:02:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/23610#issuecomment-1868216660",
            "id": 1868216660,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23610",
            "node_id": "IC_kwDOAPphoM5vWrlU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1868216660/reactions"
            },
            "updated_at": "2023-12-23T06:02:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1868216660",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8478977?v=4",
                "events_url": "https://api.github.com/users/akiyosi/events{/privacy}",
                "followers_url": "https://api.github.com/users/akiyosi/followers",
                "following_url": "https://api.github.com/users/akiyosi/following{/other_user}",
                "gists_url": "https://api.github.com/users/akiyosi/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/akiyosi",
                "id": 8478977,
                "login": "akiyosi",
                "node_id": "MDQ6VXNlcjg0Nzg5Nzc=",
                "organizations_url": "https://api.github.com/users/akiyosi/orgs",
                "received_events_url": "https://api.github.com/users/akiyosi/received_events",
                "repos_url": "https://api.github.com/users/akiyosi/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/akiyosi/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/akiyosi/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/akiyosi"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I have been thinking about this and going to start working on a solution soon. \r\n\r\nI think we need to remain flexible and allow these \"widgets\" anywhere in the window, not just around the borders. Static information related to the window is also a little bit inflexible, for example, consider the floating window titles, they also need the exact position horizontally (to prevent one of errors, by having the clients calculate it themselves. There are also elements like splits, that does not belong to a window, but still, something that an UI might want to know about. For example, in Neovide we would like to display a different cursor when the mouse is over a split, once `mouseshape` support is implemented https://github.com/neovim/neovim/issues/21458. \r\n\r\nTherefore, I'm planning to base my implementation based on the `ext_hlstate`, but a different extension that does not suffer from the performance issues associated with that and not affected by the theming. I'm probably going to call it `ext_elementtype`, and the idea would be that `hl_attr_define` gets a new field `element_type`, which describes the type of elements, an initial list could be something like this, but it should be easy to extend: \r\n`top_left_border`, `top_border`, `top_right_border`, `right_border`, `bottom_right_border`, `bottom_border`, `bottom_left_border`, `left_border`, `top_title`, `bottom_title`, `winbar`, `vertsplit`, `horsplit`. \r\n\r\nThings like the number and sign columns could also be reported.\r\n\r\nI'm not sure if should be an array or not, in that case the we could have `[top_border, left_border]` instead of `top_left_border`. And the title bar would be both `[top_border, title_bar]`. The advantage of this is that it's more flexible, and it's easier to extend in the future, for example if we add some resize handle to the floating windows, then it could be `[right_border, bottom_border, resize_handle]`. Where client that don't handle the resize handle would still probably work correctly.\r\n\r\nAfter writing that out, I definitely think I will go with the array variation, since there does not seem to be any drawbacks. \r\n\r\nNOTE: The type of the border for example can be inferred from the actual cell content, which is useful for clients that wants to render the borders in a more native way and fall back to a character border when it's unknown or unhandled. This is not something that has properly been possible before, since it was not easy to know if a window has a border or not. There's as far as I know, not even an event to subscribe to when the window option changes in either the UI protocol or outside it, so it would have to be polled.\r\n\r\nI also think that the following can be resolved once this is implemented.\r\n* https://github.com/neovim/neovim/issues/27181\r\n\r\nWe could specify that the UI should always report the target window for the mouse clicks, so ignore unfocusable ones and see through window borders. I actually think that works without further code changes on the Neovim side at all.\r\n",
            "created_at": "2024-02-06T11:57:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/23610#issuecomment-1929366416",
            "id": 1929366416,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23610",
            "node_id": "IC_kwDOAPphoM5y_8uQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 4,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1929366416/reactions"
            },
            "updated_at": "2024-02-06T11:57:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1929366416",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9946255?v=4",
                "events_url": "https://api.github.com/users/fredizzimo/events{/privacy}",
                "followers_url": "https://api.github.com/users/fredizzimo/followers",
                "following_url": "https://api.github.com/users/fredizzimo/following{/other_user}",
                "gists_url": "https://api.github.com/users/fredizzimo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/fredizzimo",
                "id": 9946255,
                "login": "fredizzimo",
                "node_id": "MDQ6VXNlcjk5NDYyNTU=",
                "organizations_url": "https://api.github.com/users/fredizzimo/orgs",
                "received_events_url": "https://api.github.com/users/fredizzimo/received_events",
                "repos_url": "https://api.github.com/users/fredizzimo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/fredizzimo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/fredizzimo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/fredizzimo"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23610/comments",
    "created_at": "2023-05-13T12:19:35Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23610/events",
    "html_url": "https://github.com/neovim/neovim/issues/23610",
    "id": 1708582444,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "UI extensibility, events, protocol",
            "id": 640132777,
            "name": "ui-extensibility",
            "node_id": "MDU6TGFiZWw2NDAxMzI3Nzc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui-extensibility"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "tabline, winbar, statuscolumn",
            "id": 3385615828,
            "name": "statusline",
            "node_id": "LA_kwDOAPphoM7JzGXU",
            "url": "https://api.github.com/repos/neovim/neovim/labels/statusline"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23610/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5l1uYs",
    "number": 23610,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 14,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 14,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23610/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23610/timeline",
    "title": "UI protocol: forward information about winbar and other window grid widgets",
    "updated_at": "2024-02-06T11:57:23Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23610",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/9946255?v=4",
        "events_url": "https://api.github.com/users/fredizzimo/events{/privacy}",
        "followers_url": "https://api.github.com/users/fredizzimo/followers",
        "following_url": "https://api.github.com/users/fredizzimo/following{/other_user}",
        "gists_url": "https://api.github.com/users/fredizzimo/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/fredizzimo",
        "id": 9946255,
        "login": "fredizzimo",
        "node_id": "MDQ6VXNlcjk5NDYyNTU=",
        "organizations_url": "https://api.github.com/users/fredizzimo/orgs",
        "received_events_url": "https://api.github.com/users/fredizzimo/received_events",
        "repos_url": "https://api.github.com/users/fredizzimo/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/fredizzimo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fredizzimo/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/fredizzimo"
    }
}
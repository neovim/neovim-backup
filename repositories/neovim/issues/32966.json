{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\nPerforming action on custom textobject (Operator-pending mapping which selects a text region, as per `:h omap-info`) can cause horizontal scroll when it is not needed. There is no obvious way to mitigate that (possibly except explicitly restoring window view which is excessive).\n\n### Steps to reproduce\n\n1. Create the following 'init.vim':\n    ```vim\n    set nocompatible\n\n    \" Define several ways to select the same region\n    function g:Select()\n      let s:pos = getcurpos()\n      call cursor(s:pos[1], s:pos[2] + 49)\n      normal! v\n      call cursor(s:pos[1], s:pos[2])\n    endfunction\n\n    onoremap io <Cmd>call g:Select()<CR>\n\n    onoremap ik :<C-u>normal! 0f\"lvt\"<CR>\n    onoremap iu vi\"\n\n    \" Set state for reproduction. Maybe add more vertical splits if not enough.\n    set nowrap\n    call setline(1, 'abcdefghij\"'.repeat('abcdefghij', 5).'\"abcdefghij' )\n    cal cursor(1, 12)\n\n    wincmd v\n    wincmd v\n    wincmd v\n    ```\n2. `nvim --clean -u init.vim`\n3. Type `cio`. Window is scrolled horizontally although it is not needed. The same happens if `cik` typed, **but** this doesn't happen if typed `ciu` (maps directly to built-in `vi\"`) or `ci\"` directly.\n\nNotes:\n- This doesn't seem to happen in Vim 9.1.1198.\n- Adding `set lazyredraw` doesn't seem to help.\n- The actual effect size seems to depend on actual window width and selected region: in some cases there is no scroll, in some - only by a single character.\n\nHere is the demo (not quite zommed in because the effect is less prominent in that case):\n\nhttps://github.com/user-attachments/assets/29666360-eb17-4aec-9ad0-b60ff4f50d98\n\n### Expected behavior\n\nNo extra horizontal scroll in such cases.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.0-dev-2033+g1369d86812\n\n### Vim (not Nvim) behaves the same?\n\nNo, Vim 9.1.1198 behaves as expected\n\n### Operating system/version\n\nEndeavourOS Linux x86_64, 6.13.7-arch1-1\n\n### Terminal name/version\n\nGhostty 1.1.2-arch2\n\n### $TERM environment variable\n\nxterm-ghostty\n\n### Installation\n\nappimage",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "After discussions with subject matter experts, the culprit here is the 'sidescroll' value: 1 reproduces this behavior while 0 does not. The difference in Neovim and Vim here is due to different default 'sidescroll' values: 1 in Neovim and 0 in Vim. With explicit `set sidescroll=1` this can be reproduced in Vim.\n\nThere is a workaround for custom textobject in a form of temporary `set sidescroll=0`. The downside is that it will center cursor on the screen if window was scrolled earlier (like after a single `zl`).\n\nI am personally okay with this workaround (using `winsaveview()` and `winrestview()` being the last-resort-solution here). Will keep this opened for maybe other opinions (feel free to close, of course).",
            "created_at": "2025-03-18T16:53:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/32966#issuecomment-2734012317",
            "id": 2734012317,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/32966",
            "node_id": "IC_kwDOAPphoM6i9bed",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2734012317/reactions"
            },
            "updated_at": "2025-03-18T17:04:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2734012317",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/32966/comments",
    "created_at": "2025-03-18T15:15:45Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/32966/events",
    "html_url": "https://github.com/neovim/neovim/issues/32966",
    "id": 2928886874,
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "text objects, normal commands",
            "id": 5826986707,
            "name": "normal-mode",
            "node_id": "LA_kwDOAPphoM8AAAABW1DC0w",
            "url": "https://api.github.com/repos/neovim/neovim/labels/normal-mode"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/32966/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6uk0Ra",
    "number": 32966,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/32966/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/32966/timeline",
    "title": "Custom textobjects can cause unnecessary horizontal scroll",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-03-18T17:04:53Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/32966",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
        "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
        "followers_url": "https://api.github.com/users/echasnovski/followers",
        "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
        "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/echasnovski",
        "id": 24854248,
        "login": "echasnovski",
        "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
        "organizations_url": "https://api.github.com/users/echasnovski/orgs",
        "received_events_url": "https://api.github.com/users/echasnovski/received_events",
        "repos_url": "https://api.github.com/users/echasnovski/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/echasnovski",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\nI try lsp.completion, and it is almost unusable for me because it aggressively insert text to my buffer instead of letting me choose it first.\r\n\r\n\r\n\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n   * Install pyright \r\n   ```sh\r\nnpm i -g pyright\r\n```\r\n   \r\n* Create minimal_init.lua in the current directory\r\n```sh\r\ntouch minimal_init.lua\r\n```\r\n\r\nAdd these lines to `minimal_init.lua`\r\n```lua\r\n vim.api.nvim_create_autocmd('FileType', {\r\n\t-- This handler will fire when the buffer's 'filetype' is \"python\"\r\n\tpattern = 'python',\r\n\tcallback = function(args)\r\n\t\tvim.lsp.start({\r\n\t\t\tname = 'pyright',\r\n\t\t\tcmd = { 'pyright-langserver', '--stdio' },\r\n\r\n\t\t\t-- Set the \"root directory\" to the parent directory of the file in the\r\n\t\t\t-- current buffer (`args.buf`) that contains either a \"setup.py\" or a\r\n\t\t\t-- \"pyproject.toml\" file. Files that share a root directory will reuse\r\n\t\t\t-- the connection to the same LSP server.\r\n\t\t\troot_dir = vim.fs.root(args.buf, { 'setup.py', 'pyproject.toml' }),\r\n\t\t})\r\n\tend,\r\n})\r\n\r\nvim.api.nvim_create_autocmd('LspAttach', {\r\n\tcallback = function(args)\r\n\t\tlocal client = vim.lsp.get_client_by_id(args.data.client_id)\r\n\t\tif client.supports_method('textDocument/completion') and vim.lsp.completion then\r\n\t\t\t-- Enable auto-completion\r\n\t\t\tvim.lsp.completion.enable(true, client.id, args.buf, { autotrigger = true })\r\n\t\tend\r\n\tend,\r\n})\r\n```\r\n\r\nRun Neovim with minimal_init \r\n```sh\r\nnvim -u minimal_init.lua\r\n```\r\n\r\nCreate a python file (for example `main.py`) and write a line \r\n```python\r\nprint(\"\r\n```\r\n\r\nYou will see what I saw right after you type the quotation mark\r\n\r\n\r\n### Expected behavior\r\n\r\nI want it to just show the suggestions list and let me choose from one of them instead of directly insert the word to my buffer\r\n\r\n\r\n### Nvim version (nvim -v)\r\n\r\nNeovim v0.11.0-dev-888+g4075e613b\r\n\r\n### Language server name/version\r\n\r\npyright 1.1.383\r\n\r\n### Operating system/version\r\n\r\nUbuntu 24.04.01\r\n\r\n### Log file\r\n\r\n_No response_",
    "closed_at": null,
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
        "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
        "followers_url": "https://api.github.com/users/brianhuster/followers",
        "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
        "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/brianhuster",
        "id": 111893501,
        "login": "brianhuster",
        "node_id": "U_kgDOBqtb_Q",
        "organizations_url": "https://api.github.com/users/brianhuster/orgs",
        "received_events_url": "https://api.github.com/users/brianhuster/received_events",
        "repos_url": "https://api.github.com/users/brianhuster/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/brianhuster"
    },
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "> You will see what I saw right after you type the quotation mark\r\n\r\nBefore someone else takes a look: can you show what sou saw? Why the `gi` keymap and `BufWritePre` autocommand are present in `minimal_init.lua`?\r\n\r\nAfter adding\r\n```lua\r\n        local triggerCharacters = vim.tbl_get(\r\n          client,\r\n          'server_capabilities',\r\n          'completionProvider',\r\n          'triggerCharacters'\r\n        ) or {}\r\n        vim.print(triggerCharacters) -- I get { \".\", \"[\", '\"', \"'\" }\r\n```\r\nI see that probably I should expect triggering completion after typing `\"`. For some reason completion doesn't work for me on this example (even with manually mapped trigger and fixing `root_dir` detection). I have pyright installed only to occasional browsing Python files.",
            "created_at": "2024-10-03T18:11:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/30644#issuecomment-2392028452",
            "id": 2392028452,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30644",
            "node_id": "IC_kwDOAPphoM6Ok3Uk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392028452/reactions"
            },
            "updated_at": "2024-10-03T18:13:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392028452",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Before someone else takes a look: can you show what sou saw? Why the gi keymap and BufWritePre autocommand are present in minimal_init.lua?\r\n\r\nhttps://github.com/user-attachments/assets/f17a8ade-7f8b-4240-97fa-45640000170c\r\n\r\nYes, the parts for `gi` keymap and `BufWritePost` are irrelevant, you can still produce the error without them. So I have updated the minimal config in the issue.\r\n\r\nTo be honest, I don't use pyright, I chose it for the minimal config just because it is a piece of cake to setup without [nvim-lspconfig](https://github.com/neovim/nvim-lspconfig).\r\n\r\nIf you can't reproduce the error, I guess you are not using the nightly version that was released on 3 Oct 2024?",
            "created_at": "2024-10-04T00:17:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/30644#issuecomment-2392548786",
            "id": 2392548786,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30644",
            "node_id": "IC_kwDOAPphoM6Om2Wy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392548786/reactions"
            },
            "updated_at": "2024-10-04T00:21:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392548786",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster"
            }
        },
        {
            "author_association": "NONE",
            "body": "I am getting the same problem but only on this minimal configuration. Pyright with lspconfig on my main config is perfectly fine.",
            "created_at": "2024-10-04T01:42:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/30644#issuecomment-2392629641",
            "id": 2392629641,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30644",
            "node_id": "IC_kwDOAPphoM6OnKGJ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392629641/reactions"
            },
            "updated_at": "2024-10-04T01:42:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392629641",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/55256196?v=4",
                "events_url": "https://api.github.com/users/ironic1234/events{/privacy}",
                "followers_url": "https://api.github.com/users/ironic1234/followers",
                "following_url": "https://api.github.com/users/ironic1234/following{/other_user}",
                "gists_url": "https://api.github.com/users/ironic1234/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ironic1234",
                "id": 55256196,
                "login": "ironic1234",
                "node_id": "MDQ6VXNlcjU1MjU2MTk2",
                "organizations_url": "https://api.github.com/users/ironic1234/orgs",
                "received_events_url": "https://api.github.com/users/ironic1234/received_events",
                "repos_url": "https://api.github.com/users/ironic1234/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ironic1234/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ironic1234/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ironic1234"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "After upgrading from `1.1.379` to `1.1.383` I still get no completion results, but it doesn't matter because probably I can get similar effect for luals. \r\n\r\nhttps://github.com/user-attachments/assets/7499acbb-e9ce-496f-83ed-727be381209f\r\n\r\nThe above screencast shows what happens on typing `print`. Is that what you want to report? To get such effect I set `completeopt=menu,preview` like by default with `--clean`. \r\n\r\nAt the moment to play with built-in completion I have set `completeopt=noinsert,menuone,fuzzy`.\r\n\r\n#30601 has an example of start luals directly. ",
            "created_at": "2024-10-04T01:42:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/30644#issuecomment-2392629798",
            "id": 2392629798,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30644",
            "node_id": "IC_kwDOAPphoM6OnKIm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392629798/reactions"
            },
            "updated_at": "2024-10-04T01:42:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392629798",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "NONE",
            "body": "After setting `completeopt`, my problem has been solved. Thank you so much!",
            "created_at": "2024-10-04T01:53:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/30644#issuecomment-2392638654",
            "id": 2392638654,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30644",
            "node_id": "IC_kwDOAPphoM6OnMS-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392638654/reactions"
            },
            "updated_at": "2024-10-04T01:53:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392638654",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Regardless, perhaps the experience with the default value `cot` is worth discussing (and keeping this issue open some time). ",
            "created_at": "2024-10-04T02:06:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/30644#issuecomment-2392650952",
            "id": 2392650952,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30644",
            "node_id": "IC_kwDOAPphoM6OnPTI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392650952/reactions"
            },
            "updated_at": "2024-10-04T02:06:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2392650952",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30644/comments",
    "created_at": "2024-10-03T16:07:35Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30644/events",
    "html_url": "https://github.com/neovim/neovim/issues/30644",
    "id": 2564431238,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "Nvim built-in (omni)completion",
            "id": 3214348835,
            "name": "completion",
            "node_id": "MDU6TGFiZWwzMjE0MzQ4ODM1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/completion"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30644/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 650,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 597,
        "state": "open",
        "title": "backlog",
        "updated_at": "2024-10-07T09:52:20Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM6Y2h2G",
    "number": 30644,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30644/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": "reopened",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30644/timeline",
    "title": "LSP: lsp.completion with completeopt=noinsert,menuone aggressively inserts text",
    "updated_at": "2024-10-04T12:22:08Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30644",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
        "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
        "followers_url": "https://api.github.com/users/brianhuster/followers",
        "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
        "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/brianhuster",
        "id": 111893501,
        "login": "brianhuster",
        "node_id": "U_kgDOBqtb_Q",
        "organizations_url": "https://api.github.com/users/brianhuster/orgs",
        "received_events_url": "https://api.github.com/users/brianhuster/received_events",
        "repos_url": "https://api.github.com/users/brianhuster/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/brianhuster"
    }
}
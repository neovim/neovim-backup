{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nRecently I was looking for a good way to test that a part of my config displayed correctly on my screen without mocking `vim.api.*`. Since I had recently been working on getting up to speed with contributing to neovim the `screen:expect()` helper for asserting a certain screen state came to mind from neovim's functional test suite. Following this I spent some time looking into alternatives to this functionality from other neovim testing frameworks and I couldn't find anything that worked anywhere as well as our internal testing utils.\n\nSo I ended up trying to see if I could use a lot of neovim's test utils in my config (see https://github.com/The-Briel-Deal/config/tree/main/nvim/test/util) and I was able to without too much trouble! So now I'm able to run functional tests on my config the same way we run functional tests in neovim! I only pulled in `testutil.lua`, `testnvim.lua`, `screen.lua` and a few other modules they depend on, but I imagine most other test utils could be exposed in a similar way.\n\n### Expected behavior\n\n\nSo what i'm wondering is how would the core maintainers feel about moving neovim's internal to the `vim.*` api that neovim ships with? We could put it in `vim.test.*` for example so that plugin developers have an easy way to test neovim with standard upstream busted like we do internally. I believe that most of our test utils are pretty agnostic of the test framework too so the user doesn't have to use busted if they want to use another or make their own test framework.\n\nIf we're interested than I would be more than happy to do this! I just wanted to get a feel for the neovim team's feelings first.\n\nAlso, if we don't want to bundle it in the standard neovim release, we could also just create a seperate repo for distributing this.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "https://github.com/lewis6991/nvim-test (in particular https://github.com/lewis6991/nvim-test/pull/12)",
            "created_at": "2025-06-21T14:48:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2993618110",
            "id": 2993618110,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ybvy-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993618110/reactions"
            },
            "updated_at": "2025-06-21T14:50:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993618110",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> https://github.com/lewis6991/nvim-test\n\nThanks for linking that @clason! I think I may have run into that but it didn't look super actively maintained. The reason I think it would be super cool if internal neovim used the same testing utils and framework as they expose is because we wouldn't have to have a third party maintain a seperate repository, it sounds nice to only have one source of truth, and I think it would be even better if you didn't even need a third party plugin to do these sort of tests.",
            "created_at": "2025-06-21T14:52:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2993619963",
            "id": 2993619963,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ybwP7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993619963/reactions"
            },
            "updated_at": "2025-06-21T14:52:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993619963",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/86860060?v=4",
                "events_url": "https://api.github.com/users/The-Briel-Deal/events{/privacy}",
                "followers_url": "https://api.github.com/users/The-Briel-Deal/followers",
                "following_url": "https://api.github.com/users/The-Briel-Deal/following{/other_user}",
                "gists_url": "https://api.github.com/users/The-Briel-Deal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/The-Briel-Deal",
                "id": 86860060,
                "login": "The-Briel-Deal",
                "node_id": "MDQ6VXNlcjg2ODYwMDYw",
                "organizations_url": "https://api.github.com/users/The-Briel-Deal/orgs",
                "received_events_url": "https://api.github.com/users/The-Briel-Deal/received_events",
                "repos_url": "https://api.github.com/users/The-Briel-Deal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/The-Briel-Deal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/The-Briel-Deal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/The-Briel-Deal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "That is exactly what's being done there (remember that both are just vendoring `busted`, which is the _real_ source of truth). And Neovim core has very special needs for testing which may not be relevant to plugins (and, conversely, packagers may want to run these tests out of the box) so \"one size fits all\" fits none. There's currently reticence to shove more stuff into the Nvim stdlib. (Certainly not `busted`, which is _way_ too large.)\n\nSo this is very likely going to remain a separate project (but may move under the neovim org at some point). Won't change the maintainer, tho ;)",
            "created_at": "2025-06-21T14:55:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2993621125",
            "id": 2993621125,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ybwiF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993621125/reactions"
            },
            "updated_at": "2025-06-21T15:01:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993621125",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I gotcha, I wasn't suggesting vendoring busted though, just the test utils to validate things like screen state, and to run neovim in a seperate process.\n\nWhen I pulled in the test utils to my config, I didn't need to change much to specifically make it work with testing my config. All I needed to do was update the imports so i don't think we would have to make anything more generic than it already is. I understand though! I might check out nvim-test then.",
            "created_at": "2025-06-21T15:01:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2993623692",
            "id": 2993623692,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ybxKM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993623692/reactions"
            },
            "updated_at": "2025-06-21T15:01:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993623692",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/86860060?v=4",
                "events_url": "https://api.github.com/users/The-Briel-Deal/events{/privacy}",
                "followers_url": "https://api.github.com/users/The-Briel-Deal/followers",
                "following_url": "https://api.github.com/users/The-Briel-Deal/following{/other_user}",
                "gists_url": "https://api.github.com/users/The-Briel-Deal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/The-Briel-Deal",
                "id": 86860060,
                "login": "The-Briel-Deal",
                "node_id": "MDQ6VXNlcjg2ODYwMDYw",
                "organizations_url": "https://api.github.com/users/The-Briel-Deal/orgs",
                "received_events_url": "https://api.github.com/users/The-Briel-Deal/received_events",
                "repos_url": "https://api.github.com/users/The-Briel-Deal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/The-Briel-Deal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/The-Briel-Deal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/The-Briel-Deal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Well, the issue is that exposing them requires documenting them and keeping them tested (as an API, not the internal tests!). It also \"locks\" these functions down so we can't easily change them if we needed for _our_ tests. So there'd be a cost. \n\nThat doesn't mean _some_ function can't be exposed -- maybe you could edit your issue to be more specific about the functions you would like to use, and how? It's a lot easier to talk about concrete proposals, so you could stub out the `vim.test` API you propose (and explain what changes would be needed to make it work without the full `test/` and `busted` runtime dependencies).\n\n(Related: https://github.com/neovim/neovim/issues/19000)\n\n(Also see the previous discussion at https://github.com/neovim/neovim/issues/17367)",
            "created_at": "2025-06-21T15:06:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2993625666",
            "id": 2993625666,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ybxpC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993625666/reactions"
            },
            "updated_at": "2025-06-21T15:13:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993625666",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Well, the issue is that exposing them requires documenting them and keeping them tested (as an API, not the internal tests!). It also \"locks\" these functions down so we can't easily change them if we needed for _our_ tests. So there'd be a cost.\n> \n> That doesn't mean _some_ function can't be exposed -- maybe you could edit your issue to be more specific about the functions you would like to use, and how? It's a lot easier to talk about concrete proposals, so you could stub out the `vim.test` API you propose (and explain what changes would be needed to make it work without the full `test/` and `busted` runtime dependencies).\n> \n> (Related: [#19000](https://github.com/neovim/neovim/issues/19000))\n> \n> (Also see the previous discussion at [#17367](https://github.com/neovim/neovim/issues/17367))\n\nI think that sounds fair. I feel like the big one I found really difficult to make a good alternative to was screen:expect(), it would also be super nice to expose a means to launch an isolated test context. I'll do some thinking on this and I might come back to this if I can come up with a concrete proposal with a smaller scope.",
            "created_at": "2025-06-21T15:27:03Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2993634635",
            "id": 2993634635,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ybz1L",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993634635/reactions"
            },
            "updated_at": "2025-06-21T15:27:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2993634635",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/86860060?v=4",
                "events_url": "https://api.github.com/users/The-Briel-Deal/events{/privacy}",
                "followers_url": "https://api.github.com/users/The-Briel-Deal/followers",
                "following_url": "https://api.github.com/users/The-Briel-Deal/following{/other_user}",
                "gists_url": "https://api.github.com/users/The-Briel-Deal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/The-Briel-Deal",
                "id": 86860060,
                "login": "The-Briel-Deal",
                "node_id": "MDQ6VXNlcjg2ODYwMDYw",
                "organizations_url": "https://api.github.com/users/The-Briel-Deal/orgs",
                "received_events_url": "https://api.github.com/users/The-Briel-Deal/received_events",
                "repos_url": "https://api.github.com/users/The-Briel-Deal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/The-Briel-Deal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/The-Briel-Deal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/The-Briel-Deal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "see also https://github.com/neovim/neovim/issues/5264#issuecomment-2328421195",
            "created_at": "2025-06-23T12:37:51Z",
            "html_url": "https://github.com/neovim/neovim/issues/34592#issuecomment-2996337660",
            "id": 2996337660,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34592",
            "node_id": "IC_kwDOAPphoM6ymHv8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2996337660/reactions"
            },
            "updated_at": "2025-06-23T12:37:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2996337660",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34592/comments",
    "created_at": "2025-06-21T14:46:37Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34592/events",
    "html_url": "https://github.com/neovim/neovim/issues/34592",
    "id": 3165143537,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 110418643,
            "name": "test",
            "node_id": "MDU6TGFiZWwxMTA0MTg2NDM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/test"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "funtime",
            "id": 120251370,
            "name": "runtime",
            "node_id": "MDU6TGFiZWwxMjAyNTEzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/runtime"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34592/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 284,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 332,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-06-23T14:24:08Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM68qEHx",
    "number": 34592,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34592/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34592/timeline",
    "title": "expose internal testing utils / framework",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-23T12:38:04Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34592",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/86860060?v=4",
        "events_url": "https://api.github.com/users/The-Briel-Deal/events{/privacy}",
        "followers_url": "https://api.github.com/users/The-Briel-Deal/followers",
        "following_url": "https://api.github.com/users/The-Briel-Deal/following{/other_user}",
        "gists_url": "https://api.github.com/users/The-Briel-Deal/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/The-Briel-Deal",
        "id": 86860060,
        "login": "The-Briel-Deal",
        "node_id": "MDQ6VXNlcjg2ODYwMDYw",
        "organizations_url": "https://api.github.com/users/The-Briel-Deal/orgs",
        "received_events_url": "https://api.github.com/users/The-Briel-Deal/received_events",
        "repos_url": "https://api.github.com/users/The-Briel-Deal/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/The-Briel-Deal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/The-Briel-Deal/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/The-Briel-Deal",
        "user_view_type": "public"
    }
}
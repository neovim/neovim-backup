{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nThis only happens on my Linux machine running NixOS, and not on a macOS laptop.\n\nNot sure what's the policy for such problems here. Also not sure if this is a problem on a 'normal' linux machine or not. I'm open to offer any help.\n\nSo after updating to 731e616 gitsigns stopped working for me as it throws an error on opening each file:\n```\nvim.schedule callback: ...unwrapped-nightly/share/nvim/runtime/lua/vim/_system.lua:249: ENOENT: no such file or directory\nstack traceback:\n        [thread: 0x7f0cf87ac348] [C]: in function 'asystem'\n        [thread: 0x7f0cf87ac348] ...vimPackages/start/gitsigns.nvim/lua/gitsigns/git/cmd.lua:58: in function 'git_command'\n        [thread: 0x7f0cf87ac348] ...imPackages/start/gitsigns.nvim/lua/gitsigns/git/repo.lua:213: in function 'get_info'\n        [thread: 0x7f0cf87ac348] ...ck/myNeovimPackages/start/gitsigns.nvim/lua/gitsigns.lua:44: in function 'get_gitdir_and_head'\n        [thread: 0x7f0cf87ac348] ...ck/myNeovimPackages/start/gitsigns.nvim/lua/gitsigns.lua:131: in function <...ck/myNeovimPackages/start/gitsigns.nvim/lua/gitsigns.lua:114>\nstack traceback:\n        [C]: in function 'error'\n        ...eovimPackages/start/gitsigns.nvim/lua/gitsigns/async.lua:229: in function '_finish'\n        ...eovimPackages/start/gitsigns.nvim/lua/gitsigns/async.lua:322: in function '_resume'\n        ...eovimPackages/start/gitsigns.nvim/lua/gitsigns/async.lua:317: in function <...eovimPackages/start/gitsigns.nvim/lua/gitsigns/async.lua:307>\n```\n\n### Steps to reproduce\n\nNot sure if this is reproducible on a non-NixOS machine. For sure not on darwin.\n\nI can 100% reproduce this on my flake https://github.com/konradmalik/neovim-flake. Steps (require `nix` installed):\n\n- `git clone https://github.com/konradmalik/neovim-flake.git`\n- checkout the bad commit: `git reset --hard 5d1f7bcd6a0b34a21b2ea99b95e26dbeee8aa440`\n- build and see the error `nix build && ./result/bin/nvim`\n- checkout the good commit which rolls the neovim-src back: `git reset --hard 76da3bbdb3ed7327add6ad43b7873bc1b6efd72a`\n- build, run, and see all is ok `nix build && ./result/bin/nvim`\n\n### Expected behavior\n\nshould not throw errors\n\n### Nvim version (nvim -v)\n\n731e616\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\nNixOS\n\n### Terminal name/version\n\nghostty 1.1.3\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nbuild from repo",
    "closed_at": "2025-07-02T16:01:31Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
        "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
        "followers_url": "https://api.github.com/users/lewis6991/followers",
        "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
        "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lewis6991",
        "id": 7904185,
        "login": "lewis6991",
        "node_id": "MDQ6VXNlcjc5MDQxODU=",
        "organizations_url": "https://api.github.com/users/lewis6991/orgs",
        "received_events_url": "https://api.github.com/users/lewis6991/received_events",
        "repos_url": "https://api.github.com/users/lewis6991/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lewis6991",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "the ENOENT is a side effect of a particular plugin, not really the core issue.\n\nsee\n\n- https://github.com/neovim/neovim/pull/33955#issuecomment-3016434780\n- https://github.com/lewis6991/gitsigns.nvim/pull/1350",
            "created_at": "2025-07-02T10:19:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/34730#issuecomment-3027298708",
            "id": 3027298708,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34730",
            "node_id": "IC_kwDOAPphoM60cOmU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027298708/reactions"
            },
            "updated_at": "2025-07-02T10:20:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027298708",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "https://github.com/neovim/neovim/pull/33955 does seem to change behaviour in a way that's not well understood.\n\nI've left a comment on #33955, but basically gitsigns is passing `{ env = nil, clear_env = true }`, which previously resulted in `env = nil` being sent to `vim.uv.spawn()`, and AFAIK is correct, as `vim.uv.spawn()` will just use the current env as is. Now `{ env = nil, clear_env = true }` passes `vim.env` in the form `{ 'VAR1=1', 'VAR2=2' }`.\n\nSince the the only bug reports are coming from nix uses, my guess is that `vim.fn.environ.PATH` is different to `PATH` when `env=nil`, and thus results in `ENOENT` errors.\n\nEither:\n- We accept this new behaviour change where `vim.system()` strictly uses the env defined in `vim.fn.environ`\n- We add a special case for `{ env = nil, clear_env = true}` causing `env = nil`, like previously. ",
            "created_at": "2025-07-02T10:46:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/34730#issuecomment-3027374237",
            "id": 3027374237,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34730",
            "node_id": "IC_kwDOAPphoM60chCd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027374237/reactions"
            },
            "updated_at": "2025-07-02T10:49:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027374237",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ok I understand this now. #33955 now causes `{env = nil, clear_env = true}` to pass `env = {}`, which I think goes against the documentation:\n\n```\n                   â€¢ clear_env: (boolean) `env` defines the job environment\n                     exactly, instead of merging current environment.\n```\n\nHere I interpret that if `env` is passed as `nil`, it should be passed as `nil` to `vim.us.spawn`.",
            "created_at": "2025-07-02T10:59:52Z",
            "html_url": "https://github.com/neovim/neovim/issues/34730#issuecomment-3027421207",
            "id": 3027421207,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34730",
            "node_id": "IC_kwDOAPphoM60csgX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027421207/reactions"
            },
            "updated_at": "2025-07-02T11:00:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027421207",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Raised #34732",
            "created_at": "2025-07-02T11:29:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/34730#issuecomment-3027518063",
            "id": 3027518063,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34730",
            "node_id": "IC_kwDOAPphoM60dEJv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027518063/reactions"
            },
            "updated_at": "2025-07-02T11:29:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3027518063",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I am having trouble figuring out where `vim.fn.environ` comes into the equation\n\nhttps://github.com/neovim/neovim/blob/535e2924365752c7dcb80d0d32101c746975bcd1/runtime/lua/vim/_system.lua#L365\n\nIt appears to me that the change was\n\nprior to the change, passing `env = nil, clear_env = true` would set `uv.spawn({}, { env = nil })` and now it sets `uv.spawn({}, { env = {} })`\n\nI am unsure where `uv.spawn` calls `vim.fn.environ` I was under the impression that uv.spawn comes straight from uv and thus shouldn't call any vim functions?\n\nI do agree though that it does change it in a way that isn't well understood though, and the behavior when `env = nil` should probably be restored.\n\nEdit: upon more reading, it seems you agree.\n\nAlso, FWIW I also use nix, and haven't experienced such issues. Although I do use my [own framework](https://github.com/BirdeeHub/nixCats-nvim) for that which prides itself in working as exactly like normal as possible so that may be part of why I haven't",
            "created_at": "2025-07-03T03:47:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/34730#issuecomment-3030551844",
            "id": 3030551844,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34730",
            "node_id": "IC_kwDOAPphoM60oo0k",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3030551844/reactions"
            },
            "updated_at": "2025-07-03T03:55:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3030551844",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/85372418?v=4",
                "events_url": "https://api.github.com/users/BirdeeHub/events{/privacy}",
                "followers_url": "https://api.github.com/users/BirdeeHub/followers",
                "following_url": "https://api.github.com/users/BirdeeHub/following{/other_user}",
                "gists_url": "https://api.github.com/users/BirdeeHub/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/BirdeeHub",
                "id": 85372418,
                "login": "BirdeeHub",
                "node_id": "MDQ6VXNlcjg1MzcyNDE4",
                "organizations_url": "https://api.github.com/users/BirdeeHub/orgs",
                "received_events_url": "https://api.github.com/users/BirdeeHub/received_events",
                "repos_url": "https://api.github.com/users/BirdeeHub/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/BirdeeHub/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/BirdeeHub/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/BirdeeHub",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34730/comments",
    "created_at": "2025-07-02T10:15:48Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34730/events",
    "html_url": "https://github.com/neovim/neovim/issues/34730",
    "id": 3195372851,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "user system environment (terminal, shell, tmux)",
            "id": 147354524,
            "name": "environment",
            "node_id": "MDU6TGFiZWwxNDczNTQ1MjQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/environment"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34730/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6-dYUz",
    "number": 34730,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34730/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34730/timeline",
    "title": "NixOS-specific (?) ENOENT in gitsigns after vim.system `clear_env=true` change",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-03T03:55:51Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34730",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/13033392?v=4",
        "events_url": "https://api.github.com/users/konradmalik/events{/privacy}",
        "followers_url": "https://api.github.com/users/konradmalik/followers",
        "following_url": "https://api.github.com/users/konradmalik/following{/other_user}",
        "gists_url": "https://api.github.com/users/konradmalik/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/konradmalik",
        "id": 13033392,
        "login": "konradmalik",
        "node_id": "MDQ6VXNlcjEzMDMzMzky",
        "organizations_url": "https://api.github.com/users/konradmalik/orgs",
        "received_events_url": "https://api.github.com/users/konradmalik/received_events",
        "repos_url": "https://api.github.com/users/konradmalik/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/konradmalik/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/konradmalik/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/konradmalik",
        "user_view_type": "public"
    }
}
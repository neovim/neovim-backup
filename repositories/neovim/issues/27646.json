{
    "active_lock_reason": "resolved",
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nCurrently only the `.git`, `node_modules` and `.hg` folders are being excluded from the watch files that LSP checks. This exclude_pattern could be exposed to the user so that other folders could be excluded, for example when attaching a client.\r\n\r\nThis was commented already on the PR #23500:\r\n\r\n            @folke I wonder if exposing a variable like this would make it possible to exclude additional patterns per language, like `target` for rust.\r\n\r\n_Originally posted by @nojnhuh in https://github.com/neovim/neovim/pull/23500#discussion_r1222310377_\r\n            \r\nFrom my experience, when working with rust, if we have cargo building or even sometimes when running an executable from the `target` folder, neovim complains with EPERM errors like this:\r\n```\r\nError executing luv callback:\r\n...\\neovim\\nvim-win64\\share\\nvim\\runtime/lua/vim/_watch.lua:68: EPERM: operation not permitted: c:/Projects/Other/Rust/b\r\nudgetLookup/target/release/deps/libunicode_ident-1737a7a6bd2cc11e.rlib.temp-archive-536a548.a\r\nstack traceback:\r\n        [C]: in function 'assert'\r\n        ...\\neovim\\nvim-win64\\share\\nvim\\runtime/lua/vim/_watch.lua:68: in function <...\\neovim\\nvim-win64\\share\\nvim\\ru\r\nntime/lua/vim/_watch.lua:55>\r\nPress ENTER or type command to continue\r\nError executing luv callback:\r\n...\\neovim\\nvim-win64\\share\\nvim\\runtime/lua/vim/_watch.lua:68: EPERM: operation not permitted: c:/Projects/Other/Rust/b\r\nudgetLookup/target/release/deps/libunicode_ident-1737a7a6bd2cc11e.rlib.temp-archive-536a548.a\r\nstack traceback:\r\n        [C]: in function 'assert'\r\n        ...\\neovim\\nvim-win64\\share\\nvim\\runtime/lua/vim/_watch.lua:68: in function <...\\neovim\\nvim-win64\\share\\nvim\\ru\r\nntime/lua/vim/_watch.lua:55>\r\nPress ENTER or type command to continue\r\n```\r\nThis errors keep showing all the time and I can't seem to find a way to stop them. If I could add the `target` folder to the `exclude_pattern` of watchfiles on the `on_attach` function of the rust-analyzer lsp it could probably fix this.\r\n\r\nThis is related to rust, but it could help on other situations of other LSPs, like the problem with the `.venv` folders of python mentioned on the PR above.\r\n\r\nIf someone knows if there is another way of fixing this without exposing this to the user, please tell me.\r\n\n\n### Expected behavior\n\nThe expected behavior would be no errors of `EPERM` should show for files under `target` folder or any other folder that the LSP shouldn't be watching.",
    "closed_at": "2024-03-04T17:12:23Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
        "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
        "followers_url": "https://api.github.com/users/lewis6991/followers",
        "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
        "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lewis6991",
        "id": 7904185,
        "login": "lewis6991",
        "node_id": "MDQ6VXNlcjc5MDQxODU=",
        "organizations_url": "https://api.github.com/users/lewis6991/orgs",
        "received_events_url": "https://api.github.com/users/lewis6991/received_events",
        "repos_url": "https://api.github.com/users/lewis6991/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lewis6991",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I've tried adding the `target` folder to the `_watchfiles.lua` on the `M._poll_exclude_pattern` like this and build nvim to test:\r\n```lua\r\nM._poll_exclude_pattern = glob.to_lpeg('**/.git/{objects,subtree-cache}/**')\r\n  + glob.to_lpeg('**/node_modules/*/**')\r\n  + glob.to_lpeg('**/.hg/store/**')\r\n  + glob.to_lpeg('**/target/**')\r\n```\r\nBut apparently it didn't fix anything, it still shows the same errors.\r\n\r\nFrom what I can see `rust-analyzer` is registering some folders inside `target` as a watcher. I'm not sure why.\r\n```\r\ndynamic_capabilities = {\r\n      capabilities = {\r\n        [\"workspace/didChangeWatchedFiles\"] = { {\r\n            id = \"workspace/didChangeWatchedFiles\",\r\n            method = \"workspace/didChangeWatchedFiles\",\r\n            registerOptions = {\r\n              watchers = { {\r\n                  globPattern = \"C:\\\\Projects\\\\Other\\\\Rust\\\\budgetLookup/**/*.rs\"\r\n                }, {\r\n                  globPattern = \"C:\\\\Projects\\\\Other\\\\Rust\\\\budgetLookup/**/Cargo.toml\"\r\n                }, {\r\n                  globPattern = \"C:\\\\Projects\\\\Other\\\\Rust\\\\budgetLookup/**/Cargo.lock\"\r\n                }, {\r\n                  globPattern = \"C:\\\\Projects\\\\Other\\\\Rust\\\\budgetLookup\\\\target\\\\x86_64-pc-windows-msvc\\\\debug\\\\build\\\\\r\nbudget_lookup-a7939d74eaadce18\\\\out/**/*.rs\"\r\n                }, {\r\n                  globPattern = \"C:\\\\Projects\\\\Other\\\\Rust\\\\budgetLookup\\\\target\\\\x86_64-pc-windows-msvc\\\\debug\\\\build\\\\\r\nbudget_lookup-a7939d74eaadce18\\\\out/**/Cargo.toml\"\r\n                }, {\r\n                  globPattern = \"C:\\\\Projects\\\\Other\\\\Rust\\\\budgetLookup\\\\target\\\\x86_64-pc-windows-msvc\\\\debug\\\\build\\\\\r\nbudget_lookup-a7939d74eaadce18\\\\out/**/Cargo.lock\"\r\n                } }\r\n            }\r\n          } }\r\n      },\r\n```\r\n\r\nNow I'm even more confused... If anyone care to help, I'd be grateful!",
            "created_at": "2024-02-27T17:33:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1967263585",
            "id": 1967263585,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51Qg9h",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1967263585/reactions"
            },
            "updated_at": "2024-02-27T17:33:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1967263585",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/145657253?v=4",
                "events_url": "https://api.github.com/users/alex-ds13/events{/privacy}",
                "followers_url": "https://api.github.com/users/alex-ds13/followers",
                "following_url": "https://api.github.com/users/alex-ds13/following{/other_user}",
                "gists_url": "https://api.github.com/users/alex-ds13/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alex-ds13",
                "id": 145657253,
                "login": "alex-ds13",
                "node_id": "U_kgDOCK6NpQ",
                "organizations_url": "https://api.github.com/users/alex-ds13/orgs",
                "received_events_url": "https://api.github.com/users/alex-ds13/received_events",
                "repos_url": "https://api.github.com/users/alex-ds13/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alex-ds13/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alex-ds13/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alex-ds13",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "So I've tested this with other projects where `rust-analyzer` is not registering any `target` folder as a watcher and this potential fix still doesn't work.\r\n\r\nThe reason is that on Windows and Mac it is using the `watch` function of the `_watch.lua` file, but on Linux it uses the `poll` function which then calls the `recurse_watch` function. The problem is that the `watch` function completely ignores the `include_pattern` and `exclude_pattern` from the `opts`. Only the `recurse_watch` function actually considers these options.\r\n\r\nI've tried adding the check on the `watch` function as well and that actually fixed it for me. Even if I don't add the `+ glob.to_lpeg('**/target/**')` to the `M._poll_exclude_pattern` because now it will only watch the folders that match the `include_pattern` but I'm not entirely sure if that is the intended purpose. I've also not been able to actually test if the watching is being properly done, so there is a chance that my fix is only stopping the watcher logic completely and that is why it fixes it.\r\n\r\n<details>\r\n\r\n<summary>Here is the fix I used:</summary>\r\n\r\n```lua\r\n--- Initializes and starts a |uv_fs_event_t|\r\n---\r\n---@param path (string) The path to watch\r\n---@param opts (table|nil) Additional options\r\n---     - uvflags (table|nil)\r\n---                Same flags as accepted by |uv.fs_event_start()|\r\n---@param callback (function) The function called when new events\r\n---@return (function) Stops the watcher\r\nfunction M.watch(path, opts, callback)\r\n  vim.validate({\r\n    path = { path, 'string', false },\r\n    opts = { opts, 'table', true },\r\n    callback = { callback, 'function', false },\r\n  })\r\n  opts = opts or {}\r\n\r\n  local function is_included(filepath)\r\n    return opts.include_pattern and opts.include_pattern:match(filepath)\r\n  end\r\n  local function is_excluded(filepath)\r\n    return opts.exclude_pattern and opts.exclude_pattern:match(filepath)\r\n  end\r\n\r\n  path = vim.fs.normalize(path)\r\n  if not is_excluded(path) then\r\n    local uvflags = opts and opts.uvflags or {}\r\n    local handle, new_err = vim.uv.new_fs_event()\r\n    assert(not new_err, new_err)\r\n    handle = assert(handle)\r\n    local _, start_err = handle:start(path, uvflags, function(err, filename, events)\r\n      assert(not err, err)\r\n      local fullpath = path\r\n      if filename then\r\n        filename = filename:gsub('\\\\', '/')\r\n        fullpath = filepath_join(fullpath, filename)\r\n      end\r\n      if is_included(fullpath) and not is_excluded(path) then\r\n        local change_type = events.change and M.FileChangeType.Changed or 0\r\n        if events.rename then\r\n          local _, staterr, staterrname = vim.uv.fs_stat(fullpath)\r\n          if staterrname == 'ENOENT' then\r\n            change_type = M.FileChangeType.Deleted\r\n          else\r\n            assert(not staterr, staterr)\r\n            change_type = M.FileChangeType.Created\r\n          end\r\n        end\r\n        callback(fullpath, change_type)\r\n      end\r\n    end)\r\n    assert(not start_err, start_err)\r\n    return function()\r\n      stop(handle)\r\n    end\r\n  end\r\n  return function () end\r\nend\r\n```\r\n</details>",
            "created_at": "2024-02-28T12:43:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1968906237",
            "id": 1968906237,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51Wx_9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1968906237/reactions"
            },
            "updated_at": "2024-02-28T12:54:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1968906237",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/145657253?v=4",
                "events_url": "https://api.github.com/users/alex-ds13/events{/privacy}",
                "followers_url": "https://api.github.com/users/alex-ds13/followers",
                "following_url": "https://api.github.com/users/alex-ds13/following{/other_user}",
                "gists_url": "https://api.github.com/users/alex-ds13/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alex-ds13",
                "id": 145657253,
                "login": "alex-ds13",
                "node_id": "U_kgDOCK6NpQ",
                "organizations_url": "https://api.github.com/users/alex-ds13/orgs",
                "received_events_url": "https://api.github.com/users/alex-ds13/received_events",
                "repos_url": "https://api.github.com/users/alex-ds13/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alex-ds13/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alex-ds13/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alex-ds13",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Does https://github.com/neovim/neovim/pull/27347 help at all?",
            "created_at": "2024-02-28T18:43:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1969613609",
            "id": 1969613609,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51Zesp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1969613609/reactions"
            },
            "updated_at": "2024-02-28T18:43:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1969613609",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Does #27347 help at all?\r\n\r\nThat does seem to fix it! No more `EPERM` errors showing up so far.\r\n\r\nBy the way as a side note, do you happen to know why is it that when I build neovim on windows it doesn't create the `share` folder inside `build`? I have to manually copy the one from the nightly release and change the `runtime` folder to the one from my branch.",
            "created_at": "2024-02-28T19:55:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1969746950",
            "id": 1969746950,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51Z_QG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1969746950/reactions"
            },
            "updated_at": "2024-02-28T19:55:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1969746950",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/145657253?v=4",
                "events_url": "https://api.github.com/users/alex-ds13/events{/privacy}",
                "followers_url": "https://api.github.com/users/alex-ds13/followers",
                "following_url": "https://api.github.com/users/alex-ds13/following{/other_user}",
                "gists_url": "https://api.github.com/users/alex-ds13/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alex-ds13",
                "id": 145657253,
                "login": "alex-ds13",
                "node_id": "U_kgDOCK6NpQ",
                "organizations_url": "https://api.github.com/users/alex-ds13/orgs",
                "received_events_url": "https://api.github.com/users/alex-ds13/received_events",
                "repos_url": "https://api.github.com/users/alex-ds13/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alex-ds13/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alex-ds13/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alex-ds13",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> That does seem to fix it! No more EPERM errors showing up so far.\n\nGood to hear. Is this with our without fswatch installed?\n\n> By the way as a side note, do you happen to know why is it that when I build neovim on windows it doesn't create the share folder inside build? I have to manually copy the one from the nightly release and change the runtime folder to the one from my branch.\n\nSorry, no idea.",
            "created_at": "2024-02-28T20:12:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1969805824",
            "id": 1969805824,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51aNoA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1969805824/reactions"
            },
            "updated_at": "2024-02-28T20:12:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1969805824",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Good to hear. Is this with our without fswatch installed?\r\n\r\nI'm on windows, so no fswatch. It's using the `watch` function with `uv.new_fs_event()`.",
            "created_at": "2024-02-29T09:49:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1970774218",
            "id": 1970774218,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51d6DK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1970774218/reactions"
            },
            "updated_at": "2024-02-29T09:49:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1970774218",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/145657253?v=4",
                "events_url": "https://api.github.com/users/alex-ds13/events{/privacy}",
                "followers_url": "https://api.github.com/users/alex-ds13/followers",
                "following_url": "https://api.github.com/users/alex-ds13/following{/other_user}",
                "gists_url": "https://api.github.com/users/alex-ds13/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alex-ds13",
                "id": 145657253,
                "login": "alex-ds13",
                "node_id": "U_kgDOCK6NpQ",
                "organizations_url": "https://api.github.com/users/alex-ds13/orgs",
                "received_events_url": "https://api.github.com/users/alex-ds13/received_events",
                "repos_url": "https://api.github.com/users/alex-ds13/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alex-ds13/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alex-ds13/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alex-ds13",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ok great.\r\n\r\nThat PR has a flaky test, but I'll just disable that and push it through.",
            "created_at": "2024-02-29T10:52:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1970879128",
            "id": 1970879128,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51eTqY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1970879128/reactions"
            },
            "updated_at": "2024-02-29T10:52:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1970879128",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@lewis6991 Should I close this issue since #27347 has been merged and it fixes the issues I was having?\r\n\r\nIt seems that for now there is no need to expose the `exclude_pattern` to the user or do you think it might still be needed if the issues mentioned on #23291 continue to exist?",
            "created_at": "2024-03-04T12:09:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-1976440494",
            "id": 1976440494,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM51zhau",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1976440494/reactions"
            },
            "updated_at": "2024-03-04T12:09:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1976440494",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/145657253?v=4",
                "events_url": "https://api.github.com/users/alex-ds13/events{/privacy}",
                "followers_url": "https://api.github.com/users/alex-ds13/followers",
                "following_url": "https://api.github.com/users/alex-ds13/following{/other_user}",
                "gists_url": "https://api.github.com/users/alex-ds13/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alex-ds13",
                "id": 145657253,
                "login": "alex-ds13",
                "node_id": "U_kgDOCK6NpQ",
                "organizations_url": "https://api.github.com/users/alex-ds13/orgs",
                "received_events_url": "https://api.github.com/users/alex-ds13/received_events",
                "repos_url": "https://api.github.com/users/alex-ds13/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alex-ds13/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alex-ds13/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alex-ds13",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> [!WARNING]\r\n> Nevermind, my bad, the issue only happens when I have neo-tree opened. I'm not deleting this in case someone is in my situation.\r\n\r\nSorry to comment on a closed issue but I'm experiencing this exact issue on current nightly / windows and wanted to know how to exclude patterns (`target` like alex) from watch, each time I cargo build from within nvim, I get a lot of these:\r\n\r\n```sh\r\nError executing luv callback:\r\nC:/Users/User/neovim/share/nvim/runtime/lua/vim/_watch.lua:90: EPERM: operation not permitted: C:/Users/User/dev/melmass/nuon-py/target/debug/deps/libpyo3_build_config-487a5fba5ec82b3d.rlib.temp-archive-47f93a4.a\r\nstack traceback:\r\n        [C]: in function 'assert'\r\n        C:/Users/User/neovim/share/nvim/runtime/lua/vim/_watch.lua:90: in function <C:/Users/User/neovim/share/nvim/runtime/lua/vim/_watch.lua:72>\r\n        \r\nError executing luv callback:\r\nC:/Users/User/neovim/share/nvim/runtime/lua/vim/_watch.lua:90: EPERM: operation not permitted: C:/Users/User/dev/melmass/nuon-py/target/debug/deps/libpyo3_macros_backend-8a062a1cea69b350.rlib.temp-archive-99174ff.a\r\nstack traceback:\r\n        [C]: in function 'assert'\r\n        C:/Users/User/neovim/share/nvim/runtime/lua/vim/_watch.lua:90: in function <C:/Users/User/neovim/share/nvim/runtime/lua/vim/_watch.lua:72>\r\n        \r\n```",
            "created_at": "2024-06-12T12:34:23Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-2162896426",
            "id": 2162896426,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM6A6y4q",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2162896426/reactions"
            },
            "updated_at": "2024-06-12T12:41:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2162896426",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7041726?v=4",
                "events_url": "https://api.github.com/users/melMass/events{/privacy}",
                "followers_url": "https://api.github.com/users/melMass/followers",
                "following_url": "https://api.github.com/users/melMass/following{/other_user}",
                "gists_url": "https://api.github.com/users/melMass/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/melMass",
                "id": 7041726,
                "login": "melMass",
                "node_id": "MDQ6VXNlcjcwNDE3MjY=",
                "organizations_url": "https://api.github.com/users/melMass/orgs",
                "received_events_url": "https://api.github.com/users/melMass/received_events",
                "repos_url": "https://api.github.com/users/melMass/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/melMass/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/melMass/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/melMass",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Need a new issue with reproduction steps.",
            "created_at": "2024-06-12T12:35:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-2162899336",
            "id": 2162899336,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM6A6zmI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2162899336/reactions"
            },
            "updated_at": "2024-06-12T12:35:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2162899336",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Here with the same issue. I'm using file based cache with a rlock.\n\n\nError executing luv callback:                                                                                                                                                                                    ...pps/neovim/current/share/nvim/runtime/lua/vim/_watch.lua:90: EPERM: operation not permitted: c:/Users/Bryce/.persist_cache/acea4bdabe6b319732/923a8b7c614a3c591525864cd53cec38344.msgpack.lock      stack traceback:                                                                                                                                                                                                         [C]: in function 'assert'                                                                                                                                                                                        ...pps/neovim/current/share/nvim/runtime/lua/vim/_watch.lua:90: in function <...pps/neovim/current/share/nvim/runtime/lua/vim/_watch.lua:72>                                                             \n",
            "created_at": "2025-02-04T14:06:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/27646#issuecomment-2634075104",
            "id": 2634075104,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27646",
            "node_id": "IC_kwDOAPphoM6dAMvg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2634075104/reactions"
            },
            "updated_at": "2025-02-04T15:12:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2634075104",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/441800?v=4",
                "events_url": "https://api.github.com/users/brycepg/events{/privacy}",
                "followers_url": "https://api.github.com/users/brycepg/followers",
                "following_url": "https://api.github.com/users/brycepg/following{/other_user}",
                "gists_url": "https://api.github.com/users/brycepg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brycepg",
                "id": 441800,
                "login": "brycepg",
                "node_id": "MDQ6VXNlcjQ0MTgwMA==",
                "organizations_url": "https://api.github.com/users/brycepg/orgs",
                "received_events_url": "https://api.github.com/users/brycepg/received_events",
                "repos_url": "https://api.github.com/users/brycepg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brycepg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brycepg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brycepg",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 11,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27646/comments",
    "created_at": "2024-02-27T17:17:51Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27646/events",
    "html_url": "https://github.com/neovim/neovim/issues/27646",
    "id": 2157216837,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27646/labels{/name}",
    "locked": true,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6AlIRF",
    "number": 27646,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 2,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27646/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27646/timeline",
    "title": "Expose LSP _watchfiles exclude_pattern",
    "updated_at": "2025-02-04T15:12:52Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27646",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/145657253?v=4",
        "events_url": "https://api.github.com/users/alex-ds13/events{/privacy}",
        "followers_url": "https://api.github.com/users/alex-ds13/followers",
        "following_url": "https://api.github.com/users/alex-ds13/following{/other_user}",
        "gists_url": "https://api.github.com/users/alex-ds13/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/alex-ds13",
        "id": 145657253,
        "login": "alex-ds13",
        "node_id": "U_kgDOCK6NpQ",
        "organizations_url": "https://api.github.com/users/alex-ds13/orgs",
        "received_events_url": "https://api.github.com/users/alex-ds13/received_events",
        "repos_url": "https://api.github.com/users/alex-ds13/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/alex-ds13/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alex-ds13/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/alex-ds13",
        "user_view_type": "public"
    }
}
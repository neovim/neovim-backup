{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nI've been banging my head against this for a few hours.  Figured i'd ask\r\n\r\nHere is a small reproduction: https://github.com/eanyanwu/neovim-bug\r\nIts a single `init.lua` file that creates a buffer and set some buffer local options\r\n\r\nHere are the contents of the file for posterity:\r\n\r\n```\r\nlocal gb = vim.api.nvim_create_buf(false, false)\r\nvim.api.nvim_buf_set_option(gb, \"buftype\", \"nofile\")\r\nvim.api.nvim_buf_set_option(gb, \"filetype\", \"alist\")\r\nvim.api.nvim_buf_set_option(gb, \"modeline\", false)\r\nprint(gb)\r\n```\r\n\r\n\r\nOpen neovim like this: `nvim -u neovim-bug/init.lua .` (note the period at the end)\r\n\r\n\r\n### Steps to reproduce\r\n\r\ngit clone https://github.com/eanyanwu/neovim-bug.git\r\nnvim -u neovim-bug/init.lua .\r\n:set filetype?\r\n:set buftype?\r\n\r\n### Expected behavior\r\n\r\nI would expect that the newly created buffer should have the options that it set.\r\n\r\nIf i go to it using `buffer <id>`, then type `set filetype?`, i expect that to be \"alist\". But it is empty. Same for `set buftype?`\r\n\r\nThe odd thing is that if I just do `nvim -u neovim-bug/init.lua` instead (without the period) ... i get the results i'd expect.\r\n\r\nAm i missing something obvious?\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.9.5\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNot sure. I don't know enough vimscript XD\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Terminal name/version\r\n\r\nwezterm\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nArchlinux official package",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Please make the minimal reproduction self-contained in this issue (i.e. copy-paste the content of small init.lua file in the issue you wrote), because your repo might be not permanent.\r\n",
            "created_at": "2024-01-03T06:35:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1874908301",
            "id": 1874908301,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vwNSN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1874908301/reactions"
            },
            "updated_at": "2024-01-03T06:36:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1874908301",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Cannot reproduce",
            "created_at": "2024-01-03T08:13:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1874986826",
            "id": 1874986826,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vwgdK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1874986826/reactions"
            },
            "updated_at": "2024-01-03T08:13:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1874986826",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I was able to reproduce in the sense that the buffer created in _init.vim_ was getting discarded when launching **nvim**.  \r\nI added the following line in _init.vim_ which solved the problem: `vim.api.nvim_set_current_buf(gb)`.  \r\nMy _init.lua_ looks like this after the change:\r\n```lua\r\nlocal gb = vim.api.nvim_create_buf(false, false)\r\nvim.api.nvim_buf_set_option(gb, \"buftype\", \"nofile\")\r\nvim.api.nvim_buf_set_option(gb, \"filetype\", \"alist\")\r\nvim.api.nvim_buf_set_option(gb, \"modeline\", false)\r\nvim.api.nvim_set_current_buf(gb) -- this solved the problem\r\nprint(gb)\r\n```  \r\n  \r\n#### Side notes\r\n* `vim.api.nvim_buf_set_option` is deprecated\r\n* I used the development build of neovim to test this",
            "created_at": "2024-01-03T09:38:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1875082780",
            "id": 1875082780,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vw34c",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875082780/reactions"
            },
            "updated_at": "2024-01-03T09:42:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875082780",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/134197728?v=4",
                "events_url": "https://api.github.com/users/sus-domesticus/events{/privacy}",
                "followers_url": "https://api.github.com/users/sus-domesticus/followers",
                "following_url": "https://api.github.com/users/sus-domesticus/following{/other_user}",
                "gists_url": "https://api.github.com/users/sus-domesticus/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/sus-domesticus",
                "id": 134197728,
                "login": "sus-domesticus",
                "node_id": "U_kgDOB_-x4A",
                "organizations_url": "https://api.github.com/users/sus-domesticus/orgs",
                "received_events_url": "https://api.github.com/users/sus-domesticus/received_events",
                "repos_url": "https://api.github.com/users/sus-domesticus/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/sus-domesticus/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sus-domesticus/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/sus-domesticus"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "this should work\r\n\r\n```lua\r\nif vim.fn.argc() > 0 then\r\n  vim.schedule(function()\r\n    local gb = vim.api.nvim_create_buf(false, false)\r\n    vim.api.nvim_set_option_value('buftype', 'nofile', { buf = gb })\r\n    vim.api.nvim_set_option_value('filetype', 'alist', { buf = gb })\r\n    vim.api.nvim_set_option_value('modeline', false, { buf = gb })\r\n    print(gb)\r\n  end)\r\nend\r\n```",
            "created_at": "2024-01-03T10:39:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1875159830",
            "id": 1875159830,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vxKsW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875159830/reactions"
            },
            "updated_at": "2024-01-03T10:39:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875159830",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "NONE",
            "body": "This is netrw issue, removing the following lines from `autoload/netrw.vim` fixes it.\r\n```vim\r\n  \" The following code wipes out currently unused netrw buffers\r\n  \"       IF g:netrw_fastbrowse is zero (ie. slow browsing selected)\r\n  \"   AND IF the listing style is not a tree listing\r\n  if exists(\"g:netrw_fastbrowse\") && g:netrw_fastbrowse == 0 && g:netrw_liststyle != s:TREELIST\r\n\"   call Decho(\"wiping out currently unused netrw buffers\",'~'.expand(\"<slnum>\"))\r\n   let ibuf    = 1\r\n   let buflast = bufnr(\"$\")\r\n   while ibuf <= buflast\r\n    if bufwinnr(ibuf) == -1 && isdirectory(s:NetrwFile(bufname(ibuf)))\r\n     exe \"sil! keepj keepalt \".ibuf.\"bw!\"\r\n    endif\r\n    let ibuf= ibuf + 1\r\n   endwhile\r\n  endif\r\n  let @@= ykeep\r\n```",
            "created_at": "2024-01-03T10:41:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1875162232",
            "id": 1875162232,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vxLR4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875162232/reactions"
            },
            "updated_at": "2024-01-03T10:41:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875162232",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/130783534?v=4",
                "events_url": "https://api.github.com/users/Sam-programs/events{/privacy}",
                "followers_url": "https://api.github.com/users/Sam-programs/followers",
                "following_url": "https://api.github.com/users/Sam-programs/following{/other_user}",
                "gists_url": "https://api.github.com/users/Sam-programs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Sam-programs",
                "id": 130783534,
                "login": "Sam-programs",
                "node_id": "U_kgDOB8uZLg",
                "organizations_url": "https://api.github.com/users/Sam-programs/orgs",
                "received_events_url": "https://api.github.com/users/Sam-programs/received_events",
                "repos_url": "https://api.github.com/users/Sam-programs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Sam-programs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Sam-programs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Sam-programs"
            }
        },
        {
            "author_association": "NONE",
            "body": "`s:NetrwEnew` Deletes the buffer with `s:NetrwBufRemover`.\r\nSorry for the wrong code in my last message.\r\n```vim\r\n  \" Clean out the last buffer: \r\n  \" Check if the last buffer has # > 1, is unlisted, is unnamed, and does not appear in a window\r\n  \" If so, delete it.\r\n  call s:NetrwBufRemover(bufnr(\"$\"))\r\n```\r\nYou can work around this by setting `buflisted` with `nvim_create_buf` for now.\r\n```lua\r\n--                                 listed\r\nlocal gb = vim.api.nvim_create_buf(true, false)\r\nvim.api.nvim_buf_set_option(gb, \"buftype\", \"nofile\")\r\nvim.api.nvim_buf_set_option(gb, \"filetype\", \"alist\")\r\nvim.api.nvim_buf_set_option(gb, \"modeline\", false)\r\nprint(gb)\r\n```",
            "created_at": "2024-01-03T11:24:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1875216477",
            "id": 1875216477,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vxYhd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 1,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875216477/reactions"
            },
            "updated_at": "2024-01-03T11:45:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875216477",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/130783534?v=4",
                "events_url": "https://api.github.com/users/Sam-programs/events{/privacy}",
                "followers_url": "https://api.github.com/users/Sam-programs/followers",
                "following_url": "https://api.github.com/users/Sam-programs/following{/other_user}",
                "gists_url": "https://api.github.com/users/Sam-programs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Sam-programs",
                "id": 130783534,
                "login": "Sam-programs",
                "node_id": "U_kgDOB8uZLg",
                "organizations_url": "https://api.github.com/users/Sam-programs/orgs",
                "received_events_url": "https://api.github.com/users/Sam-programs/received_events",
                "repos_url": "https://api.github.com/users/Sam-programs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Sam-programs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Sam-programs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Sam-programs"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thank you all! You rock.\r\n\r\n@glepnir  i also figured out that vim.schedule \"fixed\" the issue, but i really needed to know why. Sometimes you don't want to schedule stuff.\r\n\r\n@Sam-programs  thank you sooo much! It does look like that is it.\r\n\r\nExplains why the \"Netrw\" label has the text it does i guess.\r\n\r\nIdk how you all handle netrw issues, but the workaround (created the buffer as listed) works for me üëçüèΩ",
            "created_at": "2024-01-03T14:04:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/26865#issuecomment-1875419701",
            "id": 1875419701,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26865",
            "node_id": "IC_kwDOAPphoM5vyKI1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875419701/reactions"
            },
            "updated_at": "2024-01-03T14:04:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1875419701",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8395393?v=4",
                "events_url": "https://api.github.com/users/eanyanwu/events{/privacy}",
                "followers_url": "https://api.github.com/users/eanyanwu/followers",
                "following_url": "https://api.github.com/users/eanyanwu/following{/other_user}",
                "gists_url": "https://api.github.com/users/eanyanwu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/eanyanwu",
                "id": 8395393,
                "login": "eanyanwu",
                "node_id": "MDQ6VXNlcjgzOTUzOTM=",
                "organizations_url": "https://api.github.com/users/eanyanwu/orgs",
                "received_events_url": "https://api.github.com/users/eanyanwu/received_events",
                "repos_url": "https://api.github.com/users/eanyanwu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/eanyanwu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/eanyanwu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/eanyanwu"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26865/comments",
    "created_at": "2024-01-03T05:38:14Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26865/events",
    "html_url": "https://github.com/neovim/neovim/issues/26865",
    "id": 2063273927,
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "fuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu",
            "id": 2745063166,
            "name": "netrw",
            "node_id": "MDU6TGFiZWwyNzQ1MDYzMTY2",
            "url": "https://api.github.com/repos/neovim/neovim/labels/netrw"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26865/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM56-w_H",
    "number": 26865,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26865/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26865/timeline",
    "title": "Buffer options not when opening a file",
    "updated_at": "2024-01-04T13:02:19Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26865",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8395393?v=4",
        "events_url": "https://api.github.com/users/eanyanwu/events{/privacy}",
        "followers_url": "https://api.github.com/users/eanyanwu/followers",
        "following_url": "https://api.github.com/users/eanyanwu/following{/other_user}",
        "gists_url": "https://api.github.com/users/eanyanwu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/eanyanwu",
        "id": 8395393,
        "login": "eanyanwu",
        "node_id": "MDQ6VXNlcjgzOTUzOTM=",
        "organizations_url": "https://api.github.com/users/eanyanwu/orgs",
        "received_events_url": "https://api.github.com/users/eanyanwu/received_events",
        "repos_url": "https://api.github.com/users/eanyanwu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/eanyanwu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/eanyanwu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/eanyanwu"
    }
}
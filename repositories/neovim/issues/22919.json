{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\r\n\r\nAssert failure when resizing after multiline messages and calling screenstring() in VimResized\r\n\r\n### Steps to reproduce\r\n\r\n1. Run `nvim --clean`\r\n2. Source the following file:\r\n```vim\r\nautocmd VimResized * call screenstring(1, 1)\r\necho \"abc\\ndef\"\r\nset lines=10\r\n```\r\n3. ``message.c:2429: void msg_scroll_flush(void): Assertion `row >= 0' failed.``\r\n```\r\n                Stack trace of thread 185633:\r\n                #0  0x00007feaeb42b8ec n/a (libc.so.6 + 0x878ec)\r\n                #1  0x00007feaeb3dcea8 raise (libc.so.6 + 0x38ea8)\r\n                #2  0x00007feaeb3c653d abort (libc.so.6 + 0x2253d)\r\n                #3  0x00007feaeb3c645c n/a (libc.so.6 + 0x2245c)\r\n                #4  0x00007feaeb3d59f6 __assert_fail (libc.so.6 + 0x319f6)\r\n                #5  0x000055f4643b3932 msg_scroll_flush (nvim + 0x1d7932)\r\n                #6  0x000055f4642e19f6 screenchar_adjust (nvim + 0x1059f6)\r\n                #7  0x000055f464303453 f_screenstring (nvim + 0x127453)\r\n                #8  0x000055f4642f200f call_internal_func (nvim + 0x11600f)\r\n                #9  0x000055f464310556 call_func (nvim + 0x134556)\r\n                #10 0x000055f464310968 get_func_tv (nvim + 0x134968)\r\n                #11 0x000055f46431472b ex_call (nvim + 0x13872b)\r\n                #12 0x000055f46432c5a4 execute_cmd0 (nvim + 0x1505a4)\r\n                #13 0x000055f46432e42a do_one_cmd (nvim + 0x15242a)\r\n                #14 0x000055f46432f008 do_cmdline (nvim + 0x153008)\r\n                #15 0x000055f46429d3d4 apply_autocmds_group (nvim + 0xc13d4)\r\n                #16 0x000055f46429d883 apply_autocmds (nvim + 0xc1883)\r\n                #17 0x000055f4642d1488 screen_resize (nvim + 0xf5488)\r\n                #18 0x000055f4643e3c83 set_num_option (nvim + 0x207c83)\r\n                #19 0x000055f4643e58a2 do_set_num (nvim + 0x2098a2)\r\n                #20 0x000055f4643e5aa9 do_set_option_value (nvim + 0x209aa9)\r\n                #21 0x000055f4643e5fe4 do_set_option (nvim + 0x209fe4)\r\n                #22 0x000055f4643e60c9 do_set (nvim + 0x20a0c9)\r\n                #23 0x000055f4643e6306 ex_set (nvim + 0x20a306)\r\n                #24 0x000055f46432c5a4 execute_cmd0 (nvim + 0x1505a4)\r\n                #25 0x000055f46432e42a do_one_cmd (nvim + 0x15242a)\r\n                #26 0x000055f46432f008 do_cmdline (nvim + 0x153008)\r\n                #27 0x000055f464438c9a do_source (nvim + 0x25cc9a)\r\n                #28 0x000055f464439204 cmd_source (nvim + 0x25d204)\r\n                #29 0x000055f464439247 ex_source (nvim + 0x25d247)\r\n                #30 0x000055f46432c5a4 execute_cmd0 (nvim + 0x1505a4)\r\n                #31 0x000055f46432e42a do_one_cmd (nvim + 0x15242a)\r\n                #32 0x000055f46432f008 do_cmdline (nvim + 0x153008)\r\n                #33 0x000055f4643d04b8 nv_colon (nvim + 0x1f44b8)\r\n                #34 0x000055f4643cf323 normal_execute (nvim + 0x1f3323)\r\n                #35 0x000055f464468f85 state_enter (nvim + 0x28cf85)\r\n                #36 0x000055f4643c7993 normal_enter (nvim + 0x1eb993)\r\n                #37 0x000055f464254c41 main (nvim + 0x78c41)\r\n                #38 0x00007feaeb3c7790 n/a (libc.so.6 + 0x23790)\r\n                #39 0x00007feaeb3c784a __libc_start_main (libc.so.6 + 0x2384a)\r\n                #40 0x000055f464250045 _start (nvim + 0x74045)\r\n                ELF object binary architecture: AMD x86-64\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo assert failure\r\n\r\n### Neovim version (nvim -v)\r\n\r\nv0.9.0-dev-1357+g68d6ca794\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNo\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Terminal name/version\r\n\r\nkitty 0.27.1\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbuild from repo",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Actually anything that calls `msg_scroll_flush()` can cause this crash, including `:redraw` and `:sleep`.",
            "created_at": "2023-04-07T09:33:21Z",
            "html_url": "https://github.com/neovim/neovim/issues/22919#issuecomment-1500118957",
            "id": 1500118957,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22919",
            "node_id": "IC_kwDOAPphoM5Zaf-t",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1500118957/reactions"
            },
            "updated_at": "2023-04-07T09:33:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1500118957",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@zeertzjq can you check if the following test reproduces this bug or exposes some other?\r\n```lua\r\nlocal configDir = vim.fn.expand('<sfile>:p:h')\r\n\r\nvim.env['XDG_CONFIG_HOME'] = configDir\r\nvim.env['XDG_DATA_HOME'] = configDir .. '/.xdg/data'\r\nvim.env['XDG_STATE_HOME'] = configDir .. '/.xdg/state'\r\nvim.env['XDG_CACHE_HOME'] = configDir .. '/.xdg/cache'\r\nlocal stdPathConfig = vim.fn.stdpath('config')\r\n\r\nvim.opt.runtimepath:prepend(stdPathConfig)\r\nvim.opt.packpath:prepend(stdPathConfig)\r\nlocal plugins_path = vim.fn.fnamemodify('plugins/', ':p')\r\n\r\nfor name, url in pairs {\r\n  ['nui'] = 'https://github.com/MunifTanjim/nui.nvim',\r\n  ['noice.nvim'] = 'https://github.com/folke/noice.nvim',\r\n} do\r\n  local install_path = plugins_path .. name\r\n  if vim.fn.isdirectory(install_path) == 0 then\r\n    vim.fn.system { 'git', 'clone', '--depth=1', url, install_path }\r\n  end\r\n  vim.opt.runtimepath:append(install_path)\r\nend\r\n\r\nrequire('noice').setup({})\r\nvim.notify_once('\\n')\r\n```\r\n\r\nI try to find a similar issue but it's not so easy. \r\n\r\n```cpp\r\n                Stack trace of thread 485218:                                                                                                                                                                                                   \r\n                #0  0x00007fa249def0ec __pthread_kill_implementation (libc.so.6 + 0x8a0ec)                                                                                                                                                      \r\n                #1  0x00007fa249da1462 __GI_raise (libc.so.6 + 0x3c462)                                                                                                                                                                         \r\n                #2  0x00007fa249d8b4b2 __GI_abort (libc.so.6 + 0x264b2)                                                                                                                                                                         \r\n                #3  0x00007fa249d8b3d5 __assert_fail_base (libc.so.6 + 0x263d5)                                                                                                                                                                 \r\n                #4  0x00007fa249d9a3a2 __assert_fail (libc.so.6 + 0x353a2)                                                                                                                                                                      \r\n                #5  0x00005607cf7d3df1 msg_scroll_flush (nvim + 0x1ebdf1)                                                                                                                                                                       \r\n                #6  0x00005607cf8b5cfb ui_flush (nvim + 0x2cdcfb)\r\n                #7  0x00005607cf6f59e5 screen_resize (nvim + 0x10d9e5)\r\n                #8  0x00005607cf8b4947 ui_refresh (nvim + 0x2cc947)\r\n                #9  0x00005607cf8b6932 ui_add_cb (nvim + 0x2ce932)\r\n                #10 0x00005607cf7a50ea n/a (nvim + 0x1bd0ea) \r\n                #11 0x00007fa24a030a26 n/a (libluajit-5.1.so.2 + 0xaa26)\r\n                #12 0x00007fa24a08b1ee lua_pcall (libluajit-5.1.so.2 + 0x651ee)\r\n                #13 0x00005607cf79f6d8 nlua_pcall (nvim + 0x1b76d8)\r\n                #14 0x00005607cf7a3ff1 nlua_call_ref (nvim + 0x1bbff1)\r\n                #15 0x00005607cf6c1231 n/a (nvim + 0xd9231)\r\n                #16 0x00005607cf6c338f getnextac (nvim + 0xdb38f)\r\n                #17 0x00005607cf751ec3 do_cmdline (nvim + 0x169ec3)\r\n                #18 0x00005607cf6c1f49 apply_autocmds_group (nvim + 0xd9f49)\r\n                #19 0x00005607cf6c25ff apply_autocmds (nvim + 0xda5ff)\r\n                #20 0x00005607cf679077 main (nvim + 0x91077) \r\n                #21 0x00007fa249d8c6ca __libc_start_call_main (libc.so.6 + 0x276ca)\r\n                #22 0x00007fa249d8c785 __libc_start_main_impl (libc.so.6 + 0x27785)\r\n                #23 0x00005607cf674685 _start (nvim + 0x8c685)\r\n                 \r\n                Stack trace of thread 485220:\r\n                #0  0x0000000000000000 n/a (n/a + 0x0)\r\n                ELF object binary architecture: AMD x86-64\r\n```",
            "created_at": "2023-09-09T15:16:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/22919#issuecomment-1712534927",
            "id": 1712534927,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22919",
            "node_id": "IC_kwDOAPphoM5mEzWP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1712534927/reactions"
            },
            "updated_at": "2023-09-09T15:16:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1712534927",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Another",
            "created_at": "2023-09-09T21:02:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/22919#issuecomment-1712610390",
            "id": 1712610390,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22919",
            "node_id": "IC_kwDOAPphoM5mFFxW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1712610390/reactions"
            },
            "updated_at": "2023-09-09T21:02:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1712610390",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I get a similar error (but the assertion is `to_scroll >= 0`).\r\n\r\nI sometimes get it when I edit a fennel file, but only with \"fennel.vim\" installed.\r\n\r\nI can reproduce it without opening a file when I add `-V2` to the command line. It goes away with `-u NONE`, so it's still something in my config causing it. Running v0.10.0-dev from the ubuntu unstable ppa.",
            "created_at": "2023-10-02T15:42:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/22919#issuecomment-1743259502",
            "id": 1743259502,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22919",
            "node_id": "IC_kwDOAPphoM5n6Adu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1743259502/reactions"
            },
            "updated_at": "2023-10-02T15:42:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1743259502",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/497310?v=4",
                "events_url": "https://api.github.com/users/Grazfather/events{/privacy}",
                "followers_url": "https://api.github.com/users/Grazfather/followers",
                "following_url": "https://api.github.com/users/Grazfather/following{/other_user}",
                "gists_url": "https://api.github.com/users/Grazfather/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Grazfather",
                "id": 497310,
                "login": "Grazfather",
                "node_id": "MDQ6VXNlcjQ5NzMxMA==",
                "organizations_url": "https://api.github.com/users/Grazfather/orgs",
                "received_events_url": "https://api.github.com/users/Grazfather/received_events",
                "repos_url": "https://api.github.com/users/Grazfather/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Grazfather/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Grazfather/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Grazfather",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Possibly related issues: #31002 #32319",
            "created_at": "2025-02-14T02:20:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/22919#issuecomment-2658113988",
            "id": 2658113988,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22919",
            "node_id": "IC_kwDOAPphoM6eb5nE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2658113988/reactions"
            },
            "updated_at": "2025-02-14T02:20:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2658113988",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I am working on a fix for issue #32319 and #31002, and i was trying to create a scenario where assert(to_scroll >= 0) fires.\n\nand i might have came across another edge case.\n\nstep to reproduce:\nrun the build with --clean flag and source this file\n\n```vim\n\" tiny screen\nset lines=10 cmdheight=1\n\n\" Enable verbose output (equivalent to nvim -V2)\nset verbose=2\n\n\" messages into the message grid\nfor i in range(1, 100)\n  echomsg \"msg \" . i\nendfor\n\n\"Autocmd that forces redraw (causes msg_grid_pos & discount desync)\nautocmd VimResized * redraw\n\n\"multiple rapid resizes, triggering flush() repeatedly\nset lines=15\nset lines=8\nset lines=12\nset lines=9\nset lines=14\n```\n\n\nwhen you see the screen:\n\n<img width=\"661\" height=\"470\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/3890d005-360b-4282-a57e-53add79dd48b\" />\n\nhit k or up arrow key, to make the screen scrolling up one line:\n\n<img width=\"1396\" height=\"595\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/da8625ed-63ee-434f-8cd3-28634eefb80a\" />\n\n\nnow hold space to scroll all the way down, and you should see another crash related to assert failure:\n\nsrc/nvim/ui.c:463: ui_line: Assertion `0 <= row && row < grid->rows' failed. \n\nback trace:\n```gdb\n#0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:44\n#1  __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\n#2  __GI___pthread_kill (threadid=<optimized out>, signo=signo@entry=6) at ./nptl/pthread_kill.c:89\n#3  0x00007ffff7c4527e in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\n#4  0x00007ffff7c288ff in __GI_abort () at ./stdlib/abort.c:79\n#5  0x00007ffff7c2881b in __assert_fail_base (fmt=0x7ffff7dd01e8 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\", \n    assertion=assertion@entry=0x555555b3237d \"0 <= row && row < grid->rows\", \n    file=file@entry=0x555555b32358 \"/home/lpiombini/neovim/src/nvim/ui.c\", line=line@entry=463, \n    function=function@entry=0x555555b324a0 <__PRETTY_FUNCTION__.3> \"ui_line\") at ./assert/assert.c:96\n#6  0x00007ffff7c3b517 in __assert_fail (assertion=0x555555b3237d \"0 <= row && row < grid->rows\", \n    file=0x555555b32358 \"/home/lpiombini/neovim/src/nvim/ui.c\", line=463, \n    function=0x555555b324a0 <__PRETTY_FUNCTION__.3> \"ui_line\") at ./assert/assert.c:105\n#7  0x0000555555962040 in ui_line (grid=0x555555c3fbe0 <msg_grid>, row=14, invalid_row=false, startcol=0, \n    endcol=-1815690620, clearcol=118, clearattr=1, wrap=false) at /home/lpiombini/neovim/src/nvim/ui.c:463\n#8  0x000055555581f19f in msg_scroll_flush () at /home/lpiombini/neovim/src/nvim/message.c:2614\n#9  0x000055555596230f in ui_flush () at /home/lpiombini/neovim/src/nvim/ui.c:555\n#10 0x0000555555732e68 in ex_redraw (eap=0x7fffffffb850) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:6779\n#11 0x00005555557265e7 in execute_cmd0 (retv=0x7fffffffb808, eap=0x7fffffffb850, errormsg=0x7fffffffb820, \n    preview=false) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:1762\n#12 0x0000555555728424 in do_one_cmd (cmdlinep=0x7fffffffba70, flags=7, cstack=0x7fffffffbb80, \n    fgetline=0x55555564f347 <getnextac>, cookie=0x7fffffffc1a0) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:2392\n#13 0x0000555555723dee in do_cmdline (cmdline=0x0, fgetline=0x55555564f347 <getnextac>, cookie=0x7fffffffc1a0, \n    flags=7) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:679\n#14 0x000055555564e679 in apply_autocmds_group (event=EVENT_VIMRESIZED, fname=0x555555c897e0 \"\", fname_io=0x0, \n    force=false, group=-3, buf=0x555555c79550, eap=0x0, data=0x0) at /home/lpiombini/neovim/src/nvim/autocmd.c:1872\n#15 0x000055555564da88 in apply_autocmds (event=EVENT_VIMRESIZED, fname=0x0, fname_io=0x0, force=false, \n    buf=0x555555c79550) at /home/lpiombini/neovim/src/nvim/autocmd.c:1507\n#16 0x000055555569e2f3 in screen_resize (width=118, height=15) at /home/lpiombini/neovim/src/nvim/drawscreen.c:352\n#17 0x0000555555855490 in did_set_lines_or_columns (args=0x7fffffffc430)\n    at /home/lpiombini/neovim/src/nvim/option.c:2135\n#18 0x00005555558583a7 in did_set_option (opt_idx=kOptLines, varp=0x555555c5b9a0 <p_lines>, old_value=..., \n    new_value=..., opt_flags=0, set_sid=0, direct=false, value_replaced=true, errbuf=0x7fffffffc7a0 \"\\001\", \n    errbuflen=80) at /home/lpiombini/neovim/src/nvim/option.c:3485\n#19 0x0000555555859127 in set_option (opt_idx=kOptLines, value=..., opt_flags=0, set_sid=0, direct=false, \n    value_replaced=true, errbuf=0x7fffffffc7a0 \"\\001\", errbuflen=80) at /home/lpiombini/neovim/src/nvim/option.c:3719\n#20 0x00005555558535d2 in do_one_set_option (opt_flags=0, argp=0x7fffffffc778, did_show=0x7fffffffc787, \n    errbuf=0x7fffffffc7a0 \"\\001\", errbuflen=80, errmsg=0x7fffffffc790)\n    at /home/lpiombini/neovim/src/nvim/option.c:1335\n#21 0x0000555555853799 in do_set (arg=0x555555cc2719 \"=15\", opt_flags=0)\n    at /home/lpiombini/neovim/src/nvim/option.c:1384\n#22 0x0000555555851d38 in ex_set (eap=0x7fffffffc910) at /home/lpiombini/neovim/src/nvim/option.c:733\n#23 0x00005555557265e7 in execute_cmd0 (retv=0x7fffffffc8c8, eap=0x7fffffffc910, errormsg=0x7fffffffc8e0, \n    preview=false) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:1762\n#24 0x0000555555728424 in do_one_cmd (cmdlinep=0x7fffffffcb30, flags=7, cstack=0x7fffffffcc40, \n    fgetline=0x5555558d2722 <getsourceline>, cookie=0x7fffffffd240)\n    at /home/lpiombini/neovim/src/nvim/ex_docmd.c:2392\n#25 0x0000555555723dee in do_cmdline (\n    cmdline=0x555555cc1e80 \"\\\" Make the screen tiny (forces heavy message scrolling)\", \n    fgetline=0x5555558d2722 <getsourceline>, cookie=0x7fffffffd240, flags=7)\n    at /home/lpiombini/neovim/src/nvim/ex_docmd.c:679\n#26 0x00005555558d190b in do_source_ext (fname=0x555555cc32f7 \"trigger_assert_toscroll\", check_other=false, \n    is_vimrc=0, ret_sid=0x0, eap=0x0, ex_lua=false, str=0x0) at /home/lpiombini/neovim/src/nvim/runtime.c:2294\n#27 0x00005555558d1cec in do_source (fname=0x555555cc32f7 \"trigger_assert_toscroll\", check_other=false, is_vimrc=0, \n    ret_sid=0x0) at /home/lpiombini/neovim/src/nvim/runtime.c:2369\n#28 0x00005555558d070b in cmd_source (fname=0x555555cc32f7 \"trigger_assert_toscroll\", eap=0x7fffffffd420)\n    at /home/lpiombini/neovim/src/nvim/runtime.c:1861\n#29 0x00005555558d075d in ex_source (eap=0x7fffffffd420) at /home/lpiombini/neovim/src/nvim/runtime.c:1869\n#30 0x00005555557265e7 in execute_cmd0 (retv=0x7fffffffd3d8, eap=0x7fffffffd420, errormsg=0x7fffffffd3f0, \n    preview=false) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:1762\n#31 0x0000555555728424 in do_one_cmd (cmdlinep=0x7fffffffd640, flags=0, cstack=0x7fffffffd750,\n#22 0x0000555555851d38 in ex_set (eap=0x7fffffffc910) at /home/lpiombini/neovim/src/nvim/option.c:733\n#23 0x00005555557265e7 in execute_cmd0 (retv=0x7fffffffc8c8, eap=0x7fffffffc910, errormsg=0x7fffffffc8e0, \n    preview=false) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:1762\n#24 0x0000555555728424 in do_one_cmd (cmdlinep=0x7fffffffcb30, flags=7, cstack=0x7fffffffcc40, \n    fgetline=0x5555558d2722 <getsourceline>, cookie=0x7fffffffd240)\n    at /home/lpiombini/neovim/src/nvim/ex_docmd.c:2392\n#25 0x0000555555723dee in do_cmdline (\n    cmdline=0x555555cc1e80 \"\\\" Make the screen tiny (forces heavy message scrolling)\", \n    fgetline=0x5555558d2722 <getsourceline>, cookie=0x7fffffffd240, flags=7)\n    at /home/lpiombini/neovim/src/nvim/ex_docmd.c:679\n#26 0x00005555558d190b in do_source_ext (fname=0x555555cc32f7 \"trigger_assert_toscroll\", check_other=false, \n    is_vimrc=0, ret_sid=0x0, eap=0x0, ex_lua=false, str=0x0) at /home/lpiombini/neovim/src/nvim/runtime.c:2294\n#27 0x00005555558d1cec in do_source (fname=0x555555cc32f7 \"trigger_assert_toscroll\", check_other=false, is_vimrc=0, \n    ret_sid=0x0) at /home/lpiombini/neovim/src/nvim/runtime.c:2369\n#28 0x00005555558d070b in cmd_source (fname=0x555555cc32f7 \"trigger_assert_toscroll\", eap=0x7fffffffd420)\n    at /home/lpiombini/neovim/src/nvim/runtime.c:1861\n#29 0x00005555558d075d in ex_source (eap=0x7fffffffd420) at /home/lpiombini/neovim/src/nvim/runtime.c:1869\n#30 0x00005555557265e7 in execute_cmd0 (retv=0x7fffffffd3d8, eap=0x7fffffffd420, errormsg=0x7fffffffd3f0, \n    preview=false) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:1762\n#31 0x0000555555728424 in do_one_cmd (cmdlinep=0x7fffffffd640, flags=0, cstack=0x7fffffffd750, \n--Type <RET> for more, q to quit, c to continue without paging--\n    fgetline=0x55555574250c <getexline>, cookie=0x0) at /home/lpiombini/neovim/src/nvim/ex_docmd.c:2392\n#32 0x0000555555723dee in do_cmdline (cmdline=0x0, fgetline=0x55555574250c <getexline>, cookie=0x0, flags=0)\n    at /home/lpiombini/neovim/src/nvim/ex_docmd.c:679\n#33 0x000055555583b456 in nv_colon (cap=0x7fffffffddc0) at /home/lpiombini/neovim/src/nvim/normal.c:3197\n#34 0x0000555555836ebc in normal_execute (state=0x7fffffffdd50, key=58)\n    at /home/lpiombini/neovim/src/nvim/normal.c:1253\n#35 0x000055555591583a in state_enter (s=0x7fffffffdd50) at /home/lpiombini/neovim/src/nvim/state.c:100\n#36 0x0000555555834fb0 in normal_enter (cmdwin=false, noexmode=false) at /home/lpiombini/neovim/src/nvim/normal.c:523\n#37 0x00005555557d5bae in main (argc=3, argv=0x7fffffffe158) at /home/lpiombini/neovim/src/nvim/main.c:658\n```\nit does happen only with this steps. \n\nif you go up one line on the first screen, and scroll line by line with down arrow key or j, it won't cause assertion failure.\nif you go up one line at the first screen, and you then go down one line, and use space to fast scroll, it won't crashes\n\nmy build version is :\n\nNVIM v0.12.0-dev-1705+g1cc905ed45-dirty\nBuild type: Debug\nLuaJIT 2.1.1763318511\nCompilation: /usr/bin/cc -g  -Wall -Wextra -pedantic -Wno-unused-parameter -Wstrict-prototypes -std=gnu99 -Wshadow -Wconversion -Wvla -Wdouble-promotion -Wmissing-noreturn -Wmissing-format-attribute -Wmissing-prototypes -Wno-unused-function -fsigned-char -fstack-protector-strong -Wno-conversion -fno-common -Wimplicit-fallthrough -fdiagnostics-color=auto  -DHAVE_UNIBILIUM -DNVIM_LOG_DEBUG -DUNIT_TESTING -D_GNU_SOURCE -DUTF8PROC_STATIC -I/home/lpiombini/neovim/.deps/usr/include/luajit-2.1 -I/home/lpiombini/neovim/.deps/usr/include -I/home/lpiombini/neovim/build/src/nvim/auto -I/home/lpiombini/neovim/build/include -I/home/lpiombini/neovim/build/cmake.config -I/home/lpiombini/neovim/src -I/usr/include \n\n   system vimrc file: \"$VIM/sysinit.vim\"\n  fall-back for $VIM: \"/usr/local/share/nvim\"\n\n\nit does not happen in the older version that i have installed on my server via apt package manager:\n\n\nNVIM v0.9.5\nBuild type: Release\nLuaJIT 2.1.1703358377\n\n   system vimrc file: \"$VIM/sysinit.vim\"\n  fall-back for $VIM: \"/usr/share/nvim\"\n\ndoes it happen on your machine/set up???\n\n\n\n",
            "created_at": "2025-11-30T19:17:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/22919#issuecomment-3593153390",
            "id": 3593153390,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22919",
            "node_id": "IC_kwDOAPphoM7WKytu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3593153390/reactions"
            },
            "updated_at": "2025-11-30T19:17:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3593153390",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/69109614?v=4",
                "events_url": "https://api.github.com/users/LorenzoPiombini/events{/privacy}",
                "followers_url": "https://api.github.com/users/LorenzoPiombini/followers",
                "following_url": "https://api.github.com/users/LorenzoPiombini/following{/other_user}",
                "gists_url": "https://api.github.com/users/LorenzoPiombini/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/LorenzoPiombini",
                "id": 69109614,
                "login": "LorenzoPiombini",
                "node_id": "MDQ6VXNlcjY5MTA5NjE0",
                "organizations_url": "https://api.github.com/users/LorenzoPiombini/orgs",
                "received_events_url": "https://api.github.com/users/LorenzoPiombini/received_events",
                "repos_url": "https://api.github.com/users/LorenzoPiombini/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/LorenzoPiombini/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/LorenzoPiombini/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/LorenzoPiombini",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22919/comments",
    "created_at": "2023-04-07T09:25:34Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22919/events",
    "html_url": "https://github.com/neovim/neovim/issues/22919",
    "id": 1658587457,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 113026979,
            "name": "ui",
            "node_id": "MDU6TGFiZWwxMTMwMjY5Nzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains minimal reproducing steps",
            "id": 435851959,
            "name": "has:repro",
            "node_id": "MDU6TGFiZWw0MzU4NTE5NTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:repro"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "events, autocommands",
            "id": 3341085842,
            "name": "events",
            "node_id": "MDU6TGFiZWwzMzQxMDg1ODQy",
            "url": "https://api.github.com/repos/neovim/neovim/labels/events"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "UI messages, log messages, dialogs, progress, errors, warnings, feedback",
            "id": 5637083595,
            "name": "messages",
            "node_id": "LA_kwDOAPphoM8AAAABT_8Ryw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/messages"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22919/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5i3AlB",
    "number": 22919,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22919/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22919/timeline",
    "title": "Assert failure when resizing after multiline messages and calling screenstring() in VimResized",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-11-30T19:17:44Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22919",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    }
}
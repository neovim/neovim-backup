{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nThis was originally reported here https://github.com/neovide/neovide/issues/3094. When treesitter is enabled and a split is opened with the same buffer on both side and scrolled, the `win_viewport` event is sent for the wrong grid. Resulting in non-working smooth scrolling in Neovide.\n\nI have bisected this down to this commit https://github.com/neovim/neovim/commit/562056c87573a532a0e670952d23d77026eeae28. To me it does not look related, so I have triple checked it, and it's indeed that one.\n\n### Steps to reproduce\n\nSteps to reproduce the behavior:\n\n<details>\n<summary><tt>minimal.lua</tt></summary>\n\n```lua\nfor name, url in pairs({\n\t\"https://github.com/nvim-treesitter/nvim-treesitter\",\n}) do\n\tlocal install_path = vim.fn.fnamemodify(\"nvim_issue/\" .. name, \":p\")\n\tif vim.fn.isdirectory(install_path) == 0 then\n\t\tvim.fn.system({ \"git\", \"clone\", \"--depth=1\", url, install_path })\n\tend\n\tvim.opt.runtimepath:append(install_path)\nend\n\n---@diagnostic disable-next-line: missing-fields\nrequire(\"nvim-treesitter.configs\").setup({\n\tensure_installed = {\n\t\t\"json\",\n\t\t\"http\",\n\t},\n})\n\nvim.api.nvim_create_autocmd(\"FileType\", {\n\tcallback = function()\n\t\tvim.treesitter.start()\n\tend,\n})\n```\n</details>\n\n<details>\n\n<summary><tt>repro.http</tt></summary>\n\n```http\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nGET {{PATH}}\nHost: {{API}}\nAuthorization: {{AUTH}}\n###\n\nGET {{PATH}}\nHost: {{API}}\nAuthorization: {{AUTH}}\n###\n\nPOST {{PATH}}\nHost: {{API}}\nAuthorization: {{AUTH}}\n\n{\n    \"foo\": \"bar\",\n    \"foo1\": \"bar\",\n    \"foo2\": \"bar\",\n    \"foo3\": \"bar\",\n    \"foo4\": \"bar\",\n    \"foo5\": \"bar\"\n}\n###\n\nPOST {{PATH}}\nHost: {{API}}\nAuthorization: {{AUTH}}\n\n{\n    \"foo\": \"bar\",\n    \"foo1\": \"bar\",\n    \"foo2\": \"bar\"\n}\n###\n\nPATCH {{PATH}}\nHost: {{API}}\nAuthorization: {{AUTH}}\n\n{\n    \"foo\": \"bar\",\n    \"foo1\": \"bar\",\n    \"foo2\": \"bar\",\n    \"foo3\": \"bar\",\n    \"foo4\": \"bar\",\n    \"foo5\": \"bar\"\n}\n###\n```\n</details>\n\n1. `neovide -- -u minimal.lua repro.http`. Notice that `repro.http` contains a \"gap\" at the top. It's important. Its size may need to be adjusted, so the buffer takes at the least the entire viewport.\n2. Create a split with `<C-w>v`\n3. Scroll down with `<C-d>` and then up with `<C-u>`\n4. Notice no smooth scrolling\n\n### Expected behavior\n\nSmooth scrolling should work in this scenario.\n\n`win_viewport` should also be sent for grid 3. When comparing the logs, you can see that there's no win_viewport events for grid 3 as there should be, for some reason there is one sent twice for grid 2.\n\n<details>\n<summary>before 562056c87573a532a0e670952d23d77026eeae28 </summary>\n\n```\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 4, row: 0, column_start: 187, cells: [GridLineCell { text: \" \", highlight_id: Some(1), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(0) }] }\nTRACE [neovide::channel_utils] neovim_handler Scroll { grid: 3, top: 0, bottom: 49, left: 0, right: 99, rows: 18, columns: 0 }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 31, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"1\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 32, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"2\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(82) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 33, column_start: 0, cells: [GridLineCell { text: \"}\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(98) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 34, column_start: 0, cells: [GridLineCell { text: \"#\", highlight_id: Some(49), repeat: Some(3) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(96) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 35, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(99) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 36, column_start: 0, cells: [GridLineCell { text: \"P\", highlight_id: Some(16), repeat: None }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"T\", highlight_id: None, repeat: None }, GridLineCell { text: \"C\", highlight_id: None, repeat: None }, GridLineCell { text: \"H\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"{\", highlight_id: Some(59), repeat: Some(2) }, GridLineCell { text: \"P\", highlight_id: None, repeat: None }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"T\", highlight_id: None, repeat: None }, GridLineCell { text: \"H\", highlight_id: None, repeat: None }, GridLineCell { text: \"}\", highlight_id: Some(59), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(85) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 37, column_start: 0, cells: [GridLineCell { text: \"H\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"s\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"{\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"P\", highlight_id: None, repeat: None }, GridLineCell { text: \"I\", highlight_id: None, repeat: None }, GridLineCell { text: \"}\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(86) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 38, column_start: 0, cells: [GridLineCell { text: \"A\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \"u\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }, GridLineCell { text: \"h\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"i\", highlight_id: None, repeat: None }, GridLineCell { text: \"z\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }, GridLineCell { text: \"i\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"n\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"{\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"U\", highlight_id: None, repeat: None }, GridLineCell { text: \"T\", highlight_id: None, repeat: None }, GridLineCell { text: \"H\", highlight_id: None, repeat: None }, GridLineCell { text: \"}\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(76) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 39, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(99) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 40, column_start: 0, cells: [GridLineCell { text: \"{\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(98) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 41, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(82) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 42, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"1\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 43, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"2\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 44, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"3\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 45, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"4\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 46, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"5\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(82) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 47, column_start: 0, cells: [GridLineCell { text: \"}\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(98) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 48, column_start: 0, cells: [GridLineCell { text: \"#\", highlight_id: Some(49), repeat: Some(3) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(96) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 1, row: 49, column_start: 81, cells: [GridLineCell { text: \"2\", highlight_id: Some(41), repeat: None }, GridLineCell { text: \"5\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: None, repeat: None }, GridLineCell { text: \"1\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(41), repeat: Some(11) }, GridLineCell { text: \"B\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }] }\nTRACE [neovide::channel_utils] neovim_handler WindowViewport { grid: 3, top_line: 18.0, bottom_line: 67.0, current_line: 24.0, current_column: 0.0, line_count: Some(67.0), scroll_delta: Some(18.0) }\nTRACE [neovide::channel_utils] neovim_handler CursorGoto { grid: 3, row: 6, column: 0 }\nTRACE [neovide::channel_utils] neovim_handler Flush\n```\n</details>\n\n<details>\n<summary>on commit 562056c87573a532a0e670952d23d77026eeae28 </summary>\n\n```\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 4, row: 0, column_start: 187, cells: [GridLineCell { text: \" \", highlight_id: Some(1), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(0) }] }\nTRACE [neovide::channel_utils] neovim_handler Scroll { grid: 3, top: 0, bottom: 49, left: 0, right: 99, rows: 18, columns: 0 }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 31, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"1\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 32, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"2\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(82) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 33, column_start: 0, cells: [GridLineCell { text: \"}\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(98) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 34, column_start: 0, cells: [GridLineCell { text: \"#\", highlight_id: Some(49), repeat: Some(3) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(96) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 35, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(99) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 36, column_start: 0, cells: [GridLineCell { text: \"P\", highlight_id: Some(16), repeat: None }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"T\", highlight_id: None, repeat: None }, GridLineCell { text: \"C\", highlight_id: None, repeat: None }, GridLineCell { text: \"H\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"{\", highlight_id: Some(59), repeat: Some(2) }, GridLineCell { text: \"P\", highlight_id: None, repeat: None }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"T\", highlight_id: None, repeat: None }, GridLineCell { text: \"H\", highlight_id: None, repeat: None }, GridLineCell { text: \"}\", highlight_id: Some(59), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(85) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 37, column_start: 0, cells: [GridLineCell { text: \"H\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"s\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"{\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"P\", highlight_id: None, repeat: None }, GridLineCell { text: \"I\", highlight_id: None, repeat: None }, GridLineCell { text: \"}\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(86) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 38, column_start: 0, cells: [GridLineCell { text: \"A\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \"u\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }, GridLineCell { text: \"h\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"i\", highlight_id: None, repeat: None }, GridLineCell { text: \"z\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }, GridLineCell { text: \"i\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"n\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"{\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \"A\", highlight_id: None, repeat: None }, GridLineCell { text: \"U\", highlight_id: None, repeat: None }, GridLineCell { text: \"T\", highlight_id: None, repeat: None }, GridLineCell { text: \"H\", highlight_id: None, repeat: None }, GridLineCell { text: \"}\", highlight_id: Some(60), repeat: Some(2) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(76) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 39, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(99) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 40, column_start: 0, cells: [GridLineCell { text: \"{\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(98) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 41, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(82) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 42, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"1\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 43, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"2\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 44, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"3\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 45, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"4\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(81) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 46, column_start: 0, cells: [GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(4) }, GridLineCell { text: \"\\\"\", highlight_id: Some(50), repeat: None }, GridLineCell { text: \"f\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: Some(50), repeat: Some(2) }, GridLineCell { text: \"5\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \":\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: Some(15), repeat: None }, GridLineCell { text: \"b\", highlight_id: None, repeat: None }, GridLineCell { text: \"a\", highlight_id: None, repeat: None }, GridLineCell { text: \"r\", highlight_id: None, repeat: None }, GridLineCell { text: \"\\\"\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(82) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 47, column_start: 0, cells: [GridLineCell { text: \"}\", highlight_id: Some(48), repeat: None }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(98) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 3, row: 48, column_start: 0, cells: [GridLineCell { text: \"#\", highlight_id: Some(49), repeat: Some(3) }, GridLineCell { text: \" \", highlight_id: Some(0), repeat: Some(96) }] }\nTRACE [neovide::channel_utils] neovim_handler GridLine { grid: 1, row: 49, column_start: 81, cells: [GridLineCell { text: \"2\", highlight_id: Some(41), repeat: None }, GridLineCell { text: \"5\", highlight_id: None, repeat: None }, GridLineCell { text: \",\", highlight_id: None, repeat: None }, GridLineCell { text: \"1\", highlight_id: None, repeat: None }, GridLineCell { text: \" \", highlight_id: Some(41), repeat: Some(11) }, GridLineCell { text: \"B\", highlight_id: None, repeat: None }, GridLineCell { text: \"o\", highlight_id: None, repeat: None }, GridLineCell { text: \"t\", highlight_id: None, repeat: None }] }\nTRACE [neovide::channel_utils] neovim_handler WindowViewport { grid: 2, top_line: 0.0, bottom_line: 50.0, current_line: 0.0, current_column: 0.0, line_count: Some(67.0), scroll_delta: Some(0.0) }\nTRACE [neovide::channel_utils] neovim_handler WindowViewport { grid: 2, top_line: 0.0, bottom_line: 50.0, current_line: 0.0, current_column: 0.0, line_count: Some(67.0), scroll_delta: Some(0.0) }\nTRACE [neovide::channel_utils] neovim_handler CursorGoto { grid: 3, row: 6, column: 0 }\nTRACE [neovide::channel_utils] neovim_handler Flush\n\n```\n</details>\n\n**Additional context**\nDoesn't happen if not using treesitter.\nIt's almost certain that injections are required (that's why HTTP  is used as the repro).\nThere is a similar bug  https://github.com/neovim/neovim/issues/32660, where a split with injections causes flickering.\n**Not affected by disabling async treesitter parsing** (unlike the issue I linked above)\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-93+g2d11b981bf\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nArch Linux\n\n### Terminal name/version\n\nNeovide 0.15.0\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nbuild from repo",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/33353/comments",
    "created_at": "2025-04-06T14:20:07Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/33353/events",
    "html_url": "https://github.com/neovim/neovim/issues/33353",
    "id": 2974984997,
    "labels": [
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue has been tracked to a specific commit",
            "id": 1481421490,
            "name": "has:bisected",
            "node_id": "MDU6TGFiZWwxNDgxNDIxNDkw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:bisected"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/33353/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6xUqsl",
    "number": 33353,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/33353/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/33353/timeline",
    "title": "regression: win_viewport sent for the wrong grid with treesitter",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-04-06T14:21:20Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/33353",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/9946255?v=4",
        "events_url": "https://api.github.com/users/fredizzimo/events{/privacy}",
        "followers_url": "https://api.github.com/users/fredizzimo/followers",
        "following_url": "https://api.github.com/users/fredizzimo/following{/other_user}",
        "gists_url": "https://api.github.com/users/fredizzimo/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/fredizzimo",
        "id": 9946255,
        "login": "fredizzimo",
        "node_id": "MDQ6VXNlcjk5NDYyNTU=",
        "organizations_url": "https://api.github.com/users/fredizzimo/orgs",
        "received_events_url": "https://api.github.com/users/fredizzimo/received_events",
        "repos_url": "https://api.github.com/users/fredizzimo/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/fredizzimo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fredizzimo/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/fredizzimo",
        "user_view_type": "public"
    }
}
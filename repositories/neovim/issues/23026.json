{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nBy far, `textDocument/semanticTokens/full` and `textDocument/semanticTokens/full/delta` are already supported. The problem is, most servers don't have support for `textDocument/semanticTokens/full/delta` and nvim will try to request and process full semantic tokens response at every buffer change. Even though the request is debounced, there will be noticeable lagging experience if the token response is quite large due to the large file.\r\n\n\n### Expected behavior\n\nDisabling it for large file could be a workaround; but I think supporting `textDocument/semanticTokens/range` is another solution. We can only request semantic tokens for visible screen (possibly with buffer).",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Here's a `on_attach` function that disables `semanticTokens` for large files - a sort of workaround for this issue causing Neovim to slow down when editing large buffers:\r\n\r\n```lua\r\nlocal lsp = require(\"lspconfig\")\r\nservers_list = {\r\n\t\"lsp1\",\r\n\t\"lsp2\",\r\n\t--...,\r\n}\r\nfor _,v in ipairs(servers_list) do\r\n\tlsp[v].setup{\r\n\t\tautostart = true,\r\n\t\tcapabilities = capabilities,\r\n\t\ton_attach = function(client, bufnr)\r\n\t\t\t-- See https://github.com/neovim/neovim/issues/23026\r\n\t\t\tif bufIsBig(bufnr) then\r\n\t\t\t\tclient.server_capabilities.semanticTokensProvider = nil\r\n\t\t\tend\r\n\t\tend\r\n\t\t-- Keymaps etc...\r\n\t}\r\nend\r\n```",
            "created_at": "2023-05-19T22:42:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/23026#issuecomment-1555346558",
            "id": 1555346558,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23026",
            "node_id": "IC_kwDOAPphoM5ctLR-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1555346558/reactions"
            },
            "updated_at": "2023-05-20T07:41:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1555346558",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10998835?v=4",
                "events_url": "https://api.github.com/users/doronbehar/events{/privacy}",
                "followers_url": "https://api.github.com/users/doronbehar/followers",
                "following_url": "https://api.github.com/users/doronbehar/following{/other_user}",
                "gists_url": "https://api.github.com/users/doronbehar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/doronbehar",
                "id": 10998835,
                "login": "doronbehar",
                "node_id": "MDQ6VXNlcjEwOTk4ODM1",
                "organizations_url": "https://api.github.com/users/doronbehar/orgs",
                "received_events_url": "https://api.github.com/users/doronbehar/received_events",
                "repos_url": "https://api.github.com/users/doronbehar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/doronbehar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/doronbehar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/doronbehar",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "This issue is for supporting `textDocument/semanticTokens/range`, but the underlying performance/lagginess caused by large responses to the full request should be fixed in HEAD (and the future 0.9.1 bugfix release). Please try that to see if the performance/lagginess has been resolved. You shouldn't need to disable semantic tokens for large files any longer.\r\n\r\nRef #23375 and #23484",
            "created_at": "2023-05-19T22:47:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/23026#issuecomment-1555348945",
            "id": 1555348945,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23026",
            "node_id": "IC_kwDOAPphoM5ctL3R",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1555348945/reactions"
            },
            "updated_at": "2023-05-20T07:41:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1555348945",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/394891?v=4",
                "events_url": "https://api.github.com/users/jdrouhard/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdrouhard/followers",
                "following_url": "https://api.github.com/users/jdrouhard/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdrouhard/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdrouhard",
                "id": 394891,
                "login": "jdrouhard",
                "node_id": "MDQ6VXNlcjM5NDg5MQ==",
                "organizations_url": "https://api.github.com/users/jdrouhard/orgs",
                "received_events_url": "https://api.github.com/users/jdrouhard/received_events",
                "repos_url": "https://api.github.com/users/jdrouhard/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdrouhard/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdrouhard/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdrouhard",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Yes it is somewhat better, thanks for the links :pray:.",
            "created_at": "2023-05-19T23:14:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/23026#issuecomment-1555364416",
            "id": 1555364416,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23026",
            "node_id": "IC_kwDOAPphoM5ctPpA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1555364416/reactions"
            },
            "updated_at": "2023-05-20T07:41:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1555364416",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10998835?v=4",
                "events_url": "https://api.github.com/users/doronbehar/events{/privacy}",
                "followers_url": "https://api.github.com/users/doronbehar/followers",
                "following_url": "https://api.github.com/users/doronbehar/following{/other_user}",
                "gists_url": "https://api.github.com/users/doronbehar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/doronbehar",
                "id": 10998835,
                "login": "doronbehar",
                "node_id": "MDQ6VXNlcjEwOTk4ODM1",
                "organizations_url": "https://api.github.com/users/doronbehar/orgs",
                "received_events_url": "https://api.github.com/users/doronbehar/received_events",
                "repos_url": "https://api.github.com/users/doronbehar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/doronbehar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/doronbehar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/doronbehar",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I think this issue is still relevant as some LSP will not have any support for `semanticTokens/full` request and only support the `range` request due to performance issues from the server itself. An example of this is the new C# Roslyn server and this is what they [state](https://github.com/dotnet/roslyn/blob/cb3137e1e5a79c34c5ad99d9532f164893b0a3f8/src/Features/LanguageServer/Protocol/DefaultCapabilitiesProvider.cs#L88):\r\n\r\n>  // Using only range handling has shown to be more performant than using a combination of full/edits/range\r\n>             // handling, especially for larger files. With range handling, we only need to compute tokens for whatever\r\n>             // is in view, while with full/edits handling we need to compute tokens for the entire file and then\r\n>             // potentially run a diff between the old and new tokens.",
            "created_at": "2023-10-24T04:43:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/23026#issuecomment-1776530606",
            "id": 1776530606,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23026",
            "node_id": "IC_kwDOAPphoM5p47Su",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1776530606/reactions"
            },
            "updated_at": "2023-10-25T09:50:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1776530606",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/36561860?v=4",
                "events_url": "https://api.github.com/users/AnhQuanTrl/events{/privacy}",
                "followers_url": "https://api.github.com/users/AnhQuanTrl/followers",
                "following_url": "https://api.github.com/users/AnhQuanTrl/following{/other_user}",
                "gists_url": "https://api.github.com/users/AnhQuanTrl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/AnhQuanTrl",
                "id": 36561860,
                "login": "AnhQuanTrl",
                "node_id": "MDQ6VXNlcjM2NTYxODYw",
                "organizations_url": "https://api.github.com/users/AnhQuanTrl/orgs",
                "received_events_url": "https://api.github.com/users/AnhQuanTrl/received_events",
                "repos_url": "https://api.github.com/users/AnhQuanTrl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/AnhQuanTrl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/AnhQuanTrl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/AnhQuanTrl",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Would love to see this implemented in Neovim. I'm not having performance issues but errors.\r\n\r\nThe Go lsp server returns errors when there are more than 100k tokens. https://github.com/golang/tools/blob/master/gopls/internal/golang/semtok.go#L41\r\n\r\nIt's hardcoded in the lsp server, not configurable. This leads to no semantic highlighting showing up on a medium-sized file of ~3.5k lines in my case. Splitting that file would lead to some painful refactoring but I might just do it because I don't use TreeSitter and no highlighting is really hard to work with.\r\n\r\n```\r\n[DEBUG][2024-08-13 19:13:27] .../vim/lsp/rpc.lua:286\t\"rpc.send\"\t{  id = 2608,  jsonrpc = \"2.0\",  method = \"textDocument/semanticTokens/full\",  params = {    textDocument = {      uri = \"file:///redacted_file.go\"    }  }}\r\n\r\n[DEBUG][2024-08-13 19:13:27] .../vim/lsp/rpc.lua:408\t\"rpc.receive\"\t{  error = {    code = 0,    message = \"semantic tokens: range /redacted_file.go too large (160253 > 100000)\"  },  id = 2608,  jsonrpc = \"2.0\"}\r\n```\r\n\r\nUsing ranges in neovim would help solve this issue. Gopls (and hopefully other LSP servers) already supports ranges \r\nhttps://github.com/golang/tools/blob/master/gopls/internal/server/semantic.go",
            "created_at": "2024-08-13T23:46:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/23026#issuecomment-2287401140",
            "id": 2287401140,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23026",
            "node_id": "IC_kwDOAPphoM6IVvi0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2287401140/reactions"
            },
            "updated_at": "2024-08-13T23:46:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2287401140",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/23560940?v=4",
                "events_url": "https://api.github.com/users/brissonwilliam/events{/privacy}",
                "followers_url": "https://api.github.com/users/brissonwilliam/followers",
                "following_url": "https://api.github.com/users/brissonwilliam/following{/other_user}",
                "gists_url": "https://api.github.com/users/brissonwilliam/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brissonwilliam",
                "id": 23560940,
                "login": "brissonwilliam",
                "node_id": "MDQ6VXNlcjIzNTYwOTQw",
                "organizations_url": "https://api.github.com/users/brissonwilliam/orgs",
                "received_events_url": "https://api.github.com/users/brissonwilliam/received_events",
                "repos_url": "https://api.github.com/users/brissonwilliam/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brissonwilliam/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brissonwilliam/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brissonwilliam",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23026/comments",
    "created_at": "2023-04-11T16:09:44Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23026/events",
    "html_url": "https://github.com/neovim/neovim/issues/23026",
    "id": 1662827916,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1786207367,
            "name": "highlight",
            "node_id": "MDU6TGFiZWwxNzg2MjA3MzY3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/highlight"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23026/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5jHL2M",
    "number": 23026,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 42,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 42,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23026/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23026/timeline",
    "title": "LSP: textDocument/semanticTokens/range",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:59:27Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23026",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/65551246?v=4",
        "events_url": "https://api.github.com/users/yioneko/events{/privacy}",
        "followers_url": "https://api.github.com/users/yioneko/followers",
        "following_url": "https://api.github.com/users/yioneko/following{/other_user}",
        "gists_url": "https://api.github.com/users/yioneko/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/yioneko",
        "id": 65551246,
        "login": "yioneko",
        "node_id": "MDQ6VXNlcjY1NTUxMjQ2",
        "organizations_url": "https://api.github.com/users/yioneko/orgs",
        "received_events_url": "https://api.github.com/users/yioneko/received_events",
        "repos_url": "https://api.github.com/users/yioneko/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/yioneko/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/yioneko/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/yioneko",
        "user_view_type": "public"
    }
}
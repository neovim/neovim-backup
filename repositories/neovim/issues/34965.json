{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nhttps://github.com/user-attachments/assets/93b1e6ba-5828-48bf-995c-5a4fd6e8510c\n\nThis only happens on sufficiently large clojure files. On small files I don't see the flickering. It happens more often when there is \"a lot\" of lua config, but the exact config doesn't seem to matter (probably this is related to how long it takes to refresh the display?). The reproduction below very rarely flickers because it has much less config, but it does still flicker (I changed it from CursorHold to CursorMoved to make it more likely).\n\n### Steps to reproduce\n\n```sh\nnvim --clean -u minimal.lua parse.clj\n# wait a few seconds for the lsp to attach; use :LspInfo to see progress or errors\n# move the cursor around a little bit, e.g. with hjkl.\n```\nwhere minimal.lua is:\n```lua\n  require('lspconfig')\n  vim.diagnostic.config({ virtual_text = true })\n  vim.lsp.enable('clojure_lsp')\n  vim.api.nvim_create_autocmd(\"LspAttach\", { callback = function(args)\n    local bufnr = args.buf\n    local client = vim.lsp.get_client_by_id(args.data.client_id)\n    if not client then return end\n    if client.server_capabilities.codeLensProvider then\n      vim.api.nvim_create_autocmd({ \"CursorMoved\" }, {\n        callback = function() vim.lsp.codelens.refresh { bufnr = bufnr } end,\n        buffer = bufnr,\n      })\n    end\n  end })\n```\n\n### Expected behavior\n\nNo flickering. I see that there was an intended fix in https://github.com/neovim/neovim/pull/34888, but I tried with the latest master branch and still saw flickering.\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-834+gfcec1610e7\n\n### Vim (not Nvim) behaves the same?\n\nn/a, no codelens in base nvim\n\n### Operating system/version\n\nPop!_OS 22.04 LTS\n\n### Terminal name/version\n\ntmux next-3.6 (local fork) running in kitty 0.39.1\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nbuilt from source to test",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "github won't let me upload .clj files, so i've renamed it to .txt. make sure to rename it back so the LSP starts.\n\n[parse.txt](https://github.com/user-attachments/files/21272905/parse.txt)",
            "created_at": "2025-07-17T01:40:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/34965#issuecomment-3082090745",
            "id": 3082090745,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34965",
            "node_id": "IC_kwDOAPphoM63tPj5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3082090745/reactions"
            },
            "updated_at": "2025-07-17T01:40:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3082090745",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4",
                "events_url": "https://api.github.com/users/jyn514/events{/privacy}",
                "followers_url": "https://api.github.com/users/jyn514/followers",
                "following_url": "https://api.github.com/users/jyn514/following{/other_user}",
                "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jyn514",
                "id": 23638587,
                "login": "jyn514",
                "node_id": "MDQ6VXNlcjIzNjM4NTg3",
                "organizations_url": "https://api.github.com/users/jyn514/orgs",
                "received_events_url": "https://api.github.com/users/jyn514/received_events",
                "repos_url": "https://api.github.com/users/jyn514/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jyn514",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I see that there was an intended fix in [#34888](https://github.com/neovim/neovim/pull/34888), but I tried with the latest master branch and still saw flickering.\n\nThanks for confirming that! https://github.com/neovim/neovim/issues/25242#issuecomment-1725230802 mentions https://github.com/neovim/neovim/pull/22115 (migration to decoration provider), guess that is the next step.",
            "created_at": "2025-07-17T01:57:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/34965#issuecomment-3082135957",
            "id": 3082135957,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34965",
            "node_id": "IC_kwDOAPphoM63tamV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3082135957/reactions"
            },
            "updated_at": "2025-07-17T01:57:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3082135957",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "In your screencast, the flashing codelens briefly displays the text \"Unresovled lens ...\", which is removed in #34888. Can you double-check your installation? Or is it that the screencast was taken from the old version and the new version's flashing behavior is different?",
            "created_at": "2025-07-26T09:04:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/34965#issuecomment-3121540643",
            "id": 3121540643,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34965",
            "node_id": "IC_kwDOAPphoM66Du4j",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3121540643/reactions"
            },
            "updated_at": "2025-07-26T09:04:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3121540643",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/19489738?v=4",
                "events_url": "https://api.github.com/users/tomtomjhj/events{/privacy}",
                "followers_url": "https://api.github.com/users/tomtomjhj/followers",
                "following_url": "https://api.github.com/users/tomtomjhj/following{/other_user}",
                "gists_url": "https://api.github.com/users/tomtomjhj/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tomtomjhj",
                "id": 19489738,
                "login": "tomtomjhj",
                "node_id": "MDQ6VXNlcjE5NDg5NzM4",
                "organizations_url": "https://api.github.com/users/tomtomjhj/orgs",
                "received_events_url": "https://api.github.com/users/tomtomjhj/received_events",
                "repos_url": "https://api.github.com/users/tomtomjhj/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tomtomjhj/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tomtomjhj/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tomtomjhj",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "side note:\n\n> probably this is related to how long it takes to refresh the display\n\n`CursorHold` uses `'updatetime'` option for timeout. The default value is 4000ms and many pre-built configs set this value to much smaller value.",
            "created_at": "2025-07-26T09:07:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/34965#issuecomment-3121547029",
            "id": 3121547029,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34965",
            "node_id": "IC_kwDOAPphoM66DwcV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3121547029/reactions"
            },
            "updated_at": "2025-07-26T09:07:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3121547029",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/19489738?v=4",
                "events_url": "https://api.github.com/users/tomtomjhj/events{/privacy}",
                "followers_url": "https://api.github.com/users/tomtomjhj/followers",
                "following_url": "https://api.github.com/users/tomtomjhj/following{/other_user}",
                "gists_url": "https://api.github.com/users/tomtomjhj/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tomtomjhj",
                "id": 19489738,
                "login": "tomtomjhj",
                "node_id": "MDQ6VXNlcjE5NDg5NzM4",
                "organizations_url": "https://api.github.com/users/tomtomjhj/orgs",
                "received_events_url": "https://api.github.com/users/tomtomjhj/received_events",
                "repos_url": "https://api.github.com/users/tomtomjhj/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tomtomjhj/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tomtomjhj/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tomtomjhj",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34965/comments",
    "created_at": "2025-07-17T01:38:35Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34965/events",
    "html_url": "https://github.com/neovim/neovim/issues/34965",
    "id": 3237800654,
    "labels": [
        {
            "color": "FEF2C0",
            "default": false,
            "description": "performance, latency, cpu/memory usage",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "waiting for reply from the author",
            "id": 248229439,
            "name": "needs:response",
            "node_id": "MDU6TGFiZWwyNDgyMjk0Mzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:response"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "redraw, layout, presentation",
            "id": 718084050,
            "name": "display",
            "node_id": "MDU6TGFiZWw3MTgwODQwNTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/display"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34965/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 733,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 633,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-07-28T09:46:47Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM7A_OrO",
    "number": 34965,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34965/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34965/timeline",
    "title": "`vim.lsp.codelens.refresh()` causes flickering",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-27T02:50:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34965",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4",
        "events_url": "https://api.github.com/users/jyn514/events{/privacy}",
        "followers_url": "https://api.github.com/users/jyn514/followers",
        "following_url": "https://api.github.com/users/jyn514/following{/other_user}",
        "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jyn514",
        "id": 23638587,
        "login": "jyn514",
        "node_id": "MDQ6VXNlcjIzNjM4NTg3",
        "organizations_url": "https://api.github.com/users/jyn514/orgs",
        "received_events_url": "https://api.github.com/users/jyn514/received_events",
        "repos_url": "https://api.github.com/users/jyn514/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jyn514",
        "user_view_type": "public"
    }
}
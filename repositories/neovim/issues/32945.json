{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nWith `'ruler'` enabled, neovim quits with exit code 0 after setting `'rulerformat'` option to an illegal value, including `%!` `%!Func()` `%!{->'lambda'}`, either `:set` inside the editor or passed through command line with `--cmd`\n\n### Steps to reproduce\n\n1. `nvim --clean --cmd ':set ruf=%!'`\n2. [Process exited 0]\n\n### Expected behavior\n\nShould fallback to vim behaviour, that is to throw an error:\n\n```\nE15: Invalid expression: \"\"\n```\n\nAt least should not immediately die\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.0-dev-2028+g5440e59247 Build type: RelWithDebInfo LuaJIT 2.1.1741730670\n\n### Vim (not Nvim) behaves the same?\n\nno, 9.0 1-2136, 2142\n\n### Operating system/version\n\nmacOS 15.1\n\n### Terminal name/version\n\nkitty 0.38.0\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nbuild from repo",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "``nvim: neovim/src/nvim/grid.c:373: void grid_line_start(ScreenGrid *, int): Assertion `grid_line_grid == NULL' failed.``\n\nBacktrace:\n\n```\n#0  0x00007ffff7cf9b54 in __pthread_kill_implementation () from target:/lib64/libc.so.6\n#1  0x00007ffff7ca0f9e in raise () from target:/lib64/libc.so.6\n#2  0x00007ffff7c88942 in abort () from target:/lib64/libc.so.6\n#3  0x00007ffff7c8885e in __assert_fail_base.cold () from target:/lib64/libc.so.6\n#4  0x00007ffff7c990c7 in __assert_fail () from target:/lib64/libc.so.6\n#5  0x0000000000e05342 in grid_line_start (grid=0x246a380 <msg_grid>, row=0) at neovim/src/nvim/grid.c:373\n#6  0x000000000119ad18 in msg_puts_display (str=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\", maxlen=27, hl_id=6, recurse=0) at neovim/src/nvim/message.c:2319\n#7  0x0000000001191c04 in msg_puts_len (str=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\", len=27, hl_id=6, hist=false) at neovim/src/nvim/message.c:2184\n#8  0x00000000011781e1 in msg_outtrans_len (msgstr=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\", len=-1, hl_id=6, hist=false) at neovim/src/nvim/message.c:1709\n#9  0x000000000117e570 in msg_outtrans (str=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\", hl_id=6, hist=false) at neovim/src/nvim/message.c:1625\n#10 0x0000000001176654 in msg_keep (s=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\", hl_id=6, keep=false, multiline=false) at neovim/src/nvim/message.c:385\n#11 0x000000000117c874 in emsg_multiline (s=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\", kind=0x1f8ce20 <str> \"emsg\", hl_id=6, multiline=false) at neovim/src/nvim/message.c:797\n#12 0x00000000011833de in emsg (s=0x32cae80 <semsgv[errbuf]> \"E15: Invalid expression: \\\"\\\"\") at neovim/src/nvim/message.c:808\n#13 0x00000000011836b3 in semsgv (fmt=0x1f77ae0 <e_invexpr2> \"E15: Invalid expression: \\\"%s\\\"\", ap=0x7ffff5c50da0) at neovim/src/nvim/message.c:863\n#14 0x00000000011835a5 in semsg (fmt=0x1f77ae0 <e_invexpr2> \"E15: Invalid expression: \\\"%s\\\"\") at neovim/src/nvim/message.c:826\n#15 0x0000000000987d70 in eval0 (arg=0x502000021472 \"\", rettv=0x7ffff5c50c20, eap=0x0, evalarg=0x7ffff5c50c40) at neovim/src/nvim/eval.c:2586\n#16 0x000000000098be7d in eval_to_string_eap (arg=0x502000021472 \"\", join_list=false, eap=0x0, use_simple_function=false) at neovim/src/nvim/eval.c:1044\n#17 0x000000000098c7c3 in eval_to_string (arg=0x502000021472 \"\", join_list=false, use_simple_function=false) at neovim/src/nvim/eval.c:1058\n#18 0x000000000098cade in eval_to_string_safe (arg=0x502000021472 \"\", use_sandbox=false, use_simple_function=false) at neovim/src/nvim/eval.c:1075\n#19 0x00000000017ced7c in build_stl_str_hl (wp=0x526000000100, out=0x7ffff6300050 \"\", outlen=4096, fmt=0x502000021470 \"%!\", opt_idx=kOptRulerformat, opt_scope=0, fillchar=32, maxwidth=18, hltab=0x7ffff6302150, hltab_len=0x0,\n    tabtab=0x7ffff6302170, stcp=0x0) at neovim/src/nvim/statusline.c:976\n#20 0x00000000017c88d6 in win_redr_custom (wp=0x526000000100, draw_winbar=false, draw_ruler=true) at neovim/src/nvim/statusline.c:406\n#21 0x00000000017c1a84 in win_redr_ruler (wp=0x526000000100) at neovim/src/nvim/statusline.c:509\n#22 0x00000000017c034b in win_redr_status (wp=0x526000000100) at neovim/src/nvim/statusline.c:159\n#23 0x00000000008fa676 in update_screen () at neovim/src/nvim/drawscreen.c:660\n#24 0x00000000012a9416 in normal_redraw (s=0x7ffff5e8e620) at neovim/src/nvim/normal.c:1368\n#25 0x00000000012a758e in normal_check (state=0x7ffff5e8e620) at neovim/src/nvim/normal.c:1466\n#26 0x00000000017b9b1d in state_enter (s=0x7ffff5e8e620) at neovim/src/nvim/state.c:40\n#27 0x00000000012393f3 in normal_enter (cmdwin=false, noexmode=false) at neovim/src/nvim/normal.c:523\n#28 0x0000000000fa4314 in main (argc=5, argv=0x7fffffffdf38) at neovim/src/nvim/main.c:651\n```\n\n(Seems it attempts to start building the grid line for the error message while it's in the middle of building the grid line for the default statusline)",
            "created_at": "2025-03-17T17:04:21Z",
            "html_url": "https://github.com/neovim/neovim/issues/32945#issuecomment-2730260296",
            "id": 2730260296,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/32945",
            "node_id": "IC_kwDOAPphoM6ivHdI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2730260296/reactions"
            },
            "updated_at": "2025-03-17T17:45:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2730260296",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6256228?v=4",
                "events_url": "https://api.github.com/users/seandewar/events{/privacy}",
                "followers_url": "https://api.github.com/users/seandewar/followers",
                "following_url": "https://api.github.com/users/seandewar/following{/other_user}",
                "gists_url": "https://api.github.com/users/seandewar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seandewar",
                "id": 6256228,
                "login": "seandewar",
                "node_id": "MDQ6VXNlcjYyNTYyMjg=",
                "organizations_url": "https://api.github.com/users/seandewar/orgs",
                "received_events_url": "https://api.github.com/users/seandewar/received_events",
                "repos_url": "https://api.github.com/users/seandewar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seandewar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seandewar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seandewar",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/32945/comments",
    "created_at": "2025-03-17T16:31:52Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/32945/events",
    "html_url": "https://github.com/neovim/neovim/issues/32945",
    "id": 2925720622,
    "labels": [
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains minimal reproducing steps",
            "id": 435851959,
            "name": "has:repro",
            "node_id": "MDU6TGFiZWw0MzU4NTE5NTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:repro"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/32945/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 0,
        "created_at": "2025-03-14T12:12:07Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
            "events_url": "https://api.github.com/users/clason/events{/privacy}",
            "followers_url": "https://api.github.com/users/clason/followers",
            "following_url": "https://api.github.com/users/clason/following{/other_user}",
            "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/clason",
            "id": 2361214,
            "login": "clason",
            "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
            "organizations_url": "https://api.github.com/users/clason/orgs",
            "received_events_url": "https://api.github.com/users/clason/received_events",
            "repos_url": "https://api.github.com/users/clason/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/clason",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": "2025-04-18T07:00:00Z",
        "html_url": "https://github.com/neovim/neovim/milestone/49",
        "id": 12520861,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/49/labels",
        "node_id": "MI_kwDOAPphoM4Avw2d",
        "number": 49,
        "open_issues": 15,
        "state": "open",
        "title": "0.11.1",
        "updated_at": "2025-03-17T17:08:57Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/49"
    },
    "node_id": "I_kwDOAPphoM6uYvQu",
    "number": 32945,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/32945/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/32945/timeline",
    "title": "Neovim immediately exits upon setting `'rulerformat'` to illegal argument",
    "updated_at": "2025-03-17T17:45:46Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/32945",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/96031125?v=4",
        "events_url": "https://api.github.com/users/Futarimiti/events{/privacy}",
        "followers_url": "https://api.github.com/users/Futarimiti/followers",
        "following_url": "https://api.github.com/users/Futarimiti/following{/other_user}",
        "gists_url": "https://api.github.com/users/Futarimiti/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Futarimiti",
        "id": 96031125,
        "login": "Futarimiti",
        "node_id": "U_kgDOBblRlQ",
        "organizations_url": "https://api.github.com/users/Futarimiti/orgs",
        "received_events_url": "https://api.github.com/users/Futarimiti/received_events",
        "repos_url": "https://api.github.com/users/Futarimiti/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Futarimiti/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Futarimiti/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Futarimiti",
        "user_view_type": "public"
    }
}
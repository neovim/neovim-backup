{
    "active_lock_reason": "resolved",
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nThis happens every edit in a file that has a language for which I have LSP enabled (lua, python, scala, typescript/javascript).\r\n\r\n```\r\nError executing vim.schedule lua callback: vim/shared.lua:0: after the second argument: expected table, got nil\r\nstack traceback:\r\n        [C]: in function 'error'\r\n        vim/shared.lua: in function 'validate'\r\n        vim/shared.lua: in function 'tbl_deep_extend'\r\n        ...w/Cellar/neovim/0.8.3/share/nvim/runtime/lua/vim/lsp.lua:2252: in function 'handler'\r\n        ...w/Cellar/neovim/0.8.3/share/nvim/runtime/lua/vim/lsp.lua:1049: in function ''\r\n        vim/_editor.lua: in function <vim/_editor.lua:0>\r\nPress ENTER or type command to continue\r\n```\r\n\r\nThis started showing up about a week ago. Upgrading to HEAD didn't resolve this either. \r\n\r\n\r\n### Steps to reproduce\r\n\r\n * open a file with LSP enabled\r\n * try to edit\r\n\r\n### Expected behavior\r\n\r\nExpected behavior is that the editor doesn't throw an error every edit. \r\n\r\nNote that disabling LSP via `:LspStop` makes the error go away.\r\n\r\n### Neovim version (nvim -v)\r\n\r\n0.8.3\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno\r\n\r\n### Operating system/version\r\n\r\nmacOS 12.6.2\r\n\r\n### Terminal name/version\r\n\r\nAlacritty 0.11\r\n\r\n### $TERM environment variable\r\n\r\nscreen-256color\r\n\r\n### Installation\r\n\r\nhomebrew",
    "closed_at": "2023-02-10T05:04:30Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/46123?v=4",
        "events_url": "https://api.github.com/users/vpetro/events{/privacy}",
        "followers_url": "https://api.github.com/users/vpetro/followers",
        "following_url": "https://api.github.com/users/vpetro/following{/other_user}",
        "gists_url": "https://api.github.com/users/vpetro/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vpetro",
        "id": 46123,
        "login": "vpetro",
        "node_id": "MDQ6VXNlcjQ2MTIz",
        "organizations_url": "https://api.github.com/users/vpetro/orgs",
        "received_events_url": "https://api.github.com/users/vpetro/received_events",
        "repos_url": "https://api.github.com/users/vpetro/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vpetro/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vpetro/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vpetro",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Can't help you without a minimal config (and even then I strongly suspect that this is a plugin problem).",
            "created_at": "2023-02-09T23:10:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/22197#issuecomment-1424962355",
            "id": 1424962355,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22197",
            "node_id": "IC_kwDOAPphoM5U7zMz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1424962355/reactions"
            },
            "updated_at": "2023-02-09T23:10:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1424962355",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "It turned out to be the LSP config for a typescript server. I have the following code in a module:\r\n\r\n```lua\r\nM = {}\r\n\r\n\r\nM.diagnostic_config = { virtual_text = false, signs = true, update_in_insert = false, underline = true }\r\n\r\nfunction M.setup_diagnostics()\r\n  vim.lsp.handlers[\"textDocument/publishDiagnostics\"] = vim.lsp.with(\r\n      vim.lsp.diagnostic.on_publish_diagnostics, M.diagnostic_config\r\n    )\r\nend\r\n\r\nreturn M\r\n\r\n```\r\n\r\nand then i called it like this in the my `js.lua` file\r\n\r\n```lua\r\nlocal lh = require(\"vpetro.lsp_helper\")\r\n\r\nlocal capabilities = vim.lsp.protocol.make_client_capabilities()\r\ncapabilities = require('cmp_nvim_lsp').default_capabilities(capabilities)\r\n\r\nrequire'lspconfig'.tsserver.setup{ capabilities = capabilities }\r\n\r\nlh.setup_keymaps()\r\nls.setup_diagnostics()\r\n```\r\n\r\nI can't quite see this started not working all of a sudden. But changing the `js.lua` file to have this config:\r\n\r\n```lua\r\nlocal lh = require(\"vpetro.lsp_helper\")\r\n\r\nlocal capabilities = vim.lsp.protocol.make_client_capabilities()\r\ncapabilities = require('cmp_nvim_lsp').default_capabilities(capabilities)\r\n\r\nrequire'lspconfig'.tsserver.setup{\r\n  capabilities = capabilities,\r\n  handlers = {\r\n    [\"textDocument/publishDiagnostics\"] = vim.lsp.with(\r\n        vim.lsp.diagnostic.on_publish_diagnostics,\r\n        { virtual_text = false, signs = true, update_in_insert = false, underline = true}\r\n    ),\r\n  }\r\n}\r\nlh.setup_keymaps()\r\n```\r\n\r\nmade the errors go away. The funny thing is that the previous version has been months. I guess, I'll go through the rest of my LSP configs and change to passing the handler into the config rather than setting it up from the outside.\r\n\r\nThanks for the nudge to look at the plugin/config code! :)\r\n",
            "created_at": "2023-02-10T05:04:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/22197#issuecomment-1425178722",
            "id": 1425178722,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22197",
            "node_id": "IC_kwDOAPphoM5U8oBi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1425178722/reactions"
            },
            "updated_at": "2023-02-10T05:04:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1425178722",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/46123?v=4",
                "events_url": "https://api.github.com/users/vpetro/events{/privacy}",
                "followers_url": "https://api.github.com/users/vpetro/followers",
                "following_url": "https://api.github.com/users/vpetro/following{/other_user}",
                "gists_url": "https://api.github.com/users/vpetro/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vpetro",
                "id": 46123,
                "login": "vpetro",
                "node_id": "MDQ6VXNlcjQ2MTIz",
                "organizations_url": "https://api.github.com/users/vpetro/orgs",
                "received_events_url": "https://api.github.com/users/vpetro/received_events",
                "repos_url": "https://api.github.com/users/vpetro/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vpetro/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vpetro/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vpetro",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22197/comments",
    "created_at": "2023-02-09T21:57:49Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22197/events",
    "html_url": "https://github.com/neovim/neovim/issues/22197",
    "id": 1578674324,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22197/labels{/name}",
    "locked": true,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5eGKiU",
    "number": 22197,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22197/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22197/timeline",
    "title": "Error executing vim.schedule lua callback: vim/shared.lua:0",
    "type": null,
    "updated_at": "2025-11-03T15:26:15Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22197",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/46123?v=4",
        "events_url": "https://api.github.com/users/vpetro/events{/privacy}",
        "followers_url": "https://api.github.com/users/vpetro/followers",
        "following_url": "https://api.github.com/users/vpetro/following{/other_user}",
        "gists_url": "https://api.github.com/users/vpetro/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vpetro",
        "id": 46123,
        "login": "vpetro",
        "node_id": "MDQ6VXNlcjQ2MTIz",
        "organizations_url": "https://api.github.com/users/vpetro/orgs",
        "received_events_url": "https://api.github.com/users/vpetro/received_events",
        "repos_url": "https://api.github.com/users/vpetro/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vpetro/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vpetro/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vpetro",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nIf the `selection` option in set to `exclusive`, moving with 'e' while in visual mode when the cursor is located _on_ the last character of a `word`, that word is skipped, even though the cursor should move to one past the end of that word.\r\n\r\n\r\nWith the cursor positioned below `#` , repeatedly pressing 'e' in _normal mode_ moves the cursor to where the '^' and 'v' are pointing, and the same happens in visual mode with `set selection=inclusive` or `old`:\r\n\r\n1)\r\n```\r\n# v v\r\n a(b) c\r\n ^ ^  ^\r\n\r\n # v  v\r\n a(b) c\r\n  ^ ^  \r\n```\r\nWith `set selection=exclusive`,  in visual mode the cursor is displayed as I-beam (pipe symbol in the example), and the character at its position is not included in the selection (when the cursor is past the start of the selection), so pressing 'e' repeatedly should move the cursor the same way as with `selection` set to `inclusive` but one character to the left, like this:\r\n\r\n2)\r\n```\r\n|  v v\r\n a(b) c\r\n  ^ ^  ^\r\n  \r\n | v v\r\n a(b) c\r\n  ^ ^  ^\r\n```\r\n\r\n(Note that when the cursor starts at 'a', 'e' can be pressed five times before moving to the next line, unlike in example (1) because the end of the word 'a' is already selected when starting visual mode in that example).\r\n\r\n\r\nBut current behavior of both vim and neovim is this:\r\n\r\n3)\r\n```\r\n¦   v\r\n a(b) c\r\n  ^    ^\r\n ¦   v\r\n a(b) c\r\n   ^   ^\r\n```\r\n\r\nIn both examples, some `word` ends are skipped, as the cursor is located at their last character, even though the actual selection is one character shorter, and the ends of these words are not yet included in selection.\r\n\r\nMoreover, using 'e' with `count`, like '2e' or '3e', works differently from pressing 'e' two or three times, and almost works correctly (the starting 'last character' is still skipped):\r\n\r\n4)\r\n```\r\n¦   v ee\r\n a(b) c\r\n   ^ 2e\r\n\r\n  2e 4e\r\n¦  v v\r\n a(b) c\r\n  ^ ^  ^\r\n  e 3e 5e\r\n\r\n   2e  4e\r\n ¦  v  v\r\n a(b) c\r\n   ^ ^\r\n   e 3e\r\n```\r\n\r\n\r\nWhile testing all of this, I came up with this mapping that works correctly for the example at the beginning:\r\n\r\n```\r\nfunction! End()\r\n    let saved = &selection\r\n    set selection=inclusive\r\n    silent! normal! hel\r\n    let &selection = saved\r\n    echoerr 'fix my cursor'\r\nendfunction\r\n\r\nnoremap r <cmd>call End()<cr>\r\n```\r\n\r\nWhat is odd to me is that:\r\n1. `selection` needs to be set `inclusive` as `normal! e` uses the incorrect 'e' behavior from visual mode and not normal mode (`:h :normal` says that it \"Execute _Normal mode_ commands\"), but this is probably intended behavior.\r\n2. Having `echoerr 'anything'` is also important as running this function changes how the cursor looks (from I-beam back to Block), even though the behavior stays the same and the cursor is still not included in the selection; 'echoerroring' anything somehow fixes that.\r\n\r\nAlso, pressing 'ge' with `selection=exclusive` either does not select the last character from the word (if the cursor is after the start of the selection) or selects one char from a word (if the cursor is before the start of the selection), the same applies for gE.\r\n\r\nOther keys like 'b' and 'w' seem to work correctly and consistently.\r\n\r\n\r\n\n\n### Steps to reproduce\n\nnvim --clean\r\n:so [mapping.txt](https://github.com/neovim/neovim/files/13111195/mapping.txt)\r\n:e [examples.txt](https://github.com/neovim/neovim/files/13111196/examples.txt)\r\n\r\ntry the examples with `:set selection=inclusive` or `:set selection=exclusive`\r\n\n\n### Expected behavior\n\n1. 'e'  in visual mode skips a word end when `selection` option is set to `exclusive` and cursor is located at the last character of a `word` (which is excluded, so logically the cursor is not at the end of the word).\r\n2. 'gE' maybe should be adjusted to go to the right side of the last character instead of the left.\r\n3. Setting and restoring `selection` option in a function correctly restores the behavior but doesn't restore the cursor style, leaving it as `inclusive` 'block' even though it is not included in the selection.\r\n\n\n### Neovim version (nvim -v)\n\n0.9.4 commit d772f69  (latest as of 2023-10-24)\n\n### Vim (not Nvim) behaves the same?\n\nyes, 8.2.3995\n\n### Operating system/version\n\nneovim - Windows 10, vim - WSL Ubuntu 22.04.2 LTS\n\n### Terminal name/version\n\n?\n\n### $TERM environment variable\n\nxterm-256color linux\n\n### Installation\n\nnvim-win64.zip",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Did https://github.com/neovim/neovim/pull/31603 fix this?",
            "created_at": "2024-12-17T14:32:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/25764#issuecomment-2548620260",
            "id": 2548620260,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25764",
            "node_id": "IC_kwDOAPphoM6X6Nvk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2548620260/reactions"
            },
            "updated_at": "2024-12-17T14:32:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2548620260",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "No, the behavior is the same in the latest commit (`NVIM v0.11.0-dev-1372+g0dd933265f`)",
            "created_at": "2024-12-17T17:21:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/25764#issuecomment-2549096485",
            "id": 2549096485,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25764",
            "node_id": "IC_kwDOAPphoM6X8CAl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2549096485/reactions"
            },
            "updated_at": "2024-12-17T17:21:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2549096485",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/65824523?v=4",
                "events_url": "https://api.github.com/users/vanaigr/events{/privacy}",
                "followers_url": "https://api.github.com/users/vanaigr/followers",
                "following_url": "https://api.github.com/users/vanaigr/following{/other_user}",
                "gists_url": "https://api.github.com/users/vanaigr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vanaigr",
                "id": 65824523,
                "login": "vanaigr",
                "node_id": "MDQ6VXNlcjY1ODI0NTIz",
                "organizations_url": "https://api.github.com/users/vanaigr/orgs",
                "received_events_url": "https://api.github.com/users/vanaigr/received_events",
                "repos_url": "https://api.github.com/users/vanaigr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vanaigr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vanaigr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vanaigr",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/25764/comments",
    "created_at": "2023-10-24T06:25:55Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/25764/events",
    "html_url": "https://github.com/neovim/neovim/issues/25764",
    "id": 1958597414,
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "upstream issue that must be fixed in Vim first",
            "id": 2639399975,
            "name": "needs:vim-patch",
            "node_id": "MDU6TGFiZWwyNjM5Mzk5OTc1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:vim-patch"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/25764/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM50vdMm",
    "number": 25764,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/25764/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/25764/timeline",
    "title": "e in visual mode with selection exclusive skips ends of some words, cursor style is not updated when option is changed",
    "updated_at": "2025-01-19T11:45:36Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/25764",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/65824523?v=4",
        "events_url": "https://api.github.com/users/vanaigr/events{/privacy}",
        "followers_url": "https://api.github.com/users/vanaigr/followers",
        "following_url": "https://api.github.com/users/vanaigr/following{/other_user}",
        "gists_url": "https://api.github.com/users/vanaigr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vanaigr",
        "id": 65824523,
        "login": "vanaigr",
        "node_id": "MDQ6VXNlcjY1ODI0NTIz",
        "organizations_url": "https://api.github.com/users/vanaigr/orgs",
        "received_events_url": "https://api.github.com/users/vanaigr/received_events",
        "repos_url": "https://api.github.com/users/vanaigr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vanaigr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vanaigr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vanaigr",
        "user_view_type": "public"
    }
}
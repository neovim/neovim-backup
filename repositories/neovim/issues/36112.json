{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\nThere are several path-related functions in `path.c` (and perhaps elsewhere) with overlapping purposes, each slightly different but their docs don't make it clear why or exactly how they differ. \n\nCleaning up these functions, eliminating/combining some, will fix some bugs, discover some bugs, and make it possible to improve path handling (e.g. https://github.com/neovim/neovim/issues/23006 , #32590, #28384 )\n\n### Expected behavior\n\n- At minimum, clarify the docs on the functions in `path.c`. \n- see if some functions can be eliminated.\n- rename some functions, preferring `path_` prefix\n\nExamples:\n\n- `path_full_compare` overlaps with `pathcmp`, `path_fnamecmp` \n- `fix_fname` calls `FullName_save`, why are they separate functions? At least they should be named similarly.\n    - `vim_FullName` => `path_fullname`\n    - `fix_fname` => `path_fix_fullname`",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "> * `fix_fname` calls `FullName_save`, why are they separate functions? At least they should be named similarly.\n\n```diff\ndiff --git a/src/buffer.c b/src/buffer.c\n-       if (fname != NameBuff)                  /* if not already expanded */\n-       {\n-               if (!isFullName(fname))\n-               {\n-                       (void)FullName(fname, NameBuff, MAXPATHL, FALSE);\n-                       fname = NameBuff;\n-               }\n+    /*\n+     * Force expanding the path always for Unix, because symbolic links may\n+     * mess up the full path name, even though it starts with a '/'.\n+     */\n+#ifdef UNIX\n+    return FullName_save(fname, TRUE);\n+#else\n+    if (!mch_isFullName(fname))\n+       return FullName_save(fname, FALSE);\n+\n+    fname = vim_strsave(fname);\n+\n```\n`fix_fname` was added in Vim [2.7](https://github.com/vim/vim-history/commit/8fd20c655d4b4c248c2066855e1f10fbb607d3c4#diff-52cefda5c25b2fc99f2f7c7e884779d2ab8ad67fffc81ab20a9f1e2da2705597R888), and `FullName_save` was added in [5.0](https://github.com/vim/vim-history/commit/cdb313b5e89dc78e96efbaf170a531664648f692#diff-52cefda5c25b2fc99f2f7c7e884779d2ab8ad67fffc81ab20a9f1e2da2705597L1539). The latter is a wrapper around `FullName/mch_FullName`, mainly to make it easier to reuse elsewhere (this is based on my reading of the code, I couldn't find further document).\nI also feel their logic could be simplified for Neovim, and I'm continuing to investigate this. BTW, I'm also interested in addressing path/slash issues on Windows. I've explored several issues and left some comments or PRs, such as https://github.com/neovim/neovim/issues/7930#issuecomment-3688589896, #37084, https://github.com/neovim/neovim/issues/27401#issuecomment-3691459050, https://github.com/neovim/neovim/issues/31606#issuecomment-3694483917, https://github.com/neovim/neovim/issues/33824#issuecomment-3694447302, and expect to make more progress over the next two months. :)",
            "created_at": "2025-12-30T16:23:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/36112#issuecomment-3699862700",
            "id": 3699862700,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36112",
            "node_id": "IC_kwDOAPphoM7ch2ys",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3699862700/reactions"
            },
            "updated_at": "2025-12-30T16:23:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3699862700",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8579651?v=4",
                "events_url": "https://api.github.com/users/ntdiary/events{/privacy}",
                "followers_url": "https://api.github.com/users/ntdiary/followers",
                "following_url": "https://api.github.com/users/ntdiary/following{/other_user}",
                "gists_url": "https://api.github.com/users/ntdiary/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ntdiary",
                "id": 8579651,
                "login": "ntdiary",
                "node_id": "MDQ6VXNlcjg1Nzk2NTE=",
                "organizations_url": "https://api.github.com/users/ntdiary/orgs",
                "received_events_url": "https://api.github.com/users/ntdiary/received_events",
                "repos_url": "https://api.github.com/users/ntdiary/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ntdiary/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ntdiary/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ntdiary",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Hi, @justinmk, how about first normalizing separator to `/` in the C code, then cleaning up the functions above, and then fixing bugs in the Lua code? Along the way, we should be able to fix most path issues on Windows.\nI recently investigated the path-handling boundaries and made some rough changes:\n* option/filename args at startup, e.g\n  `nvim -i .\\shada`, verify with `:set shadafile?`\n* environment variables, e.g\n  `:echo $VIMRUNTIME`\n* out params of os functions, e.g\n  `:pwd` (use `os_dirname`)\n* ex command args (`XFILE` flag), e.g\n  `:e c:\\tmp\\*.c`\n* setting option value (`kOptFlagExpand` flag), e.g\n  `:set path=.,~\\a,$HOME\\b`\n* shada file, e.g\n  * `:buffers` fname of buffer\n  * `:oldfiles` fname of filemark\n* swap file, e.g\n  `b0_fname`, `:recover c:\\demo.swp`\n* tag file, e.g\n  `:ts /^main`\n* path in error file (quickfix), e.g\n  `cg c:\\tmp\\error | copen`\n* params of vim APIs, e.g\n  `echo fnamemodify('c:\\tmp', ':p')`\n  `lua vim.api.nvim_buf_set_name(0, [[c:\\tmp\\bar.vim]])`\n\nA test video: https://youtu.be/_NK5l8eW8ks. If this looks reasonable to you, I'll polish the changes and update the tests, then open a first-stage PR in a week or two. :)",
            "created_at": "2026-01-31T03:26:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/36112#issuecomment-3827342132",
            "id": 3827342132,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36112",
            "node_id": "IC_kwDOAPphoM7kIJs0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3827342132/reactions"
            },
            "updated_at": "2026-01-31T03:27:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3827342132",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8579651?v=4",
                "events_url": "https://api.github.com/users/ntdiary/events{/privacy}",
                "followers_url": "https://api.github.com/users/ntdiary/followers",
                "following_url": "https://api.github.com/users/ntdiary/following{/other_user}",
                "gists_url": "https://api.github.com/users/ntdiary/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ntdiary",
                "id": 8579651,
                "login": "ntdiary",
                "node_id": "MDQ6VXNlcjg1Nzk2NTE=",
                "organizations_url": "https://api.github.com/users/ntdiary/orgs",
                "received_events_url": "https://api.github.com/users/ntdiary/received_events",
                "repos_url": "https://api.github.com/users/ntdiary/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ntdiary/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ntdiary/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ntdiary",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "That plan sounds good. Doing it in incremental stages has the highest chance of success. \n\nWhen storing (and even displaying) options and buffer names, I think we should always use `/` slashes, even on Windows. We might get some pushback, but I think it's the most sane approach. We only need `\\` slashes in a few specific circumstances, and we should just ignore those cases until we know exactly what they are.\n\nRelated: https://github.com/neovim/neovim/issues/23639#issuecomment-1548647316\n\n",
            "created_at": "2026-01-31T12:26:03Z",
            "html_url": "https://github.com/neovim/neovim/issues/36112#issuecomment-3828363243",
            "id": 3828363243,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36112",
            "node_id": "IC_kwDOAPphoM7kMC_r",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3828363243/reactions"
            },
            "updated_at": "2026-01-31T12:26:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3828363243",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/36112/comments",
    "created_at": "2025-10-10T00:59:37Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/36112/events",
    "html_url": "https://github.com/neovim/neovim/issues/36112",
    "id": 3501018126,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "changes that are not features or bugfixes",
            "id": 106949155,
            "name": "refactor",
            "node_id": "MDU6TGFiZWwxMDY5NDkxNTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/refactor"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "file metadata/attributes, filenames, path manipulation",
            "id": 3386070083,
            "name": "filesystem",
            "node_id": "LA_kwDOAPphoM7J01RD",
            "url": "https://api.github.com/repos/neovim/neovim/labels/filesystem"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/36112/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 774,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 637,
        "state": "open",
        "title": "backlog",
        "updated_at": "2026-02-03T00:50:29Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM7QrUwO",
    "number": 36112,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 1,
        "heart": 2,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 3,
        "url": "https://api.github.com/repos/neovim/neovim/issues/36112/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/36112/timeline",
    "title": "refactor: path.c cleanup",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-01-31T12:26:03Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/36112",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    }
}
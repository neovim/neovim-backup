{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhen visually selecting a text, the values of `start/end` for `line/col` are not accurate the first time you execute the selection, but when repeating the selection the values are correct.\n\n![Image](https://github.com/user-attachments/assets/3b95a967-0c94-409b-aedd-728c92a9841c)\n\nI use the following keymaps to print out the position values:\n\n```\nvim.keymap.set('v', '<leader>p', function()\n    -- Get positions\n    local start_line = vim.fn.line(\"'<\")\n    local start_col = vim.fn.col(\"'<\")\n    local end_line = vim.fn.line(\"'>\")\n    local end_col = vim.fn.col(\"'>\")\n    \n    -- Get visual mode type\n    local mode = vim.fn.mode()\n    local mode_name = mode == 'v' and 'charwise' or \n                      mode == 'V' and 'linewise' or \n                      mode == '' and 'blockwise' or 'unknown'\n    \n    -- Get the selected text (optional)\n    local lines = vim.api.nvim_buf_get_lines(0, start_line - 1, end_line, false)\n    local n_lines = #lines\n    local n_chars = 0\n    \n    if n_lines == 1 then\n        n_chars = end_col - start_col + 1\n    else\n        -- First line chars from start_col to end\n        n_chars = #lines[1] - start_col + 1\n        -- Middle lines (full lines)\n        for i = 2, n_lines - 1 do\n            n_chars = n_chars + #lines[i]\n        end\n        -- Last line chars from beginning to end_col\n        if n_lines > 1 then\n            n_chars = n_chars + end_col\n        end\n    end\n    \n    -- Create detailed output\n    local output = string.format(\n        \"Visual Selection (%s)\\n\" ..\n        \"├─ Start: Line %d, Col %d\\n\" ..\n        \"├─ End:   Line %d, Col %d\\n\" ..\n        \"├─ Lines: %d\\n\" ..\n        \"└─ Chars: ~%d\",\n        mode_name, start_line, start_col, end_line, end_col, n_lines, n_chars\n    )\n    \n    print(output)\nend, { desc = \"Print detailed visual selection info\" })\n```\nand \n\n```\nvim.keymap.set('v', '<leader>p', function()\n    -- Get the start and end positions using marks\n    local start_pos = vim.fn.getpos(\"'<\")\n    local end_pos = vim.fn.getpos(\"'>\")\n    \n    -- Extract line and column numbers\n    local start_line = start_pos[2]\n    local start_col = start_pos[3]\n    local end_line = end_pos[2]\n    local end_col = end_pos[3]\n    \n    -- Print the positions\n    print(string.format(\"Start: [%d, %d] | End: [%d, %d]\", \n        start_line, start_col, end_line, end_col))\nend, { desc = \"Print visual selection positions\" })\n```\n\n### Steps to reproduce\n\n1. go the beginning of any line\n2. go into visual mode and jump to the end of the second word\n3. run the keymap mentioned above, it will error out.\n4. clear selection\n5. repeat steps 1, 2 and 3, it will generate the correct output\n6. clear selection\n7. visually select any word using `viw`\n8. run the keymap above, it will generate wrong output.\n9. clear selection\n10. repeat steps 5, and 6 again, it will generate the correct output.\n\n### Expected behavior\n\nShould print out the correct positions on the first attempt of visually selecting a text.\n\n### Nvim version (nvim -v)\n\n0.11.4\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\nmacos 26.0.1\n\n### Terminal name/version\n\nghostty 1.2.2\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nhomebrew",
    "closed_at": "2025-10-25T02:15:14Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "'< and '> are the start and end of the last Visual selection, not the current one.",
            "created_at": "2025-10-25T02:15:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/36311#issuecomment-3445490607",
            "id": 3445490607,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36311",
            "node_id": "IC_kwDOAPphoM7NXgOv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3445490607/reactions"
            },
            "updated_at": "2025-10-25T02:15:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3445490607",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "To get the current visual selection in a mapping, try defining the mapping as a `expr=true` mapping and in the mapping handler do something like this to get the visual selection:\n\n```lua\nif vim.api.nvim_get_mode().mode:find('[vV\u0016]') then\n  vim.fn.feedkeys(vim.keycode('<Esc>'), 'nx')\n  args.line1 = vim.fn.line(\"'<\")\n  args.line2 = vim.fn.line(\"'>\")\nend\n```\n\nI do think we need to improve the ergonomics around this.",
            "created_at": "2025-10-25T12:52:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/36311#issuecomment-3446669860",
            "id": 3446669860,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36311",
            "node_id": "IC_kwDOAPphoM7NcAIk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3446669860/reactions"
            },
            "updated_at": "2025-10-25T12:52:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3446669860",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I am probably overcomplicating it, but [I use `.` and `v` to get the two edges of the current visual selection](https://stackoverflow.com/a/78607540).",
            "created_at": "2025-10-25T13:28:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/36311#issuecomment-3446704792",
            "id": 3446704792,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36311",
            "node_id": "IC_kwDOAPphoM7NcIqY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3446704792/reactions"
            },
            "updated_at": "2025-10-25T13:28:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3446704792",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62958?v=4",
                "events_url": "https://api.github.com/users/telemachus/events{/privacy}",
                "followers_url": "https://api.github.com/users/telemachus/followers",
                "following_url": "https://api.github.com/users/telemachus/following{/other_user}",
                "gists_url": "https://api.github.com/users/telemachus/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/telemachus",
                "id": 62958,
                "login": "telemachus",
                "node_id": "MDQ6VXNlcjYyOTU4",
                "organizations_url": "https://api.github.com/users/telemachus/orgs",
                "received_events_url": "https://api.github.com/users/telemachus/received_events",
                "repos_url": "https://api.github.com/users/telemachus/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/telemachus/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/telemachus/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/telemachus",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Docs improvement:\n\n- https://github.com/neovim/neovim/pull/36322",
            "created_at": "2025-10-25T14:47:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/36311#issuecomment-3446798997",
            "id": 3446798997,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36311",
            "node_id": "IC_kwDOAPphoM7NcfqV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3446798997/reactions"
            },
            "updated_at": "2025-10-25T14:47:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3446798997",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I switched my logic to use `.` and `v`, and it works when going into visual mode using `v`, but when selecting the entire line using `V`, it doesn't work as intended, and the positions are missed up.\n\nThis is what I'm doing atm: \nhttps://github.com/YousefHadder/markdown-plus.nvim/blob/main/lua/markdown-plus/format/init.lua#L174-L226",
            "created_at": "2025-10-27T20:17:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/36311#issuecomment-3453137502",
            "id": 3453137502,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36311",
            "node_id": "IC_kwDOAPphoM7N0rJe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3453137502/reactions"
            },
            "updated_at": "2025-10-27T20:17:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3453137502",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13406547?v=4",
                "events_url": "https://api.github.com/users/YousefHadder/events{/privacy}",
                "followers_url": "https://api.github.com/users/YousefHadder/followers",
                "following_url": "https://api.github.com/users/YousefHadder/following{/other_user}",
                "gists_url": "https://api.github.com/users/YousefHadder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/YousefHadder",
                "id": 13406547,
                "login": "YousefHadder",
                "node_id": "MDQ6VXNlcjEzNDA2NTQ3",
                "organizations_url": "https://api.github.com/users/YousefHadder/orgs",
                "received_events_url": "https://api.github.com/users/YousefHadder/received_events",
                "repos_url": "https://api.github.com/users/YousefHadder/repos",
                "site_admin": true,
                "starred_url": "https://api.github.com/users/YousefHadder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/YousefHadder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/YousefHadder",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/36311/comments",
    "created_at": "2025-10-25T02:05:17Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/36311/events",
    "html_url": "https://github.com/neovim/neovim/issues/36311",
    "id": 3551517925,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as usage questions",
            "id": 77997478,
            "name": "closed:question",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3OA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:question"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/36311/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7Tr9zl",
    "number": 36311,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/36311/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/36311/timeline",
    "title": "Visual selection start/end positions generates wrong values",
    "type": null,
    "updated_at": "2025-10-27T20:17:39Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/36311",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/13406547?v=4",
        "events_url": "https://api.github.com/users/YousefHadder/events{/privacy}",
        "followers_url": "https://api.github.com/users/YousefHadder/followers",
        "following_url": "https://api.github.com/users/YousefHadder/following{/other_user}",
        "gists_url": "https://api.github.com/users/YousefHadder/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/YousefHadder",
        "id": 13406547,
        "login": "YousefHadder",
        "node_id": "MDQ6VXNlcjEzNDA2NTQ3",
        "organizations_url": "https://api.github.com/users/YousefHadder/orgs",
        "received_events_url": "https://api.github.com/users/YousefHadder/received_events",
        "repos_url": "https://api.github.com/users/YousefHadder/repos",
        "site_admin": true,
        "starred_url": "https://api.github.com/users/YousefHadder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/YousefHadder/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/YousefHadder",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!-- Before reporting: search existing issues and check the FAQ. -->\r\n\r\n- `nvim --version`: v0.5.0-68-gfe9d54f41\r\n- `vim -u DEFAULTS` (version: ) behaves differently?\r\n- Operating system/version: macos\r\n- Terminal name/version: kitty\r\n- `$TERM`:\r\n\r\n### Steps to reproduce using `nvim -u NORC`\r\n\r\n1. nvim -u NONE\r\n2. ~:map <silent><c-k> :call confirm('hello', \"&Yes\\n&No\", 0)<cr>~\r\n2. `:map <silent><c-k> :call confirm('hello', \"&Yes\\n&No\", 0)<cr>`\r\n3. send `<C-L>`\r\n4. send `<c-k>`, show as follow:\r\n![image](https://user-images.githubusercontent.com/19503791/68009377-c921d680-fcbc-11e9-918b-a831d23aa8f4.png)\r\n\r\n### Actual behaviour\r\n\r\n### Expected behaviour\r\nremove the Extra blank line\r\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I guess the `:map` in step 2 is just a typo. But what do you mean with send? Because by default the mappings `<c-l>` and `<c-k>` have no meaning to Vim.\r\n\r\nI can't reproduce it so far.\r\n\r\nI think kitty comes with an own terminfo file, so maybe try, just for testing, with `xterm-256colors` instead or use Terminal.app.",
            "created_at": "2019-11-01T13:27:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/11322#issuecomment-548787228",
            "id": 548787228,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11322",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU0ODc4NzIyOA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/548787228/reactions"
            },
            "updated_at": "2019-11-01T13:27:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/548787228",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/972014?v=4",
                "events_url": "https://api.github.com/users/mhinz/events{/privacy}",
                "followers_url": "https://api.github.com/users/mhinz/followers",
                "following_url": "https://api.github.com/users/mhinz/following{/other_user}",
                "gists_url": "https://api.github.com/users/mhinz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mhinz",
                "id": 972014,
                "login": "mhinz",
                "node_id": "MDQ6VXNlcjk3MjAxNA==",
                "organizations_url": "https://api.github.com/users/mhinz/orgs",
                "received_events_url": "https://api.github.com/users/mhinz/received_events",
                "repos_url": "https://api.github.com/users/mhinz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mhinz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mhinz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mhinz",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Sorry for typo. Update the Reproduce step. `<c-l>` used to clear cmdline.",
            "created_at": "2019-11-01T13:31:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/11322#issuecomment-548788625",
            "id": 548788625,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11322",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU0ODc4ODYyNQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/548788625/reactions"
            },
            "updated_at": "2019-11-01T13:33:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/548788625",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/19503791?v=4",
                "events_url": "https://api.github.com/users/zgpio/events{/privacy}",
                "followers_url": "https://api.github.com/users/zgpio/followers",
                "following_url": "https://api.github.com/users/zgpio/following{/other_user}",
                "gists_url": "https://api.github.com/users/zgpio/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zgpio",
                "id": 19503791,
                "login": "zgpio",
                "node_id": "MDQ6VXNlcjE5NTAzNzkx",
                "organizations_url": "https://api.github.com/users/zgpio/orgs",
                "received_events_url": "https://api.github.com/users/zgpio/received_events",
                "repos_url": "https://api.github.com/users/zgpio/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zgpio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zgpio/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zgpio",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ah, the `<c-l>` was meant for normal mode. Okay, I can reproduce it now.\r\n\r\nIt happens because of [this line](https://github.com/neovim/neovim/blob/471427d045f74fa9d2e47b2975ef178e719c2ae8/src/nvim/message.c#L3498).\r\n\r\n```diff\r\ndiff --git i/src/nvim/message.c w/src/nvim/message.c\r\nindex 03cbe8ec1..1a2427822 100644\r\n--- i/src/nvim/message.c\r\n+++ w/src/nvim/message.c\r\n@@ -3495,10 +3495,17 @@ static void copy_hotkeys_and_msg(const char_u *message, char_u *buttons,\r\n                                  int default_button_idx, const bool has_hotkey[],\r\n                                  char_u *hotkeys_ptr)\r\n {\r\n-  *confirm_msg = '\\n';\r\n-  STRCPY(confirm_msg + 1, message);\r\n+  char_u *msgp = NULL;\r\n\r\n-  char_u *msgp = confirm_msg + 1 + STRLEN(message);\r\n+  if (cmd_silent) {\r\n+    msg_clr_eos();\r\n+    STRCPY(confirm_msg, message);\r\n+    msgp = confirm_msg + STRLEN(message);\r\n+  } else {\r\n+    *confirm_msg = '\\n';\r\n+    STRCPY(confirm_msg + 1, message);\r\n+    msgp = confirm_msg + 1 + STRLEN(message);\r\n+  }\r\n\r\n   // Define first default hotkey. Keep the hotkey string NUL\r\n   // terminated to avoid reading past the end.\r\n```\r\n\r\nThe above patch is not the suggested solution (or even correct), but merely showing that the actual solution will probably have to take `cmd_silent` into account.\r\n\r\nBut since it happens in Vim as well, let ask them first. :) CC @chrisbra ",
            "created_at": "2019-11-01T18:51:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/11322#issuecomment-548908087",
            "id": 548908087,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11322",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU0ODkwODA4Nw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/548908087/reactions"
            },
            "updated_at": "2019-11-01T18:51:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/548908087",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/972014?v=4",
                "events_url": "https://api.github.com/users/mhinz/events{/privacy}",
                "followers_url": "https://api.github.com/users/mhinz/followers",
                "following_url": "https://api.github.com/users/mhinz/following{/other_user}",
                "gists_url": "https://api.github.com/users/mhinz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mhinz",
                "id": 972014,
                "login": "mhinz",
                "node_id": "MDQ6VXNlcjk3MjAxNA==",
                "organizations_url": "https://api.github.com/users/mhinz/orgs",
                "received_events_url": "https://api.github.com/users/mhinz/received_events",
                "repos_url": "https://api.github.com/users/mhinz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mhinz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mhinz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mhinz",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/11322/comments",
    "created_at": "2019-11-01T07:34:34Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/11322/events",
    "html_url": "https://github.com/neovim/neovim/issues/11322",
    "id": 515956718,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "UI messages, log messages, dialogs, progress, errors, warnings, feedback",
            "id": 5637083595,
            "name": "messages",
            "node_id": "LA_kwDOAPphoM8AAAABT_8Ryw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/messages"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/11322/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1MTU5NTY3MTg=",
    "number": 11322,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/11322/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/11322/timeline",
    "title": "Extra blank line when using confirm()",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-09-18T01:53:59Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/11322",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/19503791?v=4",
        "events_url": "https://api.github.com/users/zgpio/events{/privacy}",
        "followers_url": "https://api.github.com/users/zgpio/followers",
        "following_url": "https://api.github.com/users/zgpio/following{/other_user}",
        "gists_url": "https://api.github.com/users/zgpio/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zgpio",
        "id": 19503791,
        "login": "zgpio",
        "node_id": "MDQ6VXNlcjE5NTAzNzkx",
        "organizations_url": "https://api.github.com/users/zgpio/orgs",
        "received_events_url": "https://api.github.com/users/zgpio/received_events",
        "repos_url": "https://api.github.com/users/zgpio/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zgpio/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zgpio/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zgpio",
        "user_view_type": "public"
    }
}
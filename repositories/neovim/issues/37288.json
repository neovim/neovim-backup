{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nvim.lsp.inline_completion.enable(false) disables the entire inline completion capability,\nincluding its lifecycle, internal state, autocmds, and pending requests.\n\nThis is too coarse for UI integration scenarios where users only want to temporarily hide\nthe inline completion virtual text (“ghost text”) while keeping the capability active.\n\nA common setup is using Copilot both as a completion source (e.g. via cmp/Blink)\nand as an LSP inline completion provider. In this case, both systems may render\nvirtual text simultaneously, resulting in duplicated suggestions\n(popup menu + inline ghost text), which is visually distracting and redundant.\n\nCurrently, there is no way to hide only the inline completion rendering without\ndisabling the entire capability.\n\n### Expected behavior\n\nProvide an API to toggle rendering of inline completion virtual text independently\nfrom the inline completion capability itself.\n\nFor example, an API that allows users to temporarily hide and re-enable inline\ncompletion ghost text without affecting requests, state, or accept/select behavior.\n\nThis would allow inline completion to integrate cleanly with completion menus:\n\nWhen a completion menu opens, inline completion virtual text can be hidden\n\nWhen the menu closes, inline completion virtual text can be shown again\n\nSuch an API would address a UI-only concern without requiring heavy capability\nenable/disable cycles, making inline completion easier and safer to integrate\nwith other completion UIs.\n\nFor example, an API usage could look like:\n\n```lua\n-- Hide inline completion virtual text (rendering only)\nvim.lsp.inline_completion.display(false)\n\n-- Re-enable inline completion virtual text\nvim.lsp.inline_completion.display(true)\n```",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "It sounds like cmp/blink will rely on nvim's inline completion internal state when using Copilot as a completion source?\n\nI am skeptical of this usage because the inline completion internal state should be regarded as a private API that may introduce breaking changes. Ensuring the stability of such an API would make any potential future improvements difficult to implement.",
            "created_at": "2026-01-09T13:57:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/37288#issuecomment-3729015582",
            "id": 3729015582,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37288",
            "node_id": "IC_kwDOAPphoM7eREMe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3729015582/reactions"
            },
            "updated_at": "2026-01-09T13:57:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3729015582",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks for the feedback — let me clarify my use case and address the concern about relying on\ninline completion internal state.\n\n### About using Copilot via cmp/Blink\n\nIn my setup, Copilot is used as a completion source via `fang2hou/blink-copilot`, with\n`blink.cmp` configured as follows:\n\n```lua\n{\n  \"saghen/blink.cmp\",\n  dependencies = { \"fang2hou/blink-copilot\" },\n  opts = {\n    sources = {\n      default = { \"lsp\", \"path\", \"snippets\", \"buffer\", \"copilot\" },\n      providers = {\n        copilot = {\n          name = \"copilot\",\n          module = \"blink-copilot\",\n          async = true,\n        },\n      },\n    },\n  },\n}\n```\nThe blink-copilot plugin does not depend on Neovim's inline completion internal state.\nInstead, it detects the Copilot LSP client and issues its own\ntextDocument/inlineCompletion requests directly via the LSP client\n(see [detect_lsp_client](https://github.com/fang2hou/blink-copilot/blob/7ad8209b2f880a2840c94cdcd80ab4dc511d4f39/lua/blink-copilot/source.lua#L30) in the plugin source).\n\nIn other words, this setup relies only on the LSP protocol itself, not on\nvim.lsp.inline_completion internals.\n\n### Why inline completion is enabled at the same time\n\nInline completion is enabled so that when no completion menu is visible,\nusers can still benefit from inline (ghost text) suggestions.\n\nWhen a completion menu is visible, however, selecting suggestions via the menu\nprovides a much better interaction model. This is also a documented and encouraged\npattern in the Blink documentation [hide-copilot-on-suggestion](https://cmp.saghen.dev/recipes#hide-copilot-on-suggestion)\nTherefore, the desired behavior is:\n\nNo menu visible → inline completion ghost text is useful\n\nMenu visible → rely on the menu UI, hide inline ghost text\n\n\n### Why enable(false) is not suitable here\n\nToggling vim.lsp.inline_completion.enable(false) to achieve this behavior turns out\nto be problematic, because it disables the entire capability rather than just rendering.\n\nWhen trying to hide ghost text by toggling enable(false/true) on menu open/close,\nI would occasionally hit the following error:\n\nvim.schedule callback: .../runtime/lua/vim/lsp/inline_completion.lua:129: attempt to index a nil value\nstack traceback:\n  .../runtime/lua/vim/lsp/inline_completion.lua:129: in function 'handler'\n  .../runtime/lua/vim/lsp/inline_completion.lua:286: in function 'handler'\n  .../runtime/lua/vim/lsp/client.lua:736: in function ''\n  vim/_core/editor.lua: in function <vim/_core/editor.lua:0>\n\n\nMy understanding is that this can happen when an inline completion response arrives\nafter the capability/state has been torn down or reset (i.e. stale callbacks or\nin-flight requests), which makes capability toggling fragile for UI-only concerns.\n\n### Summary\n\nTo be clear, I am not proposing that other UIs rely on\nvim.lsp.inline_completion internal state.\n\nThe request is for a small, explicit API to control whether inline completion\nvirtual text is rendered, so that inline completion can coexist cleanly with\ncompletion menus without requiring heavy capability enable/disable cycles.",
            "created_at": "2026-01-10T02:19:51Z",
            "html_url": "https://github.com/neovim/neovim/issues/37288#issuecomment-3731539184",
            "id": 3731539184,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37288",
            "node_id": "IC_kwDOAPphoM7easTw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3731539184/reactions"
            },
            "updated_at": "2026-01-10T02:19:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3731539184",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62603356?v=4",
                "events_url": "https://api.github.com/users/qumn/events{/privacy}",
                "followers_url": "https://api.github.com/users/qumn/followers",
                "following_url": "https://api.github.com/users/qumn/following{/other_user}",
                "gists_url": "https://api.github.com/users/qumn/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/qumn",
                "id": 62603356,
                "login": "qumn",
                "node_id": "MDQ6VXNlcjYyNjAzMzU2",
                "organizations_url": "https://api.github.com/users/qumn/orgs",
                "received_events_url": "https://api.github.com/users/qumn/received_events",
                "repos_url": "https://api.github.com/users/qumn/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/qumn/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/qumn/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/qumn",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37288/comments",
    "created_at": "2026-01-07T12:03:53Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37288/events",
    "html_url": "https://github.com/neovim/neovim/issues/37288",
    "id": 3788488947,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "libnvim, Nvim RPC API",
            "id": 103819671,
            "name": "api",
            "node_id": "MDU6TGFiZWwxMDM4MTk2NzE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/api"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "needs a clear design proposal",
            "id": 124510010,
            "name": "needs:design",
            "node_id": "MDU6TGFiZWwxMjQ1MTAwMTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:design"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "built-in (omni)completion, wildmenu",
            "id": 3214348835,
            "name": "completion",
            "node_id": "MDU6TGFiZWwzMjE0MzQ4ODM1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/completion"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37288/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 301,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 361,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2026-01-10T07:05:19Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM7hz8Dz",
    "number": 37288,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37288/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37288/timeline",
    "title": "lsp: add API to toggle inline completion virtual text rendering",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-01-10T02:19:51Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37288",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/62603356?v=4",
        "events_url": "https://api.github.com/users/qumn/events{/privacy}",
        "followers_url": "https://api.github.com/users/qumn/followers",
        "following_url": "https://api.github.com/users/qumn/following{/other_user}",
        "gists_url": "https://api.github.com/users/qumn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/qumn",
        "id": 62603356,
        "login": "qumn",
        "node_id": "MDQ6VXNlcjYyNjAzMzU2",
        "organizations_url": "https://api.github.com/users/qumn/orgs",
        "received_events_url": "https://api.github.com/users/qumn/received_events",
        "repos_url": "https://api.github.com/users/qumn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/qumn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/qumn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/qumn",
        "user_view_type": "public"
    }
}
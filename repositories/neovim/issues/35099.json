{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nExtmarks already move the `end_col` correctly on test insertion when `end_col > col`\n\nHowever for the case of `col == end_col` this is by default not the case and we end up in a situation where col > end_col. I know this can be \"fixed\" by setting `end_right_gravity=true` but I would argue that even without this setting it should work. \n\n### Steps to reproduce\n\nUse the following minimal config file:\n```lua\nlocal ns = vim.api.nvim_create_namespace('test')\nlocal ext = vim.api.nvim_buf_set_extmark(0, ns, 0, 0, {\n    end_row = 0,\n    end_col = 0,\n})\n\nvim.keymap.set('n', '<C-e>', function()\n    print(vim.inspect(vim.api.nvim_buf_get_extmark_by_id(0, ns, ext1, { details = true })))\nend, {})\n```\n\n- start neovim with custom config\n- insert a few characters like \"abc\"\n- check extmark details via `<C-e>\n\n### Expected behavior\n\n`end_col` should have been moved as well:\n```\n{ 0, 3, { end_col = 3, ... }}\n```\n\nInstead we end up with an \"invalid\" state:\n```\n{ 0, 3, { end_col = 0, ... }}\n```\n\n### Nvim version (nvim -v)\n\nv0.12.0-dev-904+g628d569a59                                                                                      \n\n### Vim (not Nvim) behaves the same?\n\nNo\n\n### Operating system/version\n\nPop!_OS 22_04\n\n### Terminal name/version\n\nGNOME Terminal 3.44.0\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nbuild from repo",
    "closed_at": "2025-08-01T06:48:55Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
        "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
        "followers_url": "https://api.github.com/users/TheBlob42/followers",
        "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
        "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/TheBlob42",
        "id": 6849129,
        "login": "TheBlob42",
        "node_id": "MDQ6VXNlcjY4NDkxMjk=",
        "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
        "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
        "repos_url": "https://api.github.com/users/TheBlob42/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/TheBlob42",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> I know this can be \"fixed\" by setting end_right_gravity=true but I would argue that even without this setting it should work.\n\nIt's a tradeoff. The default gravity settings make sense if you highlight a fixed token or whatever and don't want the highlight to grow if you insert text either right before or after it. But sure, if you start with highlighting an empty range you \"obviously\" wanted the region to grow on insert because otherwise what was the point. \n\nHowever, as a low level, very generic API, it always uses the same default gravity settings regardless of other parameters. You are expected to know about the semantics of mark gravity and pick the preferred behavior explicitly. I am not sure if it is relevant either, but potentially we could let higher level API:s like `vim.hl.range()` to be \"smarter\" and pick defaults dynamically. ",
            "created_at": "2025-07-28T08:25:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/35099#issuecomment-3126104299",
            "id": 3126104299,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35099",
            "node_id": "IC_kwDOAPphoM66VJDr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3126104299/reactions"
            },
            "updated_at": "2025-07-28T08:25:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3126104299",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I found this issue when working on the snippets implementation where tabstops have an extmark attached to them. And even tabstops without a placeholder, which are basically just a cursor position, do have `col` and `end_col`. I thought this might be an issue, but am not sure if a safeguard can be implemented easily, so I reported it ðŸ™‚ \n\nYour argument about being a generic and low level API makes sense to me and I would be fine to leave it at that unless others also see a need for safeguarding here",
            "created_at": "2025-07-28T14:48:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/35099#issuecomment-3127587399",
            "id": 3127587399,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35099",
            "node_id": "IC_kwDOAPphoM66azJH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3127587399/reactions"
            },
            "updated_at": "2025-07-28T14:48:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3127587399",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
                "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheBlob42/followers",
                "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheBlob42",
                "id": 6849129,
                "login": "TheBlob42",
                "node_id": "MDQ6VXNlcjY4NDkxMjk=",
                "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
                "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
                "repos_url": "https://api.github.com/users/TheBlob42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheBlob42",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/35099/comments",
    "created_at": "2025-07-28T07:44:39Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/35099/events",
    "html_url": "https://github.com/neovim/neovim/issues/35099",
    "id": 3268573088,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "marks, extmarks, decorations, virtual text",
            "id": 1680119719,
            "name": "marks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/marks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/35099/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7C0neg",
    "number": 35099,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/35099/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/35099/timeline",
    "title": "extmarks: end_col should never be < col",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-08-01T06:48:55Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/35099",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6849129?v=4",
        "events_url": "https://api.github.com/users/TheBlob42/events{/privacy}",
        "followers_url": "https://api.github.com/users/TheBlob42/followers",
        "following_url": "https://api.github.com/users/TheBlob42/following{/other_user}",
        "gists_url": "https://api.github.com/users/TheBlob42/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/TheBlob42",
        "id": 6849129,
        "login": "TheBlob42",
        "node_id": "MDQ6VXNlcjY4NDkxMjk=",
        "organizations_url": "https://api.github.com/users/TheBlob42/orgs",
        "received_events_url": "https://api.github.com/users/TheBlob42/received_events",
        "repos_url": "https://api.github.com/users/TheBlob42/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/TheBlob42/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/TheBlob42/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/TheBlob42",
        "user_view_type": "public"
    }
}
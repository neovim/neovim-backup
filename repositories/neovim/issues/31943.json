{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nI have been encountering this issue sporadically, where I would start to type something and neovim\nwould simply freeze, taking 100% cpu and needing to be killed (as far as I remember, only on c++\nfiles). I finally managed to get MWE and a backtrace that at least may point in the right direction.\n\n### Steps to reproduce\n\nThis is the file.cpp:\n```cpp\nstruct OSQPInterface::OSQPInterfacePrivate                                                                                                                               \n{                                                                                                                                                                        \n  OSQPSettings settings;                                                                                                                                                 \n  _nb_param = static_cast<int>(q.size());                                                                                                                                \n  _nb_constraints = static_cast<int>(l.size());                                                                                                                          \n};\n```\n\nYes, it's not valid. It was a copy/paste I would then edit. But it shouldn't freeze the editor anyway.\n\nTo reproduce:\nnvim --clean file.cpp\n\nIt immediately freezes and attaching gdb I get this backtrace, mostly:\n\n```\n#0  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#1  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#2  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#3  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#4  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#5  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#6  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#7  0x00007fb67c20d29d in ts_node_child_with_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                \n#8  0x00007fb67c20dab5 in ts_node_child_containing_descendant () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24          \n#9  0x00007fb67c20dc7f in ts_node_parent () from /nix/store/0i6p6hq9qnsakjmg6i4bayn9msvk2ma7-tree-sitter-0.24.4/lib/libtree-sitter.so.0.24                               \n#10 0x000000000064664e in node_parent ()                                                                                                                                 \n#11 0x00007fb67c162a46 in ?? () from /nix/store/dgkv4jq364fip6jz7mzkdla949hlqbkr-luajit-2.1.1713773202-env/lib/libluajit-5.1.so.2                                        \n#12 0x00007fb67c1c50bd in lua_pcall () from /nix/store/dgkv4jq364fip6jz7mzkdla949hlqbkr-luajit-2.1.1713773202-env/lib/libluajit-5.1.so.2                                 \n#13 0x000000000063e901 in nlua_schedule_event ()                                                                                                                         \n#14 0x00000000007a5af8 in state_handle_k_event ()                                                                                                                        \n#15 0x00000000006c23f4 in nv_event.lto_priv ()                                                                                                                           \n#16 0x00000000006b079f in normal_execute.lto_priv ()                                                                                                                     \n#17 0x00000000007a5873 in state_enter ()                                                                                                                                 \n#18 0x00000000006afa84 in normal_enter ()                                                                                                                                \n#19 0x00000000004585c6 in main () \n```\n\nRunning some `next` with gdb I get to see some indications that there is a null value being returned on those `ts_node_child_with_descent` calls. Using `finish` it freezes on the ?? function in libluajit, that is, whatever that is, it has some sort of loop that is looping forever.\n\n### Expected behavior\n\nNo freezes.\n\n### Nvim version (nvim -v)\n\nv0.10.3\n\n### Vim (not Nvim) behaves the same?\n\nI don't have vim. Does it have tree-sitter?\n\n### Operating system/version\n\nFedora 41\n\n### Terminal name/version\n\nkitty 0.38.1\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nnix (nixpkgs-unstable)",
    "closed_at": "2025-01-10T09:04:09Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
        "events_url": "https://api.github.com/users/clason/events{/privacy}",
        "followers_url": "https://api.github.com/users/clason/followers",
        "following_url": "https://api.github.com/users/clason/following{/other_user}",
        "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/clason",
        "id": 2361214,
        "login": "clason",
        "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
        "organizations_url": "https://api.github.com/users/clason/orgs",
        "received_events_url": "https://api.github.com/users/clason/received_events",
        "repos_url": "https://api.github.com/users/clason/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/clason",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Sorry, wrong duplicate. Your tree-sitter version is wrong and contains a bug that leads to the observed hang. (0.10.3 is meant to build against 0.22.6; anything else is not supported. Latest tree-sitter version (where the bug is fixed) is 0.24.6.)",
            "created_at": "2025-01-10T09:05:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/31943#issuecomment-2582116465",
            "id": 2582116465,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31943",
            "node_id": "IC_kwDOAPphoM6Z5_hx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2582116465/reactions"
            },
            "updated_at": "2025-01-10T09:06:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2582116465",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "And it seems the bug was already reported on nixpkgs and a solution has already been merged, but is still being propagated through the channels. Thank you @clason.",
            "created_at": "2025-01-10T09:17:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/31943#issuecomment-2582143758",
            "id": 2582143758,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31943",
            "node_id": "IC_kwDOAPphoM6Z6GMO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2582143758/reactions"
            },
            "updated_at": "2025-01-10T09:17:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2582143758",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2191364?v=4",
                "events_url": "https://api.github.com/users/acristoffers/events{/privacy}",
                "followers_url": "https://api.github.com/users/acristoffers/followers",
                "following_url": "https://api.github.com/users/acristoffers/following{/other_user}",
                "gists_url": "https://api.github.com/users/acristoffers/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/acristoffers",
                "id": 2191364,
                "login": "acristoffers",
                "node_id": "MDQ6VXNlcjIxOTEzNjQ=",
                "organizations_url": "https://api.github.com/users/acristoffers/orgs",
                "received_events_url": "https://api.github.com/users/acristoffers/received_events",
                "repos_url": "https://api.github.com/users/acristoffers/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/acristoffers/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/acristoffers/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/acristoffers",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31943/comments",
    "created_at": "2025-01-10T09:01:46Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31943/events",
    "html_url": "https://github.com/neovim/neovim/issues/31943",
    "id": 2779642071,
    "labels": [
        {
            "color": "d4c5f9",
            "default": false,
            "description": "",
            "id": 4952459982,
            "name": "platform:nix",
            "node_id": "LA_kwDOAPphoM8AAAABJzCKzg",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:nix"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31943/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6lrfjX",
    "number": 31943,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31943/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "duplicate",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31943/timeline",
    "title": "bug: freezes on some cpp files",
    "updated_at": "2025-01-10T09:18:21Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31943",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2191364?v=4",
        "events_url": "https://api.github.com/users/acristoffers/events{/privacy}",
        "followers_url": "https://api.github.com/users/acristoffers/followers",
        "following_url": "https://api.github.com/users/acristoffers/following{/other_user}",
        "gists_url": "https://api.github.com/users/acristoffers/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/acristoffers",
        "id": 2191364,
        "login": "acristoffers",
        "node_id": "MDQ6VXNlcjIxOTEzNjQ=",
        "organizations_url": "https://api.github.com/users/acristoffers/orgs",
        "received_events_url": "https://api.github.com/users/acristoffers/received_events",
        "repos_url": "https://api.github.com/users/acristoffers/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/acristoffers/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/acristoffers/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/acristoffers",
        "user_view_type": "public"
    }
}
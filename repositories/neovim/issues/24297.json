{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nI tried with null-ls, and lsp formatters, and the behavior is that whenever calling vim.lsp.buf.format(), the cursor remains in position, which is what I would expect.\r\n\r\nHowever, when undoing the formatting changes, I would expect the same behavior, seeing the changes revert back on the exact same lines displayed in the window.\r\nBut instead, the cursor jumps to the top of the window, more specifically to the lowest line number where a change was undone.\r\n\r\nThis is annoying because it makes it difficult to undo/redo formatting a couple of times to view the changes happening in a specific area.\n\n### Steps to reproduce\n\nopen a file for which you have a formatter installed\r\nmake sure the file is not formatted in multiple areas\r\ncall vim.lsp.buf.format()\r\nundo\n\n### Expected behavior\n\nthe cursor and window position remains the same\n\n### Neovim version (nvim -v)\n\nNVIM v0.9.1 Build type: Release LuaJIT 2.1.0-beta3\n\n### Vim (not Nvim) behaves the same?\n\nn/a\n\n### Operating system/version\n\nLinux 6.4.1-artix1-1\n\n### Terminal name/version\n\nalacritty 0.12.2\n\n### $TERM environment variable\n\nalacritty\n\n### Installation\n\nartix repo",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> But instead, the cursor jumps to the top of the window, more specifically to the lowest line number where a change was undone.\r\n\r\nThis is just how undo works in vim. If other lsp formatters are behaving differently, maybe we can borrow their approach if it's not complicated.\r\n\r\nWe should also use `:keepmarks` to avoid setting `'[` and `']` to the start/end of the file. https://github.com/neovim/neovim/issues/8807\r\n\r\nRelated:\r\n\r\n- #22253\r\n- https://github.com/neovim/neovim/issues/21783",
            "created_at": "2023-07-08T17:23:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1627433026",
            "id": 1627433026,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5hAKhC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627433026/reactions"
            },
            "updated_at": "2023-07-08T17:23:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627433026",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "Let me know if there's any workarounds, something like a undo.stop_recording() and undo.continue_recording(), I like to trim trailing white spaces  on save, but doing so messes up my undo history",
            "created_at": "2023-07-09T10:01:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1627666212",
            "id": 1627666212,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5hBDck",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 5,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 5,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627666212/reactions"
            },
            "updated_at": "2023-07-24T21:12:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627666212",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26150581?v=4",
                "events_url": "https://api.github.com/users/duarm/events{/privacy}",
                "followers_url": "https://api.github.com/users/duarm/followers",
                "following_url": "https://api.github.com/users/duarm/following{/other_user}",
                "gists_url": "https://api.github.com/users/duarm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/duarm",
                "id": 26150581,
                "login": "duarm",
                "node_id": "MDQ6VXNlcjI2MTUwNTgx",
                "organizations_url": "https://api.github.com/users/duarm/orgs",
                "received_events_url": "https://api.github.com/users/duarm/received_events",
                "repos_url": "https://api.github.com/users/duarm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/duarm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/duarm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/duarm"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": ">This is just how undo works in vim. If other lsp formatters are behaving differently, maybe we can borrow their approach if it's not complicated.\r\n\r\n@justinmk it seems like not moving cursors at all after undoing such changes would make sense, though I see that at least current window cursor is moved intentionally and explicitly to the start of the first changed line in such cases:\r\n\r\nhttps://github.com/neovim/neovim/blob/aab06edc63c3dfbd99e0c803c6834bf771318c42/src/nvim/undo.c#L2312-L2327\r\n\r\nI tried simply commenting out this code and then cursor is not being moved after undo. This code is from the original vim, commenting it out didn't seem to break any old tests and I couldn't track down where this was introduced to understand why exactly it is there. A couple of current functional tests rely on this behavior though. And I believe simply removing it is not an option, so how could we approach this?\r\n\r\nIt could probably be solved by either introducing some flag telling that cursor should not be moved or writing invalid cursor position, which would indicate the same. And then use that from `nvim_buf_set_text`, which is used for lsp formatting. Though both of these solutions seem quite ugly. Are there any other solutions I might be missing?",
            "created_at": "2023-09-12T05:36:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715002533",
            "id": 1715002533,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mONyl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715002533/reactions"
            },
            "updated_at": "2023-09-12T05:36:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715002533",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3524621?v=4",
                "events_url": "https://api.github.com/users/faergeek/events{/privacy}",
                "followers_url": "https://api.github.com/users/faergeek/followers",
                "following_url": "https://api.github.com/users/faergeek/following{/other_user}",
                "gists_url": "https://api.github.com/users/faergeek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/faergeek",
                "id": 3524621,
                "login": "faergeek",
                "node_id": "MDQ6VXNlcjM1MjQ2MjE=",
                "organizations_url": "https://api.github.com/users/faergeek/orgs",
                "received_events_url": "https://api.github.com/users/faergeek/received_events",
                "repos_url": "https://api.github.com/users/faergeek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/faergeek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/faergeek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/faergeek"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> couldn't track down where this was introduced to understand why exactly it is there\r\n\r\nLikely matches POSIX vi.\r\n\r\n> And I believe simply removing it is not an option, so how could we approach this?\r\n\r\nIf it is unlikely that scripts depend on the behavior then we could just remove it, if the behavior is genuinely an ergonomics upgrade. But see https://github.com/neovim/neovim/issues/5989 for more discussion.\r\n\r\nUnless I'm mistaken, this is a duplicate of https://github.com/neovim/neovim/issues/5989 , so closing. @faergeek your code notes would be useful there :D ",
            "created_at": "2023-09-12T09:52:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715390154",
            "id": 1715390154,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mPsbK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715390154/reactions"
            },
            "updated_at": "2023-09-12T09:53:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715390154",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk I don't think this is actually a duplicate, because behavior mentioned here seems to be about lines only, not columns, at least from what I see in the code and from basic experiments and tests. But example provided in #5989 is about edits on a single line, which only involves movements over columns.",
            "created_at": "2023-09-12T10:02:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715405862",
            "id": 1715405862,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mPwQm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715405862/reactions"
            },
            "updated_at": "2023-09-12T10:02:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715405862",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3524621?v=4",
                "events_url": "https://api.github.com/users/faergeek/events{/privacy}",
                "followers_url": "https://api.github.com/users/faergeek/followers",
                "following_url": "https://api.github.com/users/faergeek/following{/other_user}",
                "gists_url": "https://api.github.com/users/faergeek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/faergeek",
                "id": 3524621,
                "login": "faergeek",
                "node_id": "MDQ6VXNlcjM1MjQ2MjE=",
                "organizations_url": "https://api.github.com/users/faergeek/orgs",
                "received_events_url": "https://api.github.com/users/faergeek/received_events",
                "repos_url": "https://api.github.com/users/faergeek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/faergeek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/faergeek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/faergeek"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I see https://github.com/neovim/neovim/issues/5989 as covering the general topic, the particular example it has is just an example. But we can keep this open.",
            "created_at": "2023-09-12T10:17:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715428564",
            "id": 1715428564,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mP1zU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715428564/reactions"
            },
            "updated_at": "2023-09-12T10:17:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715428564",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This was introduced before the existence of oldtests: https://github.com/vim/vim-history/commit/0206c5b14035929b9392a09985ab4b9fdef94003",
            "created_at": "2023-09-12T13:25:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715723528",
            "id": 1715723528,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mQ90I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715723528/reactions"
            },
            "updated_at": "2023-09-12T13:26:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715723528",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks, that has a useful hint: \r\n\r\n> Solution:   Try to move the cursor back to where it was or to the first line that actually changed.\r\n\r\nWhenever behavior is \"try to ...\" that means scripts can't depend on it, thus we can change it.",
            "created_at": "2023-09-12T13:32:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715734413",
            "id": 1715734413,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mRAeN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715734413/reactions"
            },
            "updated_at": "2023-09-12T13:32:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1715734413",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Let me know if there's any workarounds, something like a undo.stop_recording() and undo.continue_recording(), I like to trim trailing white spaces on save, but doing so messes up my undo history\r\n\r\n@duarm seems like `:undojoin` could help, though there's a catch, see https://github.com/sbdchd/neoformat/issues/386",
            "created_at": "2023-09-13T08:26:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1717174926",
            "id": 1717174926,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mWgKO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1717174926/reactions"
            },
            "updated_at": "2023-09-13T08:26:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1717174926",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3524621?v=4",
                "events_url": "https://api.github.com/users/faergeek/events{/privacy}",
                "followers_url": "https://api.github.com/users/faergeek/followers",
                "following_url": "https://api.github.com/users/faergeek/following{/other_user}",
                "gists_url": "https://api.github.com/users/faergeek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/faergeek",
                "id": 3524621,
                "login": "faergeek",
                "node_id": "MDQ6VXNlcjM1MjQ2MjE=",
                "organizations_url": "https://api.github.com/users/faergeek/orgs",
                "received_events_url": "https://api.github.com/users/faergeek/received_events",
                "repos_url": "https://api.github.com/users/faergeek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/faergeek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/faergeek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/faergeek"
            }
        },
        {
            "author_association": "MEMBER",
            "body": ">  seems like `:undojoin` could help, though there's a catch, see [sbdchd/neoformat#386](https://github.com/sbdchd/neoformat/issues/386)\r\n\r\nWhat about `:help i_CTRL-G_u` + `:help i_CTRL-G_U` ? Could those be used to fashion the desired undo positions?",
            "created_at": "2023-09-13T10:15:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1717347673",
            "id": 1717347673,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mXKVZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1717347673/reactions"
            },
            "updated_at": "2023-09-13T10:15:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1717347673",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> What about `:help i_CTRL-G_u` + `:help i_CTRL-G_U` ? Could those be used to fashion the desired undo positions?\r\n\r\nI don't see how those mappings would help in that cases. `:help i_CTRL-G_u` starts a new undo block, which seems to be the opposite of what was requested. And IIUC, `:help i_CTRL-G_U` allows to move cursor along the line without closing current undo block, which in theory could help if trimming is implemented by redefining mappings which move cursor up or down in insert mode to do trimming as well, but that seems complicated, so I doubt that's the case here.",
            "created_at": "2023-09-15T03:47:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1720449234",
            "id": 1720449234,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mi_jS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1720449234/reactions"
            },
            "updated_at": "2023-09-15T03:47:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1720449234",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3524621?v=4",
                "events_url": "https://api.github.com/users/faergeek/events{/privacy}",
                "followers_url": "https://api.github.com/users/faergeek/followers",
                "following_url": "https://api.github.com/users/faergeek/following{/other_user}",
                "gists_url": "https://api.github.com/users/faergeek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/faergeek",
                "id": 3524621,
                "login": "faergeek",
                "node_id": "MDQ6VXNlcjM1MjQ2MjE=",
                "organizations_url": "https://api.github.com/users/faergeek/orgs",
                "received_events_url": "https://api.github.com/users/faergeek/received_events",
                "repos_url": "https://api.github.com/users/faergeek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/faergeek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/faergeek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/faergeek"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "https://github.com/neovim/neovim/issues/24297#issuecomment-1715002533\r\n\r\n> it seems like not moving cursors at all after undoing such changes would make sense\r\n\r\nUpdate. Moving cursor by how line count above cursor changed after undo still makes sense, just without pulling it exactly to the lowest line number. I tried not moving it at all in this PR https://github.com/neovim/neovim/pull/25119. This behavior seems to be much worse than the current one in cases where line count above cursor changes quite significantly. I tried it and I could end up inside a totally different function after undoing formatting because of that.",
            "created_at": "2023-09-15T04:16:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1720529903",
            "id": 1720529903,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5mjTPv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1720529903/reactions"
            },
            "updated_at": "2023-09-15T04:16:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1720529903",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3524621?v=4",
                "events_url": "https://api.github.com/users/faergeek/events{/privacy}",
                "followers_url": "https://api.github.com/users/faergeek/followers",
                "following_url": "https://api.github.com/users/faergeek/following{/other_user}",
                "gists_url": "https://api.github.com/users/faergeek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/faergeek",
                "id": 3524621,
                "login": "faergeek",
                "node_id": "MDQ6VXNlcjM1MjQ2MjE=",
                "organizations_url": "https://api.github.com/users/faergeek/orgs",
                "received_events_url": "https://api.github.com/users/faergeek/received_events",
                "repos_url": "https://api.github.com/users/faergeek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/faergeek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/faergeek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/faergeek"
            }
        },
        {
            "author_association": "NONE",
            "body": "Just want to add to this that C-i and C-o don't seem to work as expected after this occurs either. (which makes it even harder to get back to where you were)",
            "created_at": "2023-12-08T12:57:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1847121164",
            "id": 1847121164,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5uGNUM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1847121164/reactions"
            },
            "updated_at": "2023-12-08T12:57:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1847121164",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1681236?v=4",
                "events_url": "https://api.github.com/users/ceuk/events{/privacy}",
                "followers_url": "https://api.github.com/users/ceuk/followers",
                "following_url": "https://api.github.com/users/ceuk/following{/other_user}",
                "gists_url": "https://api.github.com/users/ceuk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ceuk",
                "id": 1681236,
                "login": "ceuk",
                "node_id": "MDQ6VXNlcjE2ODEyMzY=",
                "organizations_url": "https://api.github.com/users/ceuk/orgs",
                "received_events_url": "https://api.github.com/users/ceuk/received_events",
                "repos_url": "https://api.github.com/users/ceuk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ceuk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ceuk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ceuk"
            }
        },
        {
            "author_association": "NONE",
            "body": "Had this issue for months, only suffered from this when editing javascript though, not while doing python, so I figured it was null-ls or prettier. Then googling, but this was a little harder to find because I was looking for null-ls/prettier/JSX/JS related search terms.\r\n\r\nWhy don't I suffer from this when doing python? Is the undojoin story above really the full story?",
            "created_at": "2024-01-05T13:24:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1878655388",
            "id": 1878655388,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5v-gGc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1878655388/reactions"
            },
            "updated_at": "2024-01-05T13:24:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1878655388",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2786295?v=4",
                "events_url": "https://api.github.com/users/dhensen/events{/privacy}",
                "followers_url": "https://api.github.com/users/dhensen/followers",
                "following_url": "https://api.github.com/users/dhensen/following{/other_user}",
                "gists_url": "https://api.github.com/users/dhensen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dhensen",
                "id": 2786295,
                "login": "dhensen",
                "node_id": "MDQ6VXNlcjI3ODYyOTU=",
                "organizations_url": "https://api.github.com/users/dhensen/orgs",
                "received_events_url": "https://api.github.com/users/dhensen/received_events",
                "repos_url": "https://api.github.com/users/dhensen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dhensen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dhensen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dhensen"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@dhensen it depends on where the changes have been applied after formatting. It may occur more often for javascript if e.g. you're doing an auto-import which inserts something like `import fs from \"fs\"` and formatter changes double quotes to single quotes, or may be adjusts spaces inside curly or something like that. Or in cases where formatter sends the whole buffer content as a replacement. In my case it was often caused by `esilnt-plugin-simple-import-sort`. I guess python simply doesn't have anything to format in imports, but I may be wrong, I don't code in python.\r\n\r\nIn any case cursor will basically just jump to the top-most change after undoing formatting done by `vim.buf.lsp.format`.",
            "created_at": "2024-01-05T14:46:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1878792264",
            "id": 1878792264,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5v_BhI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1878792264/reactions"
            },
            "updated_at": "2024-01-05T14:46:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1878792264",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3524621?v=4",
                "events_url": "https://api.github.com/users/faergeek/events{/privacy}",
                "followers_url": "https://api.github.com/users/faergeek/followers",
                "following_url": "https://api.github.com/users/faergeek/following{/other_user}",
                "gists_url": "https://api.github.com/users/faergeek/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/faergeek",
                "id": 3524621,
                "login": "faergeek",
                "node_id": "MDQ6VXNlcjM1MjQ2MjE=",
                "organizations_url": "https://api.github.com/users/faergeek/orgs",
                "received_events_url": "https://api.github.com/users/faergeek/received_events",
                "repos_url": "https://api.github.com/users/faergeek/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/faergeek/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/faergeek/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/faergeek"
            }
        },
        {
            "author_association": "NONE",
            "body": "@faergeek this is helpfull. On closer look it puts me back at the top of my function. When developing react and having a single component per file this is most often the only function, so it will appear as the top of the file, but it's actually the first line of the body of my function so:\r\n\r\n```\r\nimport 1;\r\nimport 2;\r\n\r\nexport default function Foobar() {\r\n   console.log('here');\r\n   // 300 LoC\r\n...\r\n   // my cursor was here, I want to undo. and then I'm suddenly at console.log and I have to press u one more time to actually undo.\r\n}\r\n\r\nSo my next step is going to see how prettier or null-ls/none-ls format the code. Maybe the function body is being replaced or line by line... I have no idea how formatters work. Thanks for the info",
            "created_at": "2024-01-08T10:12:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1880709675",
            "id": 1880709675,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5wGVor",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1880709675/reactions"
            },
            "updated_at": "2024-01-08T10:12:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1880709675",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2786295?v=4",
                "events_url": "https://api.github.com/users/dhensen/events{/privacy}",
                "followers_url": "https://api.github.com/users/dhensen/followers",
                "following_url": "https://api.github.com/users/dhensen/following{/other_user}",
                "gists_url": "https://api.github.com/users/dhensen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dhensen",
                "id": 2786295,
                "login": "dhensen",
                "node_id": "MDQ6VXNlcjI3ODYyOTU=",
                "organizations_url": "https://api.github.com/users/dhensen/orgs",
                "received_events_url": "https://api.github.com/users/dhensen/received_events",
                "repos_url": "https://api.github.com/users/dhensen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dhensen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dhensen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dhensen"
            }
        }
    ],
    "comments": 16,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/24297/comments",
    "created_at": "2023-07-08T15:14:58Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/24297/events",
    "html_url": "https://github.com/neovim/neovim/issues/24297",
    "id": 1794981699,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk. Do NOT ask \"can I work on this\", just read CONTRIBUTING.md",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 5581608985,
            "name": "marks",
            "node_id": "LA_kwDOAPphoM8AAAABTLCYGQ",
            "url": "https://api.github.com/repos/neovim/neovim/labels/marks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/24297/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 205,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Zero priority; no timeline. Promote an item from this state by taking ownership of it.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 237,
        "state": "open",
        "title": "unplanned",
        "updated_at": "2024-01-08T14:47:49Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM5q_T9D",
    "number": 24297,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 2,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/24297/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": "reopened",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/24297/timeline",
    "title": "LSP: undoing after vim.lsp.buf.format() changes cursor position",
    "updated_at": "2024-01-08T10:12:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/24297",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/44764250?v=4",
        "events_url": "https://api.github.com/users/pantosaur/events{/privacy}",
        "followers_url": "https://api.github.com/users/pantosaur/followers",
        "following_url": "https://api.github.com/users/pantosaur/following{/other_user}",
        "gists_url": "https://api.github.com/users/pantosaur/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/pantosaur",
        "id": 44764250,
        "login": "pantosaur",
        "node_id": "MDQ6VXNlcjQ0NzY0MjUw",
        "organizations_url": "https://api.github.com/users/pantosaur/orgs",
        "received_events_url": "https://api.github.com/users/pantosaur/received_events",
        "repos_url": "https://api.github.com/users/pantosaur/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/pantosaur/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pantosaur/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/pantosaur"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "## Problem\n\nSyntax concealing does not render on visible (unfolded) lines when `foldmethod=diff` is active and some folds are closed. The conceal rules are correctly defined and `conceallevel` is set, but the concealed text is displayed literally.\n\nOpening all folds (`zR`), forcing a redraw, then re-closing them (`zM`) causes concealing to render correctly.\n\nAlso filed upstream as vim/vim#19423 — the bug exists in both Vim and Neovim.\n\n## Steps to reproduce\n\n```vim\nset nocompatible\nsyntax on\n\nenew\nsetlocal buftype=nofile bufhidden=wipe\ncall setline(1, [\n  \\ 'Same 1', 'Same 2', 'Same 3',\n  \\ 'Left only [visible](http://hidden-url)',\n  \\ 'Same 5', 'Same 6',\n  \\ ])\nsetlocal syntax=markdown conceallevel=2\ndiffthis\n\nvnew\nsetlocal buftype=nofile bufhidden=wipe\ncall setline(1, [\n  \\ 'Same 1', 'Same 2', 'Same 3',\n  \\ 'Right only [visible](http://hidden-url)',\n  \\ 'Same 5', 'Same 6',\n  \\ ])\nsetlocal syntax=markdown conceallevel=2\ndiffthis\n```\n\n## Expected behavior\n\nLine 4 in both buffers should show the markdown link with the URL concealed (i.e., just “visible” instead of “[visible](http://hidden-url)”).\n\n## Actual behavior\n\nLine 4 shows the raw markdown `[visible](http://hidden-url)` with no concealing applied, even though `conceallevel=2` and the syntax conceal rules are active.\n\n## Workaround\n\nAfter `diffthis`, running `zR` (open all folds), `redraw`, then `zM` (close all folds) causes concealing to render correctly. This can be automated with a deferred callback:\n\n```lua\nvim.defer_fn(function()\n  -- open all folds in each diff window\n  vim.cmd(\"normal! zR\")\n  vim.cmd(\"redraw\")\n  vim.cmd(\"normal! zM\")\nend, 50)\n```\n\nThe redraw between `zR` and `zM` is essential — without it, the workaround has no effect.\n\n## Version\n\n```\nNVIM v0.12.0-dev-2312+g4719b94443\n```\n",
    "closed_at": "2026-02-16T11:05:09Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
        "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
        "followers_url": "https://api.github.com/users/sideshowbarker/followers",
        "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
        "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/sideshowbarker",
        "id": 194984,
        "login": "sideshowbarker",
        "node_id": "MDQ6VXNlcjE5NDk4NA==",
        "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
        "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
        "repos_url": "https://api.github.com/users/sideshowbarker/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/sideshowbarker",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "The original reproduction used conceal rules from [preservim/vim-markdown](https://github.com/preservim/vim-markdown). Here's a self-contained reproduction using a custom syntax rule with no plugins, confirming the bug is in the rendering layer:\n\n<details>\n<summary>outdated/insufficient repro (with too-few lines)</summary>\n\n\n```vim\nset nocompatible\nsyntax on\n\n\" Left buffer\nenew\nsetlocal buftype=nofile bufhidden=wipe\ncall setline(1, ['Same 1', 'Same 2', 'Same 3', 'Left SECRET here', 'Same 5', 'Same 6'])\nsyntax match MySecret /SECRET/ conceal\nsetlocal conceallevel=2\ndiffthis\n\n\" Right buffer\nvnew\nsetlocal buftype=nofile bufhidden=wipe\ncall setline(1, ['Same 1', 'Same 2', 'Same 3', 'Right SECRET here', 'Same 5', 'Same 6'])\nsyntax match MySecret /SECRET/ conceal\nsetlocal conceallevel=2\ndiffthis\n```\n\nExpected: `SECRET` is concealed on line 4 in both buffers.\nActual: `SECRET` is shown literally. Running `zR` then `zM` makes concealing appear.\n\n</details>",
            "created_at": "2026-02-16T09:56:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/37893#issuecomment-3907507567",
            "id": 3907507567,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37893",
            "node_id": "IC_kwDOAPphoM7o59Vv",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907507567/reactions"
            },
            "updated_at": "2026-02-16T10:17:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907507567",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
                "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
                "followers_url": "https://api.github.com/users/sideshowbarker/followers",
                "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
                "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/sideshowbarker",
                "id": 194984,
                "login": "sideshowbarker",
                "node_id": "MDQ6VXNlcjE5NDk4NA==",
                "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
                "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
                "repos_url": "https://api.github.com/users/sideshowbarker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/sideshowbarker",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Cannot reproduce. The script doesn't lead to any closed folds.",
            "created_at": "2026-02-16T10:08:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/37893#issuecomment-3907575562",
            "id": 3907575562,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37893",
            "node_id": "IC_kwDOAPphoM7o6N8K",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907575562/reactions"
            },
            "updated_at": "2026-02-16T10:08:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907575562",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "You're right — the previous script had too few lines to form closed folds. Here's an updated reproduction with enough unchanged lines to create folds:\n\n```vim\nset nocompatible\nsyntax on\n\nlet shared_before = map(range(1, 20), '\"Same \" .. v:val')\nlet shared_after = map(range(1, 20), '\"After \" .. v:val')\n\n\" Left buffer\nenew\nsetlocal buftype=nofile bufhidden=wipe\ncall setline(1, shared_before + ['Left SECRET here'] + shared_after)\nsyntax match MySecret /SECRET/ conceal\nsetlocal conceallevel=2\ndiffthis\n\n\" Right buffer\nvnew\nsetlocal buftype=nofile bufhidden=wipe\ncall setline(1, shared_before + ['Right SECRET here'] + shared_after)\nsyntax match MySecret /SECRET/ conceal\nsetlocal conceallevel=2\ndiffthis\n```\n\nWith 20 unchanged lines on each side of the change, `foldmethod=diff` creates closed folds. Line 21 (the changed line) is visible but `SECRET` is not concealed. Running `zR` then `zM` makes concealing appear.",
            "created_at": "2026-02-16T10:12:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/37893#issuecomment-3907594597",
            "id": 3907594597,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37893",
            "node_id": "IC_kwDOAPphoM7o6Sll",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907594597/reactions"
            },
            "updated_at": "2026-02-16T10:12:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907594597",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
                "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
                "followers_url": "https://api.github.com/users/sideshowbarker/followers",
                "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
                "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/sideshowbarker",
                "id": 194984,
                "login": "sideshowbarker",
                "node_id": "MDQ6VXNlcjE5NDk4NA==",
                "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
                "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
                "repos_url": "https://api.github.com/users/sideshowbarker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/sideshowbarker",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@sideshowbarker Please confirm that you are manually writing these comments (and the issue description). We do not allow direct interaction with agents (automated issues, comments, PRs) in this project. All contributions must be made by a human (with LLM help, if necessary).",
            "created_at": "2026-02-16T10:26:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/37893#issuecomment-3907657432",
            "id": 3907657432,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37893",
            "node_id": "IC_kwDOAPphoM7o6h7Y",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907657432/reactions"
            },
            "updated_at": "2026-02-16T10:26:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907657432",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> @sideshowbarker Please confirm that you are manually writing these comments (and the issue description). We do not allow direct interaction with agents (automated issues, comments, PRs) in this project. All contributions must be made by a human (with LLM help, if necessary).\n\nConfirmed. I had already been in the process of updating the original repro at the time I saw @zeertzjq’s comment pointing out that the repro didn't actually repro. So I instead posted it as a new comment. \n\nI did have help from Claude in isolating the problem and in drafting a problem description, and developing a repro.",
            "created_at": "2026-02-16T10:40:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/37893#issuecomment-3907724622",
            "id": 3907724622,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37893",
            "node_id": "IC_kwDOAPphoM7o6yVO",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907724622/reactions"
            },
            "updated_at": "2026-02-16T10:40:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907724622",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
                "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
                "followers_url": "https://api.github.com/users/sideshowbarker/followers",
                "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
                "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/sideshowbarker",
                "id": 194984,
                "login": "sideshowbarker",
                "node_id": "MDQ6VXNlcjE5NDk4NA==",
                "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
                "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
                "repos_url": "https://api.github.com/users/sideshowbarker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/sideshowbarker",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I can’t reproduce this when testing with `--clean`.\n\nSo I guess there’s something else going on in my environment — and given that, I’m gonna close this and regroup and try to further isolate the actual cause of the problem. ",
            "created_at": "2026-02-16T11:03:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/37893#issuecomment-3907831963",
            "id": 3907831963,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37893",
            "node_id": "IC_kwDOAPphoM7o7Mib",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907831963/reactions"
            },
            "updated_at": "2026-02-16T11:09:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3907831963",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
                "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
                "followers_url": "https://api.github.com/users/sideshowbarker/followers",
                "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
                "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/sideshowbarker",
                "id": 194984,
                "login": "sideshowbarker",
                "node_id": "MDQ6VXNlcjE5NDk4NA==",
                "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
                "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
                "repos_url": "https://api.github.com/users/sideshowbarker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/sideshowbarker",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37893/comments",
    "created_at": "2026-02-16T06:50:14Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37893/events",
    "html_url": "https://github.com/neovim/neovim/issues/37893",
    "id": 3946207878,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "We need minimal steps to reproduce the issue",
            "id": 298863445,
            "name": "needs:repro",
            "node_id": "MDU6TGFiZWwyOTg4NjM0NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:repro"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "regex syntax or non-regex parsing, lpeg, grammars",
            "id": 531600085,
            "name": "syntax",
            "node_id": "MDU6TGFiZWw1MzE2MDAwODU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/syntax"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 2598645343,
            "name": "folds",
            "node_id": "MDU6TGFiZWwyNTk4NjQ1MzQz",
            "url": "https://api.github.com/repos/neovim/neovim/labels/folds"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 3385582660,
            "name": "conceal",
            "node_id": "LA_kwDOAPphoM7Jy-RE",
            "url": "https://api.github.com/repos/neovim/neovim/labels/conceal"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37893/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7rNlqG",
    "number": 37893,
    "performed_via_github_app": null,
    "pinned_comment": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37893/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37893/timeline",
    "title": "Syntax concealing not rendered when foldmethod=diff has closed folds",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-02-16T11:09:55Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37893",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
        "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
        "followers_url": "https://api.github.com/users/sideshowbarker/followers",
        "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
        "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/sideshowbarker",
        "id": 194984,
        "login": "sideshowbarker",
        "node_id": "MDQ6VXNlcjE5NDk4NA==",
        "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
        "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
        "repos_url": "https://api.github.com/users/sideshowbarker/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/sideshowbarker",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhen wrap is disabled, depending on the size of the gutter, certain Treesitter highlights fail to show.\n\nShowing the tabline can also affect which highlights fail to show\n\nThis issue occurs if I build from commit 5edbabd, but not 118e7e7\n\n### Steps to reproduce\n\n```nvim --clean -u``` from the following file:\n\n``` lua\n-- Wrap must be set for false\nvim.api.nvim_set_option_value(\"wrap\", false, { scope = \"global\" })\n\n-- This combination of options will cause highlighting in the foo table to fail after the\n-- fourth left curly brace plus the \"global\" in the nu setting\nvim.api.nvim_set_option_value(\"nu\", true, { scope = \"global\" })\nvim.api.nvim_set_option_value(\"nuw\", 8, { scope = \"global\" })\n\n-- This will cause highlighting in the foo table on and after the fourth left curly brace\n-- vim.api.nvim_set_option_value(\"scl\", \"yes:5\", { scope = \"global\" })\n\n-- This set of options causes \"global\" in wrap and scl to fail to highlight\n-- vim.api.nvim_set_option_value(\"nu\", true, { scope = \"global\" })\n-- vim.api.nvim_set_option_value(\"nuw\", 5, { scope = \"global\" })\n-- vim.api.nvim_set_option_value(\"rnu\", true, { scope = \"global\" })\n-- vim.api.nvim_set_option_value(\"scl\", \"yes:1\", { scope = \"global\" })\n\n-- Showing the tabline also affects which highlights fail\n-- vim.api.nvim_set_option_value(\"stal\", 2, { scope = \"global\" })\n\nlocal foo = { { severity = 0 }, { severity = 1 }, { severity = 2 }, { severity = 3 } }\n\n```\n\n### Expected behavior\n\nTreesitter highlights should display properly\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-1107+g5edbabdbec\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nLinux Mint 22.1 x86_64\n\n### Terminal name/version\n\nGhostty 1.1.3\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nBuild from source",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "`{ scope = \"global\" }` doesn't seem necessary, and makes reproducing the issue harder.",
            "created_at": "2025-08-31T23:58:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/35575#issuecomment-3240509247",
            "id": 3240509247,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35575",
            "node_id": "IC_kwDOAPphoM7BJj8_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3240509247/reactions"
            },
            "updated_at": "2025-08-31T23:58:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3240509247",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This seems to fix the problem:\n```diff\ndiff --git a/src/nvim/drawline.c b/src/nvim/drawline.c\nindex cae660249b..da9d37c877 100644\n--- a/src/nvim/drawline.c\n+++ b/src/nvim/drawline.c\n@@ -3220,7 +3220,7 @@ static int decor_providers_setup(int rows_to_draw, bool draw_from_line_start, li\n     int first_row_width = draw_from_line_start ? width : width2;\n     rem_vcols = first_row_width + (rows_to_draw - 1) * width2;\n   } else {\n-    rem_vcols = wp->w_view_height - win_col_off(wp);\n+    rem_vcols = wp->w_view_width - win_col_off(wp);\n   }\n \n   // Call it here since we need to invalidate the line pointer anyway.\n```\nBut I haven't figured out how to add a test for this yet.\n\ncc @vanaigr",
            "created_at": "2025-09-01T00:06:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/35575#issuecomment-3240517611",
            "id": 3240517611,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35575",
            "node_id": "IC_kwDOAPphoM7BJl_r",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3240517611/reactions"
            },
            "updated_at": "2025-09-01T00:06:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3240517611",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> `{ scope = \"global\" }` doesn't seem necessary, and makes reproducing the issue harder.\n\nPlayed around with this again using Window local options:\n\n```lua\n-- For visibility\nvim.api.nvim_set_hl(0, \"Constant\", { link = \"Identifier\" }) \nvim.api.nvim_set_hl(0, \"@variable.member.lua\", {}) \n\nlocal function foo()\n    for _, d in ipairs(vim.diagnostic.get(opts.buf or nil)) do\n        if d.severity == vim.diagnostic.severity.ERROR then\n            return vim.diagnostic.severity.ERROR\n        elseif d.severity == vim.diagnostic.severity.WARN then\n            has_warn = true\n        elseif d.severity == vim.diagnostic.severity.INFO then\n            has_info = true\n        elseif d.severity == vim.diagnostic.severity.HINT then\n            has_hint = true\n        end\n    end\nend\n\nlocal foo = { { severity = 0 }, { severity = 1 }, { severity = 2 }, { severity = 3 } }\n\n-- Running this makes bold highlight on do go away\n-- vim.api.nvim_set_option_value(\"wrap\", false, { win = 0})\n-- Running these two will cause the highlighting in the second half of the foo table\n-- to fail\n-- vim.api.nvim_set_option_value(\"nu\", true, { win = 0})\n-- vim.api.nvim_set_option_value(\"nuw\", 8, { win = 0 })\n-- If I run this, it opens in a split above the initial window. The foo table\n-- displays properly, but the first ERROR on line 7 now does not have a constant highlight\n-- :h lua\n-- Running this makes the ERROR highlight appear again as well as the do highlight\n-- vim.api.nvim_set_option_value(\"stal\", 2, { scope = \"global\" })\n-- Then if I close the help window, the do highlight disappears\n-- If I run this, the foo table highlights improperly, but do is still highlighted\n-- vim.api.nvim_set_option_value(\"stal\", 0, { scope = \"global\" })\n-- Run this again. Foo table is correct, do highlight disappears\n-- vim.api.nvim_set_option_value(\"stal\", 2, { scope = \"global\" })\n```\n\nEDIT If I take a window with the contents above them open a horizontal tmux split below it, the highlights will display correctly\n\nIf I take the same window contents and create a tmux vertical split, nothing changes\n\nBut then if I take the Neovim window in the tmux vsplit, then do a Neovim vsplit the highlighting in those Nvim windows is correct. \n\nIf I do a Neovim vsplit and type beyond the width of the split, the highlighting becomes correct, even when I exit to Normal mode. I can then $/0 on the extended line and watch the highlighting switch between correct/incorrect\n\nIf I go back to the beginning of this long line then use l to increment slowly past the boundary in normal mode, it alternates between correct and not correct\n\nI opened a non-tmux Terminal to make sure this behavior still existed there and it does",
            "created_at": "2025-09-01T00:27:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/35575#issuecomment-3240540991",
            "id": 3240540991,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/35575",
            "node_id": "IC_kwDOAPphoM7BJrs_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3240540991/reactions"
            },
            "updated_at": "2025-09-01T00:43:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3240540991",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62523234?v=4",
                "events_url": "https://api.github.com/users/mikejmcguirk/events{/privacy}",
                "followers_url": "https://api.github.com/users/mikejmcguirk/followers",
                "following_url": "https://api.github.com/users/mikejmcguirk/following{/other_user}",
                "gists_url": "https://api.github.com/users/mikejmcguirk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mikejmcguirk",
                "id": 62523234,
                "login": "mikejmcguirk",
                "node_id": "MDQ6VXNlcjYyNTIzMjM0",
                "organizations_url": "https://api.github.com/users/mikejmcguirk/orgs",
                "received_events_url": "https://api.github.com/users/mikejmcguirk/received_events",
                "repos_url": "https://api.github.com/users/mikejmcguirk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mikejmcguirk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mikejmcguirk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mikejmcguirk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/35575/comments",
    "created_at": "2025-08-31T23:43:19Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/35575/events",
    "html_url": "https://github.com/neovim/neovim/issues/35575",
    "id": 3370782630,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue has been tracked to a specific commit",
            "id": 1481421490,
            "name": "has:bisected",
            "node_id": "MDU6TGFiZWwxNDgxNDIxNDkw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:bisected"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "marks, extmarks, decorations, virtual text",
            "id": 1680119719,
            "name": "marks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/marks"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/35575/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 113,
        "created_at": "2024-05-16T14:11:54Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/43",
        "id": 11063573,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/43/labels",
        "node_id": "MI_kwDOAPphoM4AqNEV",
        "number": 43,
        "open_issues": 73,
        "state": "open",
        "title": "0.12",
        "updated_at": "2025-09-01T15:30:32Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/43"
    },
    "node_id": "I_kwDOAPphoM7I6g-m",
    "number": 35575,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/35575/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/35575/timeline",
    "title": "TS Highlights Fail to Display with Nowrap + Gutter",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-09-01T00:43:58Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/35575",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/62523234?v=4",
        "events_url": "https://api.github.com/users/mikejmcguirk/events{/privacy}",
        "followers_url": "https://api.github.com/users/mikejmcguirk/followers",
        "following_url": "https://api.github.com/users/mikejmcguirk/following{/other_user}",
        "gists_url": "https://api.github.com/users/mikejmcguirk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mikejmcguirk",
        "id": 62523234,
        "login": "mikejmcguirk",
        "node_id": "MDQ6VXNlcjYyNTIzMjM0",
        "organizations_url": "https://api.github.com/users/mikejmcguirk/orgs",
        "received_events_url": "https://api.github.com/users/mikejmcguirk/received_events",
        "repos_url": "https://api.github.com/users/mikejmcguirk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mikejmcguirk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mikejmcguirk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mikejmcguirk",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nUndercurl works when terminfo is in `~/.terminfo/x/xterm-256color` but not when using identical system terminfo from `/usr/share/terminfo/x/xterm-256color` (default). When not with a terminfo file in the `~` directory, the undercurls in neovim will show as simple underlines.\n\n**Additional context:**\n- WSL environment\n- Both terminfo files are byte-for-byte identical\n- Issue is nvim-specific, not terminal-specific\n- Shell is `zsh`\n- Undercurls work in terminal in any case, but not in nvim\n- Setting `export TERM=\"tmux-256color\"` also fixes the no undercurl in neovim problem (We're not running in a tmux session here, it works for zsh)\n\nI'm pretty sure it was working fine 2 days ago and suddenly stopped without me being able to remeber having done anything (no nvim update, no setting $TERM, no terminal settings change...)\n\n### Steps to reproduce\n\n\n\n1. Have identical terminfo in both locations (verified with `diff`)\n<details>\n<summary>The file I've used:</summary>\n\nObtained with `infocmp $TERM > xterm-256color.terminfo`\n\n```\n# Reconstructed via infocmp from file: /home/user/.terminfo/x/xterm-256color\nxterm-256color|xterm with 256 colors,\n\tam, bce, ccc, km, mc5i, mir, msgr, npc, xenl,\n\tcolors#0x100, cols#80, it#8, lines#24, pairs#0x10000,\n\tacsc=``aaffggiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz{{||}}~~,\n\tbel=^G, blink=\\E[5m, bold=\\E[1m, cbt=\\E[Z, civis=\\E[?25l,\n\tclear=\\E[H\\E[2J, cnorm=\\E[?12l\\E[?25h, cr=\\r,\n\tcsr=\\E[%i%p1%d;%p2%dr, cub=\\E[%p1%dD, cub1=^H,\n\tcud=\\E[%p1%dB, cud1=\\n, cuf=\\E[%p1%dC, cuf1=\\E[C,\n\tcup=\\E[%i%p1%d;%p2%dH, cuu=\\E[%p1%dA, cuu1=\\E[A,\n\tcvvis=\\E[?12;25h, dch=\\E[%p1%dP, dch1=\\E[P, dim=\\E[2m,\n\tdl=\\E[%p1%dM, dl1=\\E[M, ech=\\E[%p1%dX, ed=\\E[J, el=\\E[K,\n\tel1=\\E[1K, flash=\\E[?5h$<100/>\\E[?5l, home=\\E[H,\n\thpa=\\E[%i%p1%dG, ht=^I, hts=\\EH, ich=\\E[%p1%d@,\n\til=\\E[%p1%dL, il1=\\E[L, ind=\\n, indn=\\E[%p1%dS,\n\tinitc=\\E]4;%p1%d;rgb:%p2%{255}%*%{1000}%/%2.2X/%p3%{255}%*%{1000}%/%2.2X/%p4%{255}%*%{1000}%/%2.2X\\E\\\\,\n\tinvis=\\E[8m, is2=\\E[!p\\E[?3;4l\\E[4l\\E>, kDC=\\E[3;2~,\n\tkEND=\\E[1;2F, kHOM=\\E[1;2H, kIC=\\E[2;2~, kLFT=\\E[1;2D,\n\tkNXT=\\E[6;2~, kPRV=\\E[5;2~, kRIT=\\E[1;2C, ka1=\\EOw,\n\tka3=\\EOy, kb2=\\EOu, kbeg=\\EOE, kbs=^?, kc1=\\EOq, kc3=\\EOs,\n\tkcbt=\\E[Z, kcub1=\\EOD, kcud1=\\EOB, kcuf1=\\EOC, kcuu1=\\EOA,\n\tkdch1=\\E[3~, kend=\\EOF, kent=\\EOM, kf1=\\EOP, kf10=\\E[21~,\n\tkf11=\\E[23~, kf12=\\E[24~, kf13=\\E[1;2P, kf14=\\E[1;2Q,\n\tkf15=\\E[1;2R, kf16=\\E[1;2S, kf17=\\E[15;2~, kf18=\\E[17;2~,\n\tkf19=\\E[18;2~, kf2=\\EOQ, kf20=\\E[19;2~, kf21=\\E[20;2~,\n\tkf22=\\E[21;2~, kf23=\\E[23;2~, kf24=\\E[24;2~,\n\tkf25=\\E[1;5P, kf26=\\E[1;5Q, kf27=\\E[1;5R, kf28=\\E[1;5S,\n\tkf29=\\E[15;5~, kf3=\\EOR, kf30=\\E[17;5~, kf31=\\E[18;5~,\n\tkf32=\\E[19;5~, kf33=\\E[20;5~, kf34=\\E[21;5~,\n\tkf35=\\E[23;5~, kf36=\\E[24;5~, kf37=\\E[1;6P, kf38=\\E[1;6Q,\n\tkf39=\\E[1;6R, kf4=\\EOS, kf40=\\E[1;6S, kf41=\\E[15;6~,\n\tkf42=\\E[17;6~, kf43=\\E[18;6~, kf44=\\E[19;6~,\n\tkf45=\\E[20;6~, kf46=\\E[21;6~, kf47=\\E[23;6~,\n\tkf48=\\E[24;6~, kf49=\\E[1;3P, kf5=\\E[15~, kf50=\\E[1;3Q,\n\tkf51=\\E[1;3R, kf52=\\E[1;3S, kf53=\\E[15;3~, kf54=\\E[17;3~,\n\tkf55=\\E[18;3~, kf56=\\E[19;3~, kf57=\\E[20;3~,\n\tkf58=\\E[21;3~, kf59=\\E[23;3~, kf6=\\E[17~, kf60=\\E[24;3~,\n\tkf61=\\E[1;4P, kf62=\\E[1;4Q, kf63=\\E[1;4R, kf7=\\E[18~,\n\tkf8=\\E[19~, kf9=\\E[20~, khome=\\EOH, kich1=\\E[2~,\n\tkind=\\E[1;2B, kmous=\\E[<, knp=\\E[6~, kpp=\\E[5~,\n\tkri=\\E[1;2A, mc0=\\E[i, mc4=\\E[4i, mc5=\\E[5i, meml=\\El,\n\tmemu=\\Em, mgc=\\E[?69l, nel=\\EE, oc=\\E]104\\007,\n\top=\\E[39;49m, rc=\\E8, rep=%p1%c\\E[%p2%{1}%-%db,\n\trev=\\E[7m, ri=\\EM, rin=\\E[%p1%dT, ritm=\\E[23m, rmacs=\\E(B,\n\trmam=\\E[?7l, rmcup=\\E[?1049l\\E[23;0;0t, rmir=\\E[4l,\n\trmkx=\\E[?1l\\E>, rmm=\\E[?1034l, rmso=\\E[27m, rmul=\\E[24m,\n\trs1=\\Ec\\E]104\\007, rs2=\\E[!p\\E[?3;4l\\E[4l\\E>, sc=\\E7,\n\tsetab=\\E[%?%p1%{8}%<%t4%p1%d%e%p1%{16}%<%t10%p1%{8}%-%d%e48;5;%p1%d%;m,\n\tsetaf=\\E[%?%p1%{8}%<%t3%p1%d%e%p1%{16}%<%t9%p1%{8}%-%d%e38;5;%p1%d%;m,\n\tsgr=%?%p9%t\\E(0%e\\E(B%;\\E[0%?%p6%t;1%;%?%p5%t;2%;%?%p2%t;4%;%?%p1%p3%|%t;7%;%?%p4%t;5%;%?%p7%t;8%;m,\n\tsgr0=\\E(B\\E[m, sitm=\\E[3m, smacs=\\E(0, smam=\\E[?7h,\n\tsmcup=\\E[?1049h\\E[22;0;0t, smglp=\\E[?69h\\E[%i%p1%ds,\n\tsmglr=\\E[?69h\\E[%i%p1%d;%p2%ds,\n\tsmgrp=\\E[?69h\\E[%i;%p1%ds, smir=\\E[4h, smkx=\\E[?1h\\E=,\n\tsmm=\\E[?1034h, smso=\\E[7m, smul=\\E[4m, tbc=\\E[3g,\n\tu6=\\E[%i%d;%dR, u7=\\E[6n, u8=\\E[?%[;0123456789]c,\n\tu9=\\E[c, vpa=\\E[%i%p1%dd,\n```\nThen compiled with `tic xterm-256color.terminfo` ( will go in `~/.terminfo by default`)\n</details>\n\n2. Remove `~/.terminfo/x/xterm-256color` - undercurl breaks in nvim\n3. Restore `~/.terminfo/x/xterm-256color` - undercurl works again\n\n### Expected behavior\n\nShould work with system default `usr/share` terminfo ?\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-656+g462f7aaa8e Build type: RelWithDebInfo LuaJIT 2.1.1744317938 \n**as well as**\nNVIM v0.11.2 Build type: RelWithDebInfo LuaJIT 2.1.1748459687\n\n### Vim (not Nvim) behaves the same?\n\ndid not test\n\n### Operating system/version\n\nWSL version: 2.5.9.0 Kernel version: 6.6.87.2-1 WSLg version: 1.0.66 MSRDC version: 1.2.6074 Direct3D version: 1.611.1-81528511 DXCore version: 10.0.26100.1-240331-1435.ge-release Windows version: 10.0.26100.4351\n\n### Terminal name/version\n\nwezterm 20250510-092908-4a210168\n\n### $TERM environment variable\n\nxterm256-color\n\n### Installation\n\nAUR",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34625/comments",
    "created_at": "2025-06-23T23:41:46Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34625/events",
    "html_url": "https://github.com/neovim/neovim/issues/34625",
    "id": 3169747604,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34625/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM687oKU",
    "number": 34625,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34625/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34625/timeline",
    "title": "Undercurl not working with system terminfo but works with user terminfo on WSL (xterm-256color)",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-23T23:43:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34625",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/71520287?v=4",
        "events_url": "https://api.github.com/users/woertsposzibllen4me/events{/privacy}",
        "followers_url": "https://api.github.com/users/woertsposzibllen4me/followers",
        "following_url": "https://api.github.com/users/woertsposzibllen4me/following{/other_user}",
        "gists_url": "https://api.github.com/users/woertsposzibllen4me/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/woertsposzibllen4me",
        "id": 71520287,
        "login": "woertsposzibllen4me",
        "node_id": "MDQ6VXNlcjcxNTIwMjg3",
        "organizations_url": "https://api.github.com/users/woertsposzibllen4me/orgs",
        "received_events_url": "https://api.github.com/users/woertsposzibllen4me/received_events",
        "repos_url": "https://api.github.com/users/woertsposzibllen4me/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/woertsposzibllen4me/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/woertsposzibllen4me/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/woertsposzibllen4me",
        "user_view_type": "public"
    }
}
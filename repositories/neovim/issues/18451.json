{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Neovim version (nvim -v)\r\n\r\nLatest as of right now, cb3211516298c8b01ffb432b7a7f33acdc01b34b\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nN/A\r\n\r\n### Operating system/version\r\n\r\nmacOS 12\r\n\r\n### Terminal name/version\r\n\r\niTerm2\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nFrom source\r\n\r\n### How to reproduce the issue\r\n\r\nClean clone of the repo, run `TEST_FILTER=whatever make test`.\r\n\r\n### Expected behavior\r\n\r\nClean run of the tests.\r\n\r\n### Actual behavior\r\n\r\n```\r\n[----------] Global test environment teardown.\r\n[==========] 12 tests from 365 test files ran. (2239.55 ms total)\r\n[  PASSED  ] 12 tests.\r\n-- Tests exited non-zero: Subprocess aborted\r\n-- Output to stderr:\r\nLuaJIT ASSERT lj_api.c:836: lua_rawgeti: stack slot 2 is not a table\r\n\r\nCMake Error at /Users/mishchea/tmp/neovim/cmake/RunTests.cmake:98 (message):\r\n  functional tests failed with error: Subprocess aborted\r\n\r\n\r\nFAILED: CMakeFiles/functionaltest /Users/mishchea/tmp/neovim/build/CMakeFiles/functionaltest\r\ncd /Users/mishchea/tmp/neovim/build && /opt/homebrew/Cellar/cmake/3.23.1/bin/cmake -DBUSTED_PRG=/Users/mishchea/tmp/neovim/.deps/usr/bin/busted -DLUA_PRG=/Users/mishchea/tmp/neovim/.deps/usr/bin/luajit -DNVIM_PRG=/Users/mishchea/tmp/neovim/build/bin/nvim -DWORKING_DIR=/Users/mishchea/tmp/neovim -DBUSTED_OUTPUT_TYPE=nvim -DTEST_DIR=/Users/mishchea/tmp/neovim/test -DBUILD_DIR=/Users/mishchea/tmp/neovim/build -DTEST_TYPE=functional -P /Users/mishchea/tmp/neovim/cmake/RunTests.cmake\r\nninja: build stopped: subcommand failed.\r\nmake: *** [functionaltest] Error 1\r\n~/repos/neovim $ \r\n```",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Ah, the `winhighlight` is a red herring; the crash is in the test harness itself (it also happens with, e.g., `TEST_FILTER=autocmd` or even `TEST_FILTER=sjflksflsj`). It _doesn't_ happen with `TEST_FILE`, though.\r\n\r\nSo this is in fact an issue with busted (or LuaJIT -- where such crashes tend to be fixed very quickly once a minimal standalone reproducer can be provided).",
            "created_at": "2022-05-07T09:12:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/18451#issuecomment-1120172077",
            "id": 1120172077,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18451",
            "node_id": "IC_kwDOAPphoM5CxHgt",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120172077/reactions"
            },
            "updated_at": "2022-05-07T11:19:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120172077",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Yep, I'm on an Apple Silicon M1, and yeah this is independent of the value of `TEST_FILTER=`.\r\n\r\nAlso I should say, I'm pretty sure this is a recent regression. I used to be able to run the test suite on this machine.",
            "created_at": "2022-05-08T17:31:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/18451#issuecomment-1120457602",
            "id": 1120457602,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18451",
            "node_id": "IC_kwDOAPphoM5CyNOC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120457602/reactions"
            },
            "updated_at": "2022-05-08T17:31:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120457602",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5308024?v=4",
                "events_url": "https://api.github.com/users/andmis/events{/privacy}",
                "followers_url": "https://api.github.com/users/andmis/followers",
                "following_url": "https://api.github.com/users/andmis/following{/other_user}",
                "gists_url": "https://api.github.com/users/andmis/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andmis",
                "id": 5308024,
                "login": "andmis",
                "node_id": "MDQ6VXNlcjUzMDgwMjQ=",
                "organizations_url": "https://api.github.com/users/andmis/orgs",
                "received_events_url": "https://api.github.com/users/andmis/received_events",
                "repos_url": "https://api.github.com/users/andmis/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andmis/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andmis/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andmis",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Also I should say, I'm pretty sure this is a recent regression. I used to be able to run the test suite on this machine.\r\n\r\nIf you can bisect it, that would be helpful. (I'd focus on the LuaJIT and LibUV bumps to get a starting point for the `git bisect`.)\r\n",
            "created_at": "2022-05-08T17:33:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/18451#issuecomment-1120457945",
            "id": 1120457945,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18451",
            "node_id": "IC_kwDOAPphoM5CyNTZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120457945/reactions"
            },
            "updated_at": "2022-05-08T17:33:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120457945",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Either I was mistaken that this ever worked for me, or something in my env changed that caused this to stop working. If I go back around 2300 commits from `master` (the oldest commit where `git clean -f -x -d && make test` works out-of-the-box for me, as in, doesn't give me a different error) I get the same error.\r\n\r\nSome more data points:\r\n- `TEST_FILTER=something make functionaltest` works, but `TEST_FILTER=doesnotexist make functionaltest` does not -- the latter filter matches zero tests, the former matches some. So matching no tests seems to matter.\r\n- I just tried this in a Rosetta environment (x86 emulation for Apple Silicon) and got the same error.",
            "created_at": "2022-05-08T20:29:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/18451#issuecomment-1120482425",
            "id": 1120482425,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18451",
            "node_id": "IC_kwDOAPphoM5CyTR5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120482425/reactions"
            },
            "updated_at": "2022-05-08T20:29:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120482425",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5308024?v=4",
                "events_url": "https://api.github.com/users/andmis/events{/privacy}",
                "followers_url": "https://api.github.com/users/andmis/followers",
                "following_url": "https://api.github.com/users/andmis/following{/other_user}",
                "gists_url": "https://api.github.com/users/andmis/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andmis",
                "id": 5308024,
                "login": "andmis",
                "node_id": "MDQ6VXNlcjUzMDgwMjQ=",
                "organizations_url": "https://api.github.com/users/andmis/orgs",
                "received_events_url": "https://api.github.com/users/andmis/received_events",
                "repos_url": "https://api.github.com/users/andmis/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andmis/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andmis/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andmis",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yeah, I get the same on Intel.\r\n\r\nSo this looks increasingly like a `busted` issue, and not LuaJIT. If you can extract a minimal reproducing example using only busted (not Neovim), you could open an issue there. (It hasn't seen any real development in years, so I'm not optimistic about this getting fixed, mind you.)",
            "created_at": "2022-05-08T20:33:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/18451#issuecomment-1120482851",
            "id": 1120482851,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18451",
            "node_id": "IC_kwDOAPphoM5CyTYj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120482851/reactions"
            },
            "updated_at": "2022-05-08T20:33:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1120482851",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Is this still a problem? On the surface this seems like a big problem that most people that run tests will encounter, and yet I don't think I ever have.",
            "created_at": "2025-01-23T08:12:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/18451#issuecomment-2609118630",
            "id": 2609118630,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18451",
            "node_id": "IC_kwDOAPphoM6bg_2m",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2609118630/reactions"
            },
            "updated_at": "2025-01-23T08:12:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2609118630",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/18451/comments",
    "created_at": "2022-05-06T18:27:03Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/18451/events",
    "html_url": "https://github.com/neovim/neovim/issues/18451",
    "id": 1228236392,
    "labels": [
        {
            "color": "FEF2C0",
            "default": false,
            "description": "Needs a third-party / external change or fix",
            "id": 101945532,
            "name": "status:blocked-external",
            "node_id": "MDU6TGFiZWwxMDE5NDU1MzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/status:blocked-external"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 110418643,
            "name": "test",
            "node_id": "MDU6TGFiZWwxMTA0MTg2NDM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/test"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "build dependencies (LuaJIT, LibUV, etc.)",
            "id": 1205400704,
            "name": "dependencies",
            "node_id": "MDU6TGFiZWwxMjA1NDAwNzA0",
            "url": "https://api.github.com/repos/neovim/neovim/labels/dependencies"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/18451/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5JNWZo",
    "number": 18451,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/18451/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/18451/timeline",
    "title": "tests/busted: `LuaJIT ASSERT lj_api.c:836: lua_rawgeti: stack slot 2 is not a table`",
    "updated_at": "2025-01-23T08:12:19Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/18451",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5308024?v=4",
        "events_url": "https://api.github.com/users/andmis/events{/privacy}",
        "followers_url": "https://api.github.com/users/andmis/followers",
        "following_url": "https://api.github.com/users/andmis/following{/other_user}",
        "gists_url": "https://api.github.com/users/andmis/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/andmis",
        "id": 5308024,
        "login": "andmis",
        "node_id": "MDQ6VXNlcjUzMDgwMjQ=",
        "organizations_url": "https://api.github.com/users/andmis/orgs",
        "received_events_url": "https://api.github.com/users/andmis/received_events",
        "repos_url": "https://api.github.com/users/andmis/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/andmis/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andmis/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/andmis",
        "user_view_type": "public"
    }
}
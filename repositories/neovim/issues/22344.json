{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Describe the bug\r\n\r\nRelated to https://github.com/folke/noice.nvim/issues/17, https://github.com/neovide/neovide/issues/1751, and maybe #21265\r\nNeovide version (patched for debugging): https://github.com/ryo33/neovide/commit/db6ba6d783e098614521b3b0e7299fcc22209a50\r\nNoice.nvim version: https://github.com/folke/noice.nvim/commit/d8a1f3056ad713b5d471048f8d029264828e22c0\r\nnvim-notify version: https://github.com/rcarriga/nvim-notify/commit/bdd647f61a05c9b8a57c83b78341a0690e9c29d7\r\nnui.nvim version: https://github.com/MunifTanjim/nui.nvim/commit/d147222a1300901656f3ebd5b95f91732785a329\r\n\r\n## Abstract\r\n\r\nUsing Neovide GUI with noice.nvim suddenly crashes occasionally. I've found that, in most cases, it's caused by Neovim emitting an Ill-formed redraw event and subsequent rpc messages are broken (see Appendix 2.) Some people report the sudden crash in the same case, and [one reported the almost same backtrace as mine](https://github.com/neovide/neovide/issues/1751#issuecomment-1435671936).\r\n\r\nThe event from `neovide_backtrace.log` with printing in [ron format](https://github.com/ron-rs/ron) at: `(File: src/bridge/handler.rs; Line: 77, Column: 25)`\r\n```ron\r\n[\r\n    \"msg_show\",\r\n    [\r\n        [],\r\n        [\r\n            true,\r\n        ],\r\n        [\r\n            \"msg_showcmd\",\r\n            [\r\n                [],\r\n            ],\r\n        ],\r\n    ],\r\n]\r\n```\r\n\r\n## The situation\r\n\r\n- Neovide call `ui_attach` with `ext_linegrid` and `rgb`.\r\n- noice.nvim call `ui_attach` with `ext_messages`, `ext_cmdline`, and `ext_popupmenu`.\r\n- noice.nvim sometimes trigger redraw while handling events.\r\n  - https://github.com/neovide/neovide/issues/1751#issuecomment-1435915499\r\n  - https://github.com/neovide/neovide/issues/1751#issuecomment-1436498838\r\n\r\n## Appendix 1.\r\n\r\nStarting Neovim with `nvim -u NONE` and running the following lua code without `--` in front of `print(\"hello\")` crashes neovim silently. This might be related to this issue. If someone tells me that this is an unexpected behavior, I'll open another issue.\r\n\r\n```lua\r\nlocal first = true\r\nlocal ns = vim.api.nvim_create_namespace \"test\"\r\nvim.ui_attach(ns, {\r\n  ext_messages = true,\r\n}, function(event, kind, content, replace_last)\r\n  if first then\r\n    -- print(\"hello\")\r\n    first = false\r\n  end\r\nend)\r\n```\r\n\r\nEdited: I noticed there is #21265\r\n\r\n## Appendix 2.\r\n\r\nTo ensure that the MessagePack and RPC implementation Neovide uses isn't doing wrong, I write the following Python script:\r\n\r\n```python\r\nimport sys\r\nimport pprint\r\nfrom pynvim import attach\r\npath = sys.argv[1]\r\nnvim = attach(\"socket\", path = path)\r\nnvim.ui_attach(1000, 1000, True, ext_linegrid = True)\r\npp = pprint.PrettyPrinter(indent=2, width=40)\r\ndef on_notify(name, args):\r\n    if name != \"redraw\":\r\n        return\r\n    str = pp.pformat(args)\r\n    if \"'msg_show'\" not in str:\r\n        return\r\n    print(str)\r\n\r\ndef on_request(name, args):\r\n    pass\r\n\r\nnvim.run_loop(on_request, on_notify)\r\n```\r\n\r\nIt prints:\r\n\r\n<details>\r\n  <summary>Click me</summary>\r\n\r\n```\r\n[ ['cmdline_hide', [1]],\r\n  [ 'msg_show',\r\n    [ 'emsg',\r\n      [[4, 'E32: No file name']],\r\n      False]],\r\n  ['mode_change', ['normal', 0]],\r\n  ['mouse_on', []],\r\n  ['flush', []]]\r\n[ [ 'win_viewport',\r\n    [ 2,\r\n      <Window(handle=1000)>,\r\n      0,\r\n      10,\r\n      1,\r\n      0,\r\n      6]],\r\n  [ 'grid_line',\r\n    [1, 2, 0, [[' ', 0]]],\r\n    [1, 3, 0, [[' ', 0]]],\r\n    [1, 5, 0, [['a', 0]]],\r\n    [1, 6, 0, [['~', 7], [' ', 7, 71]]],\r\n    [1, 7, 0, [['~', 7], [' ', 7, 71]]],\r\n    [1, 8, 0, [['~', 7], [' ', 7, 71]]],\r\n    [1, 26, 54, [['2', 9]]]],\r\n  [ 'hl_attr_define',\r\n    [ 383,\r\n      { 'background': 16711935,\r\n        'foreground': 11140968},\r\n      { 'background': 13,\r\n        'foreground': 0},\r\n      []],\r\n    [ 384,\r\n      { 'background': 16711935,\r\n        'foreground': 5203794},\r\n      { 'background': 13,\r\n        'foreground': 0},\r\n      []]],\r\n  [ 'grid_line',\r\n    [ 1,\r\n      0,\r\n      20,\r\n      [ ['╭', 65],\r\n        ['─', 65, 50],\r\n        ['╮']]],\r\n    [1, 1, 20, [['│', 65]]],\r\n    [1, 1, 71, [['│', 65]]],\r\n    [1, 2, 20, [['│', 65]]],\r\n    [1, 2, 71, [['│', 65]]],\r\n    [1, 3, 20, [['│', 65]]],\r\n    [1, 3, 71, [['│', 65]]],\r\n    [ 1,\r\n      4,\r\n      20,\r\n      [ ['╰', 65],\r\n        ['─', 65, 50],\r\n        ['╯']]],\r\n    [ 1,\r\n      1,\r\n      21,\r\n      [ [' ', 41],\r\n        ['\\uf057', 343],\r\n        [' '],\r\n        ['E'],\r\n        ['r', 343, 2],\r\n        ['o'],\r\n        ['r'],\r\n        [' ', 343, 5],\r\n        [' ', 41, 31],\r\n        ['2', 343, 2],\r\n        [':'],\r\n        ['4'],\r\n        ['3'],\r\n        [' ', 41]]],\r\n    [1, 2, 21, [['━', 342, 50]]],\r\n    [ 1,\r\n      3,\r\n      21,\r\n      [ ['E', 382],\r\n        ['3'],\r\n        ['2'],\r\n        [':'],\r\n        [' '],\r\n        ['N'],\r\n        ['o'],\r\n        [' '],\r\n        ['f'],\r\n        ['i'],\r\n        ['l'],\r\n        ['e'],\r\n        [' '],\r\n        ['n'],\r\n        ['a'],\r\n        ['m'],\r\n        ['e'],\r\n        [' ', 41, 33]]]],\r\n  [ 'msg_show',\r\n    ['', [[0, '3 fewer lines']], True]],\r\n  ['msg_showmode', [[]]],\r\n  [ 'win_viewport',\r\n    [ 2,\r\n      <Window(handle=1000)>,\r\n      0,\r\n      7,\r\n      1,\r\n      0,\r\n      6]],\r\n  [ 'grid_line',\r\n    [ 1,\r\n      5,\r\n      20,\r\n      [ ['╭', 67],\r\n        ['─', 67, 50],\r\n        ['╮']]],\r\n    [ 1,\r\n      6,\r\n      20,\r\n      [ ['│', 67],\r\n        [' ', 41],\r\n        ['\\uf05a', 383],\r\n        [' '],\r\n        ['M'],\r\n        ['e'],\r\n        ['s', 383, 2],\r\n        ['a'],\r\n        ['g'],\r\n        ['e'],\r\n        ['s'],\r\n        [' ', 41, 33],\r\n        ['2', 383, 2],\r\n        [':'],\r\n        ['4'],\r\n        ['3'],\r\n        [' ', 41],\r\n        ['│', 67]]],\r\n    [ 1,\r\n      7,\r\n      20,\r\n      [ ['│', 67],\r\n        ['━', 384, 50],\r\n        ['│', 67]]],\r\n    [ 1,\r\n      8,\r\n      20,\r\n      [ ['│', 67],\r\n        ['3', 41],\r\n        [' '],\r\n        ['f'],\r\n        ['e'],\r\n        ['w'],\r\n        ['e'],\r\n        ['r'],\r\n        [' '],\r\n        ['l'],\r\n        ['i'],\r\n        ['n'],\r\n        ['e'],\r\n        ['s'],\r\n        [' ', 41, 37],\r\n        ['│', 67]]],\r\n    [ 1,\r\n      9,\r\n      20,\r\n      [ ['╰', 67],\r\n        ['─', 67, 50],\r\n        ['╯']]]],\r\n  ['grid_cursor_goto', [1, 26, 55]],\r\n  ['flush', []]]\r\n[ [ 'msg_show',\r\n    [ [],\r\n      [True],\r\n      ['msg_showcmd', [[]]]]],\r\n  ['grid_cursor_goto', [1, 1, 0]],\r\n  ['mode_change', ['normal', 0]],\r\n  ['flush', []],\r\n  [ 2,\r\n    'redraw',\r\n    [ [ 'grid_line',\r\n        [ 1,\r\n          5,\r\n          20,\r\n          [ ['╭', 67],\r\n            ['─', 67, 50],\r\n            ['╮']]],\r\n        [1, 6, 20, [['│', 67]]],\r\n        [1, 6, 71, [['│', 67]]],\r\n        [1, 7, 20, [['│', 67]]],\r\n        [1, 7, 71, [['│', 67]]],\r\n        [1, 8, 20, [['│', 67]]],\r\n        [1, 8, 71, [['│', 67]]],\r\n        [ 1,\r\n          9,\r\n          20,\r\n          [ ['╰', 67],\r\n            ['─', 67, 50],\r\n            ['╯']]],\r\n        [ 1,\r\n          6,\r\n          21,\r\n          [ [' ', 41],\r\n            ['\\uf05a', 383],\r\n            [' '],\r\n            ['M'],\r\n            ['e'],\r\n            ['s', 383, 2],\r\n            ['a'],\r\n            ['g'],\r\n            ['e'],\r\n            ['s'],\r\n            [' ', 41, 33],\r\n            ['2', 383, 2],\r\n            [':'],\r\n            ['4'],\r\n            ['3'],\r\n            [' ', 41]]],\r\n        [1, 7, 21, [['━', 384, 50]]],\r\n        [ 1,\r\n          8,\r\n          21,\r\n          [ ['3', 41],\r\n            [' '],\r\n            ['f'],\r\n            ['e'],\r\n            ['w'],\r\n            ['e'],\r\n            ['r'],\r\n            [' '],\r\n            ['l'],\r\n            ['i'],\r\n            ['n'],\r\n            ['e'],\r\n            ['s'],\r\n            [' ', 41, 37]]],\r\n        [ 1,\r\n          0,\r\n          20,\r\n          [ ['╭', 65],\r\n            ['─', 65, 50],\r\n            ['╮']]],\r\n        [1, 1, 20, [['│', 65]]],\r\n        [1, 1, 71, [['│', 65]]],\r\n        [1, 2, 20, [['│', 65]]],\r\n        [1, 2, 71, [['│', 65]]],\r\n        [1, 3, 20, [['│', 65]]],\r\n        [1, 3, 71, [['│', 65]]],\r\n        [ 1,\r\n          4,\r\n          20,\r\n          [ ['╰', 65],\r\n            ['─', 65, 50],\r\n            ['╯']]],\r\n        [ 1,\r\n          1,\r\n          21,\r\n          [ [' ', 41],\r\n            ['\\uf057', 343],\r\n            [' '],\r\n            ['E'],\r\n            ['r', 343, 2],\r\n            ['o'],\r\n            ['r'],\r\n            [' ', 343, 5],\r\n            [' ', 41, 31],\r\n            ['2', 343, 2],\r\n            [':'],\r\n            ['4'],\r\n            ['3'],\r\n            [' ', 41]]],\r\n        [1, 2, 21, [['━', 342, 50]]],\r\n        [ 1,\r\n          3,\r\n          21,\r\n          [ ['E', 382],\r\n            ['3'],\r\n            ['2'],\r\n            [':'],\r\n            [' '],\r\n            ['N'],\r\n            ['o'],\r\n            [' '],\r\n            ['f'],\r\n            ['i'],\r\n            ['l'],\r\n            ['e'],\r\n            [' '],\r\n            ['n'],\r\n            ['a'],\r\n            ['m'],\r\n            ['e'],\r\n            [' ', 41, 33]]]],\r\n      ['msg_showmode', [[]]],\r\n      [ 'win_viewport',\r\n        [ 2,\r\n          <Window(handle=1000)>,\r\n          0,\r\n          7,\r\n          1,\r\n          0,\r\n          6]],\r\n      ['flush', []]]]]\r\n```\r\n\r\n</details>\r\n\r\n### Steps to reproduce\r\n\r\nneovide -- -u NONE\r\n:packadd nvim-notify\r\n:packadd nui.nvim\r\n:packadd noice.nvim\r\n:lua require(\"noice\").setup {}\r\n\" 1. input several lines\r\n\" 2. type 'd2k' in normal mode\r\n\" repeat 1 and 2 a few times \r\n\r\n### Expected behavior\r\n\r\nNeovim emits a well-formed redraw event.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.9.0-dev-1004+gbfe6b4944-dirty\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno\r\n\r\n### Operating system/version\r\n\r\nUbuntu 22.04.1 LTS\r\n\r\n### Terminal name/version\r\n\r\nGNOME Terminal Version 3.44.0 for GNOME 42\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nhomebrew (linuxbrew)",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "It might be also weird that Neovide receives that “msg_show” although Neovide does not subscribe “ext_messages”.",
            "created_at": "2023-02-21T02:58:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1437791621",
            "id": 1437791621,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5VsvWF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 5,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 5,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1437791621/reactions"
            },
            "updated_at": "2023-02-21T02:58:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1437791621",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8780513?v=4",
                "events_url": "https://api.github.com/users/ryo33/events{/privacy}",
                "followers_url": "https://api.github.com/users/ryo33/followers",
                "following_url": "https://api.github.com/users/ryo33/following{/other_user}",
                "gists_url": "https://api.github.com/users/ryo33/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ryo33",
                "id": 8780513,
                "login": "ryo33",
                "node_id": "MDQ6VXNlcjg3ODA1MTM=",
                "organizations_url": "https://api.github.com/users/ryo33/orgs",
                "received_events_url": "https://api.github.com/users/ryo33/received_events",
                "repos_url": "https://api.github.com/users/ryo33/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ryo33/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ryo33/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ryo33",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I did some research on this and found that in `ui_call_event` msg_show args are valid before calling lua callbacks and become corrupt after. Then `UI_CALL` is called with bad args and we see ill-formed events later. \r\n\r\nBad args vs good args:\r\n\r\n```\r\nui_call_event end: msg_show \r\n// args after lua callbacks\r\n arr[0]: 5\r\n   empty array\r\n arr[1]: 5\r\n   array @ 0x16b4fcac0\r\n   arr[0]: 1775635200\r\n arr[2]: 1\r\n array @ 0x16b4fcbe0\r\n\r\n// original args\r\n arr[0]: 4\r\n  str: confirm\r\n arr[1]: 5\r\n   array @ 0x16b4fcac0\r\n   arr[0]: 5\r\n     array @ 0x16b4fc9a0\r\n     arr[0]: 2\r\n     arr[1]: 4\r\n      str:\r\nSwap file \"~/.local/state/nvim/swap//%Users%censored%/sample.lua.swp\" already exists!\r\n[O]pen Read-Only, (E)dit anyway, (R)ecover, (D)elete it, (Q)uit, (A)bort:\r\n arr[2]: 1\r\n```\r\n\r\nHere's a diff I used:\r\n```diff\r\ndiff --git a/src/nvim/ui.c b/src/nvim/ui.c\r\nindex 45959b7b6..77501ad46 100644\r\n--- a/src/nvim/ui.c\r\n+++ b/src/nvim/ui.c\r\n@@ -656,10 +656,39 @@ void ui_grid_resize(handle_T grid_handle, int width, int height, Error *err)\r\n   }\r\n }\r\n \r\n+static void dump_array(Array args, int depth) {\r\n+  char buf[128] = {};\r\n+  for (int i = 0; i < depth; i++) {\r\n+    strcat(buf, \"  \");\r\n+  }\r\n+  if (args.size == 0) {\r\n+    printf(\"%s empty array\\n\", buf);\r\n+    return;\r\n+  }\r\n+  for(size_t i = 0; i < args.size; i++) {\r\n+    printf(\"%s arr[%d]: %d\\n\", buf, i, args.items[i].type);\r\n+    if (args.items[i].type == kObjectTypeString) {\r\n+      printf(\"%s  str: %s\\n\", buf, args.items[i].data.string);\r\n+    }\r\n+    if (args.items[i].type == kObjectTypeArray) {\r\n+      dump_array(args.items[i].data.array, depth + 1);\r\n+    }\r\n+  }\r\n+}\r\n+\r\n void ui_call_event(char *name, Array args)\r\n {\r\n   UIEventCallback *event_cb;\r\n   bool handled = false;\r\n+\r\n+  printf(\"ui_call_event start: %s\\n\", name);\r\n+\r\n+  if (strcmp(\"msg_show\", name) == 0) {\r\n+    dump_array(args, 0);\r\n+  }\r\n+\r\n+  Array orig_args = copy_array(args, NULL);\r\n+\r\n   map_foreach_value(&ui_event_cbs, event_cb, {\r\n     Error err = ERROR_INIT;\r\n     Object res = nlua_call_ref(event_cb->cb, name, args, false, &err);\r\n@@ -672,8 +701,14 @@ void ui_call_event(char *name, Array args)\r\n     api_clear_error(&err);\r\n   })\r\n \r\n+  printf(\"ui_call_event end: %s\\n\", name);\r\n+\r\n+  if (strcmp(\"msg_show\", name) == 0) {\r\n+    dump_array(args, 0);\r\n+    dump_array(orig_args, 0);\r\n+  }\r\n   if (!handled) {\r\n-    UI_CALL(true, event, ui, name, args);\r\n+    UI_CALL(true, event, ui, name, orig_args);\r\n   }\r\n \r\n   ui_log(name);\r\n```",
            "created_at": "2023-05-10T21:18:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1542822686",
            "id": 1542822686,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5b9Zse",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 5,
                "total_count": 5,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1542822686/reactions"
            },
            "updated_at": "2023-05-10T21:18:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1542822686",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/94035?v=4",
                "events_url": "https://api.github.com/users/polachok/events{/privacy}",
                "followers_url": "https://api.github.com/users/polachok/followers",
                "following_url": "https://api.github.com/users/polachok/following{/other_user}",
                "gists_url": "https://api.github.com/users/polachok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/polachok",
                "id": 94035,
                "login": "polachok",
                "node_id": "MDQ6VXNlcjk0MDM1",
                "organizations_url": "https://api.github.com/users/polachok/orgs",
                "received_events_url": "https://api.github.com/users/polachok/received_events",
                "repos_url": "https://api.github.com/users/polachok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/polachok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/polachok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/polachok",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "It seems like what happens is:\r\n\r\n1.`ui_call_event(\"msg_show\", args = { size: 3, items: 0xWHATEVER })` is called, where 0xWHATEVER is the addr of **static** `call_buf.items`\r\n2.it enters lua callbacks loop\r\n3.vim command `redraw` is called from a lua callback\r\n4.`msg_ext_flush_showmode` is called from `updatescreen` or w/e\r\n5. `ui_call_msg_showmode` reuses the same `call_buf` for its argument, so call_buf.items[0] becomes empty array\r\n7. we return to `ui_call_event(\"msg_show\", args = { size: 3, items: ...})`, where items[0] is an empty array, not a string, which was expected\r\n8. `UI_CALL` is called with wrong arguments",
            "created_at": "2023-05-11T22:09:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1544755764",
            "id": 1544755764,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5cExo0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 10,
                "total_count": 10,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1544755764/reactions"
            },
            "updated_at": "2023-05-11T22:09:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1544755764",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/94035?v=4",
                "events_url": "https://api.github.com/users/polachok/events{/privacy}",
                "followers_url": "https://api.github.com/users/polachok/followers",
                "following_url": "https://api.github.com/users/polachok/following{/other_user}",
                "gists_url": "https://api.github.com/users/polachok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/polachok",
                "id": 94035,
                "login": "polachok",
                "node_id": "MDQ6VXNlcjk0MDM1",
                "organizations_url": "https://api.github.com/users/polachok/orgs",
                "received_events_url": "https://api.github.com/users/polachok/received_events",
                "repos_url": "https://api.github.com/users/polachok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/polachok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/polachok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/polachok",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I made [a dirty hack](https://github.com/neovim/neovim/compare/release-0.9...polachok:0.9-ext-ctx?expand=1) which works around the problem for me. Not sure if it would make sense to make a PR, but if anyone is looking for a solution here, it may (or may not) work.",
            "created_at": "2023-05-21T17:52:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1556240310",
            "id": 1556240310,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5cwle2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1556240310/reactions"
            },
            "updated_at": "2023-05-21T17:52:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1556240310",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/94035?v=4",
                "events_url": "https://api.github.com/users/polachok/events{/privacy}",
                "followers_url": "https://api.github.com/users/polachok/followers",
                "following_url": "https://api.github.com/users/polachok/following{/other_user}",
                "gists_url": "https://api.github.com/users/polachok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/polachok",
                "id": 94035,
                "login": "polachok",
                "node_id": "MDQ6VXNlcjk0MDM1",
                "organizations_url": "https://api.github.com/users/polachok/orgs",
                "received_events_url": "https://api.github.com/users/polachok/received_events",
                "repos_url": "https://api.github.com/users/polachok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/polachok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/polachok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/polachok",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": ">  3.vim command redraw is called from a lua callback\r\n\r\nThis is the culprit. we need to make this strictly _verboten_ and fix the use cases that use that some other way.",
            "created_at": "2023-05-21T19:33:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1556269831",
            "id": 1556269831,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5cwssH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1556269831/reactions"
            },
            "updated_at": "2023-05-21T19:33:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1556269831",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It seems that from the `ui_attach` lua callback, I can control whether the attached GUI also receives the ext event. \r\n\r\nI'm further doing some tests, but it seems I can make it work so Neovide no longer crahses, even with `--multigrid` enabled",
            "created_at": "2023-07-17T08:55:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1637635678",
            "id": 1637635678,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5hnFZe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 4,
                "hooray": 0,
                "laugh": 0,
                "rocket": 2,
                "total_count": 6,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637635678/reactions"
            },
            "updated_at": "2023-07-17T08:56:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637635678",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/292349?v=4",
                "events_url": "https://api.github.com/users/folke/events{/privacy}",
                "followers_url": "https://api.github.com/users/folke/followers",
                "following_url": "https://api.github.com/users/folke/following{/other_user}",
                "gists_url": "https://api.github.com/users/folke/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/folke",
                "id": 292349,
                "login": "folke",
                "node_id": "MDQ6VXNlcjI5MjM0OQ==",
                "organizations_url": "https://api.github.com/users/folke/orgs",
                "received_events_url": "https://api.github.com/users/folke/received_events",
                "repos_url": "https://api.github.com/users/folke/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/folke/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/folke/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/folke",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@folke on the latest noice version, with `--multigrid` option on neovide im still getting an error:\r\n```\r\nYou're using a GUI that uses ext_multigrid. Noice can't work when the GUI has ext_multigrid enabled.\r\n```\r\ndid i mess smth up or is that expected with `multigrid`",
            "created_at": "2023-07-25T03:42:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/22344#issuecomment-1649028822",
            "id": 1649028822,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22344",
            "node_id": "IC_kwDOAPphoM5iSi7W",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1649028822/reactions"
            },
            "updated_at": "2023-07-25T03:42:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1649028822",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/99094581?v=4",
                "events_url": "https://api.github.com/users/felix-kyun/events{/privacy}",
                "followers_url": "https://api.github.com/users/felix-kyun/followers",
                "following_url": "https://api.github.com/users/felix-kyun/following{/other_user}",
                "gists_url": "https://api.github.com/users/felix-kyun/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/felix-kyun",
                "id": 99094581,
                "login": "felix-kyun",
                "node_id": "U_kgDOBegQNQ",
                "organizations_url": "https://api.github.com/users/felix-kyun/orgs",
                "received_events_url": "https://api.github.com/users/felix-kyun/received_events",
                "repos_url": "https://api.github.com/users/felix-kyun/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/felix-kyun/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/felix-kyun/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/felix-kyun",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22344/comments",
    "created_at": "2023-02-20T14:50:31Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22344/events",
    "html_url": "https://github.com/neovim/neovim/issues/22344",
    "id": 1592003450,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "libnvim, Nvim RPC API",
            "id": 103819671,
            "name": "api",
            "node_id": "MDU6TGFiZWwxMDM4MTk2NzE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/api"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 113026979,
            "name": "ui",
            "node_id": "MDU6TGFiZWwxMTMwMjY5Nzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "UI extensibility, events, protocol, externalized UI",
            "id": 640132777,
            "name": "ui-extensibility",
            "node_id": "MDU6TGFiZWw2NDAxMzI3Nzc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui-extensibility"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22344/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 726,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 630,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-07-07T03:51:31Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM5e5At6",
    "number": 22344,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 19,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 12,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 31,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22344/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22344/timeline",
    "title": "ui_attach: ill-formed redraw event with Neovide and noice.nvim",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:38:12Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22344",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8780513?v=4",
        "events_url": "https://api.github.com/users/ryo33/events{/privacy}",
        "followers_url": "https://api.github.com/users/ryo33/followers",
        "following_url": "https://api.github.com/users/ryo33/following{/other_user}",
        "gists_url": "https://api.github.com/users/ryo33/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ryo33",
        "id": 8780513,
        "login": "ryo33",
        "node_id": "MDQ6VXNlcjg3ODA1MTM=",
        "organizations_url": "https://api.github.com/users/ryo33/orgs",
        "received_events_url": "https://api.github.com/users/ryo33/received_events",
        "repos_url": "https://api.github.com/users/ryo33/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ryo33/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ryo33/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ryo33",
        "user_view_type": "public"
    }
}
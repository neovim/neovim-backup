{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\n### Describe the bug\n\nHello,\n\nThis is my first issue. I'm experiencing an issue with (i guess) a race condition. Whenever I use 'dd' to destroy a line in my buffer, specifically in a larger PHP file (Symfony 7.4 project, 200+ lines per file), it correctly destroys the line, but TreeSitter takes a hissy fit.\n\n```\nError in decoration provider \"line\" (ns=nvim.treesitter.highlighter):                                                                                                                                                                      \nError executing lua: ...nvimnIkFbK/usr/share/nvim/runtime/lua/vim/treesitter.lua:195: Index out of bounds                                                                                                                                           \nstack traceback:                                                                                                                                                                                                                                    \n        [C]: in function 'nvim_buf_get_text'                                                                                                                                                                                                        \n        ...nvimnIkFbK/usr/share/nvim/runtime/lua/vim/treesitter.lua:195: in function 'get_node_text'                                                                                                                                                \n        ...kFbK/usr/share/nvim/runtime/lua/vim/treesitter/query.lua:394: in function 'handler'                                                                                                                                                      \n        ...kFbK/usr/share/nvim/runtime/lua/vim/treesitter/query.lua:884: in function '_match_predicates'                                                                                                                                            \n        ...kFbK/usr/share/nvim/runtime/lua/vim/treesitter/query.lua:1013: in function 'iter'                                                                                                                                                        \n        ...sr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:385: in function 'fn'                                                                                                                                                           \n        ...sr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:239: in function 'for_each_highlight_state'                                                                                                                                     \n        ...sr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:358: in function 'on_line_impl'                                                                                                                                                 \n        ...sr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:457: in function <...sr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:451>\n```\n\n### Output of `:checkhealth nvim-treesitter`\n\n```markdown\n==============================================================================\nlspconfig:                                                                  ✅\n\n- `:checkhealth lspconfig` was removed. Use `:checkhealth vim.lsp` instead.\n\n==============================================================================\nnvim-treesitter:                                                            ✅\n\nRequirements ~\n- ✅ OK Neovim was compiled with tree-sitter runtime ABI version 15 (required >=13).\n- ✅ OK tree-sitter-cli 0.26.3 (/home/nikkie/.nvm/versions/node/v23.9.0/bin/tree-sitter)\n- ✅ OK tar 1.35.0 (/usr/bin/tar)\n- ✅ OK curl 8.5.0 (/usr/bin/curl)\n  curl 8.5.0 (x86_64-pc-linux-gnu) libcurl/8.5.0 OpenSSL/3.0.13 zlib/1.3 brotli/1.1.0 zstd/1.5.5 libidn2/2.3.7 libpsl/0.21.2 (+libidn2/2.3.7) libssh/0.10.6/openssl/zlib nghttp2/1.59.0 librtmp/2.3 OpenLDAP/2.6.7\n  Release-Date: 2023-12-06, security patched: 8.5.0-2ubuntu10.6\n  Protocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp\n  Features: alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd\n\nOS Info ~\n- machine: x86_64\n- release: 6.8.0-88-generic\n- version: #89-Ubuntu SMP PREEMPT_DYNAMIC Sat Oct 11 01:02:46 UTC 2025\n- sysname: Linux\n\nInstall directory for parsers and queries ~\n- /home/nikkie/.local/share/nvim/site/\n- ✅ OK is writable.\n- ✅ OK is in runtimepath.\n\nInstalled languages     H L F I J ~\n- html                  ✓ ✓ ✓ ✓ ✓\n- html_tags\n- php                   ✓ ✓ ✓ ✓ ✓\n- php_only              ✓ ✓ ✓ ✓ ✓\n\n  Legend: H[ighlights], L[ocals], F[olds], I[ndents], In[J]ections ~\n\n==============================================================================\ntelescope:                                                                1 ⚠️\n\nChecking for required plugins ~\n- ✅ OK plenary installed.\n\nChecking external dependencies ~\n- ✅ OK rg: found ripgrep 14.1.0\n- ⚠️ WARNING fd: not found. Install [sharkdp/fd](https://github.com/sharkdp/fd) for extended capabilities\n```\n\n### Output of `nvim --version`\n\n```text\nnvim --version\nNVIM v0.11.5\nBuild type: Release\nLuaJIT 2.1.1741730670\n```\n\n### Additional context\nI run a base nvim, no special flavour. My plugins are managed with Vim Plug. See my init.vim below\n```\ncall plug#begin()\n\nPlug 'nvim-lua/plenary.nvim'\nPlug 'nvim-telescope/telescope.nvim'\nPlug 'coffebar/neovim-project'\nPlug 'Shatur/neovim-session-manager'\nPlug 'preservim/nerdtree'\n\n\" Themes\nPlug 'nickkadutskyi/jb.nvim'\n\n\" LSP\nPlug 'neovim/nvim-lspconfig'\n\n\" Parser\nPlug 'nvim-treesitter/nvim-treesitter'\n\n\" UI\nPlug 'nvim-tree/nvim-web-devicons'\nPlug 'lewis6991/gitsigns.nvim'\nPlug 'romgrk/barbar.nvim'\nPlug 'akinsho/toggleterm.nvim'\n\n\" Autocompletion\nPlug 'hrsh7th/nvim-cmp'\nPlug 'hrsh7th/cmp-nvim-lsp'\nPlug 'hrsh7th/cmp-buffer'\nPlug 'hrsh7th/cmp-path'\nPlug 'hrsh7th/cmp-cmdline'\n\n\" Coding\n\" Plug 'nvim-mini/mini.pairs'\n\ncall plug#end()\n\ncolor jb\nset number\nset cursorline\nset shiftwidth=4\nset tabstop=4\nset guifont=Comic\\ Mono:h16\nlet g:did_indent_php = 1\nset autoindent\nlet mapleader = \" \"\n\nlua << EOF\nvim.diagnostic.config({\n    virtual_text = true,\n    signs = true,\n    underline = true,\n    update_in_insert = false,\n    severity_sort = true,\n})\n\nlocal telescope = require('telescope.builtin')\nvim.keymap.set('n', '<leader>ff', telescope.find_files)\nvim.keymap.set('n', '<leader>fg', telescope.live_grep)\nvim.keymap.set('n', '<leader>fb', telescope.buffers)\nvim.keymap.set('n', '<leader>fh', telescope.help_tags)\n\nvim.opt.sessionoptions:append('globals')\n\nrequire('neovim-project').setup {\n    projects = { \"~/projects/*\" },\n    picker = { type = \"telescope\" }\n}\n\nvim.keymap.set('n', '<leader>p', '<cmd>NeovimProjectDiscover<CR>')\n\n-- NERDTree\nvim.keymap.set('n', '<leader>tt', '<cmd>NERDTreeToggle<CR>')\nvim.keymap.set('n', '<leader>tr', '<cmd>NERDTree<CR>')\n\n-- CMP\nlocal cmp = require('cmp')\ncmp.setup({\n    mapping = {\n        ['<C-space>'] = cmp.mapping.complete(),\n        ['<CR>'] = cmp.mapping.confirm({ select = true }),\n        ['<Tab>'] = cmp.mapping.select_next_item(),\n        ['<S-Tab>'] = cmp.mapping.select_prev_item(),\n    },\n    sources = {\n        { name = 'nvim_lsp' },\n        { name = 'buffer' },\n        { name = 'path' }\n    }\n})\n\n-- LSP\nvim.lsp.config(\"intelephense\", {\n    cmd = { \"intelephense\", \"--stdio\" },\n    filetypes = { \"php\", \"twig\" },\n    settings = {\n        intelephense = {\n            diagnostics = { undefinedFunctions = false },\n            files = { maxSize = 5000000 },\n            environment = { includePaths = { vim.fn.getcwd() .. \"/vendor\" }, phpVersion = \"8.4.15\" },\n            stubs = { \"Core\", \"PDO\", \"Symfony\" },\n        },\n    },\n})\n\nvim.lsp.enable(\"intelephense\")\n\n-- Coding pairs\n-- require('mini.pairs').setup()\n\n-- Treesitter\nvim.api.nvim_create_autocmd('FileType', {\n    pattern = {'html', 'twig', 'css', 'php'},\n    callback = function()\n        vim.treesitter.start()\n    end,\n})\n\nrequire('nvim-treesitter').setup({ pattern = { 'html', 'twig', 'css', 'php' } })\n\n-- UI plugins\nrequire('barbar').setup({\n    insert_at_end = true,\n    insert_at_start = false,\n})\n\nrequire('toggleterm').setup({\n    persist_mode = true,\n    direction = 'float',\n    float_opts = { border = 'double', title_pos = 'center' }\n})\n\n-- General maps\n-- Indentation\nvim.keymap.set('i', '<S-Tab>', '<C-O><<')\n\n-- Buffers\nvim.keymap.set('n', '1', '<Cmd>BufferGoto 1<CR>')\nvim.keymap.set('n', '2', '<Cmd>BufferGoto 2<CR>')\nvim.keymap.set('n', '3', '<Cmd>BufferGoto 3<CR>')\nvim.keymap.set('n', '4', '<Cmd>BufferGoto 4<CR>')\nvim.keymap.set('n', '5', '<Cmd>BufferGoto 5<CR>')\nvim.keymap.set('n', '<S-A-l>', '<Cmd>BufferMoveNext<CR>')\nvim.keymap.set('n', '<S-A-h>', '<Cmd>BufferMovePrevious<CR>')\nvim.keymap.set('n', '<A-l>', '<Cmd>BufferNext<CR>')\nvim.keymap.set('n', '<A-h>', '<Cmd>BufferPrevious<CR>')\nvim.keymap.set('n', '<A-q>', '<Cmd>BufferClose<CR>')\n\n-- Terminal\nvim.keymap.set('n', '<A-t>', '<Cmd>ToggleTerm<CR>')\nvim.keymap.set('t', '<A-t>', '<Cmd>ToggleTerm<CR>')\n\nvim.api.nvim_create_autocmd({\"BufEnter\", \"FileType\", \"InsertEnter\"}, {\n    pattern = \"php\",\n    callback = function()\n        vim.opt_local.autoindent = true\n        vim.opt_local.smartindent = true\n    end\n})\nEOF\n```\n\n### Steps to reproduce\n\n1. Install nvim-treesitter\n2. run TSInstall php php_only\n3. Open a php file with 200+ lines (more than 500 preferably)\n4. destroy the current line using 'dd'\n\n### Expected behavior\n\nWell, I'd love to just see my line get deleted and for the process to continue as usual. \n\n\n### Nvim version (nvim -v)\n\n0.11.5\n\n### Vim (not Nvim) behaves the same?\n\nNo, VIM 9.1.697\n\n### Operating system/version\n\nLinux Mint 22.1 x86-64\n\n### Terminal name/version\n\ngnome-terminal\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nappimage",
    "closed_at": "2025-12-25T08:06:10Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "This is `master` (not `main`) branch, right? I used to have this issue constantly, with many parsers. These issues are fixed per parser. That's why your <https://github.com/nvim-treesitter/nvim-treesitter/issues/8372> was closed with \"Upstream issue\".\n\nI think the best bet is to switch to the `main` branch of `nvim-treesitter` (the one that will receive future updates, and which is now the default one); then to make sure you update parsers from time to time (with `:TSUpdate` on startup or manually).\n\nSince (based on previous similar issues) the most likely explanation is that the parser crashes, not that `vim.treesitter` suddenly mishandles ranges, if the issue is persistent, locate who maintains the PHP parser and try there.\n\n---\n\nOf course this comment is off-topic. It's better if we don't know if the person ever updates their parsers, even though all previous issues with the same error message were fixed per parser. Let the author continue going from repo to repo opening identical bug reports that are closed with no actual help. Fuck my drag...",
            "created_at": "2025-12-24T16:46:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/37091#issuecomment-3690229880",
            "id": 3690229880,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37091",
            "node_id": "IC_kwDOAPphoM7b9HB4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3690229880/reactions"
            },
            "updated_at": "2025-12-25T14:08:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3690229880",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/58133782?v=4",
                "events_url": "https://api.github.com/users/shushtain/events{/privacy}",
                "followers_url": "https://api.github.com/users/shushtain/followers",
                "following_url": "https://api.github.com/users/shushtain/following{/other_user}",
                "gists_url": "https://api.github.com/users/shushtain/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shushtain",
                "id": 58133782,
                "login": "shushtain",
                "node_id": "MDQ6VXNlcjU4MTMzNzgy",
                "organizations_url": "https://api.github.com/users/shushtain/orgs",
                "received_events_url": "https://api.github.com/users/shushtain/received_events",
                "repos_url": "https://api.github.com/users/shushtain/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shushtain/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shushtain/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shushtain",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Please test the latest development version. The [Releases](https://github.com/neovim/neovim/releases/tag/nightly) page has pre-built archives for Linux/Windows/macOS. Check `:version` to confirm the version.",
            "created_at": "2025-12-25T08:06:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/37091#issuecomment-3691111818",
            "id": 3691111818,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37091",
            "node_id": "IC_kwDOAPphoM7cAeWK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691111818/reactions"
            },
            "updated_at": "2025-12-25T08:06:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3691111818",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37091/comments",
    "created_at": "2025-12-24T13:07:49Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37091/events",
    "html_url": "https://github.com/neovim/neovim/issues/37091",
    "id": 3760294588,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37091/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7gIYq8",
    "number": 37091,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37091/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37091/timeline",
    "title": "Highlighter taking a hissy fit",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-12-25T14:08:59Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37091",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/80163087?v=4",
        "events_url": "https://api.github.com/users/NikkieDev/events{/privacy}",
        "followers_url": "https://api.github.com/users/NikkieDev/followers",
        "following_url": "https://api.github.com/users/NikkieDev/following{/other_user}",
        "gists_url": "https://api.github.com/users/NikkieDev/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/NikkieDev",
        "id": 80163087,
        "login": "NikkieDev",
        "node_id": "MDQ6VXNlcjgwMTYzMDg3",
        "organizations_url": "https://api.github.com/users/NikkieDev/orgs",
        "received_events_url": "https://api.github.com/users/NikkieDev/received_events",
        "repos_url": "https://api.github.com/users/NikkieDev/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/NikkieDev/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/NikkieDev/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/NikkieDev",
        "user_view_type": "public"
    }
}
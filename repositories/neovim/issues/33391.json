{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nrust-analyzer inlay hint enabled with `vim.lsp.inlay_hint.enable(true)\n` by not showing at buffer open. But if toggle it with `:lua vim.lsp.inlay_hint.enable(true)` later, it will work.\n\nI currently use `defer_fn` in `on_attach`to make it enabled by 2500ms in order to make the inlay hint show up on buffer open. (config is [here](https://github.com/levihuayuzhang/dotfiles/blob/161a5c4242bd70779c1effbabc5e6dafd3dec92e/nvim/.config/nvim/lua/plugins/lspconfig.lua#L14))\n\nWondering what is the best practice to use `vim.lsp.inlay_hint.enable()` or related staff to make rust-analyzer inlay hint showup on buffer open (without delay) after `nvim 0.10+`?\n\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\n\nopen a rust project with rust-analyzer enabled.\n\n### Expected behavior\n\nThe inlay hint should showup with other info generated from rust-analyzer.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.0\n\n### Language server name/version\n\nrust-analyzer 0.3.2370-standalone (588948f267 2025-04-06)\n\n### Operating system/version\n\nMac aarch64 Newest Stable\n\n### Log file\n\n_No response_\n\nServer side issue report is [here](https://github.com/rust-lang/rust-analyzer/issues/19548).",
    "closed_at": "2025-04-11T10:48:20Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Yeah, [I have a similar hack in my config](https://github.com/MariaSolOs/dotfiles/blob/814421cb50330ed71122f7c08aa53a47be5774dc/.config/nvim/lua/lsp.lua#L94-L97)...\n\nThis does look like a server problem. https://github.com/rust-lang/rust-analyzer/issues/5349 reports the same problem happening in other editors, and it seems like it got \"fixed\" with https://github.com/rust-lang/rust-analyzer/commit/b1cb4ac13d5b625dd497692b6396287a30ff12e2, which adds a retry logic.",
            "created_at": "2025-04-09T03:23:02Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2788183428",
            "id": 2788183428,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mME2E",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2788183428/reactions"
            },
            "updated_at": "2025-04-09T03:23:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2788183428",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Yeah, maybe for now just use key shortcut to [toggle](https://github.com/rust-lang/rust-analyzer/issues/5680#issuecomment-670935563) [it](https://github.com/MariaSolOs/dotfiles/blob/814421cb50330ed71122f7c08aa53a47be5774dc/.config/nvim/lua/lsp.lua#L7).",
            "created_at": "2025-04-09T06:37:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2788469087",
            "id": 2788469087,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mNKlf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2788469087/reactions"
            },
            "updated_at": "2025-04-09T06:44:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2788469087",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Related \"lifecycle/refresh\" issue: https://github.com/neovim/neovim/issues/32247",
            "created_at": "2025-04-09T10:47:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2789244762",
            "id": 2789244762,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mQH9a",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2789244762/reactions"
            },
            "updated_at": "2025-04-09T10:48:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2789244762",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "[rustaceanvim](https://github.com/mrcjkb/rustaceanvim) handled this by `toggle on and off` (so it can redraw the hints).\n\n1. https://github.com/mrcjkb/rustaceanvim/blob/3f327d15a3c1ed48b1e1087e16873a28a39768c2/lua/rustaceanvim/server_status.lua#L46\n2. https://github.com/neovim/nvim-lspconfig/pull/2658#issue-1745932712\n3. https://github.com/neovim/neovim/issues/26511#issuecomment-1884339225\n4. https://github.com/rust-lang/rust-analyzer/issues/14258#issue-1610463004\n5. https://github.com/microsoft/language-server-protocol/issues/1764#issue-1795229070",
            "created_at": "2025-04-10T23:23:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2795382037",
            "id": 2795382037,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mniUV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2795382037/reactions"
            },
            "updated_at": "2025-04-10T23:24:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2795382037",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@levihuayuzhang are you suggesting that Nvim performs a toggle-on-and-off to \"force\" refresh on buffer open?",
            "created_at": "2025-04-11T09:50:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2796405913",
            "id": 2796405913,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mrcSZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796405913/reactions"
            },
            "updated_at": "2025-04-11T09:50:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796405913",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I tried to reproduce this bug with the minimal config, but I was unsuccessful. Is this issue still present in 0.11? Or does `vim.lsp.inlay_hint.enable` need to be conditionally executed, for example, with autocmd?\n\nI think that 0.10 does have this issue, but I should have fixed it in https://github.com/neovim/neovim/pull/32446.\n\nTL;DR, rust-analyzer sends a `workspace/inlayHint/refresh` request when it is \"ready\" to return valid results, and we previously did not handle this request correctly; this PR should fix it.",
            "created_at": "2025-04-11T09:52:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2796411525",
            "id": 2796411525,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mrdqF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 1,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796411525/reactions"
            },
            "updated_at": "2025-04-11T09:52:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796411525",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> @levihuayuzhang are you suggesting that Nvim performs a toggle-on-and-off to \"force\" refresh on buffer open?\n\nYes, I guess that's what link 1 does - which is a workaround. I didn't find other language server e.g. clangd have this kind of issue, inlay hints works fine with them at buffer open. RA have same issue on vscode and helix on my side for now. The nvim plugin 'rustaceanvim' just handled it properly. So it would be good if nvim could add this as workaround for now.",
            "created_at": "2025-04-11T10:02:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2796448197",
            "id": 2796448197,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mrmnF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796448197/reactions"
            },
            "updated_at": "2025-04-11T10:04:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796448197",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> RA have same issue on vscode and helix on my side for now.\n\nSounds like this is isolated to rust-analyzer? If this is not widespread to other LSes, we likely don't want to build in a workaround.",
            "created_at": "2025-04-11T10:11:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2796471279",
            "id": 2796471279,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mrsPv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796471279/reactions"
            },
            "updated_at": "2025-04-11T10:11:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796471279",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk We can easily expose such an API, as that is what the `workspace/inlayHint/refresh` handler does. IMHO, an API like that may be masking bugs, especially server bugs, so I think it's better not to. According to LSP, if necessary, the server can request a refresh through `workspace/inlayHint/refresh`.\n\nI just confirmed that this bug could be consistently reproduced before https://github.com/neovim/neovim/pull/32446, but the 0.11 version that includes this patch does not.",
            "created_at": "2025-04-11T10:41:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2796541735",
            "id": 2796541735,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6mr9cn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796541735/reactions"
            },
            "updated_at": "2025-04-11T15:26:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2796541735",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I tried to reproduce this bug with the minimal config, but I was unsuccessful. Is this issue still present in 0.11? Or does `vim.lsp.inlay_hint.enable` need to be conditionally executed, for example, with autocmd?\n> \n> I think that 0.10 does have this issue, but I should have fixed it in [#32446](https://github.com/neovim/neovim/pull/32446).\n> \n> TL;DR, rust-analyzer sends a `workspace/inlayHint/refresh` request when it is \"ready\" to return valid results, and we previously did not handle this request correctly; this PR should fix it.\n\nI am using the `0.11` version installed from homebrew(Mac aarch64). \nhttps://github.com/neovim/nvim-lspconfig/issues/3701#issuecomment-2788374401 says this is related to the init time.\nBut the https://github.com/neovim/neovim/pull/32446 should already fixed it.\n\nWondering the minimal config looks like (using `nvim-lspconfig` with `rust-analyzer`)?",
            "created_at": "2025-04-13T07:18:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2799837258",
            "id": 2799837258,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6m4iBK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799837258/reactions"
            },
            "updated_at": "2025-04-13T09:17:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799837258",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Wondering the minimal config looks like (using `nvim-lspconfig` with `rust-analyzer`)?\n\n`h vim.lsp.config()`, `nvim-lspconfig` is unnecessary; it is merely a collection of pre-defined configurations after 0.11.\n\nAccording to your description above, that vscode and helix have the same problem, I guess it should be rust-analyzer's bug.\n\nHowever, if rust-analyzer heavily relies on `workspace/inlayHint/refresh` to correct previous invalid results, maybe nvim does have some vulnerability regarding it, but currently, there is insufficient evidence to suggest that this is the case.  I'm planning to refactor the handler for the request later, maybe that will be helpful.",
            "created_at": "2025-04-13T09:46:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2799883653",
            "id": 2799883653,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6m4tWF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799883653/reactions"
            },
            "updated_at": "2025-04-13T09:46:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799883653",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61115159?v=4",
                "events_url": "https://api.github.com/users/ofseed/events{/privacy}",
                "followers_url": "https://api.github.com/users/ofseed/followers",
                "following_url": "https://api.github.com/users/ofseed/following{/other_user}",
                "gists_url": "https://api.github.com/users/ofseed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ofseed",
                "id": 61115159,
                "login": "ofseed",
                "node_id": "MDQ6VXNlcjYxMTE1MTU5",
                "organizations_url": "https://api.github.com/users/ofseed/orgs",
                "received_events_url": "https://api.github.com/users/ofseed/received_events",
                "repos_url": "https://api.github.com/users/ofseed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ofseed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ofseed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ofseed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "\n> > Wondering the minimal config looks like (using `nvim-lspconfig` with `rust-analyzer`)?\n> \n> `h vim.lsp.config()`, `nvim-lspconfig` is unnecessary; it is merely a collection of pre-defined configurations after 0.11.\n> \n> According to your description above, that vscode and helix have the same problem, I guess it should be rust-analyzer's bug.\n> \n> However, if rust-analyzer heavily relies on `workspace/inlayHint/refresh` to correct previous invalid results, maybe nvim does have some vulnerability regarding it, but currently, there is insufficient evidence to suggest that this is the case. I'm planning to refactor the handler for the request later, maybe that will be helpful.\n\nThanks for your information. It's really great that `nvim 0.11` ships with the lsp configuration APIs. (I just discovered it according to [this](https://lsp-zero.netlify.app/blog/lsp-config-overview.html) and the [doc](https://neovim.io/doc/user/lsp.html#lsp-config).🎉)\n\nI did following \"minimal manual config\" for `nvim 0.11` in my `init.lua`:\n\n```lua\nvim.lsp.config['rust_analyzer'] = {\n    cmd = { 'rust-analyzer' },\n    filetypes = { 'rust' },\n    root_markers = { 'Cargo.toml' },\n}\nvim.lsp.enable 'rust_analyzer'\n```\nBut the problem seems still there. (Am I doing it right? Any suggestions?)\n\n(btw, the plugin [rustaceanvim](https://github.com/mrcjkb/rustaceanvim) (version 6) seems not based on `nvim-lspconfig` anymore and it does require `nvim 0.11`. And it seems handle this problem well. I will looking it it to find how this plugin handle this issue.)",
            "created_at": "2025-04-13T10:21:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2799894501",
            "id": 2799894501,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6m4v_l",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799894501/reactions"
            },
            "updated_at": "2025-04-13T11:14:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799894501",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "These should the fix for now if doing a config by using `nvim-lspconfig` for `nvim 0.11` (to make `inlay hints` for `rust-analyzer` at buffer open):\n```lua\n                   capabilities = {\n                        experimental = {\n                            serverStatusNotification = true,\n                        },\n                    },\n                    handlers = {\n                        ['experimental/serverStatus'] = function(\n                            _,\n                            result,\n                            ctx\n                        )\n                            if\n                                result.quiescent\n                                and not _ran_once[ctx.client_id]\n                            then\n                                for _, bufnr in\n                                    ipairs(\n                                        vim.lsp.get_buffers_by_client_id(\n                                            ctx.client_id\n                                        )\n                                    )\n                                do\n                                    if\n                                        vim.lsp.inlay_hint.is_enabled {\n                                            bufnr = bufnr,\n                                        }\n                                    then\n                                        vim.lsp.inlay_hint.enable(\n                                            false,\n                                            { bufnr = bufnr }\n                                        )\n                                        vim.lsp.inlay_hint.enable(\n                                            true,\n                                            { bufnr = bufnr }\n                                        )\n                                    end\n                                end\n                                _ran_once[ctx.client_id] = true\n                            end\n                        end,\n                    },\n```\n(sorry for the indents) (`_ran_once`should be a local variable declared before)\n\n~~It seems this method may have some over head, which also discouraged by [rust-analyzer](https://rust-analyzer.github.io/book/contributing/lsp-extensions.html?highlight=serverstatus#server-status).~~ The `rust-analyzer` has [status notify](https://github.com/neovim/neovim/issues/26511#issuecomment-1890954070), which can be relied on to do the redraw.\n\nI think it's better to leave `inlay hints` diabled by default and manually triggered by shortcut when needed (vscode now provide shortcut for [peeking](https://code.visualstudio.com/updates/v1_67#_toggle-inlay-hints) the inlay hints).\n\nRef:\n1. https://rust-analyzer.github.io/book/contributing/lsp-extensions.html?highlight=server-status#server-status\n2. https://github.com/neovim/nvim-lspconfig/pull/2658/commits/f1598e865ba9625298a2647ed91f2ccdee867f46\n3. https://github.com/neovim/nvim-lspconfig/pull/2658\n4. https://www.reddit.com/r/neovim/comments/1eyckqj/starting_with_inlay_hints_on_in_rust/\n5. https://github.com/neovim/neovim/issues/26511#issuecomment-1884339225\n6. https://neovim.io/doc/user/lsp.html#lsp-handler",
            "created_at": "2025-04-13T13:49:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2799960824",
            "id": 2799960824,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6m5AL4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799960824/reactions"
            },
            "updated_at": "2025-04-13T13:49:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2799960824",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> These should the fix for now if doing a config by using `nvim-lspconfig` for `nvim 0.11` (to make `inlay hints` for `rust-analyzer` at buffer open):\n> ...\n\nAnother way to configure (rust-analyzer nvim-lspconfig), based on the [lsp_status](https://github.com/nvim-lualine/lualine.nvim/blob/master/lua/lualine/components/lsp_status.lua) component of [lualine](https://github.com/nvim-lualine/lualine.nvim/):\n```lua\n-- use auto_cmd to enable inlay hints at buffer open\n                    on_attach = function(_, bufnr)\n                        pcall(vim.api.nvim_create_autocmd, 'LspProgress', {\n                            callback = function(event)\n                                local kind = event.data.params.value.kind\n                                local client_id = event.data.client_id\n                                local work = lsp_work_by_client_id[client_id] or 0\n                                local work_change = kind == 'begin' and 1\n                                    or (kind == 'end' and -1 or 0)\n                                lsp_work_by_client_id[client_id] = math.max(work + work_change, 0)\n\n                                if\n                                    vim.lsp.inlay_hint.is_enabled {\n                                        bufnr = bufnr,\n                                    }\n                                    and lsp_work_by_client_id[client_id] == 0\n                                then\n                                    vim.lsp.inlay_hint.enable(false, { bufnr = bufnr })\n                                    vim.lsp.inlay_hint.enable(true, { bufnr = bufnr })\n                                    time = time + 1\n                                    print(string.format('inlay hints redrew %d times', time))\n                                end\n                            end,\n                        })\n                    end,\n```\nIt's using the `LspProgress` event to define when to redraw.",
            "created_at": "2025-04-14T07:12:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/33391#issuecomment-2800687506",
            "id": 2800687506,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33391",
            "node_id": "IC_kwDOAPphoM6m7xmS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2800687506/reactions"
            },
            "updated_at": "2025-04-14T11:16:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2800687506",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
                "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
                "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
                "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
                "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/levihuayuzhang",
                "id": 68364307,
                "login": "levihuayuzhang",
                "node_id": "MDQ6VXNlcjY4MzY0MzA3",
                "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
                "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
                "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/levihuayuzhang",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 14,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/33391/comments",
    "created_at": "2025-04-08T19:22:42Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/33391/events",
    "html_url": "https://github.com/neovim/neovim/issues/33391",
    "id": 2980747615,
    "labels": [
        {
            "color": "FEF2C0",
            "default": false,
            "description": "Needs a third-party / external change or fix",
            "id": 101945532,
            "name": "status:blocked-external",
            "node_id": "MDU6TGFiZWwxMDE5NDU1MzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/status:blocked-external"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/33391/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 272,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 322,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-04-14T11:08:54Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM6xqplf",
    "number": 33391,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/33391/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/33391/timeline",
    "title": "LSP: rust-analyzer inlay hint enabled but not showing at buffer open",
    "type": {
        "color": "yellow",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A specific piece of work",
        "id": 597161,
        "is_enabled": true,
        "name": "Task",
        "node_id": "IT_kwDOAGK_Pc4ACRyp",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-04-14T11:16:47Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/33391",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/68364307?v=4",
        "events_url": "https://api.github.com/users/levihuayuzhang/events{/privacy}",
        "followers_url": "https://api.github.com/users/levihuayuzhang/followers",
        "following_url": "https://api.github.com/users/levihuayuzhang/following{/other_user}",
        "gists_url": "https://api.github.com/users/levihuayuzhang/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/levihuayuzhang",
        "id": 68364307,
        "login": "levihuayuzhang",
        "node_id": "MDQ6VXNlcjY4MzY0MzA3",
        "organizations_url": "https://api.github.com/users/levihuayuzhang/orgs",
        "received_events_url": "https://api.github.com/users/levihuayuzhang/received_events",
        "repos_url": "https://api.github.com/users/levihuayuzhang/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/levihuayuzhang/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/levihuayuzhang/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/levihuayuzhang",
        "user_view_type": "public"
    }
}
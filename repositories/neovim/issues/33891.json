{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhen using the new '_extui' capability of NeoVim and 'box' mode, lines that are displayed as a result of lua `print()` statements are overlaid on top of buffer text. If the messages overlap the buffer text (for example if the buffer line is very long on precisely the screen line where the message is to be displayed) then the buffer 'shows through' where the whitespace in the message is, making it very hard to read.\n\nThis happens with the default NeoVim settings including colorscheme etc.\n\n### Steps to reproduce\n\n* Ensure terminal is less than 200 characters wide\n* Run `nvim --clean -u minimal.lua` (using the minimal.lua below)\n* Observe that the buffer (which is randomly generated, with very long lines) 'shows through' into the output of the `print()` statement in the bottom right-hand corner.\n\nminimal.lua:\n\n```lua\n-- TURN ON EXTUI USING 'box' MODE\nrequire(\"vim._extui\").enable({\n    msg = {\n        pos = \"box\",\n        box = { timeout = 10000 },\n    },\n})\n\n-- CREATE A BUFFER WITH RANDOM CONTENTS, WITH VERY LONG LINES, AND TURN OFF WRAPPING\nlocal w = {}\nfor l in io.open(\"/usr/share/dict/words\"):lines() do\n    table.insert(w, l)\nend\nvim.cmd(\"enew\")\nlocal b = vim.api.nvim_get_current_buf()\nlocal f = function()\n    local l = \"\"\n    while #l < 200 do\n        local x = w[math.random(#w)]\n        if #l + #x + 1 > 200 then\n            break\n        end\n        l = l .. x .. \" \"\n    end\n    return l\nend\nlocal L = {}\nfor _ = 1, 200 do\n    table.insert(L, f())\nend\nvim.api.nvim_buf_set_lines(b, 0, -1, false, L)\nvim.o.wrap = false\n\n-- PRINT OUT A MESSAGE WHICH WILL OVERLAP THE BUFFER\nprint(\n    \"This is a test of a very long line which will probably not display clearly\"\n)\n```\n\n### Expected behavior\n\nThe message display should be 'on top' of the buffer completely, so the buffer does not show through the message - perhaps even with some left padding to the message so it looks 'clean' on top of the buffer.\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-320+g8d75910ef9\n\n### Vim (not Nvim) behaves the same?\n\nNo, vim doesn't have this feature\n\n### Operating system/version\n\nArch\n\n### Terminal name/version\n\nKitty\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nbob nightly install",
    "closed_at": "2025-05-09T12:47:38Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
        "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
        "followers_url": "https://api.github.com/users/luukvbaal/followers",
        "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
        "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/luukvbaal",
        "id": 31730729,
        "login": "luukvbaal",
        "node_id": "MDQ6VXNlcjMxNzMwNzI5",
        "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
        "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
        "repos_url": "https://api.github.com/users/luukvbaal/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/luukvbaal",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Attached is a screenshot showing what the message looks like when using the recreation instructions above, to be completely clear on the problem I'm describing:\n\n![Image](https://github.com/user-attachments/assets/997222b8-c3ca-4038-b9f8-86b125b19c78)",
            "created_at": "2025-05-07T15:56:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/33891#issuecomment-2859145467",
            "id": 2859145467,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33891",
            "node_id": "IC_kwDOAPphoM6qaxj7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2859145467/reactions"
            },
            "updated_at": "2025-05-07T15:56:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2859145467",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/107015?v=4",
                "events_url": "https://api.github.com/users/andrewferrier/events{/privacy}",
                "followers_url": "https://api.github.com/users/andrewferrier/followers",
                "following_url": "https://api.github.com/users/andrewferrier/following{/other_user}",
                "gists_url": "https://api.github.com/users/andrewferrier/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andrewferrier",
                "id": 107015,
                "login": "andrewferrier",
                "node_id": "MDQ6VXNlcjEwNzAxNQ==",
                "organizations_url": "https://api.github.com/users/andrewferrier/orgs",
                "received_events_url": "https://api.github.com/users/andrewferrier/received_events",
                "repos_url": "https://api.github.com/users/andrewferrier/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andrewferrier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andrewferrier/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andrewferrier",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks, this fix seems to work well!",
            "created_at": "2025-05-10T15:14:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/33891#issuecomment-2868958882",
            "id": 2868958882,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/33891",
            "node_id": "IC_kwDOAPphoM6rANai",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2868958882/reactions"
            },
            "updated_at": "2025-05-10T15:14:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2868958882",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/107015?v=4",
                "events_url": "https://api.github.com/users/andrewferrier/events{/privacy}",
                "followers_url": "https://api.github.com/users/andrewferrier/followers",
                "following_url": "https://api.github.com/users/andrewferrier/following{/other_user}",
                "gists_url": "https://api.github.com/users/andrewferrier/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andrewferrier",
                "id": 107015,
                "login": "andrewferrier",
                "node_id": "MDQ6VXNlcjEwNzAxNQ==",
                "organizations_url": "https://api.github.com/users/andrewferrier/orgs",
                "received_events_url": "https://api.github.com/users/andrewferrier/received_events",
                "repos_url": "https://api.github.com/users/andrewferrier/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andrewferrier/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andrewferrier/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andrewferrier",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/33891/comments",
    "created_at": "2025-05-07T15:51:53Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/33891/events",
    "html_url": "https://github.com/neovim/neovim/issues/33891",
    "id": 3046453720,
    "labels": [],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/33891/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM61lTHY",
    "number": 33891,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/33891/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/33891/timeline",
    "title": "vim._extui 'box' messages are hard to read when they overlap buffer content",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-05-10T15:14:47Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/33891",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/107015?v=4",
        "events_url": "https://api.github.com/users/andrewferrier/events{/privacy}",
        "followers_url": "https://api.github.com/users/andrewferrier/followers",
        "following_url": "https://api.github.com/users/andrewferrier/following{/other_user}",
        "gists_url": "https://api.github.com/users/andrewferrier/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/andrewferrier",
        "id": 107015,
        "login": "andrewferrier",
        "node_id": "MDQ6VXNlcjEwNzAxNQ==",
        "organizations_url": "https://api.github.com/users/andrewferrier/orgs",
        "received_events_url": "https://api.github.com/users/andrewferrier/received_events",
        "repos_url": "https://api.github.com/users/andrewferrier/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/andrewferrier/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andrewferrier/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/andrewferrier",
        "user_view_type": "public"
    }
}
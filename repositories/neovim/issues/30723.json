{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nWhen completing via `complete()`, and then using backspace, it will close the pum. This is not consistent with how it works for omnifunc. It also seems like this is something that has been discussed previously (see: https://github.com/neovim/neovim/pull/27339#discussion_r1583574488)\n\nI am opening this issue as I couldn't find a specific issue for this (sorry if there is one and I just couldn't find this).\n\nI spent some time now to see if I could figure out why and where this is happening, and I seem to have found a patch that could potentially fix this. I don't really know yet if this would break other things, and also why this was added as a guard in the first place.\n\n```diff\ndiff --git a/src/nvim/insexpand.c b/src/nvim/insexpand.c\nindex 84dd55fa7..bd83b376c 100644\n--- a/src/nvim/insexpand.c\n+++ b/src/nvim/insexpand.c\n@@ -1759,7 +1759,6 @@ int ins_compl_bs(void)\n   // Respect the 'backspace' option.\n   if ((int)(p - line) - (int)compl_col < 0\n       || ((int)(p - line) - (int)compl_col == 0 && !ctrl_x_mode_omni())\n-      || ctrl_x_mode_eval()\n       || (!can_bs(BS_START) && (int)(p - line) - (int)compl_col\n           - compl_length < 0)) {\n     return K_BS;\n```\n\nI could possibly be interested in trying to tackle this problem if it is wanted, and if so I am also going to try and upstream the solution to vim of course\n\nSo I guess my question is; is this an acceptable solution? If not, any pointers on where to start?\n\n### Expected behavior\n\nI expect it to still show the pum after backspace when using `complete()` just like how it works for omnifunc.\n\nBefore the patch:\nhttps://github.com/user-attachments/assets/0b1c8e8f-6e03-476d-aea6-997fd9ef5a8a\n\nAfter the patch:\nhttps://github.com/user-attachments/assets/55af39ae-9b25-4ddd-ab7a-bc3b6e173562\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "That check was added in https://github.com/neovim/neovim/commit/64a4ef679ab55875e0c68de5f018790a488a237d\n\nCuriously, `i_CTRL-N` already works like you want, so it would seem reasonable to have `complete()` match that behavior.\n\n> interested in trying to tackle this problem if it is wanted, and if so I am also going to try and upstream the solution to vim of course\n\nAsking at vim/vim will help, since there are more people there that might have insight.",
            "created_at": "2024-10-08T19:58:23Z",
            "html_url": "https://github.com/neovim/neovim/issues/30723#issuecomment-2400710902",
            "id": 2400710902,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30723",
            "node_id": "IC_kwDOAPphoM6PF_D2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400710902/reactions"
            },
            "updated_at": "2024-10-08T19:59:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400710902",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Bumped into this recently too. Looking at other completion plugins, they seem to handle  `<BS>`  in the provided omnifunc by returning a list of matches and delegating the handling to existing implementation. Examples: [mini.completion](https://github.com/echasnovski/mini.completion/blob/main/lua/mini/completion.lua#L477), [ale](https://github.com/dense-analysis/ale/blob/22185c4c5c8b8ff52c701020c309a4cefc3a04fa/autoload/ale/completion.vim#L953) or the built in [vim.lua_omnifunc](https://github.com/neovim/neovim/blob/2d11b981bfbb7816d88a69b43b758f3a3f515b96/runtime/lua/vim/_editor.lua#L1174).\nShouldn't the built in `vim.lsp.omnifunc` also return a list of lsp completions to have `<BS>` handled automatically, instead of requiring a modification in C code?",
            "created_at": "2025-04-08T18:43:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/30723#issuecomment-2787367023",
            "id": 2787367023,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30723",
            "node_id": "IC_kwDOAPphoM6mI9hv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2787367023/reactions"
            },
            "updated_at": "2025-04-08T18:45:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2787367023",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4627919?v=4",
                "events_url": "https://api.github.com/users/somnam/events{/privacy}",
                "followers_url": "https://api.github.com/users/somnam/followers",
                "following_url": "https://api.github.com/users/somnam/following{/other_user}",
                "gists_url": "https://api.github.com/users/somnam/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/somnam",
                "id": 4627919,
                "login": "somnam",
                "node_id": "MDQ6VXNlcjQ2Mjc5MTk=",
                "organizations_url": "https://api.github.com/users/somnam/orgs",
                "received_events_url": "https://api.github.com/users/somnam/received_events",
                "repos_url": "https://api.github.com/users/somnam/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/somnam/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/somnam/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/somnam",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Sounds great, waiting for a patch.",
            "created_at": "2025-04-09T10:22:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/30723#issuecomment-2789184765",
            "id": 2789184765,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30723",
            "node_id": "IC_kwDOAPphoM6mP5T9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2789184765/reactions"
            },
            "updated_at": "2025-04-09T10:22:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2789184765",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30723/comments",
    "created_at": "2024-10-08T19:21:22Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30723/events",
    "html_url": "https://github.com/neovim/neovim/issues/30723",
    "id": 2574017906,
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30723/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 709,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 637,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-04-12T17:52:52Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM6ZbGVy",
    "number": 30723,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30723/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30723/timeline",
    "title": "complete: keep pum visible when pressing <BS> for `complete()`",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-04-09T10:22:58Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30723",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5160701?v=4",
        "events_url": "https://api.github.com/users/seblyng/events{/privacy}",
        "followers_url": "https://api.github.com/users/seblyng/followers",
        "following_url": "https://api.github.com/users/seblyng/following{/other_user}",
        "gists_url": "https://api.github.com/users/seblyng/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/seblyng",
        "id": 5160701,
        "login": "seblyng",
        "node_id": "MDQ6VXNlcjUxNjA3MDE=",
        "organizations_url": "https://api.github.com/users/seblyng/orgs",
        "received_events_url": "https://api.github.com/users/seblyng/received_events",
        "repos_url": "https://api.github.com/users/seblyng/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/seblyng/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/seblyng/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/seblyng",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Neovim version (nvim -v)\n\n0.6.0\n\n### Vim (not Nvim) behaves the same?\n\nn/a part of :terminal\n\n### Operating system/version\n\nLinux/Archlinux\n\n### Terminal name/version\n\nkitty 0.23.1\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nsystem package manager (pacman)\n\n### How to reproduce the issue\n\nnvim --clean 24</etc/hosts\r\n:!ls /dev/fd \r\n:terminal \r\ni\r\ncat /dev/fd/24\r\n<C-d>\r\nq\r\n:!ls /dev/fd\r\n\n\n### Expected behavior\n\nInside the terminal, file descriptor 24 should still be available, and `cat </dev/fd/24` should output the contents of /etc/hosts\r\n\r\nIf closing of file descriptors is intended behavior, then it should be better document (and I'd like a feature to override that). \n\n### Actual behavior\n\nAs soon as the `:terminal` is run, the file descriptor for 24 is closed. And the cat command prints that `/dev/fd/24` does not exist. The second `:!ls /dev/fd` command also no longer includes the 24 file descriptor (although the first one does). \r\n\r\nInterestingly, if higher numbered file descriptors are used (for example 63) it does work as expected. From experimentation, on my system the threshold appears to be 27.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "For context, I was trying to implement something like this: https://github.com/kovidgoyal/kitty/issues/719#issuecomment-952039731 but using zsh instead of bash. zsh doesn't have a way to redirect to a specific file descriptor greater than 9 (it has to be a single digit), so I couldn't get it to work using a lower number, and even using syntax like `{myvar}<&0` didn't work, because the file descriptor allocated is usually too low. \r\n\r\nSidenote: it would be nice if neovim had a more streamlined way to implement this, like having a way to open a file (or stdin) containing ansi escape codes directly instead of having to go through :terminal",
            "created_at": "2021-12-24T07:25:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/16764#issuecomment-1000696697",
            "id": 1000696697,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16764",
            "node_id": "IC_kwDOAPphoM47pWt5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000696697/reactions"
            },
            "updated_at": "2021-12-24T07:25:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000696697",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2541726?v=4",
                "events_url": "https://api.github.com/users/tmccombs/events{/privacy}",
                "followers_url": "https://api.github.com/users/tmccombs/followers",
                "following_url": "https://api.github.com/users/tmccombs/following{/other_user}",
                "gists_url": "https://api.github.com/users/tmccombs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tmccombs",
                "id": 2541726,
                "login": "tmccombs",
                "node_id": "MDQ6VXNlcjI1NDE3MjY=",
                "organizations_url": "https://api.github.com/users/tmccombs/orgs",
                "received_events_url": "https://api.github.com/users/tmccombs/received_events",
                "repos_url": "https://api.github.com/users/tmccombs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tmccombs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tmccombs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tmccombs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This line is likely the cause:\r\n<https://github.com/neovim/neovim/blob/0d7a97224f28cdf47d7ecc80b6d300c8c67c0b29/src/nvim/os/pty_process_unix.c#L187>\r\n\r\nSo the file descriptors are not closed, but they are no longer inherited after the first pty subprocess is launched.",
            "created_at": "2021-12-24T07:44:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/16764#issuecomment-1000705160",
            "id": 1000705160,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16764",
            "node_id": "IC_kwDOAPphoM47pYyI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000705160/reactions"
            },
            "updated_at": "2021-12-26T04:07:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000705160",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This issue also applies to `jobstart()` with `pty: true`.",
            "created_at": "2021-12-24T07:57:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/16764#issuecomment-1000709144",
            "id": 1000709144,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16764",
            "node_id": "IC_kwDOAPphoM47pZwY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000709144/reactions"
            },
            "updated_at": "2021-12-24T07:57:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000709144",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "There has been some related discussion in #5242, but it is not clear from the discussion whether the current behavior is intended.",
            "created_at": "2021-12-24T08:21:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/16764#issuecomment-1000718891",
            "id": 1000718891,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/16764",
            "node_id": "IC_kwDOAPphoM47pcIr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000718891/reactions"
            },
            "updated_at": "2021-12-24T08:21:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1000718891",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/16764/comments",
    "created_at": "2021-12-24T07:19:32Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/16764/events",
    "html_url": "https://github.com/neovim/neovim/issues/16764",
    "id": 1088204426,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "OS processes, spawn",
            "id": 182884815,
            "name": "job-control",
            "node_id": "MDU6TGFiZWwxODI4ODQ4MTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/job-control"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 378639615,
            "name": "io",
            "node_id": "MDU6TGFiZWwzNzg2Mzk2MTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/io"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains minimal reproducing steps",
            "id": 435851959,
            "name": "has:repro",
            "node_id": "MDU6TGFiZWw0MzU4NTE5NTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:repro"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/16764/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5A3K6K",
    "number": 16764,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/16764/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/16764/timeline",
    "title": ":terminal closes file descriptors under 25",
    "updated_at": "2025-01-19T11:39:53Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/16764",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2541726?v=4",
        "events_url": "https://api.github.com/users/tmccombs/events{/privacy}",
        "followers_url": "https://api.github.com/users/tmccombs/followers",
        "following_url": "https://api.github.com/users/tmccombs/following{/other_user}",
        "gists_url": "https://api.github.com/users/tmccombs/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tmccombs",
        "id": 2541726,
        "login": "tmccombs",
        "node_id": "MDQ6VXNlcjI1NDE3MjY=",
        "organizations_url": "https://api.github.com/users/tmccombs/orgs",
        "received_events_url": "https://api.github.com/users/tmccombs/received_events",
        "repos_url": "https://api.github.com/users/tmccombs/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/tmccombs/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tmccombs/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tmccombs",
        "user_view_type": "public"
    }
}
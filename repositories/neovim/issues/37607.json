{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\n```\n=================================================================\n==1452659==ERROR: AddressSanitizer: ABRT on unknown address 0x03e800162a73 (pc 0x7f7eb5d8f90c bp 0x7ffd87e09440 sp 0x7ffd87e09400 T0)\n    #0 0x7f7eb5d8f90c in __pthread_kill_implementation /usr/src/debug/glibc/glibc/nptl/pthread_kill.c:44:76\n    #1 0x7f7eb5d3539f in raise /usr/src/debug/glibc/glibc/signal/../sysdeps/posix/raise.c:26:13\n    #2 0x7f7eb5d1c579 in abort /usr/src/debug/glibc/glibc/stdlib/abort.c:77:3\n    #3 0x56281f2121f0 in loop_uv_run **/src/nvim/event/loop.c:44:5\n    #4 0x56281f212034 in loop_poll_events **/src/nvim/event/loop.c:80:26\n    #5 0x56281f2d62a9 in do_sleep **/src/nvim/ex_docmd.c:6407:3\n    #6 0x56281f2f15b1 in ex_sleep **/src/nvim/ex_docmd.c:6394:3\n    #7 0x56281f2b092f in execute_cmd0 **/src/nvim/ex_docmd.c:1762:7\n    #8 0x56281f293705 in do_one_cmd **/src/nvim/ex_docmd.c:2392:7\n    #9 0x56281f288cc6 in do_cmdline **/src/nvim/ex_docmd.c:679:20\n    #10 0x56281f28cd48 in do_cmdline_cmd **/src/nvim/ex_docmd.c:377:10\n    #11 0x56281f0d1a54 in execute_common **/src/nvim/eval/funcs.c:1322:5\n    #12 0x56281f0fb6ea in f_execute **/src/nvim/eval/funcs.c:1359:3\n    #13 0x56281f0cf261 in call_internal_func **/src/nvim/eval/funcs.c:282:3\n    #14 0x56281f1a03ae in call_func **/src/nvim/eval/userfunc.c:1788:15\n    #15 0x56281f19d58b in get_func_tv **/src/nvim/eval/userfunc.c:580:11\n    #16 0x56281f041870 in eval_func **/src/nvim/eval.c:1725:13\n    #17 0x56281f039cb7 in eval7 **/src/nvim/eval.c:2717:15\n    #18 0x56281f035d88 in eval6 **/src/nvim/eval.c:2514:7\n    #19 0x56281f035057 in eval5 **/src/nvim/eval.c:2358:7\n    #20 0x56281f033c82 in eval4 **/src/nvim/eval.c:2146:7\n    #21 0x56281f032def in eval3 **/src/nvim/eval.c:2055:7\n    #22 0x56281effd96f in eval2 **/src/nvim/eval.c:1977:7\n    #23 0x56281efe89a1 in eval1 **/src/nvim/eval.c:1881:7\n    #24 0x56281f1a817d in call_user_func **/src/nvim/eval/userfunc.c:1263:5\n    #25 0x56281f1b1fd0 in call_user_func_check **/src/nvim/eval/userfunc.c:1424:5\n    #26 0x56281f1a010d in call_func **/src/nvim/eval/userfunc.c:1779:17\n    #27 0x56281f01011c in callback_call **/src/nvim/eval.c:4903:13\n    #28 0x56281f16776b in tv_dict_watcher_notify **/src/nvim/eval/typval.c:1988:3\n    #29 0x56281ecc1663 in dict_set_var **/src/nvim/api/private/helpers.c:253:7\n    #30 0x56281feadf79 in buf_set_term_title **/src/nvim/terminal.c:1441:3\n    #31 0x56281fec3b44 in term_settermprop **/src/nvim/terminal.c:1471:7\n    #32 0x562820151c63 in settermprop **/src/nvim/vterm/screen.c:437:12\n    #33 0x5628201650e8 in vterm_state_set_termprop **/src/nvim/vterm/state.c:2376:10\n    #34 0x562820199902 in settermprop_string **/src/nvim/vterm/state.c:548:10\n    #35 0x56282018aab2 in on_osc **/src/nvim/vterm/state.c:1953:5\n    #36 0x5628201348b0 in string_fragment **/src/nvim/vterm/parser.c:89:7\n    #37 0x562820131ec2 in vterm_input_write **/src/nvim/vterm/parser.c:323:9\n    #38 0x56281feb231f in terminal_receive **/src/nvim/terminal.c:1281:5\n    #39 0x56281ee1687f in on_channel_output **/src/nvim/channel.c:678:5\n    #40 0x56281ee13ce8 in on_channel_data **/src/nvim/channel.c:650:10\n    #41 0x56281f227d9b in read_event **/src/nvim/event/rstream.c:234:23\n    #42 0x56281f227838 in invoke_read_cb **/src/nvim/event/rstream.c:287:3\n    #43 0x56281f224c5d in poll_cb **/src/nvim/event/rstream.c:224:3\n    #44 0x56282039e33d in uv__poll_io **/.deps/build/src/libuv/src/unix/poll.c:63:3\n    #45 0x5628203ad78c in uv__io_poll **/.deps/build/src/libuv/src/unix/linux.c:1565:11\n    #46 0x5628203917e7 in uv_run **/.deps/build/src/libuv/src/unix/core.c:460:5\n    #47 0x56281f2123b7 in loop_uv_run **/src/nvim/event/loop.c:59:3\n    #48 0x56281f212034 in loop_poll_events **/src/nvim/event/loop.c:80:26\n    #49 0x56281f9f1881 in inbuf_poll **/src/nvim/os/input.c:515:3\n    #50 0x56281f9f110e in input_get **/src/nvim/os/input.c:144:19\n    #51 0x56281fdbd2d8 in state_enter **/src/nvim/state.c:79:7\n    #52 0x56281f884814 in normal_enter **/src/nvim/normal.c:523:3\n    #53 0x56281f6037cf in main **/src/nvim/main.c:660:3\n    #54 0x7f7eb5d1e634 in __libc_start_call_main /usr/src/debug/glibc/glibc/csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n    #55 0x7f7eb5d1e6e8 in __libc_start_main /usr/src/debug/glibc/glibc/csu/../csu/libc-start.c:360:3\n    #56 0x56281ea16004 in _start (**/build/bin/nvim+0xca6004) (BuildId: 624092a55dbef3f4b1f3ea9b0aa202f235fb0a15)\n\n==1452659==Register values:\nrax = 0x0000000000000000  rbx = 0x0000000000162a73  rcx = 0x00007f7eb5d8f90c  rdx = 0x0000000000000006  \nrdi = 0x0000000000162a73  rsi = 0x0000000000162a73  rbp = 0x00007ffd87e09440  rsp = 0x00007ffd87e09400  \n r8 = 0x00007f7eb5e64280   r9 = 0x0000000000000000  r10 = 0x0000000000000000  r11 = 0x0000000000000246  \nr12 = 0xf2f2f2f2f8f8f8f8  r13 = 0x0000000000000003  r14 = 0x0000000000000006  r15 = 0x0000000000000010  \nAddressSanitizer can not provide additional info.\nSUMMARY: AddressSanitizer: ABRT /usr/src/debug/glibc/glibc/nptl/pthread_kill.c:44:76 in __pthread_kill_implementation\n==1452659==ABORTING\n```\n\n### Steps to reproduce\n\n1. Run `nvim --clean`\n2. Source the following file:\n```\ncall jobstart([v:progpath, '--clean'], {'term': v:true})\ncall dictwatcheradd(b:, 'term_title', {-> execute('sleep 1m')})\ncall chansend(&channel, \":set title\\r\")\n```\n3. SIGABRT\n\n### Expected behavior\n\nNo crash\n\n### Nvim version (nvim -v)\n\nv0.12.0-dev-2140+ga8a097d178\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nArch Linux\n\n### Terminal name/version\n\nkitty 0.45.0\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nbuild from repo",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "dictwatchers are a deprecated concept, and this issue is an example of how they introduce risk to any random part of the internal state. For \"watching\" changes to terminal state, perhaps we need a new (deferred) event? Though TermResponse can be used for some things.",
            "created_at": "2026-01-29T12:58:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/37607#issuecomment-3817535667",
            "id": 3817535667,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37607",
            "node_id": "IC_kwDOAPphoM7jiviz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3817535667/reactions"
            },
            "updated_at": "2026-01-29T12:59:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3817535667",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think you mean `TermRequest`? `TermRequest` is already triggered for OSC 0 and OSC 2, which set the terminal title.",
            "created_at": "2026-01-29T13:12:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/37607#issuecomment-3817613305",
            "id": 3817613305,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37607",
            "node_id": "IC_kwDOAPphoM7jjCf5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3817613305/reactions"
            },
            "updated_at": "2026-01-29T13:14:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3817613305",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37607/comments",
    "created_at": "2026-01-29T00:00:27Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37607/events",
    "html_url": "https://github.com/neovim/neovim/issues/37607",
    "id": 3867959704,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 520282574,
            "name": "event-loop",
            "node_id": "MDU6TGFiZWw1MjAyODI1NzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/event-loop"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37607/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7mjGGY",
    "number": 37607,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37607/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37607/timeline",
    "title": "SIGABRT when using :sleep in b:term_title watcher",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-01-29T13:14:45Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37607",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    }
}
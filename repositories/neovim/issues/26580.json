{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\n`:checkhealth` doesn't work for plugins that have been installed using luarocks and added to the `package.path` and the runtimepath.\r\n\r\nThe reason for this is that the [`copy_directories` field cannot include a \"lua\" directory](https://github.com/luarocks/luarocks/wiki/Rockspec-format), as it has a special meaning (installed to `lib`, instead of `share`)\r\n\r\n### Expected behavior\r\n\r\nA potential solution would be to search the `package.path` in the [`get_healthcheck_list`](https://github.com/mrcjkb/neovim-fork/blob/ef38fdfdc6c84abd8ce7be02eaf8edc91ebc7917/runtime/lua/vim/health.lua#L76) function:\r\n\r\n```lua\r\nlocal lua_lib_path = package.searchpath(p .. '.health', package.path)\r\nif lua_lib_path then\r\n  table.insert(paths, lua_lib_path)\r\nend\r\n```\r\n\r\nI don't know if this would have any negative implications, or if there's a better way to solve this, which is why I'm opening this issue for discussion before I open a PR :smile: ",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "On the rocks.nvim side, we have implemented [a workaround](https://github.com/nvim-neorocks/rocks.nvim/pull/161/files).\r\n\r\nFeel free to close this :smile: \r\n\r\n@justinmk I hope you don't mind me pinging you here, since you seem to be pretty active when it comes to luarocks + neovim.",
            "created_at": "2024-02-23T20:16:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/26580#issuecomment-1961932900",
            "id": 1961932900,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26580",
            "node_id": "IC_kwDOAPphoM508Lhk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1961932900/reactions"
            },
            "updated_at": "2024-02-23T20:16:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1961932900",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/12857160?v=4",
                "events_url": "https://api.github.com/users/mrcjkb/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrcjkb/followers",
                "following_url": "https://api.github.com/users/mrcjkb/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrcjkb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrcjkb",
                "id": 12857160,
                "login": "mrcjkb",
                "node_id": "MDQ6VXNlcjEyODU3MTYw",
                "organizations_url": "https://api.github.com/users/mrcjkb/orgs",
                "received_events_url": "https://api.github.com/users/mrcjkb/received_events",
                "repos_url": "https://api.github.com/users/mrcjkb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrcjkb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrcjkb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrcjkb",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It looks a bit odd to look into luarocks packages for health.lua if they are not in rtp. In practice though it doesn't look hard to have sthg robust enough. I would say it might be premature to consider this for neovim, let's wait to see rocks.nvim adoption (I hope) and if the need becomes more widespread we can revisit ? especially now that you have a workaround (that doesn't look too annoying). ",
            "created_at": "2024-02-23T21:49:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/26580#issuecomment-1962046835",
            "id": 1962046835,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26580",
            "node_id": "IC_kwDOAPphoM508nVz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1962046835/reactions"
            },
            "updated_at": "2024-02-23T21:49:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1962046835",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/886074?v=4",
                "events_url": "https://api.github.com/users/teto/events{/privacy}",
                "followers_url": "https://api.github.com/users/teto/followers",
                "following_url": "https://api.github.com/users/teto/following{/other_user}",
                "gists_url": "https://api.github.com/users/teto/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/teto",
                "id": 886074,
                "login": "teto",
                "node_id": "MDQ6VXNlcjg4NjA3NA==",
                "organizations_url": "https://api.github.com/users/teto/orgs",
                "received_events_url": "https://api.github.com/users/teto/received_events",
                "repos_url": "https://api.github.com/users/teto/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/teto/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/teto/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/teto",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> It looks a bit odd to look into luarocks packages for health.lua if they are not in rtp.\r\n\r\nTrue. What is the reason for that? Why can't luarocks plugins be added to rtp?",
            "created_at": "2024-05-07T09:44:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/26580#issuecomment-2097890774",
            "id": 2097890774,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26580",
            "node_id": "IC_kwDOAPphoM59C0XW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2097890774/reactions"
            },
            "updated_at": "2024-05-07T09:44:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2097890774",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Why can't luarocks plugins be added to rtp?\r\n\r\nFor a luarocks package, the `lua` and `lib` source directories have a special meaning, and are installed into a different directory than the directories specified with `build.copy_directories` in a rockspec.\r\n\r\nIt would be possible to hack the luarocks config to force a flat hierarchy (this is what nixpkgs does), but that is hacky and could potentially lead to issues for luarocks packages that aren't neovim plugins (e.g. ones that are written in C).\r\n\r\nBesides that, for rocks.nvim, this would also mean that a plugin's dependencies' runtime (plugin, ftdetect, ...) scripts would be sourced during startup, which is something we don't want by design. We want a plugin's dependency's API (lua, autoload, ...) to be available, but its plugin scripts should only be sourced if it is explicitly installed by the user. \r\nThat works quite well with the directory structure of luarocks packages. \r\n\r\nFor now, we're happy with the symlinking workaround (which we now also use to make colorschemes and autoload scripts, etc. available), and haven't had any users report issues with it.",
            "created_at": "2024-05-07T11:17:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/26580#issuecomment-2098166253",
            "id": 2098166253,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26580",
            "node_id": "IC_kwDOAPphoM59D3nt",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2098166253/reactions"
            },
            "updated_at": "2024-05-07T11:18:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2098166253",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/12857160?v=4",
                "events_url": "https://api.github.com/users/mrcjkb/events{/privacy}",
                "followers_url": "https://api.github.com/users/mrcjkb/followers",
                "following_url": "https://api.github.com/users/mrcjkb/following{/other_user}",
                "gists_url": "https://api.github.com/users/mrcjkb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mrcjkb",
                "id": 12857160,
                "login": "mrcjkb",
                "node_id": "MDQ6VXNlcjEyODU3MTYw",
                "organizations_url": "https://api.github.com/users/mrcjkb/orgs",
                "received_events_url": "https://api.github.com/users/mrcjkb/received_events",
                "repos_url": "https://api.github.com/users/mrcjkb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mrcjkb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mrcjkb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mrcjkb",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26580/comments",
    "created_at": "2023-12-14T18:16:26Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26580/events",
    "html_url": "https://github.com/neovim/neovim/issues/26580",
    "id": 2042229809,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "plugins and Vim \"pack\"",
            "id": 117905553,
            "name": "plugin",
            "node_id": "MDU6TGFiZWwxMTc5MDU1NTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/plugin"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, self-contained. Do NOT ask \"can I work on this\", just read CONTRIBUTING.md",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26580/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 260,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 297,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-01-20T17:56:23Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM55ufQx",
    "number": 26580,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26580/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26580/timeline",
    "title": "`:checkhealth`: Search `package.path` for health files.",
    "updated_at": "2025-01-17T15:27:26Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26580",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/12857160?v=4",
        "events_url": "https://api.github.com/users/mrcjkb/events{/privacy}",
        "followers_url": "https://api.github.com/users/mrcjkb/followers",
        "following_url": "https://api.github.com/users/mrcjkb/following{/other_user}",
        "gists_url": "https://api.github.com/users/mrcjkb/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mrcjkb",
        "id": 12857160,
        "login": "mrcjkb",
        "node_id": "MDQ6VXNlcjEyODU3MTYw",
        "organizations_url": "https://api.github.com/users/mrcjkb/orgs",
        "received_events_url": "https://api.github.com/users/mrcjkb/received_events",
        "repos_url": "https://api.github.com/users/mrcjkb/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mrcjkb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mrcjkb/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mrcjkb",
        "user_view_type": "public"
    }
}
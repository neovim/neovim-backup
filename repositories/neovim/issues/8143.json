{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "- `jobwait()` (which depends on `proc_wait()` internally) needs to be revisited on Windows. \n Maybe it should be implemented using `WaitForSingleObject`. https://stackoverflow.com/a/2153846/\n  - ~~But `process_stop()` was changed in https://github.com/neovim/neovim/pull/8107 , so maybe `jobwait()` works better after that.~~\n- Related: the \"proper\"/non-racey (Linux) way to kill a process tree is to [use cgroups](https://news.ycombinator.com/item?id=20599575).\n\nIs this rare test failure related? \n\n```\n  [  ERROR   ] C:/projects/neovim/test/functional\\api\\proc_spec.lua @ 17: api nvim_get_proc_children returns child process ids\n  test\\functional\\helpers.lua:323: \n  retry() attempts: 434\n  C:/projects/neovim/test/functional\\api\\proc_spec.lua:22: Expected objects to be the same.\n  Passed in:\n  (number) 3\n  Expected:\n  (number) 1\n  \n  stack traceback:\n```",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Hi, I was looking into this, `proc_wait` is implemented using the `libuv` library, the function call `proc_wait` in `f_jobwait` , already does a blocking call through `loop_uv_run` , Can you help clarify where would you want to change the implementation of the process wait.",
            "created_at": "2025-06-13T09:01:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/8143#issuecomment-2969629642",
            "id": 2969629642,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/8143",
            "node_id": "IC_kwDOAPphoM6xAPPK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2969629642/reactions"
            },
            "updated_at": "2025-06-13T09:01:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2969629642",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/22520440?v=4",
                "events_url": "https://api.github.com/users/dheerajd5/events{/privacy}",
                "followers_url": "https://api.github.com/users/dheerajd5/followers",
                "following_url": "https://api.github.com/users/dheerajd5/following{/other_user}",
                "gists_url": "https://api.github.com/users/dheerajd5/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dheerajd5",
                "id": 22520440,
                "login": "dheerajd5",
                "node_id": "MDQ6VXNlcjIyNTIwNDQw",
                "organizations_url": "https://api.github.com/users/dheerajd5/orgs",
                "received_events_url": "https://api.github.com/users/dheerajd5/received_events",
                "repos_url": "https://api.github.com/users/dheerajd5/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dheerajd5/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dheerajd5/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dheerajd5",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`jobwait` involves `proc_stop`, which involves `os_proc_tree_kill`. Our Windows implementation of `os_proc_tree_kill` (mostly borrowed from Vim) is pretty hacky, it recurses through the process tree (which is racy and probably slow since it must wait for each process to die): https://github.com/neovim/neovim/blob/1ede826e049dde60bf21c1fe9b12729aaa0dbddb/src/nvim/os/proc.c#L51-L69\n\nThe main work to do here is to research and see if there's a better way to kill a process tree on Windows, that doesn't involve recursing through the process tree. \n\nThat could involve [WaitForSingleObject](https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject). Or it could mean that we *spawn* the processes using win32's \"job\" concept; then we can easily terminate the \"job\" container and won't need to recurse the process tree.",
            "created_at": "2025-06-13T12:35:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/8143#issuecomment-2970258122",
            "id": 2970258122,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/8143",
            "node_id": "IC_kwDOAPphoM6xCorK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2970258122/reactions"
            },
            "updated_at": "2025-06-13T12:37:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2970258122",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Looking at the `os_proc_tree_kill_rec` , the only way to make it less racy is maybe running a few more loops, but that's like a bandaid fix, if we're really looking to cleaner code, we should think about spawning processes using job objects in windows.",
            "created_at": "2025-06-15T15:11:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/8143#issuecomment-2974042395",
            "id": 2974042395,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/8143",
            "node_id": "IC_kwDOAPphoM6xREkb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2974042395/reactions"
            },
            "updated_at": "2025-06-15T15:11:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2974042395",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/22520440?v=4",
                "events_url": "https://api.github.com/users/dheerajd5/events{/privacy}",
                "followers_url": "https://api.github.com/users/dheerajd5/followers",
                "following_url": "https://api.github.com/users/dheerajd5/following{/other_user}",
                "gists_url": "https://api.github.com/users/dheerajd5/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dheerajd5",
                "id": 22520440,
                "login": "dheerajd5",
                "node_id": "MDQ6VXNlcjIyNTIwNDQw",
                "organizations_url": "https://api.github.com/users/dheerajd5/orgs",
                "received_events_url": "https://api.github.com/users/dheerajd5/received_events",
                "repos_url": "https://api.github.com/users/dheerajd5/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dheerajd5/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dheerajd5/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dheerajd5",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Hi, I write test for one of my plugin, I use\n```python\nassert nvim.funcs.jobwait([jobid], 0)[0] != -1\n```\nto check if `jobid` has stoped. It works fine in Linux and MacOS, but it makes the Windows workflow hang like forever (so I had to switch to use `jobpid()`). Could this issue be the reason why?",
            "created_at": "2025-08-01T04:31:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/8143#issuecomment-3142134372",
            "id": 3142134372,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/8143",
            "node_id": "IC_kwDOAPphoM67SSpk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3142134372/reactions"
            },
            "updated_at": "2025-08-01T04:34:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3142134372",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/111893501?v=4",
                "events_url": "https://api.github.com/users/brianhuster/events{/privacy}",
                "followers_url": "https://api.github.com/users/brianhuster/followers",
                "following_url": "https://api.github.com/users/brianhuster/following{/other_user}",
                "gists_url": "https://api.github.com/users/brianhuster/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brianhuster",
                "id": 111893501,
                "login": "brianhuster",
                "node_id": "U_kgDOBqtb_Q",
                "organizations_url": "https://api.github.com/users/brianhuster/orgs",
                "received_events_url": "https://api.github.com/users/brianhuster/received_events",
                "repos_url": "https://api.github.com/users/brianhuster/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brianhuster/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brianhuster/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brianhuster",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/8143/comments",
    "created_at": "2018-03-17T10:37:17Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/8143/events",
    "html_url": "https://github.com/neovim/neovim/issues/8143",
    "id": 306146135,
    "labels": [
        {
            "color": "d4c5f9",
            "default": false,
            "description": null,
            "id": 109461219,
            "name": "platform:windows",
            "node_id": "MDU6TGFiZWwxMDk0NjEyMTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:windows"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "OS processes, spawn",
            "id": 182884815,
            "name": "job-control",
            "node_id": "MDU6TGFiZWwxODI4ODQ4MTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/job-control"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "issue needs attention from an expert, or PR proposes significant changes to architecture or API",
            "id": 212680983,
            "name": "needs:discussion",
            "node_id": "MDU6TGFiZWwyMTI2ODA5ODM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:discussion"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, self-contained. Do NOT ask \"can I work on this\", just read CONTRIBUTING.md",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "OS resources, pipes, streams",
            "id": 713599092,
            "name": "system",
            "node_id": "MDU6TGFiZWw3MTM1OTkwOTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/system"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/8143/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 734,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 635,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-08-03T21:37:35Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWUzMDYxNDYxMzU=",
    "number": 8143,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/8143/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/8143/timeline",
    "title": "win: jobwait(): use WaitForSingleObject",
    "type": null,
    "updated_at": "2025-08-01T04:34:06Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/8143",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    }
}
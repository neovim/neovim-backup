{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nHello!\n\nFirst, thanks for Neovim, it's awesome!\n\nI'm doing a GUI for it, which starts Neovim as a process and dialogs through a socket.\n\nI have a strange situation with (some) width characters. I'll present the case, then I'll show you the relevant communication between the GUI and Neovim, and also attached is the full log if you want to inspect it.\n\nSo, for example, I have following file in disk:\n\n```\n$ cat width.txt \n# 昔PyQt\n```\n\nFor explicitness:\n\n```\n$ hexdump -C width.txt\n00000000  23 20 e6 98 94 50 79 51  74 0a                    |# ...PyQt.|\n0000000a\n```\n\nThe third char is `CJK UNIFIED IDEOGRAPH-6614`, codepoint `0x6614`, and the following may be relevant for this issue:\n```\n>>> unicodedata.east_asian_width(\"昔\")\n'W'\n```\n\nI start the GUI, a blank editor is drawn. I type `:edit width.txt` and the file is loaded and shown. The cursor is in the first character, the `#`, as it should, in column `0`, \n\n```\n22:44:39.348 INFO  Starting Neovim process\n22:44:39.399 INFO  Neovim setup done\n22:44:39.432 TRACE [nvim] Sending request id=1 method='nvim_ui_attach' params=(80, 20, {'ext_linegrid': True})\n...\n22:44:50.894 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 1, 0, [['#', 0], [' '], ['昔'], [''], ['P'], ['y'], ['Q'], ['t']], False], ...]]\n22:44:50.894 TRACE [nvim] Receiving notification method='redraw' params=[['win_viewport', [2, ExtType(code=1, data=b'\\xcd\\x03\\xe8'), 0, 2, 0, 0, 1, 0]], ['grid_cursor_goto', [1, 1, 0]], ['flush', []]]\n22:44:50.894 TRACE [nvim] Receiving notification method='redraw' params=[['win_viewport', [2, ExtType(code=1, data=b'\\xcd\\x03\\xe8'), 0, 2, 0, 0, 1, 0]], ['flush', []]]\n```\n\nI press \"right arrow key\" once, the cursor moves to column `1`, press it again and goes to column `2`... so good so far:\n\n```\n22:45:05.391 TRACE [nvim] Sending request id=20 method='nvim_input' params=('<Right>',)\n22:45:05.392 TRACE [nvim] Receiving response msgid=20 error=None result=7\n22:45:05.392 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 22, 80, [['~', 1], ['@'], ['k']], False]], ['flush', []]]\n22:45:05.430 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 22, 80, [[' ', 1, 3], [' ', 0, 0]], False], [1, 21, 87, [['2', 222]], False]], ['win_viewport', [2, ExtType(code=1, data=b'\\xcd\\x03\\xe8'), 0, 2, 0, 1, 1, 0]], ['grid_cursor_goto', [1, 1, 1]], ['flush', []]]\n...\n22:45:18.327 TRACE [nvim] Sending request id=21 method='nvim_input' params=('<Right>',)\n22:45:18.328 TRACE [nvim] Receiving response msgid=21 error=None result=7\n22:45:18.328 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 22, 80, [['~', 1], ['@'], ['k']], False]], ['flush', []]]\n22:45:18.370 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 22, 80, [[' ', 1, 3], [' ', 0, 0]], False], [1, 21, 87, [['3', 222]], False]], ['win_viewport', [2, ExtType(code=1, data=b'\\xcd\\x03\\xe8'), 0, 2, 0, 2, 1, 0]], ['grid_cursor_goto', [1, 1, 2]], ['flush', []]]\n```\n\nThe cursor is just above the ideograph, which I draw taking more space than a normal character because Unicode says it's \"width\". Then, I press the right arrow key again, and the cursor jumps from column `2` to `4`:\n\n```\n22:45:20.743 TRACE [nvim] Sending request id=22 method='nvim_input' params=('<Right>',)\n22:45:20.744 TRACE [nvim] Receiving response msgid=22 error=None result=7\n22:45:20.744 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 22, 80, [['~', 1], ['@'], ['k']], False]], ['flush', []]]\n22:45:20.784 TRACE [nvim] Receiving notification method='redraw' params=[['grid_line', [1, 22, 80, [[' ', 1, 3], [' ', 0, 0]], False], [1, 21, 87, [['5', 222]], False]], ['win_viewport', [2, ExtType(code=1, data=b'\\xcd\\x03\\xe8'), 0, 2, 0, 5, 1, 0]], ['grid_cursor_goto', [1, 1, 4]], ['flush', []]]\n```\n\nI don't understand how to handle this, really, because in column 4 I have the `y`, not the `P`, in the string `# 昔PyQt`. \n\nI get that the character is wide and in the GUI I should draw it properly, but it's a responsibility of the GUI, conceptually that character is **one** character and should occupy one column.\n\nWhat am I misinterpretating here?\n\nSorry if all this is documented somewhere, couldn't find it.\n\n([here are the promised full logs](https://github.com/user-attachments/files/20398243/detail.log.gz))\n\nThank you!!!\n\n\n\n\n### Steps to reproduce\n\nNot easily reproduceable, but probably I could prepare a script that replicates logs shown above, if needed.\n\n### Expected behavior\n\nCharacters should occupy one \"slot in the grid\" (one row/column combination)\n\n### Nvim version (nvim -v)\n\nv0.9.5\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nUbuntu 24.04.2 LTS\n\n### Terminal name/version\n\nkonsole 23.08.5 (but not used for this issue)\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nAPT",
    "closed_at": "2025-05-22T23:26:58Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> v0.9.5\n\nThat version is severely outdated. Please test the latest version, v0.11.1 (or a nightly build).",
            "created_at": "2025-05-22T17:58:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/34128#issuecomment-2902097410",
            "id": 2902097410,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34128",
            "node_id": "IC_kwDOAPphoM6s-n4C",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2902097410/reactions"
            },
            "updated_at": "2025-05-22T17:58:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2902097410",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Please notice the empty string after the `昔` in `grid_line`, it means that the previous character takes two cells.",
            "created_at": "2025-05-22T23:26:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/34128#issuecomment-2902845794",
            "id": 2902845794,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34128",
            "node_id": "IC_kwDOAPphoM6tBeli",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2902845794/reactions"
            },
            "updated_at": "2025-05-22T23:26:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2902845794",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34128/comments",
    "created_at": "2025-05-22T17:56:25Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34128/events",
    "html_url": "https://github.com/neovim/neovim/issues/34128",
    "id": 3084151120,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as usage questions",
            "id": 77997478,
            "name": "closed:question",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3OA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:question"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34128/labels{/name}",
    "locked": true,
    "milestone": null,
    "node_id": "I_kwDOAPphoM631GlQ",
    "number": 34128,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34128/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34128/timeline",
    "title": "(using Neovim through API) Weird cursor position behaviour for some width characters",
    "type": null,
    "updated_at": "2025-05-22T23:30:08Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34128",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/184060?v=4",
        "events_url": "https://api.github.com/users/facundobatista/events{/privacy}",
        "followers_url": "https://api.github.com/users/facundobatista/followers",
        "following_url": "https://api.github.com/users/facundobatista/following{/other_user}",
        "gists_url": "https://api.github.com/users/facundobatista/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/facundobatista",
        "id": 184060,
        "login": "facundobatista",
        "node_id": "MDQ6VXNlcjE4NDA2MA==",
        "organizations_url": "https://api.github.com/users/facundobatista/orgs",
        "received_events_url": "https://api.github.com/users/facundobatista/received_events",
        "repos_url": "https://api.github.com/users/facundobatista/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/facundobatista/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/facundobatista/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/facundobatista",
        "user_view_type": "public"
    }
}
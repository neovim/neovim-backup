{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nI'm trying to replace the built-in LSP hover command, by doing effectively this:\n\n```lua\nlocal function on_lsp_attach(client_id, bufnr)\n\tvim.keymap.set(\"n\", \"K\", function() print(\"hi\") end, { buffer=bufnr })\nend\n\nvim.api.nvim_create_autocmd(\n\t\"LspAttach\",\n\t{ callback=function(args) on_lsp_attach(args.data.client_id, args.bufnr) end })\n```\n\nBut when I do that, `K` is still bound to the built-in hover command. Other mappings set in the same callback in the same way work just fine. This does work as a workaround, but is obviously not ideal:\n\n```lua\nlocal prev_set_defaults = vim.lsp._set_defaults\nvim.lsp._set_defaults = function(client, bufnr)\n\tlocal ret = prev_set_defaults(client, bufnr)\n\tvim.keymap.set(\"n\", \"K\", function() print(\"hi\") end, { buffer=bufnr })\n\treturn ret\nend\n```\n\n### Steps to reproduce\n\n1. Bind `K` in for normal mode in an `LspAttach` callback.\n2. Open a file that has an LSP associated with its filetype.\n3. Note that the `K` binding is ignored in favor of the default one.\n\n### Expected behavior\n\nMy binding should apply, and not the default one.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.6\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nCachyOS w/ 6.18.8-1-cachyos-bore-lto\n\n### Terminal name/version\n\nkitty 0.45.0\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nArch repos",
    "closed_at": "2026-02-01T04:44:02Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1258798?v=4",
        "events_url": "https://api.github.com/users/rhoot/events{/privacy}",
        "followers_url": "https://api.github.com/users/rhoot/followers",
        "following_url": "https://api.github.com/users/rhoot/following{/other_user}",
        "gists_url": "https://api.github.com/users/rhoot/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rhoot",
        "id": 1258798,
        "login": "rhoot",
        "node_id": "MDQ6VXNlcjEyNTg3OTg=",
        "organizations_url": "https://api.github.com/users/rhoot/orgs",
        "received_events_url": "https://api.github.com/users/rhoot/received_events",
        "repos_url": "https://api.github.com/users/rhoot/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rhoot/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rhoot/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rhoot",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "You'd better write a minimal reproduce with `--clean`. But maybe you can try this in LspAttach\n```lua\n  local client = assert(lsp.get_client_by_id(args.data.client_id)) ---@type vim.lsp.Client\n  for buf, _ in pairs(client.attached_buffers) do\n\tvim.keymap.set(\"n\", \"K\", function() print(\"hi\") end, { buffer=buf })\n  end\n```",
            "created_at": "2026-02-01T04:06:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/37648#issuecomment-3830331265",
            "id": 3830331265,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37648",
            "node_id": "IC_kwDOAPphoM7kTjeB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3830331265/reactions"
            },
            "updated_at": "2026-02-01T04:06:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3830331265",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/154880267?v=4",
                "events_url": "https://api.github.com/users/nenahp/events{/privacy}",
                "followers_url": "https://api.github.com/users/nenahp/followers",
                "following_url": "https://api.github.com/users/nenahp/following{/other_user}",
                "gists_url": "https://api.github.com/users/nenahp/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nenahp",
                "id": 154880267,
                "login": "nenahp",
                "node_id": "U_kgDOCTtJCw",
                "organizations_url": "https://api.github.com/users/nenahp/orgs",
                "received_events_url": "https://api.github.com/users/nenahp/received_events",
                "repos_url": "https://api.github.com/users/nenahp/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nenahp/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nenahp/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nenahp",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Have you read [the docs](https://neovim.io/doc/user/lsp.html#lsp-defaults-disable) on how to disable the LSP default keymaps?",
            "created_at": "2026-02-01T04:16:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/37648#issuecomment-3830341946",
            "id": 3830341946,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37648",
            "node_id": "IC_kwDOAPphoM7kTmE6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3830341946/reactions"
            },
            "updated_at": "2026-02-01T04:16:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3830341946",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Have you read [the docs](https://neovim.io/doc/user/lsp.html#lsp-defaults-disable) on how to disable the LSP default keymaps?\n\nI don't see any mention of how to disable them entirely. The section named \"DISABLING DEFAULTS\" only says how to remove them after they have been set, and setting new ones after they have been set should have the same effect.\n\nThat said... since you got me looking closer at the documentation I noticed it was using `args.buf`, not `args.bufnr`. Changing my callback to using `args.buf` makes it work. ðŸ¤¦  Wonder if it was renamed at some point or if I just botched it when I originally wrote it.\n\nI guess the other mappings just work since they end up setting `buffer` to `nil`, which makes them global mappings. But the built-in hover ends up getting preference since it's a per-buffer mapping.\n\nThanks to both of you for the pointers, and sorry for wasting your time! ðŸ™‚ ",
            "created_at": "2026-02-01T04:44:02Z",
            "html_url": "https://github.com/neovim/neovim/issues/37648#issuecomment-3830366011",
            "id": 3830366011,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37648",
            "node_id": "IC_kwDOAPphoM7kTr87",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3830366011/reactions"
            },
            "updated_at": "2026-02-01T04:44:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3830366011",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1258798?v=4",
                "events_url": "https://api.github.com/users/rhoot/events{/privacy}",
                "followers_url": "https://api.github.com/users/rhoot/followers",
                "following_url": "https://api.github.com/users/rhoot/following{/other_user}",
                "gists_url": "https://api.github.com/users/rhoot/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rhoot",
                "id": 1258798,
                "login": "rhoot",
                "node_id": "MDQ6VXNlcjEyNTg3OTg=",
                "organizations_url": "https://api.github.com/users/rhoot/orgs",
                "received_events_url": "https://api.github.com/users/rhoot/received_events",
                "repos_url": "https://api.github.com/users/rhoot/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rhoot/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rhoot/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rhoot",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37648/comments",
    "created_at": "2026-02-01T01:55:26Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37648/events",
    "html_url": "https://github.com/neovim/neovim/issues/37648",
    "id": 3880771336,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37648/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7nT98I",
    "number": 37648,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37648/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37648/timeline",
    "title": "Can't override the LSP `K` hover binding",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-02-01T04:44:02Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37648",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1258798?v=4",
        "events_url": "https://api.github.com/users/rhoot/events{/privacy}",
        "followers_url": "https://api.github.com/users/rhoot/followers",
        "following_url": "https://api.github.com/users/rhoot/following{/other_user}",
        "gists_url": "https://api.github.com/users/rhoot/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rhoot",
        "id": 1258798,
        "login": "rhoot",
        "node_id": "MDQ6VXNlcjEyNTg3OTg=",
        "organizations_url": "https://api.github.com/users/rhoot/orgs",
        "received_events_url": "https://api.github.com/users/rhoot/received_events",
        "repos_url": "https://api.github.com/users/rhoot/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rhoot/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rhoot/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rhoot",
        "user_view_type": "public"
    }
}
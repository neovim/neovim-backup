{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\nWhen presented with the dialog when a swapfile exists for a file, this assertion fails after a second or two and Nvim crashes.\n\n### Steps to reproduce\n\nUsing `nvim --clean`, open a new file.\n\n```\nnvim --clean tmp.txt\n```\n\nEnsure a swapfile is created.\n\n```\n:set swapfile\n```\n\nKill the Nvim instance so that it does not shut down cleanly.\n\n```\nps aux | grep nvim\nkill -9 <PID of embedded Nvim instance>\n```\n\nOpen `tmp.txt` again using `nvim --clean`\n\n```\nnvim --clean tmp.txt\n```\n\nThe dialog indicating that swapfile exists will be presented. After a second or two, the assertion is triggered and Nvim crashes.\n\n### Expected behavior\n\nThe assertion is not violated.\n\n### Nvim version (nvim -v)\n\nv0.12.0-dev-556+gb98eefd803\n\n### Details\n\n<details>\n\n<summary> <strong>Backtrace</strong> </summary>\n\n```\n(gdb) bt\n#0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:44\n#1  __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\n#2  __GI___pthread_kill (threadid=<optimized out>, signo=signo@entry=6) at ./nptl/pthread_kill.c:89\n#3  0x0000780bc5e4527e in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\n#4  0x0000780bc5e288ff in __GI_abort () at ./stdlib/abort.c:79\n#5  0x0000780bc5e2881b in __assert_fail_base (fmt=0x780bc5fd01e8 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\",\n    assertion=assertion@entry=0x5919ec427d96 \"to_scroll >= 0\",\n    file=file@entry=0x5919ec4492e0 \"/home/ganders/src/neovim/src/nvim/message.c\", line=line@entry=2489,\n    function=function@entry=0x5919ec3ff7b0 <__PRETTY_FUNCTION__.1> \"msg_scroll_flush\") at ./assert/assert.c:96\n#6  0x0000780bc5e3b517 in __assert_fail (assertion=assertion@entry=0x5919ec427d96 \"to_scroll >= 0\",\n    file=file@entry=0x5919ec4492e0 \"/home/ganders/src/neovim/src/nvim/message.c\", line=line@entry=2489,\n    function=function@entry=0x5919ec3ff7b0 <__PRETTY_FUNCTION__.1> \"msg_scroll_flush\") at ./assert/assert.c:105\n#7  0x00005919ec15b84c in msg_scroll_flush () at /home/ganders/src/neovim/src/nvim/message.c:2489\n#8  0x00005919ec2886e9 in ui_flush () at /home/ganders/src/neovim/src/nvim/ui.c:559\n#9  0x00005919ec013154 in ui_flush () at /home/ganders/src/neovim/src/nvim/ui.c:189\n#10 screen_resize (height=<optimized out>, width=134) at /home/ganders/src/neovim/src/nvim/drawscreen.c:412\n#11 screen_resize (width=<optimized out>, height=<optimized out>) at /home/ganders/src/neovim/src/nvim/drawscreen.c:277\n#12 0x00005919ec2829ef in ui_refresh () at /home/ganders/src/neovim/src/nvim/ui.c:249\n#13 0x00005919ebfa5ebd in handle_nvim_ui_try_resize (channel_id=<optimized out>, args=..., arena=<optimized out>,\n    error=<optimized out>) at /home/ganders/src/neovim/build-release/src/nvim/auto/api/private/dispatch_wrappers.generated.h:6671\n#14 0x00005919ec170dd7 in request_event (argv=0x19ddcb) at /home/ganders/src/neovim/src/nvim/msgpack_rpc/channel.c:366\n#15 0x00005919ec072de0 in multiqueue_oneshot_event (argv=<optimized out>) at /home/ganders/src/neovim/src/nvim/event/multiqueue.c:283\n#16 0x00005919ec243996 in state_handle_k_event () at /home/ganders/src/neovim/src/nvim/state.c:120\n#17 0x00005919ec0a5d1d in command_line_execute (state=0x7fff0de743c0, key=<optimized out>)\n    at /home/ganders/src/neovim/src/nvim/ex_getln.c:1213\n#18 0x00005919ec243813 in state_enter (s=0x7fff0de743c0) at /home/ganders/src/neovim/src/nvim/state.c:102\n#19 0x00005919ec0a40b0 in command_line_enter (firstc=<optimized out>, count=count@entry=1, indent=indent@entry=0,\n    clear_ccline=clear_ccline@entry=false) at /home/ganders/src/neovim/src/nvim/ex_getln.c:871\n#20 0x00005919ec0a4fa8 in getcmdline_prompt (firstc=<optimized out>, prompt=<optimized out>, hl_id=<optimized out>,\n    xp_context=<optimized out>, xp_arg=<optimized out>, highlight_callback=..., one_key=<optimized out>, mouse_used=0x0)\n    at /home/ganders/src/neovim/src/nvim/ex_getln.c:2855\n#21 0x00005919ec0e5f85 in prompt_for_input (prompt=<optimized out>, hl_id=10, one_key=true, mouse_used=0x0)\n    at /home/ganders/src/neovim/src/nvim/input.c:171\n#22 0x00005919ec1605de in do_dialog (message=<optimized out>, buttons=<optimized out>, dfltbutton=1, ex_cmd=0,\n    textfield=<optimized out>, title=<optimized out>, type=<optimized out>) at /home/ganders/src/neovim/src/nvim/message.c:3572\n#23 0x00005919ec1564ed in do_dialog (ex_cmd=0, textfield=0x0, dfltbutton=1,\n    buttons=0x5919ec4495e0 \"&Open Read-Only\\n&Edit anyway\\n&Recover\\n&Delete it\\n&Quit\\n&Abort\",\n    message=0x591a13c274a0 \"Swap file \\\"~/.local/state/nvim/swap/%home%ganders%tmp.txt.swp\\\" already exists!\",\n    title=<optimized out>, type=2) at /home/ganders/src/neovim/src/nvim/memline.c:3254\n#24 findswapname (buf=<optimized out>, dirp=0x7fff0de752b0, old_fname=<optimized out>, found_existing_dir=0x7fff0de752af)\n    at /home/ganders/src/neovim/src/nvim/memline.c:3492\n#25 0x00005919ec14d46e in ml_open_file (buf=0x591a13b56510) at /home/ganders/src/neovim/src/nvim/memline.c:513\n#26 0x00005919ec0bddc0 in check_need_swap (newfile=true) at /home/ganders/src/neovim/src/nvim/memline.c:560\n#27 readfile (fname=0x591a13b6e460 \"tmp.txt\", sfname=0x591a13b6e460 \"tmp.txt\", from=0, lines_to_skip=0, lines_to_read=2147483647,\n    eap=0x0, flags=1, silent=true) at /home/ganders/src/neovim/src/nvim/fileio.c:457\n#28 0x00005919ebfceccc in open_buffer (read_stdin=false, eap=0x0, flags_arg=<optimized out>)\n    at /home/ganders/src/neovim/src/nvim/buffer.c:301\n#29 0x00005919ebf8433d in create_windows (parmp=0x7fff0de75b70) at /home/ganders/src/neovim/src/nvim/main.c:1709\n#30 main (argc=<optimized out>, argv=<optimized out>) at /home/ganders/src/neovim/src/nvim/main.c:542\n```\n\n</details>",
    "closed_at": "2025-06-10T18:54:05Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
        "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
        "followers_url": "https://api.github.com/users/gpanders/followers",
        "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
        "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gpanders",
        "id": 8965202,
        "login": "gpanders",
        "node_id": "MDQ6VXNlcjg5NjUyMDI=",
        "organizations_url": "https://api.github.com/users/gpanders/orgs",
        "received_events_url": "https://api.github.com/users/gpanders/received_events",
        "repos_url": "https://api.github.com/users/gpanders/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gpanders",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Bisected to e876a739eeb1c0c73bf633ff823a3313f3ea405d. \n\ncc @luukvbaal ",
            "created_at": "2025-06-10T18:52:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/34423#issuecomment-2960289475",
            "id": 2960289475,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34423",
            "node_id": "IC_kwDOAPphoM6wcm7D",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2960289475/reactions"
            },
            "updated_at": "2025-06-10T18:52:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2960289475",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Duplicate of https://github.com/neovim/neovim/issues/34088",
            "created_at": "2025-06-10T18:54:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/34423#issuecomment-2960292515",
            "id": 2960292515,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34423",
            "node_id": "IC_kwDOAPphoM6wcnqj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2960292515/reactions"
            },
            "updated_at": "2025-06-10T18:54:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2960292515",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34423/comments",
    "created_at": "2025-06-10T18:46:11Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34423/events",
    "html_url": "https://github.com/neovim/neovim/issues/34423",
    "id": 3134547642,
    "labels": [],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34423/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM661Wa6",
    "number": 34423,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34423/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "duplicate",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34423/timeline",
    "title": "Assertion `to_scroll >= 0' in msg_scroll_flush failed",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-10T18:54:06Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34423",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
        "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
        "followers_url": "https://api.github.com/users/gpanders/followers",
        "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
        "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gpanders",
        "id": 8965202,
        "login": "gpanders",
        "node_id": "MDQ6VXNlcjg5NjUyMDI=",
        "organizations_url": "https://api.github.com/users/gpanders/orgs",
        "received_events_url": "https://api.github.com/users/gpanders/received_events",
        "repos_url": "https://api.github.com/users/gpanders/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gpanders",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "An interesting case was [mentioned](https://twitter.com/cortesi/status/654769811914780673): Neo/Vim (~~on Windows only?~~) [creates a temporary file](https://github.com/neovim/neovim/blob/536c0ba27e79929eb30850d8e11f2ed026930ab3/src/nvim/fileio.c#L2710) to check if a directory is writable and see the resulting ACL. \n\n> So, if you’re writing software that watches for file changes, you’ll find **Vim [creates and deletes file 4913](https://github.com/b4winckler/vim/blob/1f611c1f921bc219b44272f13a298cd8d97aa6f0/src/fileio.c#L3704) on almost every edit**. [ref](https://twitter.com/cortesi/status/654770457141350400)\n\nvim_dev thread (2009): https://groups.google.com/d/msg/vim_dev/sppdpElxY44/v9fOtS1ji-cJ\n\n```\n3508 /* Close the file before removing it, on MS-Windows we\n3509  * can't delete an open file. */\n3510  close(fd);\n3511  mch_remove(IObuff);\n```\n\n> There's a race condition between lines 3510 and 3511, wherein another process could open a handle to the file and thus prevent the delete from succeeding.  One class of software that is known to do this and cause problems is antivirus programs, which want to scan things for viruses as soon as they are created.  Another class of software that sometimes causes problems is local search programs, which want to index things as soon as they are created.  Such software can do their tasks unobtrusively if they are written carefully and using the mechanisms provided by the operating system, namely oplocks.  Unfortunately there are lots of bad virus scanners and indexers out there (lots of bad software in general!).\n> \n> One solution which is very commonly used in Windows programs is to detect when a delete or rename operation fails (can be narrowed to specific error codes -- sharing violation and access denied), and retry a couple times with short delays in between.  The idea is to give the interfering process some time to finish whatever work it was doing with the file. ...  How many people out there have tried to delete a large hierarchy of files using \"rd /s /q\", and had it inexplicably fail to delete a few files?  Yet if you repeat the command it will generally succeed.  Most likely a virus scanner or search indexer got in the way and is now out of the way.\n> \n> Another solution, which is cleaner but can only be used in cases where you know you want to delete a file immediately after closing its handle, is to **set the delete disposition on the file before closing the handle.**  There are a couple of ways using Windows APIs to do this.  One way is to pass FILE_FLAG_DELETE_ON_CLOSE to CreateFile() when opening the handle originally.  Another way is to send down a FileDispositionInfo using SetFileInformationByHandle() or equivalent.  (Essentially the DeleteFile() API just does the following: open a handle, set delete disposition, and close the handle; if we break apart these steps, we gain finer control.)\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I have no idea where i'm right now with this, but yeah, it also happens on linux. ```NVIM v0.10.0-dev-12ccea596```\r\n\r\nIt happens **always** when some process uses inotify watchers. (im my situation its the rust dioxus serve + watch service which uses such under the hood)",
            "created_at": "2023-08-30T22:09:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/3460#issuecomment-1699917625",
            "id": 1699917625,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/3460",
            "node_id": "IC_kwDOAPphoM5lUq85",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1699917625/reactions"
            },
            "updated_at": "2023-08-30T22:11:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1699917625",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10587799?v=4",
                "events_url": "https://api.github.com/users/Polish-Civil/events{/privacy}",
                "followers_url": "https://api.github.com/users/Polish-Civil/followers",
                "following_url": "https://api.github.com/users/Polish-Civil/following{/other_user}",
                "gists_url": "https://api.github.com/users/Polish-Civil/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Polish-Civil",
                "id": 10587799,
                "login": "Polish-Civil",
                "node_id": "MDQ6VXNlcjEwNTg3Nzk5",
                "organizations_url": "https://api.github.com/users/Polish-Civil/orgs",
                "received_events_url": "https://api.github.com/users/Polish-Civil/received_events",
                "repos_url": "https://api.github.com/users/Polish-Civil/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Polish-Civil/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Polish-Civil/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Polish-Civil",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/3460/comments",
    "created_at": "2015-10-16T02:16:11Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/3460/events",
    "html_url": "https://github.com/neovim/neovim/issues/3460",
    "id": 111744658,
    "labels": [
        {
            "color": "F9D0C4",
            "default": false,
            "description": "wrong behavior inherited from vim",
            "id": 154310492,
            "name": "bug-vim",
            "node_id": "MDU6TGFiZWwxNTQzMTA0OTI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-vim"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "file metadata/attributes, filenames, path manipulation",
            "id": 3386070083,
            "name": "filesystem",
            "node_id": "LA_kwDOAPphoM7J01RD",
            "url": "https://api.github.com/repos/neovim/neovim/labels/filesystem"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/3460/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 686,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 635,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-01-21T00:09:37Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWUxMTE3NDQ2NTg=",
    "number": 3460,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 6,
        "-1": 0,
        "confused": 0,
        "eyes": 3,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 9,
        "url": "https://api.github.com/repos/neovim/neovim/issues/3460/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/3460/timeline",
    "title": "Vim may leave file named \"4913\" under certain conditions",
    "updated_at": "2025-01-19T11:48:20Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/3460",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\n@tris203 After #37161 I'm getting these errors during dart lsp registration and usage:\n```log\n Error  21:12:52 msg_show.echoerr LSP[dartls]: Error SERVER_REQUEST_HANDLER_ERROR: \"...eovim/HEAD-067b574_1/share/nvim/runtime/lua/vim/glob.lua:373: Invalid glob: **/**.dart\"\n Error  21:21:06 msg_show.emsg E5108: Lua: ...eovim/HEAD-067b574_1/share/nvim/runtime/lua/vim/glob.lua:373: Invalid glob: **/**.dart\nstack traceback:\n\t[C]: in function 'assert'\n\t...eovim/HEAD-067b574_1/share/nvim/runtime/lua/vim/glob.lua:373: in function 'to_lpeg'\n\t...HEAD-067b574_1/share/nvim/runtime/lua/vim/lsp/client.lua:1044: in function '_get_registrations'\n\t...HEAD-067b574_1/share/nvim/runtime/lua/vim/lsp/client.lua:1206: in function 'supports_method'\n\t...neovim/HEAD-067b574_1/share/nvim/runtime/lua/vim/lsp.lua:1169: in function 'buf_request'\n\t....local/share/nvim/lazy/noice.nvim/lua/noice/lsp/init.lua:66: in function <....local/share/nvim/lazy/noice.nvim/lua/noice/lsp/init.lua:64>\n```\n\nfirst showed when opening the file. The lsp still gets registered fine but I can't use any of it's features like getting hover messages or code actions.\n\nThe issue is that globs like `**.dart` are no longer supported the same:\nhttps://github.com/dart-lang/sdk/blob/fe6de046db85172e7610dd23343cb601c0662539/pkg/analysis_server_plugin/lib/src/plugin_server.dart#L253\n\nin LSP glob the pattern is kinda equivalent to  `**/*.dart` but we expand it to `**/**.dart` which isn't valid.\n\n### Steps to reproduce\n\nUse this init.lua (with your own source for the dart command but you'll need version 3.10 which supports the feature that uses `**.dart` pattern):\n\n```lua\nvim.lsp.config(\"dartls\", {\n  cmd = { 'dart', 'language-server', '--protocol=lsp' },\n  filetypes = { 'dart' },\n  root_markers = { 'pubspec.yaml' },\n})\nvim.lsp.enable(\"dartls\")\n```\n\nCreate a new dart project:\n```sh\ndart create app\n```\nchange the generated analysis_options.yaml to have a plugin like:\n```yaml\nplugins:\n  riverpod_lint: ^3.1.0\n```\n\nand then:\n```sh\nnvim app/lib/app.dart\n```\n\nNotice the error:\n```log\nLSP[dartls]: Error SERVER_REQUEST_HANDLER_ERROR: \"...eovim/HEAD-067b574_1/share/nvim/runtime/lua/vim/glob.lua:373: Invalid glob: **/**.dart\"\n```\n\nI tested that the version prior to #37169 doesn't not have this issue a3c56d1002ced628a69e098ca401fc93d8afe291\n\n### Expected behavior\n\njust works without issues as in a3c56d1002ced628a69e098ca401fc93d8afe291\n\n### Nvim version (nvim -v)\n\nv0.12.0-dev-1945+g067b5743f5-Homebrew\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\nmacOS 26.2 (25C56)\n\n### Terminal name/version\n\nghostty  xterm-256color\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nhomebrew",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "It's not so much they they aren't supported the same\nIt's just that now they are actually checked\n\nI'm not convinced that `**.dart` is a valid pattern\n@brynne8 might have thoughts \n\nhttps://github.com/neovim/neovim/blob/master/runtime%2Flua%2Fvim%2Fglob.lua#L23-L27\n\n\n\n\n",
            "created_at": "2026-01-03T08:28:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/37204#issuecomment-3706892270",
            "id": 3706892270,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37204",
            "node_id": "IC_kwDOAPphoM7c8q_u",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3706892270/reactions"
            },
            "updated_at": "2026-01-03T08:28:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3706892270",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I see, it seems like Dart glob package is the one violating the spec\n\nhttps://github.com/dart-lang/sdk/blob/df5701473c9147a5dde84ad8ab036e079305a1e1/pkg/analyzer/lib/src/util/glob.dart#L15\n\nhttps://pub.dev/packages/glob#match-any-characters-across-directories-",
            "created_at": "2026-01-03T10:22:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/37204#issuecomment-3706955534",
            "id": 3706955534,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37204",
            "node_id": "IC_kwDOAPphoM7c86cO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3706955534/reactions"
            },
            "updated_at": "2026-01-03T10:22:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3706955534",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/44401412?v=4",
                "events_url": "https://api.github.com/users/khensunny/events{/privacy}",
                "followers_url": "https://api.github.com/users/khensunny/followers",
                "following_url": "https://api.github.com/users/khensunny/following{/other_user}",
                "gists_url": "https://api.github.com/users/khensunny/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/khensunny",
                "id": 44401412,
                "login": "khensunny",
                "node_id": "MDQ6VXNlcjQ0NDAxNDEy",
                "organizations_url": "https://api.github.com/users/khensunny/orgs",
                "received_events_url": "https://api.github.com/users/khensunny/received_events",
                "repos_url": "https://api.github.com/users/khensunny/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/khensunny/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/khensunny/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/khensunny",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Should my proposed fix be `*.dart` or `**/*.dart`?\n\nThere error I got in nvim is `**/**.dart` is not a valid pattern. \n\nI'm also wondering why vscode didn't break/complain about `**.dart`",
            "created_at": "2026-01-03T10:29:21Z",
            "html_url": "https://github.com/neovim/neovim/issues/37204#issuecomment-3706958892",
            "id": 3706958892,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37204",
            "node_id": "IC_kwDOAPphoM7c87Qs",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3706958892/reactions"
            },
            "updated_at": "2026-01-03T10:29:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3706958892",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/44401412?v=4",
                "events_url": "https://api.github.com/users/khensunny/events{/privacy}",
                "followers_url": "https://api.github.com/users/khensunny/followers",
                "following_url": "https://api.github.com/users/khensunny/following{/other_user}",
                "gists_url": "https://api.github.com/users/khensunny/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/khensunny",
                "id": 44401412,
                "login": "khensunny",
                "node_id": "MDQ6VXNlcjQ0NDAxNDEy",
                "organizations_url": "https://api.github.com/users/khensunny/orgs",
                "received_events_url": "https://api.github.com/users/khensunny/received_events",
                "repos_url": "https://api.github.com/users/khensunny/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/khensunny/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/khensunny/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/khensunny",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Should my proposed fix be `*.dart` or `**/*.dart`?\n> \n> There error I got in nvim is `**/**.dart` is not a valid pattern.\n> \n> I'm also wondering why vscode didn't break/complain about `**.dart`\n\nThe proposed fix should be `**/*.dart` if you want to match Dart files in all directories.\n\nThe `*.dart` pattern would only match Dart files in the current directory, which isn't the same as using `**/*.dart`, which recursively matches Dart files in all subdirectories.",
            "created_at": "2026-01-04T08:28:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/37204#issuecomment-3707862972",
            "id": 3707862972,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37204",
            "node_id": "IC_kwDOAPphoM7dAX-8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3707862972/reactions"
            },
            "updated_at": "2026-01-04T08:28:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3707862972",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7542439?v=4",
                "events_url": "https://api.github.com/users/brynne8/events{/privacy}",
                "followers_url": "https://api.github.com/users/brynne8/followers",
                "following_url": "https://api.github.com/users/brynne8/following{/other_user}",
                "gists_url": "https://api.github.com/users/brynne8/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brynne8",
                "id": 7542439,
                "login": "brynne8",
                "node_id": "MDQ6VXNlcjc1NDI0Mzk=",
                "organizations_url": "https://api.github.com/users/brynne8/orgs",
                "received_events_url": "https://api.github.com/users/brynne8/received_events",
                "repos_url": "https://api.github.com/users/brynne8/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brynne8/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brynne8/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brynne8",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I agree the Dart LSP server should probably tweak the glob here (and make it clearer the format of that glob for plugins). However, I also think neovim probably should not fail here. I can't find anything stating that this glob is _invalid_. As far as I can tell, there is no proper spec for glob, and both bash and the npm minimatch package accept the glob `**.dart` without failing (even if they might not match what was intended).\n\nLSP specifies the rules itself, so it's also not clear if bash (or npm)s behaviour matters that much, but it also doesn't define that globs can be invalid or that `**` must be followed by `/`.\n\nWe could request that the LSP spec is made clearer, but based on previous experience it's very likely the spec update would be to match the current VS Code behaviour (rightly or wrongly, that's how things tend to go). Here's a test script showing `minimatch` behaviour:\n\n```js\nconst minimatch = require('minimatch');\n\nconst allFiles = [\n\t'/1.dart',\n\t'/2/3.dart',\n\t'/4/5/6.dart',\n];\n\nfor (const pattern of [\n\t'*.dart',\n\t'**.dart',\n\t'**/*.dart',\n\t'**/**.dart',\n\t'**/**/*.dart',\n\t'**/**/**.dart',\n]) {\n\tconsole.log(pattern);\n\tconst matches = allFiles.filter(path => minimatch(path, pattern));\n\tconsole.log(matches.map((m) => `  - ${m}`).join(\"\\n\"));\n\tconsole.log();\n}\n```\n\n```\nPS D:\\Dev\\Test Projects\\node> node .\\glob.js\n*.dart\n\n\n**.dart\n\n\n**/*.dart\n  - /1.dart\n  - /2/3.dart\n  - /4/5/6.dart\n\n**/**.dart\n  - /1.dart\n  - /2/3.dart\n  - /4/5/6.dart\n\n**/**/*.dart\n  - /1.dart\n  - /2/3.dart\n  - /4/5/6.dart\n\n**/**/**.dart\n  - /1.dart\n  - /2/3.dart\n  - /4/5/6.dart\n```",
            "created_at": "2026-01-05T12:26:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/37204#issuecomment-3710224440",
            "id": 3710224440,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37204",
            "node_id": "IC_kwDOAPphoM7dJYg4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3710224440/reactions"
            },
            "updated_at": "2026-01-05T12:26:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3710224440",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1078012?v=4",
                "events_url": "https://api.github.com/users/DanTup/events{/privacy}",
                "followers_url": "https://api.github.com/users/DanTup/followers",
                "following_url": "https://api.github.com/users/DanTup/following{/other_user}",
                "gists_url": "https://api.github.com/users/DanTup/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DanTup",
                "id": 1078012,
                "login": "DanTup",
                "node_id": "MDQ6VXNlcjEwNzgwMTI=",
                "organizations_url": "https://api.github.com/users/DanTup/orgs",
                "received_events_url": "https://api.github.com/users/DanTup/received_events",
                "repos_url": "https://api.github.com/users/DanTup/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DanTup/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DanTup/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DanTup",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": " \n> We could request that the LSP spec is made clearer, but based on previous experience it's very likely the spec update would be to match the current VS Code behaviour (rightly or wrongly, that's how things tend to go). \n\nThat's generally really useful for us. \nNeovim's approach has always been that we implement the spec and where there is ambiguity we seek clarification",
            "created_at": "2026-01-05T17:15:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/37204#issuecomment-3711347096",
            "id": 3711347096,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37204",
            "node_id": "IC_kwDOAPphoM7dNqmY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3711347096/reactions"
            },
            "updated_at": "2026-01-05T17:15:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3711347096",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18444302?v=4",
                "events_url": "https://api.github.com/users/tris203/events{/privacy}",
                "followers_url": "https://api.github.com/users/tris203/followers",
                "following_url": "https://api.github.com/users/tris203/following{/other_user}",
                "gists_url": "https://api.github.com/users/tris203/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tris203",
                "id": 18444302,
                "login": "tris203",
                "node_id": "MDQ6VXNlcjE4NDQ0MzAy",
                "organizations_url": "https://api.github.com/users/tris203/orgs",
                "received_events_url": "https://api.github.com/users/tris203/received_events",
                "repos_url": "https://api.github.com/users/tris203/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tris203/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tris203/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tris203",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37204/comments",
    "created_at": "2026-01-02T23:52:35Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37204/events",
    "html_url": "https://github.com/neovim/neovim/issues/37204",
    "id": 3777458527,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue has been tracked to a specific commit",
            "id": 1481421490,
            "name": "has:bisected",
            "node_id": "MDU6TGFiZWwxNDgxNDIxNDkw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:bisected"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37204/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7hJ3Ff",
    "number": 37204,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37204/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37204/timeline",
    "title": "After #37161 I get Invalid glob in lsp registration and usage",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-01-05T17:15:13Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37204",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/44401412?v=4",
        "events_url": "https://api.github.com/users/khensunny/events{/privacy}",
        "followers_url": "https://api.github.com/users/khensunny/followers",
        "following_url": "https://api.github.com/users/khensunny/following{/other_user}",
        "gists_url": "https://api.github.com/users/khensunny/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/khensunny",
        "id": 44401412,
        "login": "khensunny",
        "node_id": "MDQ6VXNlcjQ0NDAxNDEy",
        "organizations_url": "https://api.github.com/users/khensunny/orgs",
        "received_events_url": "https://api.github.com/users/khensunny/received_events",
        "repos_url": "https://api.github.com/users/khensunny/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/khensunny/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/khensunny/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/khensunny",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "- `nvim --version`: NVIM v0.4.0-1191-g740fb337d\r\n- `vim -u DEFAULTS` (version: 8.1) behaves differently? It doesn't have a `TermClose` event\r\n- Operating system/version: Fedora Linux 30\r\n- Terminal name/version: gnome-terminal\r\n- `$TERM`: xterm-256color\r\n\r\n### Steps to reproduce using `nvim -u NORC`\r\n\r\n```\r\nnvim -u NORC\r\n:autocmd TermClose * bd!\r\n:term\r\n:bd!\r\n```\r\n\r\n### Actual behaviour\r\n\r\nMemory is corrupted, nvim crashes immediately or soon after\r\n\r\n### Expected behaviour\r\n\r\nDoes something reasonable\r\n\r\n### Notes\r\n\r\nA few minutes in gdb suggests the problem comes down to `termincal_close()` running autocmds and reentering `do_bufdel`, which is presumably not safe to reenter.",
    "closed_at": "2026-01-05T23:17:39Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Is this related to the following test? It became flaky recently.\r\n```\r\n[  ERROR   ] 1 error, listed below:\r\n[  ERROR   ] ...im/neovim/test/functional/autocmd/termclose_spec.lua @ 20: TermClose event triggers when fast-exiting terminal job stops\r\ntest/functional/helpers.lua:96: Vim(call):E900: Invalid channel id\r\nstack traceback:\r\n\ttest/functional/helpers.lua:96: in function 'request'\r\n\ttest/functional/helpers.lua:254: in function 'command'\r\n\t...im/neovim/test/functional/autocmd/termclose_spec.lua:23: in function <...im/neovim/test/functional/autocmd/termclose_spec.lua:20>\r\n 17 SKIPPED TESTS\r\n 1 ERROR\r\n-- Output to stderr:\r\nCMake Error at /home/travis/build/neovim/neovim/cmake/RunTests.cmake:63 (message):\r\n  functional tests failed with error: 1\r\n```",
            "created_at": "2019-07-01T19:56:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507402777",
            "id": 507402777,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQwMjc3Nw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507402777/reactions"
            },
            "updated_at": "2019-07-01T19:56:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507402777",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8740057?v=4",
                "events_url": "https://api.github.com/users/janlazo/events{/privacy}",
                "followers_url": "https://api.github.com/users/janlazo/followers",
                "following_url": "https://api.github.com/users/janlazo/following{/other_user}",
                "gists_url": "https://api.github.com/users/janlazo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/janlazo",
                "id": 8740057,
                "login": "janlazo",
                "node_id": "MDQ6VXNlcjg3NDAwNTc=",
                "organizations_url": "https://api.github.com/users/janlazo/orgs",
                "received_events_url": "https://api.github.com/users/janlazo/received_events",
                "repos_url": "https://api.github.com/users/janlazo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/janlazo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/janlazo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/janlazo",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "```\r\n#0  0x00007f598eef3c87 in __strlen_avx2 () from /usr/lib/libc.so.6\r\n#1  0x000055ee91c98728 in xstrdup (str=0x55eea4e60430 <error: Cannot access memory at address 0x55eea4e60430>) at ../src/nvim/memory.c:418\r\n#2  0x000055ee91e27492 in vim_strsave (string=0x55eea4e60430 <error: Cannot access memory at address 0x55eea4e60430>) at ../src/nvim/strings.c:58\r\n#3  0x000055ee91b1c861 in get_buffer_lines (buf=0x55ee92494a50, start=1, end=1, retlist=0, rettv=0x7fffa7829040) at ../src/nvim/eval.c:9661\r\n#4  0x000055ee91b1f1d3 in f_getline (argvars=0x7fffa7828980, rettv=0x7fffa7829040, fptr=0x0) at ../src/nvim/eval.c:10355\r\n#5  0x000055ee91b0f644 in call_func (funcname=0x55ee924998c0 \"getline\", len=7, rettv=0x7fffa7829040, argcount_in=1, argvars_in=0x7fffa7828980, argv_func=0x0, firstline=1, lastline=1, doesrange=0x7fffa7828b3c,\r\n    evaluate=true, partial=0x0, selfdict_in=0x0) at ../src/nvim/eval.c:6553\r\n#6  0x000055ee91b0e679 in get_func_tv (name=0x55ee924998c0 \"getline\", len=7, rettv=0x7fffa7829040, arg=0x7fffa7828fe0, firstline=1, lastline=1, doesrange=0x7fffa7828b3c, evaluate=1, partial=0x0, selfdict=0x0)\r\n    at ../src/nvim/eval.c:6294\r\n#7  0x000055ee91b06873 in eval7 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1, want_string=0) at ../src/nvim/eval.c:4397\r\n#8  0x000055ee91b058d7 in eval6 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1, want_string=0) at ../src/nvim/eval.c:4094\r\n#9  0x000055ee91b04fb3 in eval5 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1) at ../src/nvim/eval.c:3942\r\n#10 0x000055ee91b038e8 in eval4 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1) at ../src/nvim/eval.c:3678\r\n#11 0x000055ee91b03577 in eval3 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1) at ../src/nvim/eval.c:3596\r\n#12 0x000055ee91b03235 in eval2 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1) at ../src/nvim/eval.c:3527\r\n#13 0x000055ee91b02e64 in eval1 (arg=0x7fffa7828fe0, rettv=0x7fffa7829040, evaluate=1) at ../src/nvim/eval.c:3454\r\n#14 0x000055ee91b02ccc in eval0 (arg=0x55ee9274de4d \"getline(c_lnum)\", rettv=0x7fffa7829040, nextcmd=0x7fffa7829168, evaluate=1) at ../src/nvim/eval.c:3414\r\n#15 0x000055ee91afb0f4 in ex_let_const (eap=0x7fffa7829160, is_const=false) at ../src/nvim/eval.c:1604\r\n#16 0x000055ee91afac5b in ex_let (eap=0x7fffa7829160) at ../src/nvim/eval.c:1545\r\n#17 0x000055ee91bb158f in do_one_cmd (cmdlinep=0x7fffa7829360, flags=7, cstack=0x7fffa7829480, fgetline=0x55ee91b5253b <get_func_line>, cookie=0x55ee924af2d0) at ../src/nvim/ex_docmd.c:2248\r\n#18 0x000055ee91bab0ae in do_cmdline (cmdline=0x0, fgetline=0x55ee91b5253b <get_func_line>, cookie=0x55ee924af2d0, flags=7) at ../src/nvim/ex_docmd.c:593\r\n#19 0x000055ee91b50d4b in call_user_func (fp=0x55ee926a3fd0, argcount=0, argvars=0x7fffa782a020, rettv=0x7fffa782a200, firstline=1, lastline=1, selfdict=0x0) at ../src/nvim/eval.c:22618\r\n#20 0x000055ee91b0f520 in call_func (funcname=0x55ee927506b0 \"\\200\\375R17_Highlight_Matching_Pair\", len=29, rettv=0x7fffa782a200, argcount_in=0, argvars_in=0x7fffa782a020, argv_func=0x0, firstline=1, lastline=1,\r\n    doesrange=0x7fffa782a1cc, evaluate=true, partial=0x0, selfdict_in=0x0) at ../src/nvim/eval.c:6538\r\n#21 0x000055ee91b0e679 in get_func_tv (name=0x55ee927506b0 \"\\200\\375R17_Highlight_Matching_Pair\", len=29, rettv=0x7fffa782a200, arg=0x7fffa782a1d0, firstline=1, lastline=1, doesrange=0x7fffa782a1cc, evaluate=1,\r\n    partial=0x0, selfdict=0x0) at ../src/nvim/eval.c:6294\r\n#22 0x000055ee91b00c5d in ex_call (eap=0x7fffa782a330) at ../src/nvim/eval.c:2891\r\n#23 0x000055ee91bb158f in do_one_cmd (cmdlinep=0x7fffa782a530, flags=7, cstack=0x7fffa782a650, fgetline=0x55ee91b5253b <get_func_line>, cookie=0x55ee9272f2d0) at ../src/nvim/ex_docmd.c:2248\r\n#24 0x000055ee91bab0ae in do_cmdline (cmdline=0x0, fgetline=0x55ee91b5253b <get_func_line>, cookie=0x55ee9272f2d0, flags=7) at ../src/nvim/ex_docmd.c:593\r\n#25 0x000055ee91b50d4b in call_user_func (fp=0x55ee924b60d0, argcount=1, argvars=0x7fffa782b210, rettv=0x7fffa782b200, firstline=1, lastline=1, selfdict=0x55ee9268c790) at ../src/nvim/eval.c:22618\r\n#26 0x000055ee91b0f520 in call_func (funcname=0x55ee924984a0 \"2\", len=1, rettv=0x7fffa782b200, argcount_in=1, argvars_in=0x7fffa782b210, argv_func=0x0, firstline=1, lastline=1, doesrange=0x7fffa782b1a4,\r\n    evaluate=true, partial=0x55ee9274f0e0, selfdict_in=0x0) at ../src/nvim/eval.c:6538\r\n#27 0x000055ee91b3dbdc in callback_call (callback=0x55ee9269e640, argcount_in=1, argvars_in=0x7fffa782b210, rettv=0x7fffa782b200) at ../src/nvim/eval.c:17880\r\n#28 0x000055ee91b3eb60 in timer_due_cb (tw=0x55ee9269e560, data=0x55ee9269e560) at ../src/nvim/eval.c:18100\r\n#29 0x000055ee91b8178e in time_event (argv=0x7fffa782b298) at ../src/nvim/event/time.c:50\r\n#30 0x000055ee91b7abde in multiqueue_process_events (this=0x55ee92482370) at ../src/nvim/event/multiqueue.c:150\r\n#31 0x000055ee91ceb578 in nv_event (cap=0x7fffa782b428) at ../src/nvim/normal.c:7983\r\n#32 0x000055ee91ccf4ce in normal_execute (state=0x7fffa782b3a0, key=-26365) at ../src/nvim/normal.c:1130\r\n#33 0x000055ee91e26b26 in state_enter (s=0x7fffa782b3a0) at ../src/nvim/state.c:73\r\n#34 0x000055ee91ccbd45 in normal_enter (cmdwin=false, noexmode=false) at ../src/nvim/normal.c:462\r\n#35 0x000055ee91c64ed5 in main (argc=3, argv=0x7fffa782b728) at ../src/nvim/main.c:568\r\n```\r\n",
            "created_at": "2019-07-01T20:09:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507406853",
            "id": 507406853,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQwNjg1Mw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507406853/reactions"
            },
            "updated_at": "2019-07-01T20:09:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507406853",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9766?v=4",
                "events_url": "https://api.github.com/users/blueyed/events{/privacy}",
                "followers_url": "https://api.github.com/users/blueyed/followers",
                "following_url": "https://api.github.com/users/blueyed/following{/other_user}",
                "gists_url": "https://api.github.com/users/blueyed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blueyed",
                "id": 9766,
                "login": "blueyed",
                "node_id": "MDQ6VXNlcjk3NjY=",
                "organizations_url": "https://api.github.com/users/blueyed/orgs",
                "received_events_url": "https://api.github.com/users/blueyed/received_events",
                "repos_url": "https://api.github.com/users/blueyed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blueyed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blueyed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blueyed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Can reproduce it with v0.3.7 also.",
            "created_at": "2019-07-01T20:21:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507410992",
            "id": 507410992,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQxMDk5Mg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507410992/reactions"
            },
            "updated_at": "2019-07-01T20:21:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507410992",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9766?v=4",
                "events_url": "https://api.github.com/users/blueyed/events{/privacy}",
                "followers_url": "https://api.github.com/users/blueyed/followers",
                "following_url": "https://api.github.com/users/blueyed/following{/other_user}",
                "gists_url": "https://api.github.com/users/blueyed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blueyed",
                "id": 9766,
                "login": "blueyed",
                "node_id": "MDQ6VXNlcjk3NjY=",
                "organizations_url": "https://api.github.com/users/blueyed/orgs",
                "received_events_url": "https://api.github.com/users/blueyed/received_events",
                "repos_url": "https://api.github.com/users/blueyed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blueyed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blueyed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blueyed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@blueyed does https://github.com/neovim/neovim/pull/8839 (formerly https://github.com/neovim/neovim/pull/7095) fix it?",
            "created_at": "2019-07-01T22:20:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507446423",
            "id": 507446423,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQ0NjQyMw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507446423/reactions"
            },
            "updated_at": "2019-07-01T22:21:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507446423",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk \r\nOn `:bd!`:\r\n```\r\nE315: ml_get: invalid lnum: 1\r\nError detected while processing function 1:\r\nline    2:\r\nE16: Invalid range:     call timer_stop(s:delayed_show.show_timer)\r\nPress ENTER or type command to continue\r\n```\r\n(via delayed matchparen plugin, https://github.com/vim/vim/pull/1338)\r\n\r\nAfter `ENTER` it also crashes (differently):\r\n\r\n> [1]    11187 floating point exception (core dumped)  nvim -u NORC\r\n```\r\n#0  0x00005643bab7bbed in fileinfo (fullname=0, shorthelp=1, dont_truncate=0) at ../src/nvim/buffer.c:2848\r\n2848        n = (int)(((long)curwin->w_cursor.lnum * 100L) /\r\n[Current thread is 1 (Thread 0x7fc8e461efc0 (LWP 11187))]\r\n(gdb) bt\r\n#0  0x00005643bab7bbed in fileinfo (fullname=0, shorthelp=1, dont_truncate=0) at ../src/nvim/buffer.c:2848\r\n#1  0x00005643bad93ecc in normal_redraw (s=0x7ffd09484b60) at ../src/nvim/normal.c:1273\r\n#2  0x00005643bad9427a in normal_check (state=0x7ffd09484b60) at ../src/nvim/normal.c:1335\r\n#3  0x00005643baedbda1 in state_enter (s=0x7ffd09484b60) at ../src/nvim/state.c:28\r\n#4  0x00005643bad8fde5 in normal_enter (cmdwin=false, noexmode=false) at ../src/nvim/normal.c:467\r\n#5  0x00005643bad2ea3b in main (argc=3, argv=0x7ffd09484eb8) at ../src/nvim/main.c:566\r\n```\r\n\r\nWith `nvim -u NONE` there is only:\r\n\r\n> E315: ml_get: invalid lnum: 1[1]    13048 floating point exception (core dumped)  nvim -u NONE",
            "created_at": "2019-07-01T22:31:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507448928",
            "id": 507448928,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQ0ODkyOA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507448928/reactions"
            },
            "updated_at": "2025-10-29T02:15:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507448928",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9766?v=4",
                "events_url": "https://api.github.com/users/blueyed/events{/privacy}",
                "followers_url": "https://api.github.com/users/blueyed/followers",
                "following_url": "https://api.github.com/users/blueyed/following{/other_user}",
                "gists_url": "https://api.github.com/users/blueyed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blueyed",
                "id": 9766,
                "login": "blueyed",
                "node_id": "MDQ6VXNlcjk3NjY=",
                "organizations_url": "https://api.github.com/users/blueyed/orgs",
                "received_events_url": "https://api.github.com/users/blueyed/received_events",
                "repos_url": "https://api.github.com/users/blueyed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blueyed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blueyed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blueyed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@justinmk \r\nDoesn't it happen for you with `nvim -u NONE -c 'autocmd TermClose * bd!' -c 'term' -c 'bd!'`?",
            "created_at": "2019-07-01T22:36:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507449938",
            "id": 507449938,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQ0OTkzOA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507449938/reactions"
            },
            "updated_at": "2019-07-01T22:36:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507449938",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9766?v=4",
                "events_url": "https://api.github.com/users/blueyed/events{/privacy}",
                "followers_url": "https://api.github.com/users/blueyed/followers",
                "following_url": "https://api.github.com/users/blueyed/following{/other_user}",
                "gists_url": "https://api.github.com/users/blueyed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blueyed",
                "id": 9766,
                "login": "blueyed",
                "node_id": "MDQ6VXNlcjk3NjY=",
                "organizations_url": "https://api.github.com/users/blueyed/orgs",
                "received_events_url": "https://api.github.com/users/blueyed/received_events",
                "repos_url": "https://api.github.com/users/blueyed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blueyed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blueyed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blueyed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "vim/vim@94f01956a (v8.1.0342) looks relevant.\r\nBefore: vim/vim@a997b45c7 (v8.0.1732).",
            "created_at": "2019-07-01T22:48:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507452715",
            "id": 507452715,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQ1MjcxNQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507452715/reactions"
            },
            "updated_at": "2019-07-01T22:54:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507452715",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9766?v=4",
                "events_url": "https://api.github.com/users/blueyed/events{/privacy}",
                "followers_url": "https://api.github.com/users/blueyed/followers",
                "following_url": "https://api.github.com/users/blueyed/following{/other_user}",
                "gists_url": "https://api.github.com/users/blueyed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blueyed",
                "id": 9766,
                "login": "blueyed",
                "node_id": "MDQ6VXNlcjk3NjY=",
                "organizations_url": "https://api.github.com/users/blueyed/orgs",
                "received_events_url": "https://api.github.com/users/blueyed/received_events",
                "repos_url": "https://api.github.com/users/blueyed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blueyed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blueyed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blueyed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Perhaps, 8.0.1119 is relevant for `close_buffer` changes.",
            "created_at": "2019-07-02T01:18:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507480547",
            "id": 507480547,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQ4MDU0Nw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507480547/reactions"
            },
            "updated_at": "2019-07-02T01:18:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507480547",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8740057?v=4",
                "events_url": "https://api.github.com/users/janlazo/events{/privacy}",
                "followers_url": "https://api.github.com/users/janlazo/followers",
                "following_url": "https://api.github.com/users/janlazo/following{/other_user}",
                "gists_url": "https://api.github.com/users/janlazo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/janlazo",
                "id": 8740057,
                "login": "janlazo",
                "node_id": "MDQ6VXNlcjg3NDAwNTc=",
                "organizations_url": "https://api.github.com/users/janlazo/orgs",
                "received_events_url": "https://api.github.com/users/janlazo/received_events",
                "repos_url": "https://api.github.com/users/janlazo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/janlazo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/janlazo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/janlazo",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@janlazo \r\nYes.  Had a pending comment on https://github.com/neovim/neovim/pull/8839#issuecomment-507491343.",
            "created_at": "2019-07-02T02:19:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-507491446",
            "id": 507491446,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzQ5MTQ0Ng==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507491446/reactions"
            },
            "updated_at": "2019-07-02T02:19:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/507491446",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9766?v=4",
                "events_url": "https://api.github.com/users/blueyed/events{/privacy}",
                "followers_url": "https://api.github.com/users/blueyed/followers",
                "following_url": "https://api.github.com/users/blueyed/following{/other_user}",
                "gists_url": "https://api.github.com/users/blueyed/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blueyed",
                "id": 9766,
                "login": "blueyed",
                "node_id": "MDQ6VXNlcjk3NjY=",
                "organizations_url": "https://api.github.com/users/blueyed/orgs",
                "received_events_url": "https://api.github.com/users/blueyed/received_events",
                "repos_url": "https://api.github.com/users/blueyed/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blueyed/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blueyed/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blueyed",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I think I still get this seg fault & subsequent crash with NeoVim 0.5,\r\nis there any consensus on what to do?\r\n[\r\nCould be similar too this?](https://github.com/neovim/neovim/issues/2359)\r\n\r\n`nvim -u NONE -c 'autocmd TermClose * bd!' -c 'term' -c 'bd!'`\r\n\r\n- nvim --version:\r\n`NVIM v0.5.0\r\nBuild type: RelWithDebInfo\r\nLuaJIT 2.1.0-beta3`\r\n\r\n- Operating system/version: Debian Buster `Linux 4.19.0-17-amd64 x86_64`\r\n- Terminal name/version: Konsole\r\n- $TERM: xterm-256color\r\n\r\n\r\nThanks for NeoVim! It's awesome :) ",
            "created_at": "2021-07-22T06:47:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-884691351",
            "id": 884691351,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM40u1GX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/884691351/reactions"
            },
            "updated_at": "2022-07-04T12:29:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/884691351",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3367398?v=4",
                "events_url": "https://api.github.com/users/G-Rowell/events{/privacy}",
                "followers_url": "https://api.github.com/users/G-Rowell/followers",
                "following_url": "https://api.github.com/users/G-Rowell/following{/other_user}",
                "gists_url": "https://api.github.com/users/G-Rowell/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/G-Rowell",
                "id": 3367398,
                "login": "G-Rowell",
                "node_id": "MDQ6VXNlcjMzNjczOTg=",
                "organizations_url": "https://api.github.com/users/G-Rowell/orgs",
                "received_events_url": "https://api.github.com/users/G-Rowell/received_events",
                "repos_url": "https://api.github.com/users/G-Rowell/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/G-Rowell/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/G-Rowell/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/G-Rowell",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I am starting to work on this and port vim patches that should fix this.",
            "created_at": "2021-08-04T09:18:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-892502833",
            "id": 892502833,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM41MoMx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/892502833/reactions"
            },
            "updated_at": "2021-08-04T09:18:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/892502833",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/39092278?v=4",
                "events_url": "https://api.github.com/users/vigoux/events{/privacy}",
                "followers_url": "https://api.github.com/users/vigoux/followers",
                "following_url": "https://api.github.com/users/vigoux/following{/other_user}",
                "gists_url": "https://api.github.com/users/vigoux/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vigoux",
                "id": 39092278,
                "login": "vigoux",
                "node_id": "MDQ6VXNlcjM5MDkyMjc4",
                "organizations_url": "https://api.github.com/users/vigoux/orgs",
                "received_events_url": "https://api.github.com/users/vigoux/received_events",
                "repos_url": "https://api.github.com/users/vigoux/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vigoux/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vigoux/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vigoux",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Related but doesn't fix this issue:\r\n\r\n- https://github.com/neovim/neovim/pull/18453\r\n- https://github.com/neovim/neovim/pull/18832\r\n- https://github.com/neovim/neovim/pull/18978",
            "created_at": "2022-06-26T11:23:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-1166500754",
            "id": 1166500754,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM5Fh2OS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1166500754/reactions"
            },
            "updated_at": "2022-06-26T11:24:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1166500754",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "see https://github.com/neovim/neovim/pull/15267#discussion_r913752143 : \r\n\r\nFor the case where altbuf is the first default empty buffer,  `do_buffer` calls `set_curbuf` with the wrong arg. Maybe just need a change in `do_buffer` for that case.\r\n\r\n",
            "created_at": "2022-07-05T13:51:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-1175085952",
            "id": 1175085952,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM5GCmOA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1175085952/reactions"
            },
            "updated_at": "2022-07-05T13:51:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1175085952",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I just noticed that this crash also still happens with multiple splits:\r\n```vim\r\nautocmd TermClose * bdelete!\r\nvnew\r\nterminal\r\nbdelete!\r\n```",
            "created_at": "2022-07-05T13:59:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-1175095071",
            "id": 1175095071,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM5GCocf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1175095071/reactions"
            },
            "updated_at": "2022-07-05T13:59:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1175095071",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Interesting, there is no altbuf in that case. I think it's same root cause as https://github.com/neovim/neovim/blob/2536bde6c9ef5f0a94c0d3789a18a14de6a0a666/test/functional/autocmd/termxx_spec.lua#L30 where there also isn't really an altbuf (except internally `do_buffer` seems to think there is).",
            "created_at": "2022-07-05T14:09:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-1175106563",
            "id": 1175106563,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM5GCrQD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1175106563/reactions"
            },
            "updated_at": "2022-07-05T14:09:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1175106563",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Perhaps we can defer the `TermClosed` event https://github.com/neovim/neovim/issues/35366",
            "created_at": "2025-10-29T02:22:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-3459367424",
            "id": 3459367424,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM7OMcIA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3459367424/reactions"
            },
            "updated_at": "2025-10-29T02:22:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3459367424",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I just noticed that this crash also still happens with multiple splits:\n> \n> autocmd TermClose * bdelete!\n> vnew\n> terminal\n> bdelete!\n\nActually in this case the `TermClose` autocommand doesn't close the terminal's own buffer, but the buffer from the old window. It is the same as:\n```vim\nlet g:oldbuf = bufnr()\nautocmd TermClose * exe g:oldbuf .. 'bdelete!'\nvnew\nterminal\nbdelete!\n```\n\nThis change seems to fix the crash:\n```diff\ndiff --git a/src/nvim/buffer.c b/src/nvim/buffer.c\nindex 0494ff9c9c..bb2f3ffa46 100644\n--- a/src/nvim/buffer.c\n+++ b/src/nvim/buffer.c\n@@ -640,12 +640,6 @@ bool close_buffer(win_T *win, buf_T *buf, int action, bool abort_if_last, bool i\n     return true;\n   }\n \n-  if (buf->terminal) {\n-    buf->b_locked++;\n-    terminal_close(&buf->terminal, -1);\n-    buf->b_locked--;\n-  }\n-\n   // Always remove the buffer when there is no file name.\n   if (buf->b_ffname == NULL) {\n     del_buf = true;\n@@ -669,6 +663,16 @@ bool close_buffer(win_T *win, buf_T *buf, int action, bool abort_if_last, bool i\n \n   buf->b_nwindows = nwindows;\n \n+  if (buf->terminal) {\n+    buf->b_locked++;\n+    terminal_close(&buf->terminal, -1);\n+    buf->b_locked--;\n+\n+    if (buf == curbuf && !is_curbuf) {\n+      return false;\n+    }\n+  }\n+\n   buf_freeall(buf, ((del_buf ? BFA_DEL : 0)\n                     + (wipe_buf ? BFA_WIPE : 0)\n                     + (ignore_abort ? BFA_IGNORE_ABORT : 0)));\n```",
            "created_at": "2026-01-05T01:11:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/10386#issuecomment-3708632184",
            "id": 3708632184,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/10386",
            "node_id": "IC_kwDOAPphoM7dDTx4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3708632184/reactions"
            },
            "updated_at": "2026-01-05T02:30:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3708632184",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 17,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/10386/comments",
    "created_at": "2019-07-01T06:41:55Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/10386/events",
    "html_url": "https://github.com/neovim/neovim/issues/10386",
    "id": 462538353,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/10386/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 53,
        "created_at": "2025-11-02T23:16:37Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
            "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
            "followers_url": "https://api.github.com/users/zeertzjq/followers",
            "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
            "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zeertzjq",
            "id": 35768171,
            "login": "zeertzjq",
            "node_id": "MDQ6VXNlcjM1NzY4MTcx",
            "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
            "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
            "repos_url": "https://api.github.com/users/zeertzjq/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zeertzjq",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/54",
        "id": 14032334,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/54/labels",
        "node_id": "MI_kwDOAPphoM4A1h3O",
        "number": 54,
        "open_issues": 17,
        "state": "open",
        "title": "0.11.6",
        "updated_at": "2026-01-05T23:52:14Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/54"
    },
    "node_id": "MDU6SXNzdWU0NjI1MzgzNTM=",
    "number": 10386,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/10386/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/10386/timeline",
    "title": "TermClose autocmd can free `curbuf`",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-01-05T23:17:39Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/10386",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2101303?v=4",
        "events_url": "https://api.github.com/users/bkoropoff/events{/privacy}",
        "followers_url": "https://api.github.com/users/bkoropoff/followers",
        "following_url": "https://api.github.com/users/bkoropoff/following{/other_user}",
        "gists_url": "https://api.github.com/users/bkoropoff/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/bkoropoff",
        "id": 2101303,
        "login": "bkoropoff",
        "node_id": "MDQ6VXNlcjIxMDEzMDM=",
        "organizations_url": "https://api.github.com/users/bkoropoff/orgs",
        "received_events_url": "https://api.github.com/users/bkoropoff/received_events",
        "repos_url": "https://api.github.com/users/bkoropoff/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/bkoropoff/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bkoropoff/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/bkoropoff",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\nCalling `confirm()` during startup doesn't show confirm message, only choices.\n\n### Steps to reproduce\n\n1. Create the following 'init.vim':\n\n    ```vim\n    call confirm(\"Hello\\nWorld\", \"&Yes\\n&No\")\n    ```\n\n2. `nvim --clean -u init.vim`\n3. Only `[Y]es, (N)o: ` is shown, while there is no \"Hello\" and \"World\" lines.\n\n### Expected behavior\n\nConfirmation is shown in full during startup.\n\nNotes:\n- It does work as expected not during startup.\n- Deferring a redraw doesn't fix the problem and shows that there is room in command line only for a single confirmation line.\n- It works on 0.10.4 (without special highlighting), but not on 0.11.1 or Nightly.\n- It works with `require('vim._extui')` on Nightly, i.e. with the following code before `confirm`:\n\n    ```vim\n    lua << EOF\n      require('vim._extui').enable({ enable = true })\n    EOF\n    ```\n\n- It (kind of) works in Vim in a sense that the whole confirmation message and choices are shown in the shell prior to drawing the Vim itself. @luukvbaal, I'd think this might be somehow related to the ongoing command line rework?\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-378+ge9fd6dc956-dirty\n\n### Vim (not Nvim) behaves the same?\n\nNo (see \"Expected behavior\")\n\n### Operating system/version\n\nEndeavourOS Linux x86_64, 6.14.6-arch1-1\n\n### Terminal name/version\n\nGhostty 1.1.3-arch1\n\n### $TERM environment variable\n\nxterm-ghostty\n\n### Installation\n\nFrom source and appimages",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Yes prompt messages are fragile w.r.t. redraws/resizing since #31525. This is basically a duplicate of #32068.",
            "created_at": "2025-05-19T12:47:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/34088#issuecomment-2890886253",
            "id": 2890886253,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34088",
            "node_id": "IC_kwDOAPphoM6sT2xt",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2890886253/reactions"
            },
            "updated_at": "2025-05-19T12:47:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2890886253",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I see. As there is no explicit `redraw` happening, I don't see a workaround here. For example, adding `set lazyredraw` doesn't help.\n\nThis makes it very problematic to add installation confirmation for #34009 (as the main use case is to execute this during startup). Do you have any suggestions here?",
            "created_at": "2025-05-19T12:57:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/34088#issuecomment-2890918950",
            "id": 2890918950,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34088",
            "node_id": "IC_kwDOAPphoM6sT-wm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2890918950/reactions"
            },
            "updated_at": "2025-05-19T12:57:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2890918950",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Probably some kind of redraw/resize is happening due to one of our terminal responses (the reproduction steps don't follow on my end)? Is delaying the confirm call an option and does it help?\n\nIn any case I will take another look how feasible restoring the `MODE_CONFIRM` logic that prevented these messages from being cleared is, even though we are now in `MODE_CMDLINE` for prompts.",
            "created_at": "2025-05-19T13:17:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/34088#issuecomment-2891004124",
            "id": 2891004124,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34088",
            "node_id": "IC_kwDOAPphoM6sUTjc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2891004124/reactions"
            },
            "updated_at": "2025-05-19T13:17:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2891004124",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Is delaying the confirm call an option and does it help?\n\nI am afraid delaying confirm is not an option for `vim.pack`. Plugin installation should happen immediately and synchronously, i.e. before next parts of 'init.lua' are executed (because they should be allowed to already use installed plugin). So confirmation of that installation should happen also immediately.\n\nI also tried Lua version `vim._with({ silent = true, emsg_silent = true }, function() vim.fn.confirm('Hello\\nWorld', '&Yes\\n&No') end)`, but it also doesn't appear to work.",
            "created_at": "2025-05-19T13:23:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/34088#issuecomment-2891025752",
            "id": 2891025752,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34088",
            "node_id": "IC_kwDOAPphoM6sUY1Y",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2891025752/reactions"
            },
            "updated_at": "2025-05-19T13:23:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2891025752",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I am afraid delaying confirm is not an option for `vim.pack`.\n\nThe workaround to have something working *right now* is to have something like this:\n\n```lua\n-- Defer showing confirm message manually\nvim.defer_fn(function() vim.print(confirm_msg) end, 10)\n-- Block immediately and manually process `key`\nlocal key = vim.fn.getchar()\n```\n\nBut it is a bit... workaround-y :)",
            "created_at": "2025-05-19T13:43:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/34088#issuecomment-2891090826",
            "id": 2891090826,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34088",
            "node_id": "IC_kwDOAPphoM6sUouK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2891090826/reactions"
            },
            "updated_at": "2025-05-19T13:43:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2891090826",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34088/comments",
    "created_at": "2025-05-19T12:37:56Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34088/events",
    "html_url": "https://github.com/neovim/neovim/issues/34088",
    "id": 3073700806,
    "labels": [
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "redraw, layout, presentation",
            "id": 718084050,
            "name": "display",
            "node_id": "MDU6TGFiZWw3MTgwODQwNTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/display"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34088/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 56,
        "created_at": "2024-05-16T14:11:54Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/43",
        "id": 11063573,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/43/labels",
        "node_id": "MI_kwDOAPphoM4AqNEV",
        "number": 43,
        "open_issues": 67,
        "state": "open",
        "title": "0.12",
        "updated_at": "2025-06-02T14:32:49Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/43"
    },
    "node_id": "I_kwDOAPphoM63NPPG",
    "number": 34088,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34088/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34088/timeline",
    "title": "`confirm()` during startup doesn't show message, only choices",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-02T13:08:48Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34088",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
        "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
        "followers_url": "https://api.github.com/users/echasnovski/followers",
        "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
        "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/echasnovski",
        "id": 24854248,
        "login": "echasnovski",
        "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
        "organizations_url": "https://api.github.com/users/echasnovski/orgs",
        "received_events_url": "https://api.github.com/users/echasnovski/received_events",
        "repos_url": "https://api.github.com/users/echasnovski/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/echasnovski",
        "user_view_type": "public"
    }
}
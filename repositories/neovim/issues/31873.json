{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\n### Description\n\nI use sourcekit and xcode build server to swift, the diagnostic is very slowly, but the same lsp server(sourcekit) use vscode is very fast. I feel very obviously between nvim-lspconfig and vscode then the video shows.\n\n**nvim lsp** use sourcekit video **(slowly) (update_in_insert = true)**:\n\nhttps://github.com/user-attachments/assets/71812718-ee19-4d0d-b64b-85a8dcb907df\n\n\n**vscode lsp** use sourcekit video **(fast)**:\n\nhttps://github.com/user-attachments/assets/49ed0375-746c-4f48-b04e-eb1bae29362d\n\n\n\nHere is my config:\n```\nreturn {\n\t'neovim/nvim-lspconfig',\n\tconfig = function()\n\t\tvim.diagnostic.config({\n\t\t\tvirtual_text = true,\n\t\t\tsigns = true,\n\t\t\tupdate_in_insert = true,\n\t\t\tunderline = true,\n\t\t\tseverity_sort = false,\n\t\t\tfloat = true,\n\t\t})\n\n\t\tlocal capabilities = require('cmp_nvim_lsp').default_capabilities()\n\t\tlocal lspconfig = require('lspconfig');\n\n                --...\n                -- other language confg\n                -- ...\n\n\t\tlspconfig.sourcekit.setup {\n\t\t\tcapabilities = capabilities,\n\t\t\tcmd = {\n\t\t\t\t\"/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/sourcekit-lsp\",\n\t\t\t},\n\t\t\troot_dir = function(filename, _)\n\t\t\t\tlocal util = require(\"lspconfig.util\")\n\t\t\t\treturn util.root_pattern(\"buildServer.json\")(filename)\n\t\t\t\t\t\tor util.root_pattern(\"*.xcodeproj\", \"*.xcworkspace\")(filename)\n\t\t\t\t\t\tor util.find_git_ancestor(filename)\n\t\t\t\t\t\tor util.root_pattern(\"Package.swift\")(filename)\n\t\t\tend,\n\t\t}\n\n\t\tlocal util = require('lspconfig/util')\n\n\t\tlocal path = util.path\n\n\t\tlocal function get_python_path(workspace)\n\t\t\t-- Use activated virtualenv.\n\t\t\tif vim.env.VIRTUAL_ENV then\n\t\t\t\treturn path.join(vim.env.VIRTUAL_ENV, 'bin', 'python')\n\t\t\tend\n\n\t\t\t-- Find and use virtualenv in workspace directory.\n\t\t\tfor _, pattern in ipairs({ '*', '.*' }) do\n\t\t\t\tlocal match = vim.fn.glob(path.join(workspace, pattern, 'pyvenv.cfg'))\n\t\t\t\tif match ~= '' then\n\t\t\t\t\treturn path.join(path.dirname(match), 'bin', 'python')\n\t\t\t\tend\n\t\t\tend\n\n\t\t\t-- Fallback to system Python.\n\t\t\treturn vim.fn.exepath('python3') or vim.fn.exepath('python') or 'python'\n\t\tend\n\n\t\tlspconfig.pyright.setup({\n\t\t\t-- -- ...\n\t\t\t-- before_init = function(_, config)\n\t\t\t--   config.settings.python.pythonPath = get_python_path(config.root_dir)\n\t\t\t-- end,\n\t\t\ton_init = function(client)\n\t\t\t\tlocal p = get_python_path(client.config.root_dir)\n\n\t\t\t\tprint(p)\n\t\t\t\tclient.config.settings.python.pythonPath = get_python_path(client.config.root_dir)\n\t\t\tend\n\t\t})\n\n\t\tlspconfig.rust_analyzer.setup {}\n\tend\n}\n```\n\nHere is my nvim-lspconfig log(:LspLog) :\n![Image](https://github.com/user-attachments/assets/278682e7-1ced-4ddd-9d28-2495149d06fa)\n\nThe nvim-lsp log shows, the last \"didChange\" time is 59:22, but \"publishDiagnostic\"(empty msg) is 59:24, after 2 seconds ...\n\nBut the vscode lsp logs, show the last\b \"didChange\" and the \"publishDiagnostic empty msg(clear)\" at the same second.\n\nBuy the way I tried to close other plugins such as cmp as the logs show ..., only left lspconfg, but is slowly nether.\n\nFull logs:\n\n[nvim_lsp_swift_log.txt](https://github.com/user-attachments/files/18309190/nvim_lsp_swift_log.txt)\n\n\n\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\n\nas the configs show.\n\n### Expected behavior\n\n_No response_\n\n### Nvim version (nvim -v)\n\n0.10\n\n### Language server name/version\n\ncurrent\n\n### Operating system/version\n\nmacos 15\n\n### Log file\n\n_No response_",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Please test the latest development version. The [Releases](https://github.com/neovim/neovim/releases/tag/nightly) page has pre-built archives for Linux/Windows/macOS. Check `:version` to confirm the version.",
            "created_at": "2025-01-05T11:04:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/31873#issuecomment-2571586799",
            "id": 2571586799,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31873",
            "node_id": "IC_kwDOAPphoM6ZR0zv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2571586799/reactions"
            },
            "updated_at": "2025-01-05T11:04:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2571586799",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Please test the latest development version. The [Releases](https://github.com/neovim/neovim/releases/tag/nightly) page has pre-built archives for Linux/Windows/macOS. Check `:version` to confirm the version.\n\nThe problem is still there, test on last pre-build `NVIM v0.11.0-dev-1471+g64b0e6582a`\n\n@justinmk ",
            "created_at": "2025-01-06T02:16:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/31873#issuecomment-2572063921",
            "id": 2572063921,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31873",
            "node_id": "IC_kwDOAPphoM6ZTpSx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2572063921/reactions"
            },
            "updated_at": "2025-01-06T02:16:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2572063921",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/16489162?v=4",
                "events_url": "https://api.github.com/users/Napoleon-Jm/events{/privacy}",
                "followers_url": "https://api.github.com/users/Napoleon-Jm/followers",
                "following_url": "https://api.github.com/users/Napoleon-Jm/following{/other_user}",
                "gists_url": "https://api.github.com/users/Napoleon-Jm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Napoleon-Jm",
                "id": 16489162,
                "login": "Napoleon-Jm",
                "node_id": "MDQ6VXNlcjE2NDg5MTYy",
                "organizations_url": "https://api.github.com/users/Napoleon-Jm/orgs",
                "received_events_url": "https://api.github.com/users/Napoleon-Jm/received_events",
                "repos_url": "https://api.github.com/users/Napoleon-Jm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Napoleon-Jm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Napoleon-Jm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Napoleon-Jm",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The nvim-lsp log shows, the last \"didChange\" time is 59:22, but \"publishDiagnostic\"(empty msg) is 59:24, after 2 seconds ...\n> \n> But the vscode lsp logs, show the lastï¿½ \"didChange\" and the \"publishDiagnostic empty msg(clear)\" at the same second.\n\nIf Nvim (the client) is sending stuff and the server responds slowly, we don't have control over that? Are you certain that vscode is using the same server, and the same server settings?\n\nMaybe related: #29792\n",
            "created_at": "2025-01-06T10:57:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/31873#issuecomment-2572868533",
            "id": 2572868533,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31873",
            "node_id": "IC_kwDOAPphoM6ZWtu1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2572868533/reactions"
            },
            "updated_at": "2025-01-06T10:57:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2572868533",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31873/comments",
    "created_at": "2025-01-05T09:04:08Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31873/events",
    "html_url": "https://github.com/neovim/neovim/issues/31873",
    "id": 2769180820,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "performance, latency, cpu/memory usage",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "waiting for reply from the author",
            "id": 248229439,
            "name": "needs:response",
            "node_id": "MDU6TGFiZWwyNDgyMjk0Mzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:response"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "We need minimal steps to reproduce the issue",
            "id": 298863445,
            "name": "needs:repro",
            "node_id": "MDU6TGFiZWwyOTg4NjM0NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:repro"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31873/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 261,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 290,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-01-07T00:55:39Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM6lDliU",
    "number": 31873,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31873/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31873/timeline",
    "title": "LSP: slow diagnostics publish from server after client sends didChange",
    "updated_at": "2025-01-06T10:58:49Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31873",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/16489162?v=4",
        "events_url": "https://api.github.com/users/Napoleon-Jm/events{/privacy}",
        "followers_url": "https://api.github.com/users/Napoleon-Jm/followers",
        "following_url": "https://api.github.com/users/Napoleon-Jm/following{/other_user}",
        "gists_url": "https://api.github.com/users/Napoleon-Jm/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Napoleon-Jm",
        "id": 16489162,
        "login": "Napoleon-Jm",
        "node_id": "MDQ6VXNlcjE2NDg5MTYy",
        "organizations_url": "https://api.github.com/users/Napoleon-Jm/orgs",
        "received_events_url": "https://api.github.com/users/Napoleon-Jm/received_events",
        "repos_url": "https://api.github.com/users/Napoleon-Jm/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Napoleon-Jm/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Napoleon-Jm/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Napoleon-Jm",
        "user_view_type": "public"
    }
}
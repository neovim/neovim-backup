{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nI have two related problems:\r\n1. When using `:!` or `:term`, completion functions in a shell-like mode. The first argument is completed as `shellcmd`, while subsequent arguments are treated as `file`s. This behavior is not easily replicated with other commands. In attempting to resolve this issue, I discovered [this Stack Overflow question](https://stackoverflow.com/questions/5685005/shell-command-completion) and [this plugin](https://github.com/ej-shafran/compile-mode.nvim/blob/main/plugin/command.lua#L9). Both solutions employ `completion=custom` and utilize some hacky methods to achieve shell-like completion. However, `completion=custom` may not integrate well with plugins like wilder.nvim.\r\n2. There is no effective methods to retrieve the current completion pattern. As a result, completion plugins like wilder.nvim  do the heavy lifting by itself and parses the command line independently, which seems unnecessary since Neovim already does that internally.\r\n\r\n### Expected behavior\r\n\r\n1. It seems reasonable to be able to enable this shell-like completion on user commands with `shellcmd` completion type.\r\n2. Add new function to the family of functions `getcmd*` to expose current completion pattern.\r\n\r\nI already hacked on that matter a bit in this [PR](https://github.com/neovim/neovim/pull/30698). This is just a proof of concept so no docs or additional tests added.\r\nThat is my first contribution attempt and I just wanted to be sure that such a change could possibly go upstream. If that is the case I'm gonna add docs and tests.\r\n\r\nAlso, I'm not sure if this should be one or two issues/PRs but the PR is small enough and I worked on them in pair so I decided to submit it as one.",
    "closed_at": "2024-10-09T05:25:40Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/33986203?v=4",
        "events_url": "https://api.github.com/users/kekulta/events{/privacy}",
        "followers_url": "https://api.github.com/users/kekulta/followers",
        "following_url": "https://api.github.com/users/kekulta/following{/other_user}",
        "gists_url": "https://api.github.com/users/kekulta/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kekulta",
        "id": 33986203,
        "login": "kekulta",
        "node_id": "MDQ6VXNlcjMzOTg2MjAz",
        "organizations_url": "https://api.github.com/users/kekulta/orgs",
        "received_events_url": "https://api.github.com/users/kekulta/received_events",
        "repos_url": "https://api.github.com/users/kekulta/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kekulta/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kekulta/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kekulta",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "please show a small, concrete example with the expected result.",
            "created_at": "2024-10-06T22:01:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/30699#issuecomment-2395600683",
            "id": 2395600683,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30699",
            "node_id": "IC_kwDOAPphoM6Oyfcr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395600683/reactions"
            },
            "updated_at": "2024-10-06T22:01:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395600683",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "1. I want to write a \"emacs compile mode\" command (something like [this plugin](https://github.com/ej-shafran/compile-mode.nvim)). It is called `Comp` and completion for it should behave like completion for `:!`. So i set `completion=shellcmd` and try it.\r\n\r\nExpected:\r\n```VimScript\r\n\" Shell has gcc installed and there is file gnu.c in cwd\r\n\" | stands for current cursor position\r\n:Comp |\r\n\" Press <Tab>\r\n:Comp gcc|\r\n:Comp gcc |\r\n\" Press <Tab>\r\n:Comp gcc gnu.c|\r\n```\r\n\r\nActual:\r\n```VimScript\r\n\" Shell has gcc installed and there is file gnu.c in cwd\r\n\" | stands for current cursor position\r\n:Comp |\r\n\" Press <Tab>\r\n:Comp gcc|\r\n:Comp gcc |\r\n\" Press <Tab>\r\n:Comp gcc gcc|\r\n```\r\n\r\nThe problem that user command with `completion=shellcmd` will expand all of its argument into shell commands. And I want only the first argument to be expanded into command and all subsequent ones to be expanded into filenames. That behavior already exists in nvim but is limited to `:!` and `:term` commands. So I suggest to add new param to `nvim_create_user_command()` to enable this shell-like completion.\r\n\r\n2. I want to write my completion plugin in the spirit of wilder.nvim. To start searching for candidates I need two params: completion type and completion pattern. Completion type can be easily accessed with the function `getcmdcompltype()`. But current completion pattern does not have dedicated command. The best way I can think of is to get full command line with `getcmdline()` function and parse it in order to extract current completion type. This is the way wilder.nvim does the trick. That seems unreasonable to me because nvim already does that internally and stores completion pattern in `expand_T->xp_pattern`. So I suggest to add function `getcmdcomplpat()` that works in the same manner as `getcmdcomptype()` and exposes to user current completion pattern.",
            "created_at": "2024-10-07T04:59:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/30699#issuecomment-2395902049",
            "id": 2395902049,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30699",
            "node_id": "IC_kwDOAPphoM6OzpBh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395902049/reactions"
            },
            "updated_at": "2024-10-07T05:29:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395902049",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33986203?v=4",
                "events_url": "https://api.github.com/users/kekulta/events{/privacy}",
                "followers_url": "https://api.github.com/users/kekulta/followers",
                "following_url": "https://api.github.com/users/kekulta/following{/other_user}",
                "gists_url": "https://api.github.com/users/kekulta/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kekulta",
                "id": 33986203,
                "login": "kekulta",
                "node_id": "MDQ6VXNlcjMzOTg2MjAz",
                "organizations_url": "https://api.github.com/users/kekulta/orgs",
                "received_events_url": "https://api.github.com/users/kekulta/received_events",
                "repos_url": "https://api.github.com/users/kekulta/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kekulta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kekulta/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kekulta",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Hm... It seems a new feature `-complete=shellcmdline` is needed.\r\nThis feature is also not implemented in Vim, so it should be requested in Vim as well.\r\n\r\n`-complete=shellcmd` is just to completion command name.  It is not for command arguments.",
            "created_at": "2024-10-07T07:24:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/30699#issuecomment-2396123991",
            "id": 2396123991,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30699",
            "node_id": "IC_kwDOAPphoM6O0fNX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396123991/reactions"
            },
            "updated_at": "2024-10-07T07:26:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396123991",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41495?v=4",
                "events_url": "https://api.github.com/users/Shougo/events{/privacy}",
                "followers_url": "https://api.github.com/users/Shougo/followers",
                "following_url": "https://api.github.com/users/Shougo/following{/other_user}",
                "gists_url": "https://api.github.com/users/Shougo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Shougo",
                "id": 41495,
                "login": "Shougo",
                "node_id": "MDQ6VXNlcjQxNDk1",
                "organizations_url": "https://api.github.com/users/Shougo/orgs",
                "received_events_url": "https://api.github.com/users/Shougo/received_events",
                "repos_url": "https://api.github.com/users/Shougo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Shougo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Shougo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Shougo",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I want to write my completion plugin in the spirit of wilder.nvim. To start searching for candidates I need two params: completion type and completion pattern. Completion type can be easily accessed with the function getcmdcompltype(). But current completion pattern does not have dedicated command. The best way I can think of is to get full command line with getcmdline() function and parse it in order to extract current completion type. This is the way wilder.nvim does the trick. That seems unreasonable to me because nvim already does that internally and stores completion pattern in expand_T->xp_pattern. So I suggest to add function getcmdcomplpat() that works in the same manner as getcmdcomptype() and exposes to user current completion pattern.\r\n\r\nHi.  I am the author of `getcmdcompltype()`.\r\nIt is possible.  Please request it in Vim.\r\n\r\nhttps://github.com/vim/vim/commit/92997dda789ad8061841128cbc99b15ec0374411",
            "created_at": "2024-10-07T07:31:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/30699#issuecomment-2396139149",
            "id": 2396139149,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30699",
            "node_id": "IC_kwDOAPphoM6O0i6N",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396139149/reactions"
            },
            "updated_at": "2024-10-07T07:31:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396139149",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41495?v=4",
                "events_url": "https://api.github.com/users/Shougo/events{/privacy}",
                "followers_url": "https://api.github.com/users/Shougo/followers",
                "following_url": "https://api.github.com/users/Shougo/following{/other_user}",
                "gists_url": "https://api.github.com/users/Shougo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Shougo",
                "id": 41495,
                "login": "Shougo",
                "node_id": "MDQ6VXNlcjQxNDk1",
                "organizations_url": "https://api.github.com/users/Shougo/orgs",
                "received_events_url": "https://api.github.com/users/Shougo/received_events",
                "repos_url": "https://api.github.com/users/Shougo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Shougo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Shougo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Shougo",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Ok, thanks!\nThan I'm gonna try to add  `-complete=shellcmdline` and `getcmdcomplpat()` into Vim first and came back here with a patch.",
            "created_at": "2024-10-07T08:38:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/30699#issuecomment-2396281502",
            "id": 2396281502,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30699",
            "node_id": "IC_kwDOAPphoM6O1Fqe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396281502/reactions"
            },
            "updated_at": "2024-10-07T08:38:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396281502",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33986203?v=4",
                "events_url": "https://api.github.com/users/kekulta/events{/privacy}",
                "followers_url": "https://api.github.com/users/kekulta/followers",
                "following_url": "https://api.github.com/users/kekulta/following{/other_user}",
                "gists_url": "https://api.github.com/users/kekulta/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kekulta",
                "id": 33986203,
                "login": "kekulta",
                "node_id": "MDQ6VXNlcjMzOTg2MjAz",
                "organizations_url": "https://api.github.com/users/kekulta/orgs",
                "received_events_url": "https://api.github.com/users/kekulta/received_events",
                "repos_url": "https://api.github.com/users/kekulta/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kekulta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kekulta/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kekulta",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Closed with https://github.com/neovim/neovim/commit/f449a38f6a47bee30f0d4e291d8234d1ac8288a7.",
            "created_at": "2024-10-09T05:25:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/30699#issuecomment-2401344399",
            "id": 2401344399,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30699",
            "node_id": "IC_kwDOAPphoM6PIZuP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2401344399/reactions"
            },
            "updated_at": "2024-10-09T05:25:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2401344399",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33986203?v=4",
                "events_url": "https://api.github.com/users/kekulta/events{/privacy}",
                "followers_url": "https://api.github.com/users/kekulta/followers",
                "following_url": "https://api.github.com/users/kekulta/following{/other_user}",
                "gists_url": "https://api.github.com/users/kekulta/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kekulta",
                "id": 33986203,
                "login": "kekulta",
                "node_id": "MDQ6VXNlcjMzOTg2MjAz",
                "organizations_url": "https://api.github.com/users/kekulta/orgs",
                "received_events_url": "https://api.github.com/users/kekulta/received_events",
                "repos_url": "https://api.github.com/users/kekulta/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kekulta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kekulta/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kekulta",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30699/comments",
    "created_at": "2024-10-06T21:37:16Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30699/events",
    "html_url": "https://github.com/neovim/neovim/issues/30699",
    "id": 2568915693,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "Nvim built-in (omni)completion",
            "id": 3214348835,
            "name": "completion",
            "node_id": "MDU6TGFiZWwzMjE0MzQ4ODM1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/completion"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "command line, also cmdwin",
            "id": 5826989442,
            "name": "cmdline-mode",
            "node_id": "LA_kwDOAPphoM8AAAABW1DNgg",
            "url": "https://api.github.com/repos/neovim/neovim/labels/cmdline-mode"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30699/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 260,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 297,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-01-20T17:56:23Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM6ZHort",
    "number": 30699,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30699/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30699/timeline",
    "title": "Get shell-like completion for user commands and expose current completion pattern.",
    "updated_at": "2025-01-17T15:34:12Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30699",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/33986203?v=4",
        "events_url": "https://api.github.com/users/kekulta/events{/privacy}",
        "followers_url": "https://api.github.com/users/kekulta/followers",
        "following_url": "https://api.github.com/users/kekulta/following{/other_user}",
        "gists_url": "https://api.github.com/users/kekulta/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kekulta",
        "id": 33986203,
        "login": "kekulta",
        "node_id": "MDQ6VXNlcjMzOTg2MjAz",
        "organizations_url": "https://api.github.com/users/kekulta/orgs",
        "received_events_url": "https://api.github.com/users/kekulta/received_events",
        "repos_url": "https://api.github.com/users/kekulta/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kekulta/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kekulta/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kekulta",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "## Problem\n\nFollowup to #34296 #34354\n\n`:restart` currently depends on the UI client to spawn a new `nvim` server. This has some disadvantages:\n\n- all other UI clients detach and can't reattach to the new server.\n- if the UI client is on a different machine, it can't restart the server on the remote machine.\n\n## Expected behavior\n\n- Perform the restart on the server instead of the client. The `restart` UI event passes the listen address (instead of CLI args). \n- If Nvim doesn't know how to restart the server, show an error and cancel the `:restart`.\n\n### Benefits\n\n1. All UI clients can re-attach to the new address.\n2. No race conditions?\n    - If the user config has errors / waiting for input, are all UIs able to attach while Nvim is waiting for input?\n\n### Implementation?\n\n1. old server spawns a new server and gets the listen address\n2. old server emits the `remote` UI event with the new listen address\n3. UIs can attach to new server, they don't need to wait for old server to exit\n4. old server exits",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> passes the listen address\n\nI'm not sure if this will work for a client on a different machine.\n- If the listen address is a local socket, a remote client cannot access the socket.\n- If the listen address is a TCP address, the server doesn't know which network interface is the one that remote clients can reach, and different clients may even connect via different network interfaces, so the server doesn't know which network interface's IP address to use.",
            "created_at": "2025-06-08T00:50:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/34367#issuecomment-2953314322",
            "id": 2953314322,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34367",
            "node_id": "IC_kwDOAPphoM6wCAAS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953314322/reactions"
            },
            "updated_at": "2025-06-08T00:53:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953314322",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Good point. It seems very difficult to support the remote-machine scenario.\n\nFor the case when server+clients are all on the same machine, would emitting the listen address allow all clients to reattach (instead of only 1 client)?\n\n(Side note: would be useful if the client used `nvim_set_client_info()` to tell the server about its machine info, e.g. hostname, connect address (from the client's perspective, i.e. the `--server` arg), etc.)",
            "created_at": "2025-06-08T00:56:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/34367#issuecomment-2953320036",
            "id": 2953320036,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34367",
            "node_id": "IC_kwDOAPphoM6wCBZk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953320036/reactions"
            },
            "updated_at": "2025-06-08T01:01:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953320036",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Some other thoughts:\n- The new server should still be started after all `*Leave` events have been triggered on the old server, to make stuff like session restoration work.\n- If all clients fail to reattach, this will lead to a dangling server process.\n- There may be extra complications with `--listen` argument, since the old server and the new server cannot listen on the same address at the same time.\n  - Both UI and non-UI clients may be attached to an address.\n  - If the old server stops listening on an address before starting the new server, it cannot send the new server's listening address to UI clients attached to that address.\n  - If `--listen` arguments are stripped from the new server's command line, this means `:restart` will not work for users that use a non-UI client to control Nvim via a socket passed after `--listen`.",
            "created_at": "2025-06-08T01:38:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/34367#issuecomment-2953379042",
            "id": 2953379042,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34367",
            "node_id": "IC_kwDOAPphoM6wCPzi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953379042/reactions"
            },
            "updated_at": "2025-06-08T13:39:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953379042",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Good to note edge cases. We don't need to go crazy trying to support everything now, but it's worth trying to future-proof the UI event/protocol.\n\nDifferent idea: reuse the *old* listen-address in the new server?\n\n1. old-server spawns new-server and passes the *old* listen-address to the new server\n2. old-server confirms that new-server started and is waiting for UI attach\n3. old-server emits the `remote` UI event\n4. old-server exits, UIs detach\n6. new-server calls `serverstart()` with the *old* listen-address\n7. UIs reattach to the *old* listen-address (new server)\n\n> future-proof the UI event/protocol\n\nIf fhe above \"reuse the old address\" approach is implemented later, the UI event `args` could just be empty. So it's kind of \"future-proof\" in that case.",
            "created_at": "2025-06-08T01:49:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/34367#issuecomment-2953389974",
            "id": 2953389974,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34367",
            "node_id": "IC_kwDOAPphoM6wCSeW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953389974/reactions"
            },
            "updated_at": "2025-06-08T01:55:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2953389974",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34367/comments",
    "created_at": "2025-06-08T00:46:54Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34367/events",
    "html_url": "https://github.com/neovim/neovim/issues/34367",
    "id": 3127739131,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "listen",
            "id": 406104372,
            "name": "server",
            "node_id": "MDU6TGFiZWw0MDYxMDQzNzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/server"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "UI extensibility, events, protocol, externalized UI",
            "id": 640132777,
            "name": "ui-extensibility",
            "node_id": "MDU6TGFiZWw2NDAxMzI3Nzc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui-extensibility"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "startup, shutdown, attach, detach",
            "id": 870629450,
            "name": "lifecycle",
            "node_id": "MDU6TGFiZWw4NzA2Mjk0NTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lifecycle"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "remote UI, --remote commands, p2p / peer-to-peer",
            "id": 2269137131,
            "name": "remote",
            "node_id": "MDU6TGFiZWwyMjY5MTM3MTMx",
            "url": "https://api.github.com/repos/neovim/neovim/labels/remote"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34367/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 63,
        "created_at": "2024-05-16T14:11:54Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/43",
        "id": 11063573,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/43/labels",
        "node_id": "MI_kwDOAPphoM4AqNEV",
        "number": 43,
        "open_issues": 69,
        "state": "open",
        "title": "0.12",
        "updated_at": "2025-06-09T17:26:31Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/43"
    },
    "node_id": "I_kwDOAPphoM66bYL7",
    "number": 34367,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34367/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34367/timeline",
    "title": ":restart can reattach all UIs and works on remote machine",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-08T13:39:02Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34367",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "<!-- Before reporting: search existing issues and check the FAQ. -->\r\n\r\n- `nvim --version`: 0.2.0\r\n- Vim (version: ) behaves differently? N/A\r\n- Operating system/version: macOS Sierra 10.12.1\r\n- Terminal name/version: a remote UI talking to a --headless nvim through the Nvim API\r\n- `$TERM`: N/A\r\n\r\n### Steps to reproduce using `nvim -u NORC`\r\n\r\nRun:\r\n    \r\n    NVIM_LISTEN_ADDRESS=... nvim -u NORC --headless \r\n\r\nConnect to that address, and issue an API call:\r\n\r\n    nvim_command(\"edit README.md\")\r\n\r\nKill the nvim process and restart it.\r\nReconnect and issue the same command.\r\n\r\nObserve that nvim prints out a swap file recovery dialog with a prompt to nvim's stdout:\r\n\r\n```\r\nFound a swap file by the name ...\r\n...\r\n[O]pen Read-Only, (E)dit anyway, (R)ecover, (D)elete it, (Q)uit, (A)bort: \r\n```\r\n\r\n**Note**: Changing `nvim_command` to `nvim_command_output` exposes the same behaviour.\r\n\r\n### Actual behaviour\r\n\r\nThe API call blocks and never returns, neither success nor failure.\r\nMoreover, no API calls work from this point.\r\nFor example, calling `nvim_command(\"recover\")` or `nvim_command(\"help recovery\")` blocks and doesn't return any result either, and has no effect on nvim.\r\n\r\n### Expected behaviour\r\n\r\n`nvim_command` must not block. It should return immediately an error reply explaining that a recovery decision is required. Until the decision is taken, other commands like `nvim_command(\"help recovery\")` should be processed normally.\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "The problem seems to not be special to recovery or \"edit\". It happens also with some other commands that provoke dialogs & prompts.\r\n\r\nFor example, `nvim_command(\"version\")` provokes a prompt:\r\n\r\n> Press ENTER or type command to continue\r\n\r\nand never returns. Further `nvim_command` calls are blocked In this state.\r\n\r\nThis might be mitigated by fixing https://github.com/neovim/neovim/issues/6201",
            "created_at": "2017-08-09T15:14:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/7142#issuecomment-321286543",
            "id": 321286543,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/7142",
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTI4NjU0Mw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321286543/reactions"
            },
            "updated_at": "2017-08-09T15:14:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321286543",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11477595?v=4",
                "events_url": "https://api.github.com/users/battlmonstr/events{/privacy}",
                "followers_url": "https://api.github.com/users/battlmonstr/followers",
                "following_url": "https://api.github.com/users/battlmonstr/following{/other_user}",
                "gists_url": "https://api.github.com/users/battlmonstr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/battlmonstr",
                "id": 11477595,
                "login": "battlmonstr",
                "node_id": "MDQ6VXNlcjExNDc3NTk1",
                "organizations_url": "https://api.github.com/users/battlmonstr/orgs",
                "received_events_url": "https://api.github.com/users/battlmonstr/received_events",
                "repos_url": "https://api.github.com/users/battlmonstr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/battlmonstr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/battlmonstr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/battlmonstr"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Possibly a duplicate of:\r\nhttps://github.com/neovim/neovim/issues/3901",
            "created_at": "2017-08-09T15:22:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/7142#issuecomment-321288699",
            "id": 321288699,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/7142",
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTI4ODY5OQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321288699/reactions"
            },
            "updated_at": "2019-05-08T16:25:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321288699",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11477595?v=4",
                "events_url": "https://api.github.com/users/battlmonstr/events{/privacy}",
                "followers_url": "https://api.github.com/users/battlmonstr/followers",
                "following_url": "https://api.github.com/users/battlmonstr/following{/other_user}",
                "gists_url": "https://api.github.com/users/battlmonstr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/battlmonstr",
                "id": 11477595,
                "login": "battlmonstr",
                "node_id": "MDQ6VXNlcjExNDc3NTk1",
                "organizations_url": "https://api.github.com/users/battlmonstr/orgs",
                "received_events_url": "https://api.github.com/users/battlmonstr/received_events",
                "repos_url": "https://api.github.com/users/battlmonstr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/battlmonstr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/battlmonstr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/battlmonstr"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Only \"async\" API functions are non-blocking. Search `:help api` for \"async\" to see which functions have `Attributes: {async}`. Currently there's only 3:\r\n\r\n- nvim_input\r\n- nvim_get_mode\r\n- nvim_get_api_info\r\n\r\nAll other API functions block while nvim is waiting for input. \r\n\r\nTo avoid being blocked in a client, you can use `nvim_get_mode()` which returns a `blocking` flag to detect whether nvim is in a wait-for-input state. If `nvim_get_mode()` returns `blocking=true`, you can send input to nvim (just as a tty/GUI user could send keyboard input) via the async `nvim_input` function, to unblock nvim. (Yes, this is a bit of a hack.)\r\n\r\nFuture improvements are planned:\r\n\r\n1. Add more non-blocking (\"async\") API functions\r\n2. Offer a mode where functions return with an error if they would block\r\n    - Probably this should be controlled by a timeout limit.\r\n3. Reduce the cases where nvim blocks for a long time. (via mechanisms such as #6201)",
            "created_at": "2017-08-09T15:34:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/7142#issuecomment-321292444",
            "id": 321292444,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/7142",
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTI5MjQ0NA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321292444/reactions"
            },
            "updated_at": "2017-08-09T21:26:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321292444",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thank you for the detailed reply.\r\nHaving such a mode, which returns an error if vim is blocked waiting for input, would be very nice.\r\nIt would be nice if the initial call (that provoked that) also returned a \"blocked on a dialog\" error.\r\n\r\nI guess that externalized dialogs would solve the last bit of the problem where I know it's blocked, but I don't really know what to send to nvim_input to unblock the engine.",
            "created_at": "2017-08-10T23:54:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/7142#issuecomment-321703638",
            "id": 321703638,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/7142",
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTcwMzYzOA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321703638/reactions"
            },
            "updated_at": "2019-05-08T16:25:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321703638",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11477595?v=4",
                "events_url": "https://api.github.com/users/battlmonstr/events{/privacy}",
                "followers_url": "https://api.github.com/users/battlmonstr/followers",
                "following_url": "https://api.github.com/users/battlmonstr/following{/other_user}",
                "gists_url": "https://api.github.com/users/battlmonstr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/battlmonstr",
                "id": 11477595,
                "login": "battlmonstr",
                "node_id": "MDQ6VXNlcjExNDc3NTk1",
                "organizations_url": "https://api.github.com/users/battlmonstr/orgs",
                "received_events_url": "https://api.github.com/users/battlmonstr/received_events",
                "repos_url": "https://api.github.com/users/battlmonstr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/battlmonstr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/battlmonstr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/battlmonstr"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I don't quite understand an idea about a timeout. If the engine is waiting for input this should be known immediately in the engine somehow without a delay (in most cases). Someting like \"error: blocked on a dialog input\" makes sense here. A timeout would probably complicate things.",
            "created_at": "2017-08-11T00:03:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/7142#issuecomment-321704685",
            "id": 321704685,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/7142",
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTcwNDY4NQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321704685/reactions"
            },
            "updated_at": "2019-05-08T16:25:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321704685",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11477595?v=4",
                "events_url": "https://api.github.com/users/battlmonstr/events{/privacy}",
                "followers_url": "https://api.github.com/users/battlmonstr/followers",
                "following_url": "https://api.github.com/users/battlmonstr/following{/other_user}",
                "gists_url": "https://api.github.com/users/battlmonstr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/battlmonstr",
                "id": 11477595,
                "login": "battlmonstr",
                "node_id": "MDQ6VXNlcjExNDc3NTk1",
                "organizations_url": "https://api.github.com/users/battlmonstr/orgs",
                "received_events_url": "https://api.github.com/users/battlmonstr/received_events",
                "repos_url": "https://api.github.com/users/battlmonstr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/battlmonstr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/battlmonstr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/battlmonstr"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I don't quite understand an idea about a timeout. If the engine is waiting for input this should be known immediately in the engine somehow without a delay (in most cases).\r\n\r\nNvim knows it's blocked, but maybe it's only blocked for a 10 ms. In that case rather than return an error, it would wait 10ms then proceed as normal.",
            "created_at": "2017-08-11T08:27:51Z",
            "html_url": "https://github.com/neovim/neovim/issues/7142#issuecomment-321756776",
            "id": 321756776,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/7142",
            "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTc1Njc3Ng==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321756776/reactions"
            },
            "updated_at": "2017-08-11T08:27:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/321756776",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/7142/comments",
    "created_at": "2017-08-09T14:17:13Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/7142/events",
    "html_url": "https://github.com/neovim/neovim/issues/7142",
    "id": 249046169,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "libnvim, Nvim RPC API",
            "id": 103819671,
            "name": "api",
            "node_id": "MDU6TGFiZWwxMDM4MTk2NzE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/api"
        },
        {
            "color": "c7def8",
            "default": false,
            "description": null,
            "id": 242522707,
            "name": "rpc",
            "node_id": "MDU6TGFiZWwyNDI1MjI3MDc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/rpc"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/7142/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 601,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 515,
        "state": "open",
        "title": "backlog",
        "updated_at": "2024-04-01T02:46:11Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWUyNDkwNDYxNjk=",
    "number": 7142,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/7142/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/7142/timeline",
    "title": "API: timeout for blocking requests",
    "updated_at": "2024-03-30T13:11:18Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/7142",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11477595?v=4",
        "events_url": "https://api.github.com/users/battlmonstr/events{/privacy}",
        "followers_url": "https://api.github.com/users/battlmonstr/followers",
        "following_url": "https://api.github.com/users/battlmonstr/following{/other_user}",
        "gists_url": "https://api.github.com/users/battlmonstr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/battlmonstr",
        "id": 11477595,
        "login": "battlmonstr",
        "node_id": "MDQ6VXNlcjExNDc3NTk1",
        "organizations_url": "https://api.github.com/users/battlmonstr/orgs",
        "received_events_url": "https://api.github.com/users/battlmonstr/received_events",
        "repos_url": "https://api.github.com/users/battlmonstr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/battlmonstr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/battlmonstr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/battlmonstr"
    }
}
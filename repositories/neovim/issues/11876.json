{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "<!-- Before reporting: search existing issues and check the FAQ. -->\r\n\r\n- `nvim --version`: bb331a9\r\n- Operating system/version: Windows 10\r\n\r\n### Steps to reproduce using `nvim -u NORC`\r\n\r\nInstall Firefox Nightly, Neovim and NodeJS in a [Windows 10 VM](https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/). Then, install Firenvim [from source](https://github.com/glacambre/firenvim#from-source) and run its testsuite (`npm run test`) a few times.\r\n\r\n### Actual behaviour\r\n\r\nNeovim eventually corrupts the shada file. I can only reproduce this by running the Firenvim testsuite (which starts and kills lots of neovim process very quickly) on a Windows VM (which is pretty slow). I know reproducing this would be a lot of effort so feel free to ask for more information, I'll be happy to run whatever steps need to be ran.\r\n\r\nUsing `-i NONE` is an acceptable workaround for my usecase.\r\n\r\nHere are two example corrupted shada directories: https://file.io/DpD6xJ\r\nhttps://file.io/J2daeD\r\nIn both cases, the error message is `E576: Error while reading ShaDa file: last entry specified that it occupies 99 bytes, but file ended earlier.`.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "It's not too surprising AFAIR, there was never any effort put towards concurrent scenarios, though it was vaguely acknowledge as a future potential problem.\r\n\r\nTo avoid it in a test suite, one can of course use `-i` to isolate shada files to per-test locations. And use `-i NONE` for (most?) tests where shada is not needed.",
            "created_at": "2020-02-17T09:54:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/11876#issuecomment-586908430",
            "id": 586908430,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11876",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU4NjkwODQzMA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/586908430/reactions"
            },
            "updated_at": "2020-02-17T09:54:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/586908430",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hi, sorry to be bumping such an old thread, but I seem to be getting this issue a lot.\r\n\r\nI open & close Neovim frequently and like to run multiple instances through Nvy. I have multiple ShaDa-file corruptions per day.\r\n\r\nIt wouldn't really bother me so much if not for the fact that the message is displayed often and is actually blocking my workflow. It is definitely slowing me down.\r\n\r\nI am not sure if there is anything I can do to make sure the ShaDa file is properly written on shutdown. I use olimorris/persisted.nvim. Could mksession interfer with shada file writing? I can see this is a todo item but wonder if there is anything that I can do to increase stability.",
            "created_at": "2023-11-20T10:10:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/11876#issuecomment-1818744188",
            "id": 1818744188,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11876",
            "node_id": "IC_kwDOAPphoM5sZ9V8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1818744188/reactions"
            },
            "updated_at": "2023-11-20T10:10:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1818744188",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13405712?v=4",
                "events_url": "https://api.github.com/users/axelhj/events{/privacy}",
                "followers_url": "https://api.github.com/users/axelhj/followers",
                "following_url": "https://api.github.com/users/axelhj/following{/other_user}",
                "gists_url": "https://api.github.com/users/axelhj/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/axelhj",
                "id": 13405712,
                "login": "axelhj",
                "node_id": "MDQ6VXNlcjEzNDA1NzEy",
                "organizations_url": "https://api.github.com/users/axelhj/orgs",
                "received_events_url": "https://api.github.com/users/axelhj/received_events",
                "repos_url": "https://api.github.com/users/axelhj/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/axelhj/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/axelhj/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/axelhj"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Would deactivating shada by adding `set shada=` to your init.vim be an acceptable workaround?",
            "created_at": "2023-11-20T11:12:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/11876#issuecomment-1818848564",
            "id": 1818848564,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11876",
            "node_id": "IC_kwDOAPphoM5saW00",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1818848564/reactions"
            },
            "updated_at": "2023-11-20T11:12:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1818848564",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11534587?v=4",
                "events_url": "https://api.github.com/users/glacambre/events{/privacy}",
                "followers_url": "https://api.github.com/users/glacambre/followers",
                "following_url": "https://api.github.com/users/glacambre/following{/other_user}",
                "gists_url": "https://api.github.com/users/glacambre/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glacambre",
                "id": 11534587,
                "login": "glacambre",
                "node_id": "MDQ6VXNlcjExNTM0NTg3",
                "organizations_url": "https://api.github.com/users/glacambre/orgs",
                "received_events_url": "https://api.github.com/users/glacambre/received_events",
                "repos_url": "https://api.github.com/users/glacambre/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glacambre/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glacambre/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glacambre"
            }
        },
        {
            "author_association": "NONE",
            "body": "I have considered it, but I'd rather not. I quite like that my buffers resume exactly where I've left off. I would like to understand why my shada-files are constantly getting corrupted though. I run NVIM v.0.9.2 on Windows 10. I have no firm idea of how to go about figuring out why my shada-files contain less data than expected.\r\nEdit: Seem related to running concurrent instances on Windows and maybe switching Git branches.",
            "created_at": "2023-11-20T14:58:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/11876#issuecomment-1819225416",
            "id": 1819225416,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11876",
            "node_id": "IC_kwDOAPphoM5sby1I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1819225416/reactions"
            },
            "updated_at": "2023-12-24T15:50:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1819225416",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13405712?v=4",
                "events_url": "https://api.github.com/users/axelhj/events{/privacy}",
                "followers_url": "https://api.github.com/users/axelhj/followers",
                "following_url": "https://api.github.com/users/axelhj/following{/other_user}",
                "gists_url": "https://api.github.com/users/axelhj/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/axelhj",
                "id": 13405712,
                "login": "axelhj",
                "node_id": "MDQ6VXNlcjEzNDA1NzEy",
                "organizations_url": "https://api.github.com/users/axelhj/orgs",
                "received_events_url": "https://api.github.com/users/axelhj/received_events",
                "repos_url": "https://api.github.com/users/axelhj/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/axelhj/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/axelhj/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/axelhj"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/11876/comments",
    "created_at": "2020-02-15T09:28:39Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/11876/events",
    "html_url": "https://github.com/neovim/neovim/issues/11876",
    "id": 565722939,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1430181182,
            "name": "multiproc",
            "node_id": "MDU6TGFiZWwxNDMwMTgxMTgy",
            "url": "https://api.github.com/repos/neovim/neovim/labels/multiproc"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "save/restore editor state: shada, context, ctx",
            "id": 4449264023,
            "name": "editor-state",
            "node_id": "LA_kwDOAPphoM8AAAABCTJhlw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/editor-state"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/11876/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 594,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 426,
        "state": "open",
        "title": "backlog",
        "updated_at": "2023-12-24T03:02:50Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWU1NjU3MjI5Mzk=",
    "number": 11876,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/11876/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/11876/timeline",
    "title": "Concurrent startup/exit corrupts shada on windows",
    "updated_at": "2023-12-24T15:50:52Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/11876",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11534587?v=4",
        "events_url": "https://api.github.com/users/glacambre/events{/privacy}",
        "followers_url": "https://api.github.com/users/glacambre/followers",
        "following_url": "https://api.github.com/users/glacambre/following{/other_user}",
        "gists_url": "https://api.github.com/users/glacambre/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/glacambre",
        "id": 11534587,
        "login": "glacambre",
        "node_id": "MDQ6VXNlcjExNTM0NTg3",
        "organizations_url": "https://api.github.com/users/glacambre/orgs",
        "received_events_url": "https://api.github.com/users/glacambre/received_events",
        "repos_url": "https://api.github.com/users/glacambre/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/glacambre/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/glacambre/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/glacambre"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nOccasionally when deleting lines near eob. I see the following error:\n\n```\nError in decoration provider \"line\" (ns=nvim.treesitter.highlighter):\nError executing lua: /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:370: Invalid 'col': out of range\nstack traceback:\n        [C]: in function 'nvim_buf_set_extmark'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:370: in function 'fn'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:232: in function 'for_each_highlight_state'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:322: in function 'on_line_impl'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:411: in function </usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:405>\nError in decoration provider \"line\" (ns=nvim.treesitter.highlighter):\nError executing lua: /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:370: Invalid 'col': out of range\nstack traceback:\n        [C]: in function 'nvim_buf_set_extmark'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:370: in function 'fn'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:232: in function 'for_each_highlight_state'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:322: in function 'on_line_impl'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:411: in function </usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:405>\n        [C]: in function 'redrawstatus'\n        ...zy/slimline.nvim/lua/slimline/components/diagnostics.lua:115: in function ''\n        vim/_editor.lua: in function <vim/_editor.lua:0>\nError in decoration provider \"line\" (ns=nvim.treesitter.highlighter):\nError executing lua: /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:370: Invalid 'col': out of range\nstack traceback:\n        [C]: in function 'nvim_buf_set_extmark'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:370: in function 'fn'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:232: in function 'for_each_highlight_state'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:322: in function 'on_line_impl'\n        /usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:411: in function </usr/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:405>\n        [C]: in function 'redrawstatus'\n        ...zy/slimline.nvim/lua/slimline/components/diagnostics.lua:115: in function ''\n        vim/_editor.lua: in function <vim/_editor.lua:0>\n```\n\nThis is triggered by my statusline plugin. When it calls `:redrawstatus` however, I don't think this is related to the plugin, hence why I've opened the issue here.\n\nhttps://github.com/sschleemilch/slimline.nvim/blob/v2.5.4/lua/slimline/components/diagnostics.lua#L115\n\nI do think other plugins were triggering this issue as well. In the past I couldn't get a stack trace as nvim would crash entirely. I recently disable some plugins and this was the first time I could get a stack trace from `:messages`. \n\n\n\n### Steps to reproduce\n\nThis is one of those race conditions that appears just frequently enough to drive me nuts, but not frequently enough for me to be able to confirm behavior by trying over and over again.\n\nIt's a race condition, I don't have exact steps, however I think one of the conditions is:\n\n- There must be highlighted code at an index will be out of bound after the deletion of lines.\n\nFor example:\n\nBuffer has 100 lines, at line 100 there is some code. If I delete any line while line 100 is on screen, then there was syntax highlight at line 100, but line 100 no longer exists.\n\nI thought it might be related to `:h statuscolumn`, and the line numbers going from an N digit number to an N-1 digit number, but I don't think it's the case, I was able to reproduce on a ~300 line file (only 3 digit numbers).\n\nMotions which I have been able to reproduce with:\n`dj` `dk` `dd` `d2j`\n\n\n### Expected behavior\n\nThis never happens.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.3\n\n### Vim (not Nvim) behaves the same?\n\nunknown, hard to confirm, unlikely considering vim doesn't have treesitter highlights.\n\n### Operating system/version\n\nLinux 6.16.0-arch2-1\n\n### Terminal name/version\n\nGhostty 1.1.3-arch1\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nArch extra/neovim package",
    "closed_at": "2025-08-16T12:29:04Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
        "events_url": "https://api.github.com/users/clason/events{/privacy}",
        "followers_url": "https://api.github.com/users/clason/followers",
        "following_url": "https://api.github.com/users/clason/following{/other_user}",
        "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/clason",
        "id": 2361214,
        "login": "clason",
        "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
        "organizations_url": "https://api.github.com/users/clason/orgs",
        "received_events_url": "https://api.github.com/users/clason/received_events",
        "repos_url": "https://api.github.com/users/clason/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/clason",
        "user_view_type": "public"
    },
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/35354/comments",
    "created_at": "2025-08-16T12:28:06Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/35354/events",
    "html_url": "https://github.com/neovim/neovim/issues/35354",
    "id": 3327232944,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/35354/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7GUYuw",
    "number": 35354,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/35354/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "duplicate",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/35354/timeline",
    "title": "Potential race condition in treesitter highlighter.",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-08-16T12:29:04Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/35354",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/33691921?v=4",
        "events_url": "https://api.github.com/users/XavierChanth/events{/privacy}",
        "followers_url": "https://api.github.com/users/XavierChanth/followers",
        "following_url": "https://api.github.com/users/XavierChanth/following{/other_user}",
        "gists_url": "https://api.github.com/users/XavierChanth/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/XavierChanth",
        "id": 33691921,
        "login": "XavierChanth",
        "node_id": "MDQ6VXNlcjMzNjkxOTIx",
        "organizations_url": "https://api.github.com/users/XavierChanth/orgs",
        "received_events_url": "https://api.github.com/users/XavierChanth/received_events",
        "repos_url": "https://api.github.com/users/XavierChanth/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/XavierChanth/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/XavierChanth/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/XavierChanth",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!-- Before reporting: search existing issues and check the FAQ. -->\r\n\r\n- `nvim --version`: v0.3.2\r\n- Vim (version: ) behaves differently? yes\r\n- Operating system/version: ubuntu16.04\r\n- Terminal name/version: \r\n- `$TERM`:\r\n\r\n### Steps to reproduce using `nvim -u NORC`\r\n\r\n```\r\n1. nvim -u NORC\r\n2. tnoremap jk <C-\\><C-n>\r\n3. :term\r\n4. start insert and hold down the key `j`\r\n```\r\n\r\n### Actual behaviour\r\nWhen I hold down the key `j`, it has no echo,\r\nWhen I release the key `j`, it show as\r\n![image](https://user-images.githubusercontent.com/19503791/47652479-068ee800-dbc1-11e8-9ed3-4d2f4dc47fc7.png)\r\n\r\n### Expected behaviour\r\nAs same as vim8.1\r\n\r\n",
    "closed_at": null,
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "For questions about usage/configuration, try https://vi.stackexchange.com and the resources listed at https://neovim.io/community/. The issue tracker is for bugs and feature requests. Thanks.",
            "created_at": "2018-10-29T13:17:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-433905827",
            "id": 433905827,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzkwNTgyNw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433905827/reactions"
            },
            "updated_at": "2018-10-29T13:40:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433905827",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I don't know if you misunderstood what I meant.",
            "created_at": "2018-10-29T13:19:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-433906777",
            "id": 433906777,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzkwNjc3Nw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433906777/reactions"
            },
            "updated_at": "2019-04-02T19:53:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433906777",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/19503791?v=4",
                "events_url": "https://api.github.com/users/zgpio/events{/privacy}",
                "followers_url": "https://api.github.com/users/zgpio/followers",
                "following_url": "https://api.github.com/users/zgpio/following{/other_user}",
                "gists_url": "https://api.github.com/users/zgpio/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zgpio",
                "id": 19503791,
                "login": "zgpio",
                "node_id": "MDQ6VXNlcjE5NTAzNzkx",
                "organizations_url": "https://api.github.com/users/zgpio/orgs",
                "received_events_url": "https://api.github.com/users/zgpio/received_events",
                "repos_url": "https://api.github.com/users/zgpio/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zgpio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zgpio/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zgpio",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@zgpio please fill in the \"actual behavior\" field to describe the bug, if there is a bug.",
            "created_at": "2018-10-29T13:21:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-433907260",
            "id": 433907260,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzkwNzI2MA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433907260/reactions"
            },
            "updated_at": "2019-04-02T19:53:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433907260",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@bfredl  I filled it, can you check it?",
            "created_at": "2018-10-29T13:29:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-433909773",
            "id": 433909773,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzkwOTc3Mw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433909773/reactions"
            },
            "updated_at": "2019-04-02T19:53:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/433909773",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/19503791?v=4",
                "events_url": "https://api.github.com/users/zgpio/events{/privacy}",
                "followers_url": "https://api.github.com/users/zgpio/followers",
                "following_url": "https://api.github.com/users/zgpio/following{/other_user}",
                "gists_url": "https://api.github.com/users/zgpio/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zgpio",
                "id": 19503791,
                "login": "zgpio",
                "node_id": "MDQ6VXNlcjE5NTAzNzkx",
                "organizations_url": "https://api.github.com/users/zgpio/orgs",
                "received_events_url": "https://api.github.com/users/zgpio/received_events",
                "repos_url": "https://api.github.com/users/zgpio/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zgpio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zgpio/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zgpio",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I decided to investigate this so that I can get more familiar with the code base. The problem can also be stated as follows: with the `jk` mapping in terminal mode, there is a delay between pressing the key and it showing up on the screen. Once another key (other than `k`) is pressed, both keys get rendered. If `k` is pressed, the mapped sequence gets replaced immediately.\r\n\r\nWhat I have found so far is that the terminal refreshes when `terminal_execute` is called with `K_EVENT` as the key. This causes it to process any events in the multi-queue, which causes a refresh. The event that causes this is the refresh timer, if I'm not mistaken. This happens here:\r\n\r\nhttps://github.com/neovim/neovim/blob/d13803f64fc5607c6319087240e35a8b86082f64/src/nvim/terminal.c#L455-L464\r\n\r\nKeys that are not the beginning of a mapping, say `m`, must be generating a refresh event for the terminal, since these get displayed immediately (before the refresh timer kicks in).\r\n\r\nI'm not able to find the place where such an event is generated when a non-mapped key is pressed. Any help or guidance would be greatly appreciated.",
            "created_at": "2019-04-01T13:28:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-478578901",
            "id": 478578901,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODU3ODkwMQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 2,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/478578901/reactions"
            },
            "updated_at": "2019-04-01T13:28:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/478578901",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7952509?v=4",
                "events_url": "https://api.github.com/users/Said6289/events{/privacy}",
                "followers_url": "https://api.github.com/users/Said6289/followers",
                "following_url": "https://api.github.com/users/Said6289/following{/other_user}",
                "gists_url": "https://api.github.com/users/Said6289/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Said6289",
                "id": 7952509,
                "login": "Said6289",
                "node_id": "MDQ6VXNlcjc5NTI1MDk=",
                "organizations_url": "https://api.github.com/users/Said6289/orgs",
                "received_events_url": "https://api.github.com/users/Said6289/received_events",
                "repos_url": "https://api.github.com/users/Said6289/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Said6289/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Said6289/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Said6289",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I also noticed that non-terminal insert mode has a `check` function whereas the terminal doesn't. In `insert_check` there is a call to `ins_redraw` which calls `update_screen` when there are no characters available.\r\n\r\nhttps://github.com/neovim/neovim/blob/d13803f64fc5607c6319087240e35a8b86082f64/src/nvim/edit.c#L606-L608",
            "created_at": "2019-04-01T13:37:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-478582283",
            "id": 478582283,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODU4MjI4Mw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/478582283/reactions"
            },
            "updated_at": "2019-04-01T13:37:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/478582283",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7952509?v=4",
                "events_url": "https://api.github.com/users/Said6289/events{/privacy}",
                "followers_url": "https://api.github.com/users/Said6289/followers",
                "following_url": "https://api.github.com/users/Said6289/following{/other_user}",
                "gists_url": "https://api.github.com/users/Said6289/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Said6289",
                "id": 7952509,
                "login": "Said6289",
                "node_id": "MDQ6VXNlcjc5NTI1MDk=",
                "organizations_url": "https://api.github.com/users/Said6289/orgs",
                "received_events_url": "https://api.github.com/users/Said6289/received_events",
                "repos_url": "https://api.github.com/users/Said6289/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Said6289/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Said6289/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Said6289",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The event that causes this is the refresh timer ...\r\n> I'm not able to find the place where such an event is generated when a non-mapped key is pressed. \r\n\r\nDo you mean _mapped_? Try this:\r\n\r\n```diff\r\ndiff --git a/src/nvim/terminal.c b/src/nvim/terminal.c\r\nindex 4ef37f14d21c..1b54168313a7 100644\r\n--- a/src/nvim/terminal.c\r\n+++ b/src/nvim/terminal.c\r\n@@ -455,6 +455,7 @@ static int terminal_execute(VimState *state, int key)\r\n     case K_EVENT:                                                                                                                                                 // We cannot let an event free the terminal yet. It is still needed.\r\n       s->term->refcount++;\r\n+      ELOG(\"XXX\");\r\n       multiqueue_process_events(main_loop.events);\r\n       s->term->refcount--;\r\n       if (s->term->buf_handle == 0) {\r\n```\r\n\r\nWatch the log: \r\n\r\n    stdbuf -o0 tail -F log\r\n\r\nIn another terminal, try inputing \"j\" and other keys in a `:terminal` buffer.\r\n\r\n```\r\nNVIM_LOG_FILE=log ./build/bin/nvim\r\n:tnoremap jk <C-\\><C-n>\r\n:te\r\nijabc\r\n```\r\n\r\nMapped key \"j\" will not trigger `case K_EVENT` until it times out.\r\nIIRC this behavior originates in `state.c:state_enter` and `os/input.c:os_inchar`, it's not specific to `terminal.c`. ",
            "created_at": "2019-04-02T19:58:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-479173446",
            "id": 479173446,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTE3MzQ0Ng==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/479173446/reactions"
            },
            "updated_at": "2019-04-02T20:02:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/479173446",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I also noticed that non-terminal insert mode has a `check` function whereas the terminal doesn't. In `insert_check` there is a call to `ins_redraw` which calls `update_screen` when there are no characters available.\r\n\r\nThat seems like a good  direction. Because normally while waiting for a mapping, we intentionally don't handle `K_EVENT` (because this could be any RPC, timer, etc., which could break the mapping). So maybe we should do a \"eager refresh\" (something like `insert_check` as you noted) before waiting for a mapping in terminal-mode.",
            "created_at": "2019-04-02T20:13:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-479179989",
            "id": 479179989,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTE3OTk4OQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/479179989/reactions"
            },
            "updated_at": "2019-04-02T20:13:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/479179989",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the debugging tips! I've been stepping through the code so far, which led to some misleading results sometimes because of the timeout.\r\n\r\nIt seems that `insert_check` isn't the thing that renders the `j` key before the timeout in normal mode. After adding some extra logging, I noticed that `vgetorpeek` blocks after encountering a partly mapped character. This means that in terminal mode `terminal_execute` doesn't even get called with the `j` key before `vgetorpeek` returns (i.e. after the timeout). This also happens in normal mode, except that something in `vgetorpeek` displays the `j` character _before_ `vgetorpeek` returns.\r\n\r\nIn normal mode (with the `jk` mapping set) after stepping over `ui_flush` in `inchar`, the `j` character gets displayed (in this scenario it happens on the second call to `inchar` from `vgetorpeek`).\r\n\r\nSo, it seems to me, the question is why doesn't `ui_flush` display the character in terminal mode?\r\n\r\nI will investigate this further, but hopefully this provides some insights.\r\n\r\nHere's the extra logging I added:\r\n```diff\r\ndiff --git a/src/nvim/edit.c b/src/nvim/edit.c\r\nindex a0dce5ff7..dc56d23c3 100644\r\n--- a/src/nvim/edit.c\r\n+++ b/src/nvim/edit.c\r\n@@ -480,6 +480,7 @@ static void insert_enter(InsertState *s)\r\n \r\n static int insert_check(VimState *state)\r\n {\r\n+  ELOG(\"insert_check\");\r\n   InsertState *s = (InsertState *)state;\r\n \r\n   // If typed something may trigger CursorHoldI again.\r\n@@ -610,6 +611,7 @@ static int insert_check(VimState *state)\r\n \r\n static int insert_execute(VimState *state, int key)\r\n {\r\n+  ELOG(\"insert_execute\");\r\n   if (key == K_IGNORE) {\r\n     return -1;  // get another key\r\n   }\r\ndiff --git a/src/nvim/getchar.c b/src/nvim/getchar.c\r\nindex 87a8d9b53..2bad74084 100644\r\n--- a/src/nvim/getchar.c\r\n+++ b/src/nvim/getchar.c\r\n@@ -2334,6 +2334,7 @@ static int vgetorpeek(int advance)\r\n \r\n   --vgetc_busy;\r\n \r\n+  ELOG(\"vgetorpeek done\");\r\n   return c;\r\n }\r\n \r\n@@ -2366,6 +2367,7 @@ int inchar(\r\n     long wait_time                      // milli seconds\r\n )\r\n {\r\n+  ELOG(\"inchar\");\r\n   int len = 0;  // Init for GCC.\r\n   int retesc = false;  // Return ESC with gotint.\r\n   const int tb_change_cnt = typebuf.tb_change_cnt;\r\n@@ -2437,6 +2439,9 @@ int inchar(\r\n     // Fill up to a third of the buffer, because each character may be\r\n     // tripled below.\r\n     len = os_inchar(buf, maxlen / 3, (int)wait_time, tb_change_cnt);\r\n+    if (len > 0) {\r\n+      ELOG(\"buf[0]: 0x%x\", buf[0]);\r\n+    }\r\n   }\r\n \r\n   // If the typebuf was changed further down, it is like nothing was added by\r\ndiff --git a/src/nvim/screen.c b/src/nvim/screen.c\r\nindex edddfd8ed..60b859793 100644\r\n--- a/src/nvim/screen.c\r\n+++ b/src/nvim/screen.c\r\n@@ -269,6 +269,7 @@ void update_curbuf(int type)\r\n /// @param type set to a NOT_VALID to force redraw of entire screen\r\n void update_screen(int type)\r\n {\r\n+  ELOG(\"update_screen\");\r\n   static int did_intro = FALSE;\r\n   int did_one;\r\n \r\ndiff --git a/src/nvim/terminal.c b/src/nvim/terminal.c\r\nindex ffe650f41..3a0aecc36 100644\r\n--- a/src/nvim/terminal.c\r\n+++ b/src/nvim/terminal.c\r\n@@ -429,6 +429,7 @@ void terminal_enter(void)\r\n \r\n static int terminal_execute(VimState *state, int key)\r\n {\r\n+  ELOG(\"terminal_execute\");\r\n   TerminalState *s = (TerminalState *)state;\r\n \r\n   switch (key) {\r\n```",
            "created_at": "2019-04-03T08:16:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/9167#issuecomment-479387318",
            "id": 479387318,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/9167",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTM4NzMxOA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/479387318/reactions"
            },
            "updated_at": "2019-04-03T08:16:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/479387318",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7952509?v=4",
                "events_url": "https://api.github.com/users/Said6289/events{/privacy}",
                "followers_url": "https://api.github.com/users/Said6289/followers",
                "following_url": "https://api.github.com/users/Said6289/following{/other_user}",
                "gists_url": "https://api.github.com/users/Said6289/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Said6289",
                "id": 7952509,
                "login": "Said6289",
                "node_id": "MDQ6VXNlcjc5NTI1MDk=",
                "organizations_url": "https://api.github.com/users/Said6289/orgs",
                "received_events_url": "https://api.github.com/users/Said6289/received_events",
                "repos_url": "https://api.github.com/users/Said6289/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Said6289/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Said6289/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Said6289",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 9,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/9167/comments",
    "created_at": "2018-10-29T11:43:52Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/9167/events",
    "html_url": "https://github.com/neovim/neovim/issues/9167",
    "id": 374976647,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 520282574,
            "name": "event-loop",
            "node_id": "MDU6TGFiZWw1MjAyODI1NzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/event-loop"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim core functionality or code",
            "id": 858327504,
            "name": "core",
            "node_id": "MDU6TGFiZWw4NTgzMjc1MDQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/core"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/9167/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 686,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 635,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-01-21T00:09:37Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWUzNzQ5NzY2NDc=",
    "number": 9167,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/9167/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/9167/timeline",
    "title": "\"tnoremap jk <C-\\><C-n>\" delay when holding down \"j\"",
    "updated_at": "2025-01-19T11:31:28Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/9167",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/19503791?v=4",
        "events_url": "https://api.github.com/users/zgpio/events{/privacy}",
        "followers_url": "https://api.github.com/users/zgpio/followers",
        "following_url": "https://api.github.com/users/zgpio/following{/other_user}",
        "gists_url": "https://api.github.com/users/zgpio/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zgpio",
        "id": 19503791,
        "login": "zgpio",
        "node_id": "MDQ6VXNlcjE5NTAzNzkx",
        "organizations_url": "https://api.github.com/users/zgpio/orgs",
        "received_events_url": "https://api.github.com/users/zgpio/received_events",
        "repos_url": "https://api.github.com/users/zgpio/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zgpio/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zgpio/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zgpio",
        "user_view_type": "public"
    }
}
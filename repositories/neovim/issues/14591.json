{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### In short\r\n`:checkhealth` inside tmux runs `tmux show-option -qvg escape-time`. On my system (tmux version 2.6) this command hangs and enter some really strange unresponsive state where stuff like ctrl-c/d just prints code to the terminal instead of exiting this state. This causes neovim `:checkhealth` to run indefinitely. \r\n\r\n### More details\r\n- `nvim --version`: NVIM v0.5.0-dev+1233-g82ac44d01\r\n- Operating system/version: Ubuntu 18.04\r\n- Terminal name/version: Wezterm connected in ssh mode\r\n- `$TERM`: screen-256color\r\n- `echo $0`: -bash\r\n- `tmux -V`: Both \"tmux2.6\" and \"tmux 3.1b\"\r\n\r\n### Steps to reproduce\r\nI first noticed this issue because I have a strange tmux2.6 behavior, see [this superuser question](https://superuser.com/questions/1648417/tmux-list-sets-my-shell-in-an-unresponsive-state). For example running `tmux show-option -qvg escape-time` (which is one of the commands that `:checkhealth` runs) with my broken tmux2.6 enters an unresponsive state which I have no idea how o exit.\r\n\r\nSo then when `:checkhealth` is performed the tmux command that is checked likely hangs and so hangs nvim.\r\n\r\nA more reproducible way is to replace `tmux` with something really bad, like `yes`\r\n```\r\nmv /usr/bin/tmux /usr/bin/tmux.hidden\r\ncp /usr/bin/yes /usr/bin/tmux\r\ntmux.hidden\r\nnvim -u NORC\r\n:checkhealth\r\n```\r\n\r\n### Actual behaviour 1 (with yes camouflaging as tmux)\r\nHitting ctrl-c while waiting for checkhealth to complete\r\n```\r\nRunning healthchecks...munmap_chunk(): invalid pointer\r\n                                                      Aborted (core dumped)\r\n```\r\n### Actual behaviour 2 (with yes camouflaging as tmux)\r\nWaiting 1 minute for checkhealth to complete resulted in\r\n```\r\nRunning healthchecks...Killed\r\n```\r\nand then being back at the terminal prompt with neovim killed. After this the STDIN is also broken/unavailable:\r\n```\r\n> cat\r\ncat: -: Resource temporarily unavailable\r\n```\r\n\r\n### Actual behavior 3 (with (broken?) tmux2.6 as tmux)\r\nAfter doing `:checkhealth` neovim is unresponsive forever (>5 minutes) and after pressing ctrl-c exactly 4 times, it gets unstuck and the checkhealth output for tmux looks like this:\r\n```\r\n## tmux\r\n  - ERROR: command failed: tmux show-option -qvg escape-time\r\n\r\n  - ERROR: command failed: tmux show-option -qvg focus-events\r\n\r\n  - INFO: Checking stuff\r\n  - INFO: $TERM: screen-256color\r\n  - ERROR: command failed: tmux show-option -qvgs default-terminal\r\n```\r\n\r\n### Expected behaviour\r\nRobust reaction to long-running or crashing tmux. Neovim should have a quick timeout on all commands it tests.\r\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/14591/comments",
    "created_at": "2021-05-19T19:26:32Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/14591/events",
    "html_url": "https://github.com/neovim/neovim/issues/14591",
    "id": 895802687,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "funtime",
            "id": 120251370,
            "name": "runtime",
            "node_id": "MDU6TGFiZWwxMjAyNTEzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/runtime"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/14591/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4OTU4MDI2ODc=",
    "number": 14591,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/14591/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/14591/timeline",
    "title": "checkhealth inside tmux chokes on broken tmux binary",
    "updated_at": "2025-01-19T11:39:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/14591",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/4508793?v=4",
        "events_url": "https://api.github.com/users/kaddkaka/events{/privacy}",
        "followers_url": "https://api.github.com/users/kaddkaka/followers",
        "following_url": "https://api.github.com/users/kaddkaka/following{/other_user}",
        "gists_url": "https://api.github.com/users/kaddkaka/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kaddkaka",
        "id": 4508793,
        "login": "kaddkaka",
        "node_id": "MDQ6VXNlcjQ1MDg3OTM=",
        "organizations_url": "https://api.github.com/users/kaddkaka/orgs",
        "received_events_url": "https://api.github.com/users/kaddkaka/received_events",
        "repos_url": "https://api.github.com/users/kaddkaka/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kaddkaka/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kaddkaka/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kaddkaka",
        "user_view_type": "public"
    }
}
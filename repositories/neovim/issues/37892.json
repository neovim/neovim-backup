{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "## Problem\n\n`linematch` degrades `inline:char` (and `inline:word`) precision by splitting multi-line diff blocks into separate per-line hunks before the inline diff runs. This prevents the inline diff from cross-matching text across lines within the same hunk.\n\nThis interaction was noted in the commit message of PR #33086 (_“This doesn’t interact with linematch perfectly currently”_), but no issue exists to track it. It’s also surfacing in practice as a compatibility issue — see [this comment on #22696](https://github.com/neovim/neovim/issues/22696#issuecomment-2796819324), where a user resorts to `set diffopt-=linematch:40` to work around linematch-related problems in `nvimdiff`.\n\n## Steps to reproduce\n\nCreate two files that differ by a line change + a line addition, with no unchanged separator between them:\n\n**left.txt:**\n```\nShared 1\nThe term being defined with role=\"term\", using [`aria-labelledby`](/path/to/aria-labelledby).\n$\n```\n\n**right.txt:**\n```\nShared 1\nThe term being defined with role=\"term\".\nCRThe contents; the [`aria-braillelabel`](url1), [`aria-label`](url2), and [`aria-labelledby`](/path/to/aria-labelledby). properties are prohibited.\n$\n```\n\nThen diff them with and without `linematch`.\n\n## Expected behavior\n\nWith `inline:char` enabled, the inline diff should highlight only `, using` as the changed text on the left side — regardless of whether `linematch` is enabled.\n\nThe text `[\\`aria-labelledby\\`](/path/to/aria-labelledby)` appears on both the left (line 2) and right (line 3). The inline diff should match these across lines, showing only the true difference.\n\n## Actual behavior\n\n- **Without `linematch`**: All three changed lines (L2, R2, R3) form one diff block. `inline:char` cross-matches `aria-labelledby` across L2 and R3, correctly highlighting only `, using` (7 chars) as `DiffText`.\n\n- **With `linematch`**: The hunk is split so that the inline diff cannot cross-match across lines. The result is 42 chars of `DiffText` instead of 7.\n\n## Minimal reproduction script\n\n```lua\n-- Save as /tmp/repro.lua, run: nvim --headless -u NONE -c \"luafile /tmp/repro.lua\"\nvim.o.columns = 200\nvim.o.lines = 30\n\nlocal shared = {}\nfor i = 1, 10 do shared[i] = \"Shared line \" .. i end\n\nlocal left = vim.list_extend(vim.list_extend({}, shared), {\n  'The term being defined with role=\"term\", using [`aria-labelledby`](/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-labelledby).',\n  \"$\",\n})\nlocal right = vim.list_extend(vim.list_extend({}, shared), {\n  'The term being defined with role=\"term\".',\n  'CRThe contents; the [`aria-braillelabel`](url1), [`aria-label`](url2), and [`aria-labelledby`](/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-labelledby). properties are prohibited.',\n  \"$\",\n})\n\nlocal function test(label, diffopt_val)\n  vim.cmd(\"silent! only | enew\")\n  vim.o.diffopt = diffopt_val\n  local rb = vim.api.nvim_create_buf(false, true)\n  vim.cmd(\"noautocmd buffer \" .. rb)\n  vim.api.nvim_buf_set_lines(rb, 0, -1, false, right)\n  vim.bo[rb].buftype = \"nofile\"\n  vim.cmd(\"noautocmd aboveleft vnew\")\n  local lb = vim.api.nvim_create_buf(false, true)\n  vim.cmd(\"noautocmd buffer \" .. lb)\n  vim.api.nvim_buf_set_lines(lb, 0, -1, false, left)\n  vim.bo[lb].buftype = \"nofile\"\n  vim.cmd(\"diffthis | wincmd p | diffthis | wincmd p | redraw\")\n  local line = vim.api.nvim_buf_get_lines(lb, 10, 11, false)[1]\n  local ranges = {}\n  local prev, start = \"\", 0\n  for col = 1, #line do\n    local hlid = vim.fn.diff_hlID(11, col)\n    local name = hlid > 0 and vim.fn.synIDattr(hlid, \"name\") or \"\"\n    if name ~= prev then\n      if prev ~= \"\" then ranges[#ranges+1] = prev .. \"[\" .. start .. \"-\" .. (col-1) .. \"]\" end\n      if name ~= \"\" then start = col end\n      prev = name\n    end\n  end\n  if prev ~= \"\" then ranges[#ranges+1] = prev .. \"[\" .. start .. \"-\" .. #line .. \"]\" end\n  io.write(label .. \": \" .. table.concat(ranges, \" \") .. \"\\n\")\n  vim.cmd(\"diffoff!\")\nend\n\ntest(\"WITHOUT linematch\", \"internal,filler,closeoff,indent-heuristic,inline:char\")\ntest(\"WITH    linematch\", \"internal,filler,closeoff,indent-heuristic,inline:char,linematch:60\")\nvim.cmd(\"qa!\")\n```\n\n**Output:**\n```\nWITHOUT linematch: DiffChange[1-39] DiffText[40-46] DiffChange[47-140]\nWITH    linematch: DiffChange[1-4] DiffText[5-46] DiffChange[47-140]\n```\n\nWithout `linematch`: `DiffText` covers columns 40 — 46 = `, using` (**7 chars, precise**).\nWith `linematch`: `DiffText` covers columns 5 — 46 = **42 chars** (6× worse).\n\n## Version\n\n```\nNVIM v0.12.0-dev-2312+g4719b94443\n```\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37892/comments",
    "created_at": "2026-02-16T05:35:25Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37892/events",
    "html_url": "https://github.com/neovim/neovim/issues/37892",
    "id": 3945975584,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 3010934759,
            "name": "diff",
            "node_id": "MDU6TGFiZWwzMDEwOTM0NzU5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/diff"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37892/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 777,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 639,
        "state": "open",
        "title": "backlog",
        "updated_at": "2026-02-16T22:39:01Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM7rMs8g",
    "number": 37892,
    "performed_via_github_app": null,
    "pinned_comment": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37892/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37892/timeline",
    "title": "linematch degrades inline:char diff precision",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-02-17T01:44:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37892",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/194984?v=4",
        "events_url": "https://api.github.com/users/sideshowbarker/events{/privacy}",
        "followers_url": "https://api.github.com/users/sideshowbarker/followers",
        "following_url": "https://api.github.com/users/sideshowbarker/following{/other_user}",
        "gists_url": "https://api.github.com/users/sideshowbarker/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/sideshowbarker",
        "id": 194984,
        "login": "sideshowbarker",
        "node_id": "MDQ6VXNlcjE5NDk4NA==",
        "organizations_url": "https://api.github.com/users/sideshowbarker/orgs",
        "received_events_url": "https://api.github.com/users/sideshowbarker/received_events",
        "repos_url": "https://api.github.com/users/sideshowbarker/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/sideshowbarker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sideshowbarker/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/sideshowbarker",
        "user_view_type": "public"
    }
}
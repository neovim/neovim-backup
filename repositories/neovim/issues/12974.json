{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "<!-- Before reporting: search existing issues and check the FAQ. -->\r\n\r\n- `nvim --version`: NVIM v0.5.0-702-g569e75799\r\n- Operating system/version: Windows 10 19041\r\n- Terminal name/version: powershell / my own gui (issue seems unrelated)\r\n\r\n### Steps to reproduce\r\nThe easiest way to reproduce is to install [Telescope](https://github.com/nvim-lua/telescope.nvim), then\r\n- Open some file, ideally in a folder with many files\r\n- Run `:lua require'telescope.builtin'.find_files{}`\r\n- Enter normal mode and hold down `j` and `k` to scroll through the files fast\r\n\r\n### Actual behaviour\r\nTelescope opens a new preview window with `vim.fn.termopen` and runs `cat`, if another\r\npreview is requested before the `cat` process returns, `vim.fn.jobstop` is called on the id\r\nreturned by the previous `termopen` call, this results in a memory leak.\r\n\r\nOn my Windows 10 machine this results in a ton of conhost.exe processes staying alive \r\nafter the termopen instance should been stopped.\r\n\r\n### Expected behaviour\r\n`vim.fn.jobstop` should terminate and cleanup the entire `vim.fn.termopen` instance.\r\n\r\nNote: Simply removing the `vim.fn.jobstop` calls seems to work, even then I suppose\r\nthat calling `vim.fn.jobstop` should never cause a leak like this?",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "@tjdevries ",
            "created_at": "2020-09-23T21:44:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-697988972",
            "id": 697988972,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5Nzk4ODk3Mg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/697988972/reactions"
            },
            "updated_at": "2020-09-23T21:44:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/697988972",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42123601?v=4",
                "events_url": "https://api.github.com/users/RMichelsen/events{/privacy}",
                "followers_url": "https://api.github.com/users/RMichelsen/followers",
                "following_url": "https://api.github.com/users/RMichelsen/following{/other_user}",
                "gists_url": "https://api.github.com/users/RMichelsen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RMichelsen",
                "id": 42123601,
                "login": "RMichelsen",
                "node_id": "MDQ6VXNlcjQyMTIzNjAx",
                "organizations_url": "https://api.github.com/users/RMichelsen/orgs",
                "received_events_url": "https://api.github.com/users/RMichelsen/received_events",
                "repos_url": "https://api.github.com/users/RMichelsen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RMichelsen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RMichelsen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RMichelsen",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "might this be an issue with `set hidden` ? You might need to manually unload/wipe the terminal buffer in addition to call `jobstop()` ",
            "created_at": "2020-09-23T21:47:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-697990081",
            "id": 697990081,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5Nzk5MDA4MQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/697990081/reactions"
            },
            "updated_at": "2020-09-23T21:47:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/697990081",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> might this be an issue with `set hidden` ? You might need to manually unload/wipe the terminal buffer in addition to call `jobstop()`\r\n\r\n`set nohidden` does not seem to change anything, unsure how to unload/wipe the buffer from the API to test that.",
            "created_at": "2020-09-23T21:53:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-697992298",
            "id": 697992298,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5Nzk5MjI5OA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/697992298/reactions"
            },
            "updated_at": "2020-09-23T21:53:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/697992298",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42123601?v=4",
                "events_url": "https://api.github.com/users/RMichelsen/events{/privacy}",
                "followers_url": "https://api.github.com/users/RMichelsen/followers",
                "following_url": "https://api.github.com/users/RMichelsen/following{/other_user}",
                "gists_url": "https://api.github.com/users/RMichelsen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RMichelsen",
                "id": 42123601,
                "login": "RMichelsen",
                "node_id": "MDQ6VXNlcjQyMTIzNjAx",
                "organizations_url": "https://api.github.com/users/RMichelsen/orgs",
                "received_events_url": "https://api.github.com/users/RMichelsen/received_events",
                "repos_url": "https://api.github.com/users/RMichelsen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RMichelsen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RMichelsen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RMichelsen",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "As suggested to me by @bfredl I've tried deleting the old buffers by `vim.cmd(tostring(old_bufnr)..'bw!')`, however this does not seem to help either.",
            "created_at": "2020-09-23T22:31:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-698005852",
            "id": 698005852,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODAwNTg1Mg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/698005852/reactions"
            },
            "updated_at": "2020-09-23T22:31:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/698005852",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42123601?v=4",
                "events_url": "https://api.github.com/users/RMichelsen/events{/privacy}",
                "followers_url": "https://api.github.com/users/RMichelsen/followers",
                "following_url": "https://api.github.com/users/RMichelsen/following{/other_user}",
                "gists_url": "https://api.github.com/users/RMichelsen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RMichelsen",
                "id": 42123601,
                "login": "RMichelsen",
                "node_id": "MDQ6VXNlcjQyMTIzNjAx",
                "organizations_url": "https://api.github.com/users/RMichelsen/orgs",
                "received_events_url": "https://api.github.com/users/RMichelsen/received_events",
                "repos_url": "https://api.github.com/users/RMichelsen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RMichelsen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RMichelsen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RMichelsen",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@RMichelsen Is the memory leak you are referring to the `conhost.exe` process that is left after the `jobstop` call? Then perhaps microsoft/terminal#1810 is involved. In the next example above, this happens. However, it does not occur in the example below. Therefore, including `sleep` before `jobstop` may be a workaround.\r\n\r\n```vim\r\n:lua local job_id = vim.fn.termopen('cat -') vim.fn.jobstop(job_id)\r\n```\r\n\r\n```vim\r\n:lua job_id = vim.fn.termopen('cat -')\r\n:lua vim.fn.jobstop(job_id)\r\n```",
            "created_at": "2020-09-25T01:38:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-698673003",
            "id": 698673003,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODY3MzAwMw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/698673003/reactions"
            },
            "updated_at": "2020-09-25T01:39:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/698673003",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11682285?v=4",
                "events_url": "https://api.github.com/users/erw7/events{/privacy}",
                "followers_url": "https://api.github.com/users/erw7/followers",
                "following_url": "https://api.github.com/users/erw7/following{/other_user}",
                "gists_url": "https://api.github.com/users/erw7/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/erw7",
                "id": 11682285,
                "login": "erw7",
                "node_id": "MDQ6VXNlcjExNjgyMjg1",
                "organizations_url": "https://api.github.com/users/erw7/orgs",
                "received_events_url": "https://api.github.com/users/erw7/received_events",
                "repos_url": "https://api.github.com/users/erw7/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/erw7/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/erw7/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/erw7",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@erw7 Indeed that seems to be the case. I suppose all we can do is wait for a fix from Microsoft or try to work around it with delays.",
            "created_at": "2020-09-25T14:45:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-698971245",
            "id": 698971245,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODk3MTI0NQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/698971245/reactions"
            },
            "updated_at": "2020-09-25T14:45:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/698971245",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42123601?v=4",
                "events_url": "https://api.github.com/users/RMichelsen/events{/privacy}",
                "followers_url": "https://api.github.com/users/RMichelsen/followers",
                "following_url": "https://api.github.com/users/RMichelsen/following{/other_user}",
                "gists_url": "https://api.github.com/users/RMichelsen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RMichelsen",
                "id": 42123601,
                "login": "RMichelsen",
                "node_id": "MDQ6VXNlcjQyMTIzNjAx",
                "organizations_url": "https://api.github.com/users/RMichelsen/orgs",
                "received_events_url": "https://api.github.com/users/RMichelsen/received_events",
                "repos_url": "https://api.github.com/users/RMichelsen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RMichelsen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RMichelsen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RMichelsen",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Good find -- I think I can make a workaround in telescope at some point. In the meantime, maybe MS will fix at some point.",
            "created_at": "2020-09-28T12:42:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/12974#issuecomment-699981740",
            "id": 699981740,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/12974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTk4MTc0MA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/699981740/reactions"
            },
            "updated_at": "2020-09-28T12:42:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/699981740",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4466899?v=4",
                "events_url": "https://api.github.com/users/tjdevries/events{/privacy}",
                "followers_url": "https://api.github.com/users/tjdevries/followers",
                "following_url": "https://api.github.com/users/tjdevries/following{/other_user}",
                "gists_url": "https://api.github.com/users/tjdevries/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tjdevries",
                "id": 4466899,
                "login": "tjdevries",
                "node_id": "MDQ6VXNlcjQ0NjY4OTk=",
                "organizations_url": "https://api.github.com/users/tjdevries/orgs",
                "received_events_url": "https://api.github.com/users/tjdevries/received_events",
                "repos_url": "https://api.github.com/users/tjdevries/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tjdevries/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tjdevries/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tjdevries",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/12974/comments",
    "created_at": "2020-09-23T21:39:34Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/12974/events",
    "html_url": "https://github.com/neovim/neovim/issues/12974",
    "id": 707696538,
    "labels": [
        {
            "color": "d4c5f9",
            "default": false,
            "description": null,
            "id": 109461219,
            "name": "platform:windows",
            "node_id": "MDU6TGFiZWwxMDk0NjEyMTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:windows"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/12974/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 285,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 339,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-07-04T21:53:41Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "MDU6SXNzdWU3MDc2OTY1Mzg=",
    "number": 12974,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/12974/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/12974/timeline",
    "title": "calling vim.fn.jobstop on an id returned by vim.fn.termopen causes a memory leak",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:36:38Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/12974",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/42123601?v=4",
        "events_url": "https://api.github.com/users/RMichelsen/events{/privacy}",
        "followers_url": "https://api.github.com/users/RMichelsen/followers",
        "following_url": "https://api.github.com/users/RMichelsen/following{/other_user}",
        "gists_url": "https://api.github.com/users/RMichelsen/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/RMichelsen",
        "id": 42123601,
        "login": "RMichelsen",
        "node_id": "MDQ6VXNlcjQyMTIzNjAx",
        "organizations_url": "https://api.github.com/users/RMichelsen/orgs",
        "received_events_url": "https://api.github.com/users/RMichelsen/received_events",
        "repos_url": "https://api.github.com/users/RMichelsen/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/RMichelsen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/RMichelsen/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/RMichelsen",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nUsing wezterm on Windows with `config.term = \"wezterm\"` results in the cursor not correctly switching between block and line in modes, among other typical terminal misconfigurations.\r\n\r\nUpdating `TERM` to contain `xterm-256color` partially fixes the problem.\r\n\r\nLooking in the terminal docs, they describe being able to use a terminfo file to extend Neovims understanding of terminal capabilities, however files under ~/.terminfo are apparently not loaded. I looked in https://github.com/mauke/unibilium/blob/master/uniutil.c#L174 and attempted to set `TERMINFO` and `HOME` to appropriate values, but had no success.\r\n\r\nIt is unclear how to solve this problem cleanly, it appears the docs do not cover Windows build behaviors.\n\n### Steps to reproduce\n\nwinget install wez.wezterm\r\n\r\nIn ~/.wezterm.lua:\r\n```\r\nlocal wezterm = require(\"wezterm\")\r\nlocal config = {}\r\nconfig = wezterm.config_builder()\r\nconfig.term = \"wezterm\"\r\n```\r\n\r\nStart nvim. Enter insert mode, observe cursor does not change modes.\r\n\r\nOpen `help term`, observe references to removed legacy feature `ttybuiltin`.\r\n\r\nOpen `help startup-terminal`, observe that while there is a description that a terminfo database will be used if available, and Unibilium is the library in use, attempts to install a terminfo database along with setting `HOME`, `TERMINFO` or `TERMINFO_DIRS` fail to load a terminfo to address the problem. There is no further description of the apparent difference in configuration on Windows, nor any way to add to or influence or even use members of the builtin mapping.\n\n### Expected behavior\n\n- A mapping of TERM=wezterm to xterm-256color until there is builtin terminfo for this terminal\r\n- Documentation as to how terminfo can be configured on Windows\r\n- Neovim on Windows running under Wezterm has functional title sets, cursor changes, and so on.\n\n### Neovim version (nvim -v)\n\nNVIM v0.9.4\n\n### Vim (not Nvim) behaves the same?\n\nunknown\n\n### Operating system/version\n\nWindows 11\n\n### Terminal name/version\n\nwezterm 20230712-072601-f4abf8fd\n\n### $TERM environment variable\n\nwezterm\n\n### Installation\n\nrepo",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I don't know why `$TERMINFO` or `$TERMINFO_DIRS` _wouldn't_ work on Windows. Where does Windows keep the system terminfo database? Can you share the output of `infocmp xterm-256color`?",
            "created_at": "2023-11-29T21:08:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1832703337",
            "id": 1832703337,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM5tPNVp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1832703337/reactions"
            },
            "updated_at": "2023-11-29T21:09:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1832703337",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "IIRC Nvim uses builtin terminfo on Windows because there is no terminfo database.",
            "created_at": "2023-11-29T22:02:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1832771141",
            "id": 1832771141,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM5tPd5F",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1832771141/reactions"
            },
            "updated_at": "2023-11-29T22:02:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1832771141",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> IIRC Nvim uses builtin terminfo on Windows because there is no terminfo database.\r\n\r\nMakes sense:\r\n\r\n```\r\n  // Set up unibilium/terminfo.\r\n  if (term) {\r\n    tui->ut = unibi_from_term(term);\r\n    if (tui->ut) {\r\n      if (!tui->term) {\r\n        tui->term = xstrdup(term);\r\n      }\r\n    }\r\n  }\r\n  if (!tui->ut) {\r\n    tui->ut = terminfo_from_builtin(term, &tui->term);\r\n  }\r\n```\r\n\r\nBut `unibi_from_term` checks `$TERMINFO`, `$TERMINFO_DIRS`, and for `$HOME/.terminfo`. So if those are set they should be checked, even on Windows.\r\n\r\nEDIT: Unless this is a path separator thing. Unibilium hardcodes forward slashes: https://github.com/neovim/unibilium/blob/ab28a2ddb86a144194a798bcf1fef1ab4f981ab7/uniutil.c#L126-L133",
            "created_at": "2023-11-29T22:22:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1832794916",
            "id": 1832794916,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM5tPjsk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1832794916/reactions"
            },
            "updated_at": "2023-11-29T22:24:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1832794916",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I had a similar issue. I couldn't get undercurl to work correctly using Neovim on Windows. Although, it worked perfectly fine when using WSL. I tried copying the `xterm-256color` binary from my WSL setup to Windows but still Neovim wasn't using that `.termfile` for some reason (executing `:echo &term` still showed `builtin-xterm` and not `xterm-256color`).\r\n\r\nUsing Visual Studio I was able to check that Unibilium is getting the `.terminfo` correctly when `TERMINFO` env variable is set. Reviewing the source code apparently is an issue of how Windows interprets some characters inside the `.terminfo` file. In the binary, there are some `\\x1a` characters (ASCII 26 in decimal). This is equivalent to `Ctrl + Z`, which on Windows represents the **End Of File**. Therefore, Unibilium tries to read each byte, but when it encounters the `\\x1a`, it stops counting how many bytes it has read.\r\n\r\n```\r\nunibi_term *unibi_from_fd(int fd) {\r\n    char buf[MAX_BUF];\r\n    size_t n;\r\n    ssize_t r;\r\n\r\n    for (n = 0; n < sizeof buf && (r = read(fd, buf + n, sizeof buf - n)) > 0; ) {\r\n        n += r;\r\n    }\r\n\r\n    if (r < 0) {\r\n        return NULL;\r\n    }\r\n\r\n    return unibi_from_mem(buf, n);\r\n}\r\n```\r\n[Extracted from here.](https://github.com/neovim/unibilium/blob/ab28a2ddb86a144194a798bcf1fef1ab4f981ab7/uniutil.c#L66-L80)\r\n\r\nThis causes issues parsing the data to the corresponded `struct`, making Unibilium unable to set the `.terminfo` properties correctly. Actually, it is reading all the file perfectly fine, but `read` function is returning the wrong number of bytes that have been read.\r\n\r\nNow, Neovim when `.terminfo` wasn't correctly set, uses a hardcoded binary located inside `src/nvim/tui/terminfo_defs.h` (if you are using a compatible `xcode` family terminal, it would use [this](https://github.com/neovim/neovim/blob/master/src/nvim/tui/terminfo_defs.h#L2303-L2305)).\r\n\r\nChanging [this](https://github.com/neovim/neovim/blob/master/src/nvim/tui/terminfo_defs.h#L2303-L2305) to whatever `.teminfo` data you want to use, and recompiling, is a workaround to fix the issue. A better solution would be to create a compatible `.terminfo` file for Windows.",
            "created_at": "2023-11-30T18:24:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1834320216",
            "id": 1834320216,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM5tVYFY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1834320216/reactions"
            },
            "updated_at": "2023-11-30T18:24:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1834320216",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/57044155?v=4",
                "events_url": "https://api.github.com/users/ChuyB/events{/privacy}",
                "followers_url": "https://api.github.com/users/ChuyB/followers",
                "following_url": "https://api.github.com/users/ChuyB/following{/other_user}",
                "gists_url": "https://api.github.com/users/ChuyB/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ChuyB",
                "id": 57044155,
                "login": "ChuyB",
                "node_id": "MDQ6VXNlcjU3MDQ0MTU1",
                "organizations_url": "https://api.github.com/users/ChuyB/orgs",
                "received_events_url": "https://api.github.com/users/ChuyB/received_events",
                "repos_url": "https://api.github.com/users/ChuyB/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ChuyB/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ChuyB/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ChuyB",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@ChuyB very helpful, thanks. From https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/read?view=msvc-170 : \r\n\r\n> If the file was opened in text mode, the read terminates when _read encounters a CTRL+Z character, which is treated as an end-of-file indicator.\r\n\r\nI wonder why the `fd` was opened in text mode, maybe we can change that in unibilium.",
            "created_at": "2023-12-01T01:01:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1835221800",
            "id": 1835221800,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM5tY0Mo",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1835221800/reactions"
            },
            "updated_at": "2023-12-01T01:01:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1835221800",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I was just wondering if there was ever a fix figured out for this? I use wezterm on Windows without WSL. I can get undercurl from Wezterm in the terminal outside of neovim. However, there is no undercurl inside of neovim unless I set my $TERM env variable to something like \"tmux\".  Using a custom wezterm terminfo file doesn't work for above reasons but I wasn't sure if I should just stick to the modified $TERM env variable.",
            "created_at": "2024-02-19T17:35:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1952933381",
            "id": 1952933381,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM50Z2YF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1952933381/reactions"
            },
            "updated_at": "2024-02-19T18:56:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1952933381",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/105152139?v=4",
                "events_url": "https://api.github.com/users/akthe-at/events{/privacy}",
                "followers_url": "https://api.github.com/users/akthe-at/followers",
                "following_url": "https://api.github.com/users/akthe-at/following{/other_user}",
                "gists_url": "https://api.github.com/users/akthe-at/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/akthe-at",
                "id": 105152139,
                "login": "akthe-at",
                "node_id": "U_kgDOBkR-iw",
                "organizations_url": "https://api.github.com/users/akthe-at/orgs",
                "received_events_url": "https://api.github.com/users/akthe-at/received_events",
                "repos_url": "https://api.github.com/users/akthe-at/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/akthe-at/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/akthe-at/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/akthe-at",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> @ChuyB very helpful, thanks. From https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/read?view=msvc-170 :\r\n> \r\n> > If the file was opened in text mode, the read terminates when _read encounters a CTRL+Z character, which is treated as an end-of-file indicator.\r\n> \r\n> I wonder why the `fd` was opened in text mode, maybe we can change that in unibilium.\r\n\r\nIf I recall correctly, on Windows the `O_BINARY` flag is needed in the `open()` call. This flag does not exist on POSIX systems, so it must be gated behind a pre-processor guard.\r\n\r\nThe following patch applied to Unibilium might work, though I haven't actually tested it:\r\n\r\n```diff\r\ndiff --git a/uniutil.c b/uniutil.c\r\nindex e0b4e01..19cc287 100644\r\n--- a/uniutil.c\r\n+++ b/uniutil.c\r\n@@ -83,7 +83,11 @@ unibi_term *unibi_from_file(const char *file) {\r\n     int fd;\r\n     unibi_term *ut;\r\n \r\n-    if ((fd = open(file, O_RDONLY)) < 0) {\r\n+    int flags = O_RDONLY;\r\n+#ifdef MSWIN\r\n+    flags |= O_BINARY;\r\n+#endif\r\n+    if ((fd = open(file, flags)) < 0) {\r\n         return NULL;\r\n     }\r\n \r\n```",
            "created_at": "2024-02-19T18:21:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-1952986153",
            "id": 1952986153,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM50aDQp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1952986153/reactions"
            },
            "updated_at": "2024-02-19T18:21:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1952986153",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "I can not reproduce the above two users on Windows 10 with Neovim 0.10... I thought this was fixed earlier this year before the release of neovim 0.10 ? When I use pwsh.exe with no $TERM set in the profile I have undercurl support with both Windows Terminal and Wezterm. If I use git-bash and once again do not manually set a $TERM var then I have undercurl in both WT and Wezterm.\r\n\r\n![image](https://github.com/user-attachments/assets/4ee9c459-b1c1-49e0-8bb1-3a1d21f9d9bc)\r\n",
            "created_at": "2024-09-19T16:20:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2361463659",
            "id": 2361463659,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6MwRNr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2361463659/reactions"
            },
            "updated_at": "2024-09-21T14:50:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2361463659",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/105152139?v=4",
                "events_url": "https://api.github.com/users/akthe-at/events{/privacy}",
                "followers_url": "https://api.github.com/users/akthe-at/followers",
                "following_url": "https://api.github.com/users/akthe-at/following{/other_user}",
                "gists_url": "https://api.github.com/users/akthe-at/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/akthe-at",
                "id": 105152139,
                "login": "akthe-at",
                "node_id": "U_kgDOBkR-iw",
                "organizations_url": "https://api.github.com/users/akthe-at/orgs",
                "received_events_url": "https://api.github.com/users/akthe-at/received_events",
                "repos_url": "https://api.github.com/users/akthe-at/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/akthe-at/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/akthe-at/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/akthe-at",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I can not reproduce the above two users on Windows 10 with Neovim 0.10... I thought this was fixed earlier this year before the release of neovim 0.10 ? When I use pwsh.exe with no $TERM set in the profile I have undercurl support with both Windows Terminal and Wezterm. If I use git-bash and once again do not manually set a $TERM var then I have undercurl in both WT and Wezterm.\r\n> \r\n> ![image](https://private-user-images.githubusercontent.com/105152139/369085081-4ee9c459-b1c1-49e0-8bb1-3a1d21f9d9bc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjY4NjYwMzAsIm5iZiI6MTcyNjg2NTczMCwicGF0aCI6Ii8xMDUxNTIxMzkvMzY5MDg1MDgxLTRlZTljNDU5LWIxYzEtNDllMC04YmIxLTNhMWQyMWY5ZDliYy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwOTIwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDkyMFQyMDU1MzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yZGM2MDIzODJkYzBiN2EwZWMxYzdmOWY5ODM2YzI2N2ZmZTY2MDRmMGZiNmIxZTg0OTc4NjhiYTY4OTJmMjRkJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.G9ggw_8-4pihMEg4mpv8q-RW3BC-JU2Ue35Q5bDBDw4)\r\n\r\nIt's fixed after I upgraded neovim and windows terminal preview.",
            "created_at": "2024-09-20T22:03:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2364676065",
            "id": 2364676065,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6M8hfh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2364676065/reactions"
            },
            "updated_at": "2024-09-21T14:51:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2364676065",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61672396?v=4",
                "events_url": "https://api.github.com/users/xudyang1/events{/privacy}",
                "followers_url": "https://api.github.com/users/xudyang1/followers",
                "following_url": "https://api.github.com/users/xudyang1/following{/other_user}",
                "gists_url": "https://api.github.com/users/xudyang1/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/xudyang1",
                "id": 61672396,
                "login": "xudyang1",
                "node_id": "MDQ6VXNlcjYxNjcyMzk2",
                "organizations_url": "https://api.github.com/users/xudyang1/orgs",
                "received_events_url": "https://api.github.com/users/xudyang1/received_events",
                "repos_url": "https://api.github.com/users/xudyang1/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/xudyang1/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xudyang1/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/xudyang1",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I can not reproduce the above two users on Windows 10 with Neovim 0.10... I thought this was fixed earlier this year before the release of neovim 0.10 ? When I use pwsh.exe with no $TERM set in the profile I have undercurl support with both Windows Terminal and Wezterm. If I use git-bash and once again do not manually set a $TERM var then I have undercurl in both WT and Wezterm.\r\n>\r\n> ![image](https://private-user-images.githubusercontent.com/105152139/369085081-4ee9c459-b1c1-49e0-8bb1-3a1d21f9d9bc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjY5MjQ2NDgsIm5iZiI6MTcyNjkyNDM0OCwicGF0aCI6Ii8xMDUxNTIxMzkvMzY5MDg1MDgxLTRlZTljNDU5LWIxYzEtNDllMC04YmIxLTNhMWQyMWY5ZDliYy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwOTIxJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDkyMVQxMzEyMjhaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xZjA5OGVkNzNjNTczMzJmNDlhMTU3MDc4MzNhNWJjYzliNWNhOWM5ZjBkOTI5MDZjOWQ1OTU4NjZkYWFlY2M4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.TJuEr-oXDOmY-QxVLOAzCbjxWClhlACmn_eorho4C0w)\r\n\r\nNow I know why I commented in this thread: `$TERM` is empty in neovim with powershell, thus markdown strikethrough `~~strike~~` does not render:\r\n\r\n1. Without setting $TERM\r\n\r\n- repro.md\r\n\r\n  ```markdown\r\n  ~~strike~~\r\n  ```\r\n\r\n- run `nvim --clean --noplugin repro.md`\r\n- `:echo $TERM`: empty\r\n- `:Inspect` over strike: `Syntax - markdownStrike links to htmlStrike`\r\n- `:highlight htmlStrike`: `htmlStrike xxx cterm=strikethrough gui=strikethrough`\r\n- cross does not render\r\n\r\n2. Set `$Env:TERM=\"xterm-256color\"` before running nvim\r\n\r\n- run `$env:TERM='xterm-256color'; nvim --clean --noplugin repro.md`\r\n- `:echo $TERM`: `xterm-256color`\r\n- cross rendered as expected",
            "created_at": "2024-09-21T13:24:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2365187597",
            "id": 2365187597,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6M-eYN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365187597/reactions"
            },
            "updated_at": "2024-09-21T14:51:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365187597",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/61672396?v=4",
                "events_url": "https://api.github.com/users/xudyang1/events{/privacy}",
                "followers_url": "https://api.github.com/users/xudyang1/followers",
                "following_url": "https://api.github.com/users/xudyang1/following{/other_user}",
                "gists_url": "https://api.github.com/users/xudyang1/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/xudyang1",
                "id": 61672396,
                "login": "xudyang1",
                "node_id": "MDQ6VXNlcjYxNjcyMzk2",
                "organizations_url": "https://api.github.com/users/xudyang1/orgs",
                "received_events_url": "https://api.github.com/users/xudyang1/received_events",
                "repos_url": "https://api.github.com/users/xudyang1/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/xudyang1/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xudyang1/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/xudyang1",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@xudyang1 this seems limited to windows terminal. Your reproduction creates a strike through in Wezterm for me but not in Windows terminal. ",
            "created_at": "2024-09-21T13:36:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2365190641",
            "id": 2365190641,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6M-fHx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365190641/reactions"
            },
            "updated_at": "2024-09-21T14:51:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365190641",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/105152139?v=4",
                "events_url": "https://api.github.com/users/akthe-at/events{/privacy}",
                "followers_url": "https://api.github.com/users/akthe-at/followers",
                "following_url": "https://api.github.com/users/akthe-at/following{/other_user}",
                "gists_url": "https://api.github.com/users/akthe-at/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/akthe-at",
                "id": 105152139,
                "login": "akthe-at",
                "node_id": "U_kgDOBkR-iw",
                "organizations_url": "https://api.github.com/users/akthe-at/orgs",
                "received_events_url": "https://api.github.com/users/akthe-at/received_events",
                "repos_url": "https://api.github.com/users/akthe-at/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/akthe-at/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/akthe-at/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/akthe-at",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "wtf does any of the last 5 comments have to do with the original issue here?",
            "created_at": "2024-09-21T14:50:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2365214508",
            "id": 2365214508,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6M-k8s",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365214508/reactions"
            },
            "updated_at": "2024-09-21T14:50:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365214508",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Is there any update to this issue?  I was looking through the TUI doc for how Neovim sets window `lines` & `columns` for window size and none of the steps are applicable to Windows Terminal:\n\n* Doesn't support TIOCGWINSZ\n* Env `LINES` and `COLUMNS` are empty\n* Now learning that terminfo doesn't work properly\n\nSince `$TERM` isn't set, I'm assuming that \n\n> Nvim will map |$TERM| to a builtin entry according to the above table, or \"ansi\" if there is no match.\n\nisn't working for Windows Terminal.  Not sure how Neovim is setting the window size in this scenario, but it isn't the default 24 x 80 and it doesn't quite fill the whole window.  Now I'm wondering what other potential problems arise from this issue.  I'd prefer not to fork the repo, modify the `terminfo_defs.h`, and build it myself if I don't have to.",
            "created_at": "2025-04-24T22:19:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2828987414",
            "id": 2828987414,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6onuwW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2828987414/reactions"
            },
            "updated_at": "2025-04-24T22:19:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2828987414",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26778688?v=4",
                "events_url": "https://api.github.com/users/arpan3t/events{/privacy}",
                "followers_url": "https://api.github.com/users/arpan3t/followers",
                "following_url": "https://api.github.com/users/arpan3t/following{/other_user}",
                "gists_url": "https://api.github.com/users/arpan3t/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/arpan3t",
                "id": 26778688,
                "login": "arpan3t",
                "node_id": "MDQ6VXNlcjI2Nzc4Njg4",
                "organizations_url": "https://api.github.com/users/arpan3t/orgs",
                "received_events_url": "https://api.github.com/users/arpan3t/received_events",
                "repos_url": "https://api.github.com/users/arpan3t/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/arpan3t/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/arpan3t/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/arpan3t",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "No update. Need someone on Windows to try https://github.com/neovim/neovim/issues/26221#issuecomment-1952986153 , and send a PR (ideally with a test).",
            "created_at": "2025-04-26T15:29:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/26221#issuecomment-2832318904",
            "id": 2832318904,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26221",
            "node_id": "IC_kwDOAPphoM6o0cG4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2832318904/reactions"
            },
            "updated_at": "2025-04-26T15:29:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2832318904",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 14,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26221/comments",
    "created_at": "2023-11-26T02:10:22Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26221/events",
    "html_url": "https://github.com/neovim/neovim/issues/26221",
    "id": 2010861393,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "d4c5f9",
            "default": false,
            "description": null,
            "id": 109461219,
            "name": "platform:windows",
            "node_id": "MDU6TGFiZWwxMDk0NjEyMTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:windows"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "user system environment (terminal, shell, tmux)",
            "id": 147354524,
            "name": "environment",
            "node_id": "MDU6TGFiZWwxNDczNTQ1MjQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/environment"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, self-contained. Do NOT ask \"can I work on this\", just read CONTRIBUTING.md",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "",
            "id": 606691254,
            "name": "has:plan",
            "node_id": "MDU6TGFiZWw2MDY2OTEyNTQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:plan"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26221/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 712,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 638,
        "state": "open",
        "title": "backlog",
        "updated_at": "2025-04-28T12:13:30Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM53209R",
    "number": 26221,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26221/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26221/timeline",
    "title": "TUI: load custom terminfo for Windows builds",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-04-26T15:29:41Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26221",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/348?v=4",
        "events_url": "https://api.github.com/users/raggi/events{/privacy}",
        "followers_url": "https://api.github.com/users/raggi/followers",
        "following_url": "https://api.github.com/users/raggi/following{/other_user}",
        "gists_url": "https://api.github.com/users/raggi/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/raggi",
        "id": 348,
        "login": "raggi",
        "node_id": "MDQ6VXNlcjM0OA==",
        "organizations_url": "https://api.github.com/users/raggi/orgs",
        "received_events_url": "https://api.github.com/users/raggi/received_events",
        "repos_url": "https://api.github.com/users/raggi/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/raggi/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/raggi/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/raggi",
        "user_view_type": "public"
    }
}
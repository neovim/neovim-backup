{
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
        "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
        "followers_url": "https://api.github.com/users/luukvbaal/followers",
        "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
        "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/luukvbaal",
        "id": 31730729,
        "login": "luukvbaal",
        "node_id": "MDQ6VXNlcjMxNzMwNzI5",
        "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
        "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
        "repos_url": "https://api.github.com/users/luukvbaal/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/luukvbaal",
        "user_view_type": "public"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
            "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
            "followers_url": "https://api.github.com/users/luukvbaal/followers",
            "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
            "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/luukvbaal",
            "id": 31730729,
            "login": "luukvbaal",
            "node_id": "MDQ6VXNlcjMxNzMwNzI5",
            "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
            "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
            "repos_url": "https://api.github.com/users/luukvbaal/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/luukvbaal",
            "user_view_type": "public"
        }
    ],
    "author_association": "NONE",
    "body": "### Problem\n\nI've been trying to use the new `vim.fn.wildtrigger()` and I found an issue related to the extui + findfunc. This is the error I get when I try to use `:find` with a keymap (I'm not able to replicate when writing it myself):\n\n```\nError in \"cmdline_show\" UI event handler (ns=nvim._ext_ui):\nLua: /usr/local/share/nvim/runtime/lua/vim/_extui/cmdline.lua:52: E565: Not allowed to change text or change window\nstack traceback:\n        [C]: in function 'nvim_buf_set_lines'\n        /usr/local/share/nvim/runtime/lua/vim/_extui/cmdline.lua:52: in function 'set_text'\n        /usr/local/share/nvim/runtime/lua/vim/_extui/cmdline.lua:77: in function 'handler'\n        /usr/local/share/nvim/runtime/lua/vim/_extui.lua:44: in function 'ui_callback'\n        /usr/local/share/nvim/runtime/lua/vim/_extui.lua:89: in function </usr/local/share/nvim/runtime/lua/vim/_extui.lua:82>\n        [C]: in function 'wait'\n        vim/_system.lua: in function 'wait'\n        /home/user/.config/nvim-test/init.lua:13: in function </home/user/.config/nvim-test/init.lua:11>\n```\n\nThe error is repeated a bunch of times until the last error is `Excessive errors in vim.ui_attach() callback (ns=nvim._ext_ui)` when the whole extui is non-functional (and still hides the \"normal cmdline\" so I can I use the cmdline but can't see what I type). The line `init.lua:13` is marked in the reproduction below.\n\nLooks like this is because the cmdline (extui) is now a window? `:h 'findfunc'`: \"It is not allowed to change text or jump to another window while executing the 'findfunc' |textlock|.\" I guess it is mentioned in the help, but it is annoying to not be able to use `wildtrigger()` with the extui.\n\n### Steps to reproduce\n\n- Use this `init.lua` in `~/.config/nvim-test`:\n```lua\nrequire('vim._extui').enable({})\n\nvim.api.nvim_create_autocmd({ 'CmdlineChanged' }, {\n  pattern = '*',\n  callback = function()\n      vim.fn.wildtrigger()\n  end,\n})\n\n---@param cmdarg string\nfunction FindFunc(cmdarg, _)\n  local cmd = { 'find', '.', '-type', 'f' }\n  local files = vim.system(cmd, { text = true }):wait() // <- this is the line 13\n  if not files.stdout then\n    return {}\n  end\n  return vim.split(vim.trim(files.stdout), '\\n')\nend\n\nvim.o.findfunc = 'v:lua.FindFunc'\nvim.o.wildmode = \"noselect:lastused,full\"\nvim.o.wildoptions = \"pum\"\n\nvim.keymap.set('n', 'f', ':find ')\n```\n- run `NVIM_APPNAME=nvim-test nvim`\n- press `f` until it crashes (the error doesn't always happen, so you may need to `<esc>` and press `f` a few times until it crashes)\n\n### Expected behavior\n\nTo not crash extui when using wildtrigger() with extui.\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-1469+g86d90f3fff\n\n### Vim (not Nvim) behaves the same?\n\nnot relevant\n\n### Operating system/version\n\nWindows 11 and Ubuntu 24.04.3\n\n### Terminal name/version\n\nwezterm\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nbuilding from master",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "I've been having the same error triggered on selecting certain completion items in the wildmenu when using extui. Im not using findfunc so that part may be unnecessary to replecate this.",
            "created_at": "2025-10-20T02:54:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/36240#issuecomment-3420358222",
            "id": 3420358222,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/36240",
            "node_id": "IC_kwDOAPphoM7L3oZO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3420358222/reactions"
            },
            "updated_at": "2025-10-20T02:54:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3420358222",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/51029315?v=4",
                "events_url": "https://api.github.com/users/crwebb85/events{/privacy}",
                "followers_url": "https://api.github.com/users/crwebb85/followers",
                "following_url": "https://api.github.com/users/crwebb85/following{/other_user}",
                "gists_url": "https://api.github.com/users/crwebb85/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/crwebb85",
                "id": 51029315,
                "login": "crwebb85",
                "node_id": "MDQ6VXNlcjUxMDI5MzE1",
                "organizations_url": "https://api.github.com/users/crwebb85/orgs",
                "received_events_url": "https://api.github.com/users/crwebb85/received_events",
                "repos_url": "https://api.github.com/users/crwebb85/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/crwebb85/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/crwebb85/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/crwebb85",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/36240/comments",
    "created_at": "2025-10-18T14:57:41Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/36240/events",
    "html_url": "https://github.com/neovim/neovim/issues/36240",
    "id": 3528901802,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim 0.12 mesages/dialog/pager/notifications based on the UI-ext protocol",
            "id": 8934685970,
            "name": "ui2",
            "node_id": "LA_kwDOAPphoM8AAAACFIx9Eg",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ui2"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/36240/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM7SVsSq",
    "number": 36240,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/36240/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/36240/timeline",
    "title": "wildtrigger + extui + findfunc crashes extui",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-10-20T02:54:50Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/36240",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/33849340?v=4",
        "events_url": "https://api.github.com/users/SebasF1349/events{/privacy}",
        "followers_url": "https://api.github.com/users/SebasF1349/followers",
        "following_url": "https://api.github.com/users/SebasF1349/following{/other_user}",
        "gists_url": "https://api.github.com/users/SebasF1349/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/SebasF1349",
        "id": 33849340,
        "login": "SebasF1349",
        "node_id": "MDQ6VXNlcjMzODQ5MzQw",
        "organizations_url": "https://api.github.com/users/SebasF1349/orgs",
        "received_events_url": "https://api.github.com/users/SebasF1349/received_events",
        "repos_url": "https://api.github.com/users/SebasF1349/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/SebasF1349/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SebasF1349/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/SebasF1349",
        "user_view_type": "public"
    }
}
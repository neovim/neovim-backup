{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\n\nThere is no way to check if Nvim is currently in some sort of lock state. Like `:h textlock` or `:h :map-expression`.\n\nThere is `:h state()`, but it seems to only partially overlap with this \"lock\" situation.\n\n---\n\nThe outline of the use case for this is along the lines of \"asynchronously show text regardless of the current state\". Like showing LSP progress in the floating window even if there is currently expression mapping executing (which can be not instant if it contains `vim.fn.getcharstr()`).\n\n### Expected behavior\n\nA `vim.in_lock()` (similar to `vim.in_fast_event()`) that returns `true` if the editor is locked (can't change buffer lines, etc.) and `false` otherwise.\n\nAnother alternative might be enhancing `vim.fn.state()` to have a new character `l` to indicate \"lock\".",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "`nvim_get_mode()` returns a `blocking` flag which is currently the best clue about this, though it is only best-effort and can't guarantee anything. \n\nI think `state()` was added much later :(\n\nSee also : \n\n- https://github.com/neovim/neovim/issues/30760\n\n",
            "created_at": "2026-02-23T16:46:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/38034#issuecomment-3945944965",
            "id": 3945944965,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/38034",
            "node_id": "IC_kwDOAPphoM7rMleF",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3945944965/reactions"
            },
            "updated_at": "2026-02-23T16:46:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3945944965",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> `nvim_get_mode()` returns a `blocking` flag which is currently the best clue about this, though it is only best-effort and can't guarantee anything.\n\nMissed that, but I've just checked and it doesn't seem to work for this issue (at least in a \"detect if inside expression mapping\" sense).\n\nThe best hacky solution (kindly suggested by @seandewar) seems to be to explicitly try to do the stuff on a smaller and detect an error. Like try setting lines for a dummy scratch buffer and see if there is an error.",
            "created_at": "2026-02-23T17:34:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/38034#issuecomment-3946243953",
            "id": 3946243953,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/38034",
            "node_id": "IC_kwDOAPphoM7rNudx",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3946243953/reactions"
            },
            "updated_at": "2026-02-23T17:34:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3946243953",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I don't fully understand the use case. Does `vim.schedule()` or `vim.defer_fn()` not work because the callback could execute during textlock (or other kinds of \"locks\")? If so, maybe we need a flag on those function(s) that \"(re)schedules\" stuff until textlock/fast/whatever is favorable.\n\n    vim.defer_fn({textlock=false, fast=false}, ...)\n\nI do not think we should add a bunch of random `is_foo()` checks for these hacky situations. Plugins should be able to say \"do this when you can actually fucking do it\". All of those \"lock\" things are lame hacks, not a central concept that plugins should have to worry about.\n\nWDYT?",
            "created_at": "2026-02-23T20:42:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/38034#issuecomment-3947228006",
            "id": 3947228006,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/38034",
            "node_id": "IC_kwDOAPphoM7rRetm",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3947228006/reactions"
            },
            "updated_at": "2026-02-23T20:44:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3947228006",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I don't fully understand the use case. Does `vim.schedule()` or `vim.defer_fn()` not work because the callback could execute during textlock (or other kinds of \"locks\")?\n\nThe use case is quite literally to write a function for external use that sets buffer text and shows it in the floating window. In my original case - basically a `vim.notify` implementation.\n\nThe goal is to have function do its thing immediately if possible. The problem is that it might be called 1) inside libuv timer; or 2) in the background when expression mapping is active. The 1 can be adjusted by checking at the top of the `vim.notify` with `vim.in_fast_event`, while 2 doesn't have this type of workaround.\n\nThe `vim.schedule` is not enough here because expression mapping can be \"in process\" for an indefinite amount of time (thanks to `vim.fn.getcharstr()`).\n\n>  If so, maybe we need a flag on those function(s) that \"(re)schedules\" stuff until textlock/fast/whatever is favorable.\n\nI would be an improvement. Not immediately sure if it cover more ground than a dedicated predicate. The `vim.fn.state()` looks like a good place for this kind of stuff as it already provides similar capabilities.",
            "created_at": "2026-02-23T21:17:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/38034#issuecomment-3947380482",
            "id": 3947380482,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/38034",
            "node_id": "IC_kwDOAPphoM7rSD8C",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3947380482/reactions"
            },
            "updated_at": "2026-02-23T21:17:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3947380482",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The `vim.fn.state()` looks like a good place for this kind of stuff as it already provides similar capabilities.\n\nSure, SGTM. Maybe we should add a \"fast\" flag in there too.",
            "created_at": "2026-02-23T22:15:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/38034#issuecomment-3947626112",
            "id": 3947626112,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/38034",
            "node_id": "IC_kwDOAPphoM7rS_6A",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3947626112/reactions"
            },
            "updated_at": "2026-02-23T22:15:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3947626112",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/38034/comments",
    "created_at": "2026-02-23T16:28:58Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/38034/events",
    "html_url": "https://github.com/neovim/neovim/issues/38034",
    "id": 3979060137,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "",
            "id": 606691254,
            "name": "has:plan",
            "node_id": "MDU6TGFiZWw2MDY2OTEyNTQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:plan"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "user workflows, Ex commands",
            "id": 7421978602,
            "name": "editor",
            "node_id": "LA_kwDOAPphoM8AAAABumJn6g",
            "url": "https://api.github.com/repos/neovim/neovim/labels/editor"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/38034/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 780,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 637,
        "state": "open",
        "title": "backlog",
        "updated_at": "2026-02-23T20:46:06Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM7tK6Op",
    "number": 38034,
    "performed_via_github_app": null,
    "pinned_comment": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/38034/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/38034/timeline",
    "title": "plugins can check if editor state is \"locked\" (textlock, etc?)",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-02-23T22:16:24Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/38034",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
        "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
        "followers_url": "https://api.github.com/users/echasnovski/followers",
        "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
        "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/echasnovski",
        "id": 24854248,
        "login": "echasnovski",
        "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
        "organizations_url": "https://api.github.com/users/echasnovski/orgs",
        "received_events_url": "https://api.github.com/users/echasnovski/received_events",
        "repos_url": "https://api.github.com/users/echasnovski/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/echasnovski",
        "user_view_type": "public"
    }
}
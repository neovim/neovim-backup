{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "# Floating Windows Do Not Maintain Focus and Have Inconsistent Events\n\n## Problem\n\nFloating windows in Neovim do not maintain focus consistently and lack proper lifecycle events, making modal behavior impossible without workarounds. Users frequently lose focus when navigating within floating windows, and there's no reliable way to track floating window state changes.\n\n**Current issues:**\n1. Focus is lost unpredictably during normal navigation within floating windows\n2. Window navigation commands (`<C-w>w`, `<C-w>h/j/k/l`) can break out of floating windows unexpectedly  \n3. No `FloatNew`/`FloatClosed` events for proper lifecycle management\n4. `focusable=false` behavior is inconsistent across different scenarios\n\n## Steps to reproduce\n\nUsing minimal reproduction:\n\n```bash\nnvim --clean -u minimal.lua\n```\n\nminimal.lua:\n```lua\n-- Test floating window focus behavior\nvim.keymap.set('n', '<leader>f', function()\n  local buf = vim.api.nvim_create_buf(false, true)\n  vim.api.nvim_buf_set_lines(buf, 0, -1, false, {\n    'Floating window test',\n    'Try using <C-w>w or <C-w>h/j/k/l',\n    'Focus should stay trapped here'\n  })\n  \n  vim.api.nvim_open_win(buf, true, {\n    relative = 'editor',\n    width = 40,\n    height = 10,\n    row = 5,\n    col = 10,\n    style = 'minimal',\n    border = 'rounded'\n  })\nend)\n```\n\nSteps:\n1. Open a few splits: `:split | vsplit`\n2. Press `<leader>f` to open floating window\n3. Try `<C-w>w` or `<C-w>h` - focus escapes to background windows\n4. No way to detect when floating window opens/closes without manual tracking\n\n## Expected behavior\n\n1. Floating windows should optionally support modal behavior where focus stays trapped\n2. Window navigation should respect floating window boundaries when modal\n3. Events should fire when floating windows are created/destroyed\n4. `focusable` attribute should work consistently\n\n## Neovim version (nvim -v)\nNVIM v0.10.2\nBuild type: Release\nLuaJIT 2.1.1713484068\n\n## Vim (not Nvim) behaves the same?\nN/A - Vim doesn't have floating windows\n\n## Operating system/version\nLinux 6.11.0-26-generic\n\n## Terminal name/version\ngnome-terminal 3.52.2\n\n## $TERM environment variable\nxterm-256color\n\n## Installation\nSystem package manager (apt)\n\n---\n\n## Related Issues\n- #26548 (Add FloatNew and FloatClosed events)\n- #28454 (Floating window with focusable=false can become current)\n- #17509 (LSP hover focus issues)  \n- #25643 (Mouse input focus problems)\n- #29365 (focusable for non-floating windows)\n\n## Current Workaround\n\nMany users implement autocmd-based focus trapping:\n\n```lua\nvim.api.nvim_create_augroup(\"ModalFloating\", { clear = true })\nvim.api.nvim_create_autocmd(\"WinLeave\", {\n  group = \"ModalFloating\",\n  callback = function()\n    local win = vim.api.nvim_get_current_win()\n    local config = vim.api.nvim_win_get_config(win)\n    if config.relative ~= \"\" then\n      vim.g.last_floating_win = win\n    end\n  end,\n})\n\nvim.api.nvim_create_autocmd(\"WinEnter\", {\n  group = \"ModalFloating\", \n  callback = function()\n    if vim.g.last_floating_win and vim.api.nvim_win_is_valid(vim.g.last_floating_win) then\n      vim.api.nvim_set_current_win(vim.g.last_floating_win)\n    end\n  end,\n})\n```",
    "closed_at": "2025-06-09T13:16:28Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> Window navigation should respect floating window boundaries when modal\n\nNot sure this is to be expected, I think it makes sense for window navigation commands to escape a floating window. `:h CTRL-W_w` also specifically mentions \"move the cursor to the |focusable| window below/right of the current one. If none, go to the top left window.\" Which could already be interpreted to apply to floating windows.\n\n> focusable attribute should work consistently\n\nThere has been work to improve this, please try a nightly build and adjust your report if you find a command that still focuses `unfocusable` windows.",
            "created_at": "2025-06-09T07:16:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/34391#issuecomment-2954903831",
            "id": 2954903831,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34391",
            "node_id": "IC_kwDOAPphoM6wIEEX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2954903831/reactions"
            },
            "updated_at": "2025-06-09T07:22:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2954903831",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "auto-closing since latest release (not to mention the nightly) was not tested.",
            "created_at": "2025-06-09T13:16:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/34391#issuecomment-2955767462",
            "id": 2955767462,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/34391",
            "node_id": "IC_kwDOAPphoM6wLW6m",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2955767462/reactions"
            },
            "updated_at": "2025-06-09T13:16:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2955767462",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/34391/comments",
    "created_at": "2025-06-09T06:11:58Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/34391/events",
    "html_url": "https://github.com/neovim/neovim/issues/34391",
    "id": 3129265311,
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "floating windows, popups, hover",
            "id": 3234818716,
            "name": "floatwin",
            "node_id": "MDU6TGFiZWwzMjM0ODE4NzE2",
            "url": "https://api.github.com/repos/neovim/neovim/labels/floatwin"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/34391/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM66hMyf",
    "number": 34391,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/34391/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/34391/timeline",
    "title": "Floating windows do not maintain focus and have inconsistent events",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-06-09T13:16:29Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/34391",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/20738722?v=4",
        "events_url": "https://api.github.com/users/3dyuval/events{/privacy}",
        "followers_url": "https://api.github.com/users/3dyuval/followers",
        "following_url": "https://api.github.com/users/3dyuval/following{/other_user}",
        "gists_url": "https://api.github.com/users/3dyuval/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/3dyuval",
        "id": 20738722,
        "login": "3dyuval",
        "node_id": "MDQ6VXNlcjIwNzM4NzIy",
        "organizations_url": "https://api.github.com/users/3dyuval/orgs",
        "received_events_url": "https://api.github.com/users/3dyuval/received_events",
        "repos_url": "https://api.github.com/users/3dyuval/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/3dyuval/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/3dyuval/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/3dyuval",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Neovim version (nvim -v)\n\n0.7.0\n\n### Vim (not Nvim) behaves the same?\n\nno, vim 8.2.3412\n\n### Operating system/version\n\nWindows\n\n### Terminal name/version\n\nWindows Terminal v1.14\n\n### $TERM environment variable\n\nn/a\n\n### Installation\n\nwinget\n\n### How to reproduce the issue\n\nnvim --clean\r\n:q\n\n### Expected behavior\n\nThere's a lot more investigation over in https://github.com/microsoft/terminal/issues/13238, so go read that thread.\r\n\r\nIt seems that on exit, neovim writes a `FOCUS_EVENT` `INPUT_RECORD` to the console via `WriteConsoleInput`, before disabling VT input or FocusEvent mode. However, neovim doesn't drain the input queue at this point, so the input that ends up getting synthesized here (`\\x1b[O`) ends up arriving at the shell prompt (who was almost certainly not expecting it).\n\n### Actual behavior\n\nDepending on the shell, some variation on ^[[O is printed to the input.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I'd be curious to know if this is intentional or not. The Windows Terminal only added support for FocusEvent messages in the latest release (1.14). Before that, the focus event would have just done nothing. I'm pretty sure the focus event should have _always_ done nothing, so I'm surprised to be seeing this at all. ",
            "created_at": "2022-06-08T17:59:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/18899#issuecomment-1150224831",
            "id": 1150224831,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18899",
            "node_id": "IC_kwDOAPphoM5Ejwm_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1150224831/reactions"
            },
            "updated_at": "2022-06-08T17:59:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1150224831",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18356694?v=4",
                "events_url": "https://api.github.com/users/zadjii-msft/events{/privacy}",
                "followers_url": "https://api.github.com/users/zadjii-msft/followers",
                "following_url": "https://api.github.com/users/zadjii-msft/following{/other_user}",
                "gists_url": "https://api.github.com/users/zadjii-msft/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zadjii-msft",
                "id": 18356694,
                "login": "zadjii-msft",
                "node_id": "MDQ6VXNlcjE4MzU2Njk0",
                "organizations_url": "https://api.github.com/users/zadjii-msft/orgs",
                "received_events_url": "https://api.github.com/users/zadjii-msft/received_events",
                "repos_url": "https://api.github.com/users/zadjii-msft/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zadjii-msft/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zadjii-msft/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zadjii-msft",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "This is in `libuv`: https://github.com/libuv/libuv/blob/d54c92e3e68f0b8152617d8e97f704dd1e586bd6/src/win/tty.c#L1065-L1072\r\n\r\n```c\r\n  if (handle->flags & UV_HANDLE_TTY_RAW) {\r\n    /* Cancel raw read. Write some bullshit event to force the console wait to\r\n     * return. */\r\n    memset(&record, 0, sizeof record);\r\n    record.EventType = FOCUS_EVENT;\r\n    if (!WriteConsoleInputW(handle->handle, &record, 1, &written)) {\r\n      return GetLastError();\r\n    }\r\n```",
            "created_at": "2022-06-08T21:58:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/18899#issuecomment-1150456895",
            "id": 1150456895,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18899",
            "node_id": "IC_kwDOAPphoM5EkpQ_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1150456895/reactions"
            },
            "updated_at": "2022-06-08T21:58:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1150456895",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/189190?v=4",
                "events_url": "https://api.github.com/users/DHowett/events{/privacy}",
                "followers_url": "https://api.github.com/users/DHowett/followers",
                "following_url": "https://api.github.com/users/DHowett/following{/other_user}",
                "gists_url": "https://api.github.com/users/DHowett/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DHowett",
                "id": 189190,
                "login": "DHowett",
                "node_id": "MDQ6VXNlcjE4OTE5MA==",
                "organizations_url": "https://api.github.com/users/DHowett/orgs",
                "received_events_url": "https://api.github.com/users/DHowett/received_events",
                "repos_url": "https://api.github.com/users/DHowett/repos",
                "site_admin": true,
                "starred_url": "https://api.github.com/users/DHowett/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DHowett/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DHowett",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "So, we're implementing a workaround on the Windows/Console side to drop spurious¹ `FOCUS_EVENT` records from VT translation. However, I do personally think it would be right to pursue a fix for this in libuv regardless: they're injecting console input as a way to break out of their own read loop, which is... not exactly the most robust thing they could do. They're doing so using a reserved--documented, but reserved--message and are the only folks on record that we know of to do so.\r\n\r\n@justinmk At the end of the day, it's your discretion as to whether to keep this one open, as it is not strictly a neovim issue. :smile:\r\n\r\n¹ Client-originated.",
            "created_at": "2022-06-09T19:50:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/18899#issuecomment-1151555910",
            "id": 1151555910,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/18899",
            "node_id": "IC_kwDOAPphoM5Eo1lG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1151555910/reactions"
            },
            "updated_at": "2022-06-09T19:50:01Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1151555910",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/189190?v=4",
                "events_url": "https://api.github.com/users/DHowett/events{/privacy}",
                "followers_url": "https://api.github.com/users/DHowett/followers",
                "following_url": "https://api.github.com/users/DHowett/following{/other_user}",
                "gists_url": "https://api.github.com/users/DHowett/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DHowett",
                "id": 189190,
                "login": "DHowett",
                "node_id": "MDQ6VXNlcjE4OTE5MA==",
                "organizations_url": "https://api.github.com/users/DHowett/orgs",
                "received_events_url": "https://api.github.com/users/DHowett/received_events",
                "repos_url": "https://api.github.com/users/DHowett/repos",
                "site_admin": true,
                "starred_url": "https://api.github.com/users/DHowett/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DHowett/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DHowett",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/18899/comments",
    "created_at": "2022-06-08T17:36:20Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/18899/events",
    "html_url": "https://github.com/neovim/neovim/issues/18899",
    "id": 1265084232,
    "labels": [
        {
            "color": "FEF2C0",
            "default": false,
            "description": "Needs a third-party / external change or fix",
            "id": 101945532,
            "name": "status:blocked-external",
            "node_id": "MDU6TGFiZWwxMDE5NDU1MzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/status:blocked-external"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "",
            "id": 606691254,
            "name": "has:plan",
            "node_id": "MDU6TGFiZWw2MDY2OTEyNTQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:plan"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/18899/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 285,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 339,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2025-07-04T21:53:41Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM5LZ6dI",
    "number": 18899,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/18899/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/18899/timeline",
    "title": "Neovim erroneously sends a focus lost FOCUS_EVENT on shutdown",
    "type": {
        "color": "red",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "An unexpected problem or behavior",
        "id": 597163,
        "is_enabled": true,
        "name": "Bug",
        "node_id": "IT_kwDOAGK_Pc4ACRyr",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2025-07-02T08:37:19Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/18899",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/18356694?v=4",
        "events_url": "https://api.github.com/users/zadjii-msft/events{/privacy}",
        "followers_url": "https://api.github.com/users/zadjii-msft/followers",
        "following_url": "https://api.github.com/users/zadjii-msft/following{/other_user}",
        "gists_url": "https://api.github.com/users/zadjii-msft/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zadjii-msft",
        "id": 18356694,
        "login": "zadjii-msft",
        "node_id": "MDQ6VXNlcjE4MzU2Njk0",
        "organizations_url": "https://api.github.com/users/zadjii-msft/orgs",
        "received_events_url": "https://api.github.com/users/zadjii-msft/received_events",
        "repos_url": "https://api.github.com/users/zadjii-msft/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zadjii-msft/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zadjii-msft/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zadjii-msft",
        "user_view_type": "public"
    }
}
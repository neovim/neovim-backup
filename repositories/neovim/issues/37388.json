{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nMy first instinct when using this tool on my small laptop display is to find a\nfile i want to look at in the quickfix window, hit enter on it to diff it and close the qf\nwindow so I have more display real estate to view the diff windows vertically.  That use\npattern is not currently supported. What happens is:\n\nWhen closing the quickfix window opened by the plugin, the autocmds created by the plugin\nare deleted and an empty list is added to the quickfix history (`:h :chistory`). Despite\nthe original quickfix list generated still technically being available (via `:colder`),\nthis effectively ends the usefulness of that list because the `BufWinEnter` autocmd was\nwhat triggered the file diffing when navigating the list.  After that it just becomes an\nordinary quickfix list, i.e. `:cnext` just shows the file.\n\nThis is intentional.  However does it need to be?  Perhaps it is for the sake of cleanup?\n\nIf you drop the `WinClosed` autocmd that is on the quickfix window (it was calling the\n`cleanup_layout` function and also closing the left diff window) and remove all code\nreferencing `layout.qf_win` inside `cleanup_layout`, then that quickfix list remains functional\nwhen closing and reopening the qf window--at least until one of the diff windows is closed\n(which also does the cleanup).  Maybe there is a use case where this would cause a problem?\n\n### Expected behavior\n\nClosing the quickfix window has no effect on the functioning of the difftool.",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "You can put this in your after/ftplugin/qf.lua \n```lua\nlocal win = api.nvim_get_current_win()\nvim.schedule(function()\n  local group = api.nvim_create_augroup('nvim.difftool.events', { clear = false })\n  api.nvim_clear_autocmds({ group = group, pattern = tostring(win), event = 'WinClosed' })\nend)\n```\n**EDIT: still need patch.**\n```diff\ndiff --git a/runtime/pack/dist/opt/nvim.difftool/lua/difftool.lua b/runtime/pack/dist/opt/nvim.difftool/lua/difftool.lua\nindex b40517e4f1..1b469e265a 100644\n--- a/runtime/pack/dist/opt/nvim.difftool/lua/difftool.lua\n+++ b/runtime/pack/dist/opt/nvim.difftool/lua/difftool.lua\n@@ -497,7 +497,7 @@ function M.open(left, right, opt)\n \n       vim.w.lazyredraw = true\n       vim.schedule(function()\n-        diff_files(entry.user_data.left, entry.user_data.right, true)\n+        diff_files(entry.user_data.left, entry.user_data.right)\n         vim.w.lazyredraw = false\n       end)\n     end,\n```\n\n cc @deathbeam",
            "created_at": "2026-01-14T06:32:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/37388#issuecomment-3748013091",
            "id": 3748013091,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37388",
            "node_id": "IC_kwDOAPphoM7fZiQj",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3748013091/reactions"
            },
            "updated_at": "2026-01-14T06:50:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3748013091",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/154880267?v=4",
                "events_url": "https://api.github.com/users/nenahp/events{/privacy}",
                "followers_url": "https://api.github.com/users/nenahp/followers",
                "following_url": "https://api.github.com/users/nenahp/following{/other_user}",
                "gists_url": "https://api.github.com/users/nenahp/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nenahp",
                "id": 154880267,
                "login": "nenahp",
                "node_id": "U_kgDOCTtJCw",
                "organizations_url": "https://api.github.com/users/nenahp/orgs",
                "received_events_url": "https://api.github.com/users/nenahp/received_events",
                "repos_url": "https://api.github.com/users/nenahp/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nenahp/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nenahp/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nenahp",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@nenahp \n\n![Image](https://github.com/user-attachments/assets/a54497e7-b48a-4a7b-8746-ee9e375e8ad6)\n\nI'm joking of course :)",
            "created_at": "2026-01-14T07:02:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/37388#issuecomment-3748099954",
            "id": 3748099954,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37388",
            "node_id": "IC_kwDOAPphoM7fZ3dy",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 1,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3748099954/reactions"
            },
            "updated_at": "2026-01-14T07:02:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3748099954",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/77601554?v=4",
                "events_url": "https://api.github.com/users/stringTrimmer/events{/privacy}",
                "followers_url": "https://api.github.com/users/stringTrimmer/followers",
                "following_url": "https://api.github.com/users/stringTrimmer/following{/other_user}",
                "gists_url": "https://api.github.com/users/stringTrimmer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/stringTrimmer",
                "id": 77601554,
                "login": "stringTrimmer",
                "node_id": "MDQ6VXNlcjc3NjAxNTU0",
                "organizations_url": "https://api.github.com/users/stringTrimmer/orgs",
                "received_events_url": "https://api.github.com/users/stringTrimmer/received_events",
                "repos_url": "https://api.github.com/users/stringTrimmer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/stringTrimmer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/stringTrimmer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/stringTrimmer",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@deathbeam WDYT ?",
            "created_at": "2026-02-12T23:00:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/37388#issuecomment-3893870494",
            "id": 3893870494,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37388",
            "node_id": "IC_kwDOAPphoM7oF7-e",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3893870494/reactions"
            },
            "updated_at": "2026-02-12T23:00:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3893870494",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Yea its technically not required to cleanup after closing quickfix window (i mostly just did it for consistency, e.g any part of the difftool layout is closed so act like we want to leave the difftool mode) so I think this makes sense. But also the issue description mentions removing the cleanup of quickfix itself when its cleaned up by closing the left or right window which I dont think is right, closing left/right should still cleanup the quickfix imo even when closing quickfix itself do not cleans up the layout.\n\nEDIT: Hmm without the removal of quickfix cleanup code from cleanup_layout when jumping with quickfix closed the layout is recreated and quickfix cleaned so its not so simple change without getting rid of the quickfix cleanup itself completely",
            "created_at": "2026-02-12T23:18:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/37388#issuecomment-3893924462",
            "id": 3893924462,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37388",
            "node_id": "IC_kwDOAPphoM7oGJJu",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3893924462/reactions"
            },
            "updated_at": "2026-02-12T23:23:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3893924462",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5115805?v=4",
                "events_url": "https://api.github.com/users/deathbeam/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathbeam/followers",
                "following_url": "https://api.github.com/users/deathbeam/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathbeam/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathbeam",
                "id": 5115805,
                "login": "deathbeam",
                "node_id": "MDQ6VXNlcjUxMTU4MDU=",
                "organizations_url": "https://api.github.com/users/deathbeam/orgs",
                "received_events_url": "https://api.github.com/users/deathbeam/received_events",
                "repos_url": "https://api.github.com/users/deathbeam/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathbeam/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathbeam/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathbeam",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "As you found, I had to get rid of **all** the quickfix cleanup to get around that problem.\n\nIt's hard to know when the user is done with the tool.  Maybe you could introduce a sub-command to the user cmd, e.g.  `GitDiffTool clean` and let them decide when/if to use it?\n\n\n```diff\ndiff --git \"a/C:\\\\Program Files\\\\Neovim\\\\share\\\\nvim\\\\runtime\\\\pack\\\\dist\\\\opt\\\\nvim.difftool\\\\lua\\\\difftool.lua\" \"b/.\\\\difftool.lua\"\nindex b40517e..9e8e973 100644\n--- \"a/C:\\\\Program Files\\\\Neovim\\\\share\\\\nvim\\\\runtime\\\\pack\\\\dist\\\\opt\\\\nvim.difftool\\\\lua\\\\difftool.lua\"\t\n+++ \"b/.\\\\difftool.lua\"\n@@ -28,7 +28,6 @@ local layout = {\n   group = nil,\n   left_win = nil,\n   right_win = nil,\n-  qf_win = nil,\n }\n \n local util = require('vim._core.util')\n@@ -42,7 +41,6 @@ local function cleanup_layout(with_qf)\n   end\n   layout.left_win = nil\n   layout.right_win = nil\n-  layout.qf_win = nil\n \n   if with_qf then\n     vim.fn.setqflist({})\n@@ -55,9 +53,8 @@ end\n local function setup_layout(with_qf)\n   local left_valid = layout.left_win and vim.api.nvim_win_is_valid(layout.left_win)\n   local right_valid = layout.right_win and vim.api.nvim_win_is_valid(layout.right_win)\n-  local qf_valid = layout.qf_win and vim.api.nvim_win_is_valid(layout.qf_win)\n \n-  if left_valid and right_valid and (not with_qf or qf_valid) then\n+  if left_valid and right_valid then\n     return false\n   end\n \n@@ -68,9 +65,6 @@ local function setup_layout(with_qf)\n \n   if with_qf then\n     vim.cmd('botright copen')\n-    layout.qf_win = vim.api.nvim_get_current_win()\n-  else\n-    layout.qf_win = nil\n   end\n   vim.api.nvim_set_current_win(layout.right_win)\n \n@@ -89,20 +83,6 @@ local function setup_layout(with_qf)\n       cleanup_layout(with_qf)\n     end,\n   })\n-  if with_qf then\n-    vim.api.nvim_create_autocmd('WinClosed', {\n-      group = layout.group,\n-      pattern = tostring(layout.qf_win),\n-      callback = function()\n-        -- For quickfix also close one of diff windows\n-        if layout.left_win and vim.api.nvim_win_is_valid(layout.left_win) then\n-          vim.api.nvim_win_close(layout.left_win, true)\n-        end\n-\n-        cleanup_layout(with_qf)\n-      end,\n-    })\n-  end\n end\n```",
            "created_at": "2026-02-12T23:47:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/37388#issuecomment-3894009366",
            "id": 3894009366,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37388",
            "node_id": "IC_kwDOAPphoM7oGd4W",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3894009366/reactions"
            },
            "updated_at": "2026-02-12T23:47:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3894009366",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/77601554?v=4",
                "events_url": "https://api.github.com/users/stringTrimmer/events{/privacy}",
                "followers_url": "https://api.github.com/users/stringTrimmer/followers",
                "following_url": "https://api.github.com/users/stringTrimmer/following{/other_user}",
                "gists_url": "https://api.github.com/users/stringTrimmer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/stringTrimmer",
                "id": 77601554,
                "login": "stringTrimmer",
                "node_id": "MDQ6VXNlcjc3NjAxNTU0",
                "organizations_url": "https://api.github.com/users/stringTrimmer/orgs",
                "received_events_url": "https://api.github.com/users/stringTrimmer/received_events",
                "repos_url": "https://api.github.com/users/stringTrimmer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/stringTrimmer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/stringTrimmer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/stringTrimmer",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> It's hard to know when the user is done with the tool. Maybe you could introduce a sub-command to the user cmd, e.g. `GitDiffTool clean` and let them decide when/if to use it?\n\nClosing part of the UI (the split windows) is quite an obvious signal (fugitive and diff-mode work similarly). There is no reason to do that if you are still using the tool. Open a new tabpage if you need to open/close other windows.",
            "created_at": "2026-02-13T00:01:01Z",
            "html_url": "https://github.com/neovim/neovim/issues/37388#issuecomment-3894049044",
            "id": 3894049044,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/37388",
            "node_id": "IC_kwDOAPphoM7oGnkU",
            "performed_via_github_app": null,
            "pin": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3894049044/reactions"
            },
            "updated_at": "2026-02-13T00:01:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/3894049044",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/37388/comments",
    "created_at": "2026-01-14T05:15:26Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/37388/events",
    "html_url": "https://github.com/neovim/neovim/issues/37388",
    "id": 3811608108,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 117905553,
            "name": "plugin",
            "node_id": "MDU6TGFiZWwxMTc5MDU1NTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/plugin"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, self-contained. Do NOT ask \"can I work on this\", just read CONTRIBUTING.md",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 3010934759,
            "name": "diff",
            "node_id": "MDU6TGFiZWwzMDEwOTM0NzU5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/diff"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/37388/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 777,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "Low priority items. We plan to work on this but don't have a target date.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 639,
        "state": "open",
        "title": "backlog",
        "updated_at": "2026-02-16T22:39:01Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM7jMIYs",
    "number": 37388,
    "performed_via_github_app": null,
    "pinned_comment": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/37388/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/37388/timeline",
    "title": "difftool: closing the quickfix window resets the current quickfix list",
    "type": {
        "color": "blue",
        "created_at": "2024-01-25T10:10:19Z",
        "description": "A request, idea, or new functionality",
        "id": 597167,
        "is_enabled": true,
        "name": "Enhancement",
        "node_id": "IT_kwDOAGK_Pc4ACRyv",
        "updated_at": "2024-07-26T10:12:30Z"
    },
    "updated_at": "2026-02-13T00:01:15Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/37388",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/77601554?v=4",
        "events_url": "https://api.github.com/users/stringTrimmer/events{/privacy}",
        "followers_url": "https://api.github.com/users/stringTrimmer/followers",
        "following_url": "https://api.github.com/users/stringTrimmer/following{/other_user}",
        "gists_url": "https://api.github.com/users/stringTrimmer/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/stringTrimmer",
        "id": 77601554,
        "login": "stringTrimmer",
        "node_id": "MDQ6VXNlcjc3NjAxNTU0",
        "organizations_url": "https://api.github.com/users/stringTrimmer/orgs",
        "received_events_url": "https://api.github.com/users/stringTrimmer/received_events",
        "repos_url": "https://api.github.com/users/stringTrimmer/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/stringTrimmer/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/stringTrimmer/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/stringTrimmer",
        "user_view_type": "public"
    }
}
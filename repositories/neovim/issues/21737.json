{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Describe the bug\n\nheap-use-after-free in garbage collection with EXITFREE\r\n```\r\n=================================================================\r\n==653241==ERROR: AddressSanitizer: heap-use-after-free on address 0x61d000a9c9ac at pc 0x55953f8e3a78 bp 0x7ffe13ce0550 sp 0x7ffe13ce0548\r\nREAD of size 4 at 0x61d000a9c9ac thread T0\r\n    #0 0x55953f8e3a77 in tv_list_len **/src/nvim/eval/typval.h:181:13\r\n    #1 0x55953f91baff in _typval_encode_nothing_convert_one_value **/src/nvim/eval/typval_encode.c.h:365:36\r\n    #2 0x55953f907b1e in encode_vim_to_nothing **/src/nvim/eval/typval_encode.c.h:661:7\r\n    #3 0x55953f8dc3cd in tv_clear **/src/nvim/eval/typval.c:3217:25\r\n    #4 0x55953f975ea1 in vars_clear_ext **/src/nvim/eval/vars.c:1152:9\r\n    #5 0x55953f975a99 in vars_clear **/src/nvim/eval/vars.c:1131:3\r\n    #6 0x55953f962fe3 in free_funccal_contents **/src/nvim/eval/userfunc.c:648:3\r\n    #7 0x55953f9629ed in free_unref_funccal **/src/nvim/eval/userfunc.c:3395:7\r\n    #8 0x55953f714d67 in garbage_collect **/src/nvim/eval.c:4278:16\r\n    #9 0x55953f71083c in eval_clear **/src/nvim/eval.c:514:9\r\n    #10 0x55953ff4882f in free_all_mem **/src/nvim/memory.c:803:3\r\n    #11 0x55953f1fbc2e in os_exit **/src/nvim/main.c:659:3\r\n    #12 0x55953f1fa0d6 in getout **/src/nvim/main.c:784:3\r\n    #13 0x55953fa7de60 in ex_quit **/src/nvim/ex_docmd.c:4541:7\r\n    #14 0x55953fa4b22f in execute_cmd0 **/src/nvim/ex_docmd.c:1621:7\r\n    #15 0x55953fa2758a in do_one_cmd **/src/nvim/ex_docmd.c:2280:7\r\n    #16 0x55953fa17e6e in do_cmdline **/src/nvim/ex_docmd.c:579:20\r\n    #17 0x55953fa1cf80 in do_cmdline_cmd **/src/nvim/ex_docmd.c:282:10\r\n    #18 0x55954008d4cb in nv_Zet **/src/nvim/normal.c:3313:7\r\n    #19 0x55954006d495 in normal_execute **/src/nvim/normal.c:1181:3\r\n    #20 0x55954067f5a7 in state_enter **/src/nvim/state.c:99:26\r\n    #21 0x559540050d70 in normal_enter **/src/nvim/normal.c:478:3\r\n    #22 0x55953f1e79ab in main **/src/nvim/main.c:628:3\r\n    #23 0x7ff2317fd28f  (/usr/lib/libc.so.6+0x2328f) (BuildId: 1e94beb079e278ac4f2c8bce1f53091548ea1584)\r\n    #24 0x7ff2317fd349 in __libc_start_main (/usr/lib/libc.so.6+0x23349) (BuildId: 1e94beb079e278ac4f2c8bce1f53091548ea1584)\r\n    #25 0x55953f0ead64 in _start /build/glibc/src/glibc/csu/../sysdeps/x86_64/start.S:115\r\n\r\n0x61d000a9c9ac is located 1324 bytes inside of 2056-byte region [0x61d000a9c480,0x61d000a9cc88)\r\nfreed by thread T0 here:\r\n    #0 0x55953f19ec22 in __interceptor_free.part.0 asan_malloc_linux.cpp.o\r\n    #1 0x55953ff449b4 in xfree **/src/nvim/memory.c:137:3\r\n    #2 0x55953f967c1e in free_funccal **/src/nvim/eval/userfunc.c:636:3\r\n    #3 0x55953f9631ae in free_funccal_contents **/src/nvim/eval/userfunc.c:655:3\r\n    #4 0x55953f9629ed in free_unref_funccal **/src/nvim/eval/userfunc.c:3395:7\r\n    #5 0x55953f714d67 in garbage_collect **/src/nvim/eval.c:4278:16\r\n    #6 0x55953f71083c in eval_clear **/src/nvim/eval.c:514:9\r\n    #7 0x55953ff4882f in free_all_mem **/src/nvim/memory.c:803:3\r\n    #8 0x55953f1fbc2e in os_exit **/src/nvim/main.c:659:3\r\n    #9 0x55953f1fa0d6 in getout **/src/nvim/main.c:784:3\r\n    #10 0x55953fa7de60 in ex_quit **/src/nvim/ex_docmd.c:4541:7\r\n    #11 0x55953fa4b22f in execute_cmd0 **/src/nvim/ex_docmd.c:1621:7\r\n    #12 0x55953fa2758a in do_one_cmd **/src/nvim/ex_docmd.c:2280:7\r\n    #13 0x55953fa17e6e in do_cmdline **/src/nvim/ex_docmd.c:579:20\r\n    #14 0x55953fa1cf80 in do_cmdline_cmd **/src/nvim/ex_docmd.c:282:10\r\n    #15 0x55954008d4cb in nv_Zet **/src/nvim/normal.c:3313:7\r\n    #16 0x55954006d495 in normal_execute **/src/nvim/normal.c:1181:3\r\n    #17 0x55954067f5a7 in state_enter **/src/nvim/state.c:99:26\r\n    #18 0x559540050d70 in normal_enter **/src/nvim/normal.c:478:3\r\n    #19 0x55953f1e79ab in main **/src/nvim/main.c:628:3\r\n    #20 0x7ff2317fd28f  (/usr/lib/libc.so.6+0x2328f) (BuildId: 1e94beb079e278ac4f2c8bce1f53091548ea1584)\r\n\r\npreviously allocated by thread T0 here:\r\n    #0 0x55953f19ff91 in __interceptor_calloc (**/build/bin/nvim+0xcf1f91) (BuildId: ea0be20ab6084f8dc184fbe5a453f898d4ca58de)\r\n    #1 0x55953ff44a56 in xcalloc **/src/nvim/memory.c:151:15\r\n    #2 0x55953f92d0e7 in call_user_func **/src/nvim/eval/userfunc.c:876:8\r\n    #3 0x55953f93de02 in call_user_func_check **/src/nvim/eval/userfunc.c:1254:5\r\n    #4 0x55953f92bdd1 in call_func **/src/nvim/eval/userfunc.c:1612:17\r\n    #5 0x55953f93b879 in func_call **/src/nvim/eval/userfunc.c:1406:7\r\n    #6 0x55953f83ae18 in f_call **/src/nvim/eval/funcs.c:582:3\r\n    #7 0x55953f82412a in call_internal_func **/src/nvim/eval/funcs.c:242:3\r\n    #8 0x55953f92c21d in call_func **/src/nvim/eval/userfunc.c:1621:15\r\n    #9 0x55953f929345 in get_func_tv **/src/nvim/eval/userfunc.c:494:11\r\n    #10 0x55953f79b943 in eval_func **/src/nvim/eval.c:2229:13\r\n    #11 0x55953f7924dc in eval7 **/src/nvim/eval.c:3103:15\r\n    #12 0x55953f78dc0b in eval6 **/src/nvim/eval.c:2768:7\r\n    #13 0x55953f78b322 in eval5 **/src/nvim/eval.c:2603:7\r\n    #14 0x55953f789d60 in eval4 **/src/nvim/eval.c:2505:7\r\n    #15 0x55953f789282 in eval3 **/src/nvim/eval.c:2436:7\r\n    #16 0x55953f739782 in eval2 **/src/nvim/eval.c:2379:7\r\n    #17 0x55953f7296b4 in eval1 **/src/nvim/eval.c:2317:7\r\n    #18 0x55953f928ce3 in get_func_tv **/src/nvim/eval/userfunc.c:465:9\r\n    #19 0x55953f79b943 in eval_func **/src/nvim/eval.c:2229:13\r\n    #20 0x55953f7924dc in eval7 **/src/nvim/eval.c:3103:15\r\n    #21 0x55953f78dc0b in eval6 **/src/nvim/eval.c:2768:7\r\n    #22 0x55953f78b322 in eval5 **/src/nvim/eval.c:2603:7\r\n    #23 0x55953f789d60 in eval4 **/src/nvim/eval.c:2505:7\r\n    #24 0x55953f789282 in eval3 **/src/nvim/eval.c:2436:7\r\n    #25 0x55953f739782 in eval2 **/src/nvim/eval.c:2379:7\r\n    #26 0x55953f7296b4 in eval1 **/src/nvim/eval.c:2317:7\r\n    #27 0x55953f72722d in eval0 **/src/nvim/eval.c:2272:9\r\n    #28 0x55953f95c248 in ex_return **/src/nvim/eval/userfunc.c:2968:10\r\n    #29 0x55953fa4b22f in execute_cmd0 **/src/nvim/ex_docmd.c:1621:7\r\n\r\nSUMMARY: AddressSanitizer: heap-use-after-free **/src/nvim/eval/typval.h:181:13 in tv_list_len\r\nShadow bytes around the buggy address:\r\n  0x0c3a8014b8e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b8f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b900: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b910: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b920: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n=>0x0c3a8014b930: fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b940: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b950: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b960: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b970: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c3a8014b980: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07 \r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==653241==ABORTING\r\n\r\n```\n\n### Steps to reproduce\n\nNot available\n\n### Expected behavior\n\nNo heap-use-after-free\n\n### Neovim version (nvim -v)\n\nv0.9.0-dev-655+g08d5b4275\n\n### Vim (not Nvim) behaves the same?\n\nUnable to verify\n\n### Operating system/version\n\nArch Linux\n\n### Terminal name/version\n\nkitty 0.26.5\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nbuild from repo",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/21737/comments",
    "created_at": "2023-01-10T23:41:11Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/21737/events",
    "html_url": "https://github.com/neovim/neovim/issues/21737",
    "id": 1528159563,
    "labels": [
        {
            "color": "c7def8",
            "default": false,
            "description": "",
            "id": 109899557,
            "name": "vimscript",
            "node_id": "MDU6TGFiZWwxMDk4OTk1NTc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/vimscript"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "We need minimal steps to reproduce the issue",
            "id": 298863445,
            "name": "needs:repro",
            "node_id": "MDU6TGFiZWwyOTg4NjM0NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:repro"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/21737/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5bFd1L",
    "number": 21737,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/21737/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/21737/timeline",
    "title": "heap-use-after-free in garbage collection with EXITFREE",
    "updated_at": "2025-01-19T11:43:58Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/21737",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq",
        "user_view_type": "public"
    }
}
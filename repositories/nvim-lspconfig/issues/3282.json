{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\r\n\r\nI have configured both `solargraph` and `sorbet` for Ruby files,\r\nso when I call `vim.lsp.buf.hover()` on a name (currently mapped to `<F9>`) I have an unexpected behavior that really looks like a bug.\r\n\r\nIt seems like it happens when both LSPs provide hover for that name, otherwise it works fine.\r\nI'm not sure if this happens with other LSPs.\r\n\r\n## Issue details \r\n\r\n### Expected behavior\r\n\r\n- Show hover/floating window for the name under cursor\r\n- If more than one LSP implements `hover`, either\r\n  + show both at same time, on a single floating window\r\n  + show one at each time, allowing to use a mapping to cycle between them (e.g. `[1/2]`)\r\n  + show one at each time, cycling automatically on first, second, and subsequent calls\r\n  + show one at each time, asking from a menu\r\n\r\n### Actual behavior\r\n\r\n- When there is a single `hover` for the name\r\n  + show that in a floating window as expected\r\n  + does not jump to floating window\r\n- When there is more than one `hover` for that name\r\n  + randomly shows the hover from one of the LSPs\r\n  + immediately jumps to the floating window\r\n\r\nThe major issue is that it immediately jumps to the floating window, interrupting workflow.\r\n\r\nI hope there is a way to fix this using some custom configuration, but I didn't find a way so far.\r\n\r\n### My current configuration\r\n\r\nhttps://github.com/paulodiovani/dotfiles/blob/aed80ef/home/user/.config/nvim/lua/completion.lua\r\n\r\n### Steps to reproduce\r\n\r\n1. Setup both `solargraph` and `sorbet` with `nvim-lspconfig`, optinally using `Mason`.\r\n\r\noutput of `:LspInfo`\r\n```\r\n Client: sorbet (id: 2, bufnr: [4])\r\n \tfiletypes:       ruby\r\n \tautostart:       true\r\n \troot directory:  /Users/diovani/Development/Ruby/sorbet-lsp-test\r\n \tcmd:             /Users/diovani/.local/share/nvim/mason/bin/srb tc --lsp --disable-watchman /Users/diovani/Development/Ruby/sorbet-lsp-test\r\n \r\n Client: solargraph (id: 3, bufnr: [4])\r\n \tfiletypes:       ruby\r\n \tautostart:       true\r\n \troot directory:  /Users/diovani/Development/Ruby/sorbet-lsp-test\r\n \tcmd:             /Users/diovani/.local/share/nvim/mason/bin/solargraph stdio\r\n```\r\n\r\n2. Make sure to create a mapping.\r\n\r\ne.g.\r\n```lua\r\nlocal bufopts = { noremap = true }\r\nvim.keymap.set({ 'n', 'i' }, '<F9>', vim.lsp.buf.hover, bufopts)\r\n```\r\n\r\n3. Create a ruby application and include `sorbet`\r\n\r\n`Gemfile`\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nsource \"https://rubygems.org\"\r\n\r\ngem \"sorbet-runtime\", \"~> 0.5.11537\"\r\n```\r\n\r\n`main.rb`\r\n```ruby\r\n# typed: true\r\n# frozen_string_literal: true\r\n\r\nrequire 'sorbet-runtime'\r\n\r\n# sample class\r\nclass SampleClass\r\n  extend T::Sig\r\n\r\n  sig { params(greet: String, who: String).void }\r\n  def some_method(greet, who)\r\n    puts \"#{greet} #{who}\"\r\n  end\r\nend\r\n\r\nSampleClass.new.some_method('Hello', 'world')\r\n```\r\n\r\n4. Install and generate YARD index\r\n\r\n```ruby\r\nbundle install\r\nyard gems\r\n```\r\n\r\nOpen the file and try `hover` (`<F9>`) on some variables, method names or arguments.",
    "closed_at": "2024-08-23T20:54:18Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "You probably want to disable the hover capability of one of those servers, eg.:\r\n```lua\r\nlspconfig.sorbet.setup({\r\n  on_attach = function(client)\r\n    client.server_capabilities.hoverProvider = false\r\n  end,\r\n})\r\n```",
            "created_at": "2024-08-23T19:29:11Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3282#issuecomment-2307691636",
            "id": 2307691636,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282",
            "node_id": "IC_kwDODTQC186JjJR0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307691636/reactions"
            },
            "updated_at": "2024-08-23T19:29:11Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307691636",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3533182?v=4",
                "events_url": "https://api.github.com/users/polyzen/events{/privacy}",
                "followers_url": "https://api.github.com/users/polyzen/followers",
                "following_url": "https://api.github.com/users/polyzen/following{/other_user}",
                "gists_url": "https://api.github.com/users/polyzen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/polyzen",
                "id": 3533182,
                "login": "polyzen",
                "node_id": "MDQ6VXNlcjM1MzMxODI=",
                "organizations_url": "https://api.github.com/users/polyzen/orgs",
                "received_events_url": "https://api.github.com/users/polyzen/received_events",
                "repos_url": "https://api.github.com/users/polyzen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/polyzen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/polyzen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/polyzen"
            }
        },
        {
            "author_association": "NONE",
            "body": "> You probably want to disable the hover capability of one of those servers, eg.:\r\n> \r\n> ```lua\r\n> lspconfig.sorbet.setup({\r\n>   on_attach = function(client)\r\n>     client.server_capabilities.hoverProvider = false\r\n>   end,\r\n> })\r\n> ```\r\n\r\nThat solves the main issue. But the ideal would be to still have both.\r\nI'm doing some tests with `lewis6991/hover.nvim`.",
            "created_at": "2024-08-23T19:57:29Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3282#issuecomment-2307728119",
            "id": 2307728119,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282",
            "node_id": "IC_kwDODTQC186JjSL3",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307728119/reactions"
            },
            "updated_at": "2024-08-23T19:57:29Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307728119",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1295197?v=4",
                "events_url": "https://api.github.com/users/paulodiovani/events{/privacy}",
                "followers_url": "https://api.github.com/users/paulodiovani/followers",
                "following_url": "https://api.github.com/users/paulodiovani/following{/other_user}",
                "gists_url": "https://api.github.com/users/paulodiovani/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/paulodiovani",
                "id": 1295197,
                "login": "paulodiovani",
                "node_id": "MDQ6VXNlcjEyOTUxOTc=",
                "organizations_url": "https://api.github.com/users/paulodiovani/orgs",
                "received_events_url": "https://api.github.com/users/paulodiovani/received_events",
                "repos_url": "https://api.github.com/users/paulodiovani/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/paulodiovani/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/paulodiovani/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/paulodiovani"
            }
        },
        {
            "author_association": "NONE",
            "body": "This is probably a duplication of https://github.com/neovim/neovim/issues/16363 and might be resolved on `neovim` source code.",
            "created_at": "2024-08-23T19:57:59Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3282#issuecomment-2307728754",
            "id": 2307728754,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282",
            "node_id": "IC_kwDODTQC186JjSVy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307728754/reactions"
            },
            "updated_at": "2024-08-23T19:57:59Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307728754",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1295197?v=4",
                "events_url": "https://api.github.com/users/paulodiovani/events{/privacy}",
                "followers_url": "https://api.github.com/users/paulodiovani/followers",
                "following_url": "https://api.github.com/users/paulodiovani/following{/other_user}",
                "gists_url": "https://api.github.com/users/paulodiovani/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/paulodiovani",
                "id": 1295197,
                "login": "paulodiovani",
                "node_id": "MDQ6VXNlcjEyOTUxOTc=",
                "organizations_url": "https://api.github.com/users/paulodiovani/orgs",
                "received_events_url": "https://api.github.com/users/paulodiovani/received_events",
                "repos_url": "https://api.github.com/users/paulodiovani/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/paulodiovani/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/paulodiovani/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/paulodiovani"
            }
        },
        {
            "author_association": "NONE",
            "body": "I managed to make it work the way I wanted by using lewis6991/hover.nvim as follows:\r\n\r\n```lua\r\nlocal util = vim.lsp.util\r\nlocal get_clients = vim.lsp.get_clients or vim.lsp.get_active_clients\r\n\r\nlocal LSPServerHover = function(server_name)\r\n  return {\r\n    name = string.format('LSP[%s]', server_name),\r\n    priority = 1002, -- above diagnostics\r\n\r\n    enabled = function(bufnr)\r\n      return #get_clients({ bufnr = bufnr, name = server_name, method = 'textDocument/hover' }) > 0\r\n    end,\r\n\r\n    execute = function(opts, done)\r\n      local params = util.make_position_params()\r\n      local client = get_clients({ bufnr = opts.bufnr, name = server_name, method = 'textDocument/hover' })[1]\r\n\r\n      client.request('textDocument/hover', params, function(err, result)\r\n        if result and result.contents and result.contents.value then\r\n          local value = result.contents.value\r\n          done({ lines = vim.split(value, '\\n', true), filetype = 'markdown' })\r\n        else\r\n          print(err)\r\n          done()\r\n        end\r\n      end)\r\n    end,\r\n  }\r\nend\r\n```\r\n\r\n```lua\r\n-- USAGE:\r\n-- when configuring LSP Servers\r\n    on_attach = function(_, bufnr)\r\n      hover.register(LSPServerHover(server_name))\r\n      vim.keymap.set({ 'n', 'i' }, '<F9>', hover.hover)\r\n    end,\r\n```\r\n\r\nhttps://github.com/paulodiovani/dotfiles/blob/4eb17e19b113b32f3fd6da2c7357d26958056edb/home/user/.config/nvim/lua/completion.lua#L5-L29\r\n\r\nThe trick was to create and register a new provider on server attach, to be able to split the results while keeping a reference to the name.\r\n\r\nScreenshots:\r\n![image](https://github.com/user-attachments/assets/fb26239f-e490-4a87-9643-614dd5714f58)\r\n\r\n![image](https://github.com/user-attachments/assets/2cd01296-e1f4-431b-bd77-5d04b8527e15)\r\n",
            "created_at": "2024-08-23T20:44:55Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3282#issuecomment-2307786225",
            "id": 2307786225,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282",
            "node_id": "IC_kwDODTQC186JjgXx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307786225/reactions"
            },
            "updated_at": "2024-08-23T20:44:55Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307786225",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1295197?v=4",
                "events_url": "https://api.github.com/users/paulodiovani/events{/privacy}",
                "followers_url": "https://api.github.com/users/paulodiovani/followers",
                "following_url": "https://api.github.com/users/paulodiovani/following{/other_user}",
                "gists_url": "https://api.github.com/users/paulodiovani/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/paulodiovani",
                "id": 1295197,
                "login": "paulodiovani",
                "node_id": "MDQ6VXNlcjEyOTUxOTc=",
                "organizations_url": "https://api.github.com/users/paulodiovani/orgs",
                "received_events_url": "https://api.github.com/users/paulodiovani/received_events",
                "repos_url": "https://api.github.com/users/paulodiovani/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/paulodiovani/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/paulodiovani/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/paulodiovani"
            }
        },
        {
            "author_association": "NONE",
            "body": "I'm closing this ticket, since the issue actually happens on `neovim`, on the `lsp.hover` implementation (issue linked above).\r\n\r\nFor whoever faces the same issue and don't want to disable one of the servers, my solution above might be an option.",
            "created_at": "2024-08-23T20:54:18Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3282#issuecomment-2307797390",
            "id": 2307797390,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282",
            "node_id": "IC_kwDODTQC186JjjGO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307797390/reactions"
            },
            "updated_at": "2024-08-23T20:54:18Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2307797390",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1295197?v=4",
                "events_url": "https://api.github.com/users/paulodiovani/events{/privacy}",
                "followers_url": "https://api.github.com/users/paulodiovani/followers",
                "following_url": "https://api.github.com/users/paulodiovani/following{/other_user}",
                "gists_url": "https://api.github.com/users/paulodiovani/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/paulodiovani",
                "id": 1295197,
                "login": "paulodiovani",
                "node_id": "MDQ6VXNlcjEyOTUxOTc=",
                "organizations_url": "https://api.github.com/users/paulodiovani/orgs",
                "received_events_url": "https://api.github.com/users/paulodiovani/received_events",
                "repos_url": "https://api.github.com/users/paulodiovani/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/paulodiovani/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/paulodiovani/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/paulodiovani"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282/comments",
    "created_at": "2024-08-23T17:40:55Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3282",
    "id": 2483591667,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC186UCJnz",
    "number": 3282,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282/timeline",
    "title": "vim.lsp.buf.hover() immediately jumps to floating window when 2 LSPs are active",
    "updated_at": "2024-08-23T20:54:18Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3282",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1295197?v=4",
        "events_url": "https://api.github.com/users/paulodiovani/events{/privacy}",
        "followers_url": "https://api.github.com/users/paulodiovani/followers",
        "following_url": "https://api.github.com/users/paulodiovani/following{/other_user}",
        "gists_url": "https://api.github.com/users/paulodiovani/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/paulodiovani",
        "id": 1295197,
        "login": "paulodiovani",
        "node_id": "MDQ6VXNlcjEyOTUxOTc=",
        "organizations_url": "https://api.github.com/users/paulodiovani/orgs",
        "received_events_url": "https://api.github.com/users/paulodiovani/received_events",
        "repos_url": "https://api.github.com/users/paulodiovani/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/paulodiovani/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/paulodiovani/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/paulodiovani"
    }
}
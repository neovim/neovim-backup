{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\n\nAfter changing the import to fly from\n`require(\"lspconfig\").volar.setup({})` to `vim.lsp.enable(\"volar\")`\nI get the following error both using `vtsls` and using `ts_ls`:\n\n```\nError executing vim.schedule lua callback: ...im.aPBmfPd/usr/share/nvim/runtime/lua/vim/lsp/client.lua:548: RPC[Error] code_name = InternalError, message = \"Request initialize failed with message: Can't find typ\nescript.js or tsserverlibrary.js in \\\"/home/<name>/Site/vue-test/node_modules/typescript/lib\\\"\"                                                                                                            \nstack traceback:                                                                                                                                                                                                   \n        [C]: in function 'assert'                                                                                                                                                                                  \n        ...im.aPBmfPd/usr/share/nvim/runtime/lua/vim/lsp/client.lua:548: in function ''                                                                                                                            \n        vim/_editor.lua: in function <vim/_editor.lua:0>\n```\nAfter seeing the error when opening the fisrt file everything works correctly (`go-to-definition`, `reference`, `import component`).\n\nInside the folder `after/lsp` vtsls this content returns:\n\n```\nreturn {\n    filetypes = { \"typescript\", \"javascript\", \"vue\" },\n    settings = {\n        javascript = {\n            preferences = {\n                -- importModuleSpecifier = \"non-relative\",\n            },\n            inlayHints = {\n                functionLikeReturnTypes = { enabled = true },\n                parameterNames = { enabled = \"all\" },\n                variableTypes = { enabled = true },\n            },\n        },\n        typescript = {\n            preferences = {\n                -- importModuleSpecifier = \"non-relative\",\n            },\n        },\n        vtsls = {\n            autoUseWorkspaceTsdk = true,\n            experimental = {\n                -- Inlay hint truncation.\n                maxInlayHintLength = 30,\n                -- For completion performance.\n                completion = {\n                    enableServerSideFuzzyMatch = true,\n                },\n            },\n            tsserver = {\n                globalPlugins = {\n                    {\n                        name = \"@vue/typescript-plugin\",\n                        -- location = volar_path,\n                        location = require(\"mason-registry\").get_package(\"vue-language-server\"):get_install_path()\n                            .. \"/node_modules/@vue/language-server\",\n                        languages = { \"vue\" },\n                        configNamespace = \"typescript\",\n                        enableForWorkspaceTypeScriptVersions = true,\n                    },\n                },\n            },\n        },\n    },\n}\n```\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "edit:\n\nAs per doc `volar` in this case only handles `html` and `css`, so it is normal that the `js/ts` part works.\n\nOn `nuxt` everything works ok because typescript is installed in the default project, and is therefore in `node-modules`.\n\nThe error occurs when typescript is not installed in the project. An installation of `vue.js` without `typescript` therefore now generates an error.\n\nThis condition was solved in the previous configuration I guess using the typescript package installed with `mason` or `globally` if the package is not found in `node-module`.\n\nAn installation made with `vite` of `vue javascript` does not install typescript.",
            "created_at": "2025-04-17T18:09:57Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3742#issuecomment-2813698499",
            "id": 2813698499,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742",
            "node_id": "IC_kwDODTQC186ntaHD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2813698499/reactions"
            },
            "updated_at": "2025-04-17T19:15:53Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2813698499",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/46299700?v=4",
                "events_url": "https://api.github.com/users/albnavarro/events{/privacy}",
                "followers_url": "https://api.github.com/users/albnavarro/followers",
                "following_url": "https://api.github.com/users/albnavarro/following{/other_user}",
                "gists_url": "https://api.github.com/users/albnavarro/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/albnavarro",
                "id": 46299700,
                "login": "albnavarro",
                "node_id": "MDQ6VXNlcjQ2Mjk5NzAw",
                "organizations_url": "https://api.github.com/users/albnavarro/orgs",
                "received_events_url": "https://api.github.com/users/albnavarro/received_events",
                "repos_url": "https://api.github.com/users/albnavarro/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/albnavarro/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/albnavarro/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/albnavarro",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The error occurs when typescript is not installed in the project. An installation of `vue.js` without `typescript` therefore now generates an error.\n\nWhat do you expect from nvim-lspconfig to resolve this?\n\nAre the docs not clear enough? I noticied that a lot of the ts-related configs have these big complex docs: https://github.com/neovim/nvim-lspconfig/blob/943a0556638fb809d3f72f1f091454bd56b23021/lsp/volar.lua#L41-L49",
            "created_at": "2025-04-30T13:23:40Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3742#issuecomment-2841960761",
            "id": 2841960761,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742",
            "node_id": "IC_kwDODTQC186pZOE5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2841960761/reactions"
            },
            "updated_at": "2025-04-30T13:23:40Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2841960761",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Sorry, you're right, I just wanted to point out the differences between the old `require(\"lspconfig\")` and the new `vim.lsp.enable`.\nI personally have already solved the problem but my solution is quite personal and I don't think it's possible to abstract it on this repository.\nI opened this issue because maybe it could be useful to understand what changed from the old to the new config.\n\nFor those who may encounter this problem I can expose my solution (maybe something better can be done).\n( For convenience I use small utilities that are equivalent to the Higher Order Functions of javascript, in this case map and filter)\n\n\n```\nlocal U = require(\"utils/tables_utils\")\n\n-- local typescript\nlocal function get_local_typescript_server_path(root_dir)\n    local project_root = vim.fs.dirname(vim.fs.find(\"node_modules\", { path = root_dir, upward = true })[1])\n    return project_root and vim.fs.joinpath(project_root, \"node_modules\", \"typescript\", \"lib\") or \"\"\nend\n\n-- typescript lib in order of priority\nlocal pathsTable = {\n    {\n        package = \"vtsls\",\n        path = \"/node_modules/@vtsls/language-server/node_modules/typescript/lib\",\n    },\n    {\n        package = \"typescript-language-server\",\n        path = \"/node_modules/typescript/lib/\",\n    },\n    {\n        package = \"vue-language-server\",\n        path = \"/node_modules/typescript/lib\",\n    },\n}\n\n-- get table with lib paths\nlocal paths = U.map(pathsTable, function(item)\n    return require(\"mason-registry\").get_package(item.package):get_install_path() .. item.path\nend)\n\nreturn {\n    before_init = function(_, config)\n        if config.init_options and config.init_options.typescript and config.init_options.typescript.tsdk == \"\" then\n            -- add local lib in first tposition\n            table.insert(paths, 1, get_local_typescript_server_path(config.root_dir))\n\n            -- print(vim.inspect(paths))\n\n            -- Find first valid path in priority order.\n            local firstValidPath = U.find(paths, function(path)\n                return vim.fn.isdirectory(path) ~= 0\n            end)\n\n            -- print(firstValidPath)\n\n            config.init_options.typescript.tsdk = firstValidPath\n        end\n    end,\n}\n```\n",
            "created_at": "2025-04-30T17:28:04Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3742#issuecomment-2842767675",
            "id": 2842767675,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742",
            "node_id": "IC_kwDODTQC186pcTE7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2842767675/reactions"
            },
            "updated_at": "2025-04-30T18:19:21Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2842767675",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/46299700?v=4",
                "events_url": "https://api.github.com/users/albnavarro/events{/privacy}",
                "followers_url": "https://api.github.com/users/albnavarro/followers",
                "following_url": "https://api.github.com/users/albnavarro/following{/other_user}",
                "gists_url": "https://api.github.com/users/albnavarro/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/albnavarro",
                "id": 46299700,
                "login": "albnavarro",
                "node_id": "MDQ6VXNlcjQ2Mjk5NzAw",
                "organizations_url": "https://api.github.com/users/albnavarro/orgs",
                "received_events_url": "https://api.github.com/users/albnavarro/received_events",
                "repos_url": "https://api.github.com/users/albnavarro/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/albnavarro/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/albnavarro/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/albnavarro",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742/comments",
    "created_at": "2025-04-17T17:56:28Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3742",
    "id": 3003126130,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "New feature or request",
            "id": 1674892767,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzY3",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC186zABFy",
    "number": 3742,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742/timeline",
    "title": "Volar LSP: \"Can't find typescript.js or tsserverlibrary.js\"",
    "type": null,
    "updated_at": "2025-04-30T21:33:14Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3742",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/46299700?v=4",
        "events_url": "https://api.github.com/users/albnavarro/events{/privacy}",
        "followers_url": "https://api.github.com/users/albnavarro/followers",
        "following_url": "https://api.github.com/users/albnavarro/following{/other_user}",
        "gists_url": "https://api.github.com/users/albnavarro/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/albnavarro",
        "id": 46299700,
        "login": "albnavarro",
        "node_id": "MDQ6VXNlcjQ2Mjk5NzAw",
        "organizations_url": "https://api.github.com/users/albnavarro/orgs",
        "received_events_url": "https://api.github.com/users/albnavarro/received_events",
        "repos_url": "https://api.github.com/users/albnavarro/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/albnavarro/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/albnavarro/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/albnavarro",
        "user_view_type": "public"
    }
}
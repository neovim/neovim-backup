{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\n\nOut of the box, it is impossible to attach the LSP client to most deno projects.\n\nThe `denols` configuration will not attach if there is a `package.json` file at a parent path equal to or greater than the nearest `deno.lock` file.\n\nThe `ts_ls` configuration will not attach if there is a `deno.lock` file at a parent path equal to or greater than the nearest `package-lock.json` file. (It does not respect `package.json`, though it ought to.)\n\nThis means that if you have a `package.json` and `deno.lock` file in the same directory, neither lsp client will attach.\n\nConsider the following fairly typical case case:\n\n```\nmy-project-workspace\n+-- package-lock.json\n+-- deno.lock\n+-- packages\n    +-- deno-package\n    |    +-- deno.json\n    |    +-- package.json\n    |    +-- src\n    |        +-- index.ts\n    +-- node-package\n        +-- package.json\n        +-- src\n            +-- index.ts\n```\n\nThe file at `packages/deno-package/src/index.ts` will not\nattach the `denols` client, because there is a `package.json`\nfile present closer than the nearest `deno.lock` file.\n\nThe file at `packages/node-package/src/index.ts` will not attach\nthe `ts_ls` client, because there is a `deno.lock` file present\nparallel to the nearest `package-lock.json` file.\n\nThere is no LSP attachment for any typescript files anywhere in the project!\n\n## Proposed solution\n\nIf both lsps are enabled, then at least one should apply for any given TS file, no matter what.\n\n### `denols` behavior\n\n- Look for a `deno.lock`, `deno.json`, or `deno.jsonc` file.\n- Attach as long as the deno root is *at least as close* as the\n  non-deno lockfile or project marker\n\n```lua\nlocal deno_markers = { 'deno.lock', 'deno.json', 'deno.jsonc' }\nlocal project_markers = {\n  'package-lock.json',\n  'yarn.lock',\n  'pnpm-lock.yaml',\n  'bun.lockb',\n  'bun.lock',\n  'package.json',\n  'node_modules',\n}\nlocal deno_root = vim.fs.root(bufnr, deno_markers)\nlocal project_root = vim.fs.root(bufnr, project_markers)\n\nif project_root and (not deno_root or #project_root > #deno_root) then\n    return\nend\non_dir(deno_root or vim.fn.getcwd())\n```\n\n### `ts_ls` behavior\n\nThis should be the exact inverse of the `denols` attachment\nbehavior.\n\n- Look for a `deno.lock`, `deno.json`, or `deno.jsonc` file.\n- Attach as long as the deno root is further away than any\n  non-deno project root.\n\n```lua\nlocal deno_markers = { 'deno.lock', 'deno.json', 'deno.jsonc' }\nlocal project_markers = {\n  'package-lock.json',\n  'yarn.lock',\n  'pnpm-lock.yaml',\n  'bun.lockb',\n  'bun.lock',\n  'package.json',\n  'node_modules',\n}\nlocal deno_root = vim.fs.root(bufnr, deno_markers)\nlocal project_root = vim.fs.root(bufnr, project_markers)\n\nif deno_root and (not project_root or #deno_root >= #project_root) then\n    return\nend\non_dir(project_root or vim.fn.getcwd())\n```\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "There's probably some refinement to be done on the proposed solution above, but the point is: the heuristic should be designed such that _every_ TS file is _either_ denols or non-denols, and most normal projects should default properly, even if they have both a `deno.lock` and a `package.json` file.",
            "created_at": "2026-01-30T18:49:16Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4300#issuecomment-3825157534",
            "id": 3825157534,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300",
            "node_id": "IC_kwDODTQC187j_0We",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3825157534/reactions"
            },
            "updated_at": "2026-01-30T18:49:16Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3825157534",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9287?v=4",
                "events_url": "https://api.github.com/users/isaacs/events{/privacy}",
                "followers_url": "https://api.github.com/users/isaacs/followers",
                "following_url": "https://api.github.com/users/isaacs/following{/other_user}",
                "gists_url": "https://api.github.com/users/isaacs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/isaacs",
                "id": 9287,
                "login": "isaacs",
                "node_id": "MDQ6VXNlcjkyODc=",
                "organizations_url": "https://api.github.com/users/isaacs/orgs",
                "received_events_url": "https://api.github.com/users/isaacs/received_events",
                "repos_url": "https://api.github.com/users/isaacs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/isaacs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/isaacs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/isaacs",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "If you have a PR in mind that would be very welcome. The deno/ts/etc disambiguation has been fraught with conflicting decisions.",
            "created_at": "2026-01-30T23:54:55Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4300#issuecomment-3826537170",
            "id": 3826537170,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300",
            "node_id": "IC_kwDODTQC187kFFLS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3826537170/reactions"
            },
            "updated_at": "2026-01-30T23:54:55Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3826537170",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@justinmk Ok, I think I have something that works, close to what I proposed above, but with a few edges ironed out. I've been switching between a mostly node (but some deno) multi-workspaces project, a bunch of node projects, and a few deno projects, and it's been holding up. I'll PR it today or tomorrow :)",
            "created_at": "2026-02-02T15:10:05Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4300#issuecomment-3835714888",
            "id": 3835714888,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300",
            "node_id": "IC_kwDODTQC187koF1I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3835714888/reactions"
            },
            "updated_at": "2026-02-02T15:10:05Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3835714888",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9287?v=4",
                "events_url": "https://api.github.com/users/isaacs/events{/privacy}",
                "followers_url": "https://api.github.com/users/isaacs/followers",
                "following_url": "https://api.github.com/users/isaacs/following{/other_user}",
                "gists_url": "https://api.github.com/users/isaacs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/isaacs",
                "id": 9287,
                "login": "isaacs",
                "node_id": "MDQ6VXNlcjkyODc=",
                "organizations_url": "https://api.github.com/users/isaacs/orgs",
                "received_events_url": "https://api.github.com/users/isaacs/received_events",
                "repos_url": "https://api.github.com/users/isaacs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/isaacs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/isaacs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/isaacs",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300/comments",
    "created_at": "2026-01-30T18:41:48Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4300",
    "id": 3876914809,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC187nFQZ5",
    "number": 4300,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300/timeline",
    "title": "denols and ts_ls conflict, neither activate in many typical scenarios",
    "type": null,
    "updated_at": "2026-02-02T15:10:05Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4300",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/9287?v=4",
        "events_url": "https://api.github.com/users/isaacs/events{/privacy}",
        "followers_url": "https://api.github.com/users/isaacs/followers",
        "following_url": "https://api.github.com/users/isaacs/following{/other_user}",
        "gists_url": "https://api.github.com/users/isaacs/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/isaacs",
        "id": 9287,
        "login": "isaacs",
        "node_id": "MDQ6VXNlcjkyODc=",
        "organizations_url": "https://api.github.com/users/isaacs/orgs",
        "received_events_url": "https://api.github.com/users/isaacs/received_events",
        "repos_url": "https://api.github.com/users/isaacs/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/isaacs/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/isaacs/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/isaacs",
        "user_view_type": "public"
    }
}
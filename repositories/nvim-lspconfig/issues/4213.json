{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Description\n\nNVIM v0.12.0-dev-1573+g466b2ac192 \nBuild type: RelWithDebInfo\nLuaJIT 2.1.1762386122\n\n```lua\nlspconfig.config = function(_, opts)\n  local has_blink, blink = pcall(require, 'blink.cmp')\n  local capabilities = vim.tbl_deep_extend(\n    'force',\n    {},\n    vim.lsp.protocol.make_client_capabilities(),\n    has_blink and blink.get_lsp_capabilities() or {},\n    opts.capabilities or {}\n  )\n\n  for name, server in pairs(require 'nuance.core.lsps') do\n    if not (server.enabled == nil) and (not server.enabled == false) then\n      vim.lsp.enable(name)\n    end\n\n    -- Ugly Hack\n    vim.tbl_map(function(cb_name)\n      local cb = vim.lsp.config[name][cb_name]\n      if cb then\n        vim.lsp.config(name, {\n          [cb_name] = {\n            lspconfig = cb,\n          },\n        })\n      end\n    end, { 'on_attach', 'on_init', 'on_exit' })\n\n    vim.tbl_map(function(key)\n      vim.lsp.config(name, { [key] = server[key] })\n    end, vim.tbl_keys(server))\n  end\n\n  vim.lsp.config('*', {\n    capabilities = capabilities,\n\n    on_init = {\n      global = function(client, _initialize_result)\n        local msg = 'Initialized Language Server: ' .. client.name\n        if client.config.root_dir then\n          msg = msg .. '\\n' .. 'In root directory: ' .. client.config.root_dir\n        end\n        vim.notify(msg, vim.log.levels.INFO, { title = 'LSP' })\n\n        if client and client:supports_method(vim.lsp.protocol.Methods.textDocument_codeLens) then\n          local codelens_augroup = augroup 'lsp-codelens'\n          vim.b.codelens_enabled = vim.b.codelens_enabled or false\n\n          nmap('<leader>tr', function()\n            vim.b.codelens_enabled = not vim.b.codelens_enabled\n\n            if vim.b.codelens_enabled then\n              vim.lsp.codelens.refresh()\n\n              autocmd({ 'BufEnter', 'CursorHold', 'InsertLeave' }, {\n                group = codelens_augroup,\n                callback = function()\n                  vim.lsp.codelens.refresh()\n                end,\n              })\n            else\n              pcall(vim.api.nvim_clear_autocmds, { group = codelens_augroup })\n              vim.lsp.codelens.clear()\n            end\n\n            vim.notify(\n              'LSP CodeLens ' .. (vim.b.codelens_enabled and 'Enabled' or 'Disabled'),\n              (vim.b.codelens_enabled and vim.log.levels.INFO or vim.log.levels.WARN),\n              { title = 'LSP' }\n            )\n          end, { desc = 'LSP [T]oggle [R]efresh CodeLens', noremap = false })\n\n          autocmd('LspDetach', {\n            group = codelens_augroup,\n            callback = function(ev)\n              pcall(vim.api.nvim_clear_autocmds, { group = codelens_augroup, buffer = ev.buf })\n            end,\n          })\n        end\n\n        if client and client:supports_method(vim.lsp.protocol.Methods.textDocument_inlayHint) then\n          nmap('<leader>th', function()\n            vim.notify(\n              'LSP Inlay Hints ' .. (vim.lsp.inlay_hint.is_enabled() and 'Disabled' or 'Enabled'),\n              (vim.lsp.inlay_hint.is_enabled() and vim.log.WARN or vim.log.INFO),\n              { title = 'LSP' }\n            )\n            vim.lsp.inlay_hint.enable(not vim.lsp.inlay_hint.is_enabled())\n          end, { desc = 'LSP [T]oggle Inlay [H]ints', noremap = false })\n        end\n\n        local cleanup_group = augroup('lsp-detach-cleanup', { clear = false })\n        autocmd('LspDetach', {\n          group = cleanup_group,\n          callback = function(ev)\n            pcall(vim.api.nvim_clear_autocmds, { group = cleanup_group, buffer = ev.buf })\n            vim.defer_fn(function()\n              -- Kill the LS process if no buffers are attached to the client\n              local cur_client = vim.lsp.get_client_by_id(ev.data.client_id)\n              if cur_client == nil or cur_client.name == 'copilot' then\n                return\n              end\n              if cur_client:is_stopped() then\n                return\n              end\n              local attached_buffers_count = vim.tbl_count(cur_client.attached_buffers)\n              if attached_buffers_count == 0 then\n                local msg = 'No buffers attached to client: ' .. client.name .. '\\n'\n                msg = msg .. 'Stopping Server: ' .. client.name\n                vim.notify(msg, vim.log.levels.INFO, { title = 'LSP' })\n                cur_client:stop(true)\n              end\n            end, 3000)\n          end,\n        })\n      end,\n    },\n\n    on_exit = {\n      global = function(_code, _signal, client_id)\n        local client = vim.lsp.get_client_by_id(client_id)\n        if not client then\n          vim.notify('LSP client not found for id: ' .. tostring(client_id), vim.log.levels.WARN, { title = 'LSP' })\n          return\n        end\n\n        for ns_id, ns in pairs(vim.diagnostic.get_namespaces()) do\n          if ns.name and ns.name:match(client.name) then\n            require('nuance.core.promise').async_promise(100, function()\n              vim.diagnostic.reset(ns_id)\n            end)\n          end\n        end\n\n        vim.notify('De-Initialized Language Server: ' .. client.name, vim.log.levels.INFO, { title = 'LSP' })\n      end,\n    },\n  })\nend\n```\nAs you can see above, I'm using a pretty complicated setup. Custom configs are retrieved from a file which returns a table of ---@type table<string, vim.lsp.ClientConfig> which I call vim.lsp.config on and then another call on all servers to define a uniform set of notify+autocmd setup callbacks.\n\nThe problem with this, is that if nvim-lspconfig defines any of the same callbacks, then they won't be called.\n\nI had this problem trying to get callbacks defined in the other file and the ones defined here to work as well. You may see that I'm using a table of callbacks, which is how I solved that problem. I got my setup to play nice with nvim-lspconfig defined callbacks with a bit of a hack, but well it's a hack that is not quite as robust as I would like.\n\nThe problem with nvim-lspconfig defined callbacks not being solved can also be resolved by setting all on_init, on_attach and on_exit fields to a table of callbacks.\n\nFor instance, in rust_analyzer.lua, there is:\n```lua\n  on_attach = function(_, bufnr)\n    vim.api.nvim_buf_create_user_command(bufnr, 'LspCargoReload', function()\n      reload_workspace(bufnr)\n    end, { desc = 'Reload current cargo workspace' })\n  end,\n```\n\nWhich doesn't get called if I define my own on_attach. But this will work.\n```lua\n  on_attach = {\n    lspconfig = function(_, bufnr)\n      vim.api.nvim_buf_create_user_command(bufnr, 'LspCargoReload', function()\n        reload_workspace(bufnr)\n      end, { desc = 'Reload current cargo workspace' })\n    end,\n  },\n```\n\nNow, the on_attach from the file I load, the on_attach from call with the '*' and the on_attach from nvim-lspconfig are all called. Of course, since vim.lsp.config internally uses pairs they are called out of order, but that's not really an issue. You don't define these callbacks to not be self-contained, right? If so, well then that's something to talk about upstream.\n\nMy Proposal:\nRefactor everywhere in lsp/ where we set on_init, on_attach, and on_exit to use table of functions instead just a straight up function. This will give users of nvim-lspconfig the freedom to define their own callbacks for them, with a bit more syntax+boilerplate, while getting to keep the enhancements of nvim-lspconfig.",
    "closed_at": "2025-11-23T15:25:05Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Also, I labelled this as bug since I didn't know how to change it but it's really an enhancement/feature-request and should be thought of as such.",
            "created_at": "2025-11-23T07:08:04Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4213#issuecomment-3567566491",
            "id": 3567566491,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213",
            "node_id": "IC_kwDODTQC187UpL6b",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3567566491/reactions"
            },
            "updated_at": "2025-11-23T19:00:03Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3567566491",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/113052920?v=4",
                "events_url": "https://api.github.com/users/Atan-D-RP4/events{/privacy}",
                "followers_url": "https://api.github.com/users/Atan-D-RP4/followers",
                "following_url": "https://api.github.com/users/Atan-D-RP4/following{/other_user}",
                "gists_url": "https://api.github.com/users/Atan-D-RP4/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Atan-D-RP4",
                "id": 113052920,
                "login": "Atan-D-RP4",
                "node_id": "U_kgDOBr0M-A",
                "organizations_url": "https://api.github.com/users/Atan-D-RP4/orgs",
                "received_events_url": "https://api.github.com/users/Atan-D-RP4/received_events",
                "repos_url": "https://api.github.com/users/Atan-D-RP4/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Atan-D-RP4/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Atan-D-RP4/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Atan-D-RP4",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "duplicate of https://github.com/neovim/nvim-lspconfig/issues/3827\n\nmerge semantics are discussed in https://github.com/neovim/neovim/issues/33577\n",
            "created_at": "2025-11-23T15:25:05Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4213#issuecomment-3568076800",
            "id": 3568076800,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213",
            "node_id": "IC_kwDODTQC187UrIgA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3568076800/reactions"
            },
            "updated_at": "2025-11-23T15:25:05Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3568076800",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The linked discussion is now 6 months old on the latest reply. \n\nI read through it in it's entirety but did not find that any consensus was reached on the merge semantics based on that discussion.\n\nWas a resolution reached and I was missing something? And are the semantics locked in for now?\n",
            "created_at": "2025-11-23T19:17:21Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4213#issuecomment-3568255478",
            "id": 3568255478,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213",
            "node_id": "IC_kwDODTQC187Ur0H2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3568255478/reactions"
            },
            "updated_at": "2025-11-23T19:17:21Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3568255478",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/113052920?v=4",
                "events_url": "https://api.github.com/users/Atan-D-RP4/events{/privacy}",
                "followers_url": "https://api.github.com/users/Atan-D-RP4/followers",
                "following_url": "https://api.github.com/users/Atan-D-RP4/following{/other_user}",
                "gists_url": "https://api.github.com/users/Atan-D-RP4/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Atan-D-RP4",
                "id": 113052920,
                "login": "Atan-D-RP4",
                "node_id": "U_kgDOBr0M-A",
                "organizations_url": "https://api.github.com/users/Atan-D-RP4/orgs",
                "received_events_url": "https://api.github.com/users/Atan-D-RP4/received_events",
                "repos_url": "https://api.github.com/users/Atan-D-RP4/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Atan-D-RP4/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Atan-D-RP4/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Atan-D-RP4",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The issue is open because it requires someone to actually spend time on it. Help is welcome there.\n\nI summarized the status: https://github.com/neovim/neovim/issues/33577#issuecomment-3568292351",
            "created_at": "2025-11-23T20:10:25Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4213#issuecomment-3568293565",
            "id": 3568293565,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213",
            "node_id": "IC_kwDODTQC187Ur9a9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3568293565/reactions"
            },
            "updated_at": "2025-11-23T20:11:05Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3568293565",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213/comments",
    "created_at": "2025-11-23T07:06:01Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4213",
    "id": 3655592830,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC187Z4-t-",
    "number": 4213,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "duplicate",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213/timeline",
    "title": "Custom on_init and other callbacks overrides lspconfig-defined ones",
    "type": null,
    "updated_at": "2025-11-23T20:11:05Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4213",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/113052920?v=4",
        "events_url": "https://api.github.com/users/Atan-D-RP4/events{/privacy}",
        "followers_url": "https://api.github.com/users/Atan-D-RP4/followers",
        "following_url": "https://api.github.com/users/Atan-D-RP4/following{/other_user}",
        "gists_url": "https://api.github.com/users/Atan-D-RP4/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Atan-D-RP4",
        "id": 113052920,
        "login": "Atan-D-RP4",
        "node_id": "U_kgDOBr0M-A",
        "organizations_url": "https://api.github.com/users/Atan-D-RP4/orgs",
        "received_events_url": "https://api.github.com/users/Atan-D-RP4/received_events",
        "repos_url": "https://api.github.com/users/Atan-D-RP4/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Atan-D-RP4/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Atan-D-RP4/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Atan-D-RP4",
        "user_view_type": "public"
    }
}
{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\n[Commit 8ad2d8d](https://github.com/neovim/nvim-lspconfig/commit/8ad2d8d8991d868ff8e7c21a7db624f32b882531) introduced changes that restrict mentioned language servers from attaching to files outside the workspace directory. While this behavior makes sense for some servers, it creates inconveniences for JavaScript/TypeScript development.\n\n#### Problem:\n\n* General JS/TS files: Developers often edit standalone JS/TS files not bound to any workspace or project. The current restriction prevents language servers from attaching to these files, reducing functionality (e.g., linting, autocompletion, and diagnostics).\n* ESLint/Biome: These servers do not support single files and should only attach when configuration files (e.g., .eslintrc, biome.json) are present in the directory, even if the directory is not a formal workspace.\n* Svelte: Unlike JS/TS, the Svelte language server should likely only attach to files within a Svelte project, as standalone Svelte files are rare and less practical.\n\n#### Expected Behavior:\n\n* JS/TS Language Servers: Should attach to any JS/TS file, regardless of workspace context, to support standalone file editing.\n* ESLint/Biome: Should attach to files when configuration files are present in the directory, even if it’s not a workspace.\n* Svelte Language Server: Should only attach to files within a Svelte project.\n\n#### Current Behavior:\n\n* All mentioned servers are restricted from attaching to files outside the workspace directory,\n\n#### Possible solutions\n \n<details><summary> example of current eslint config</summary>\n\n```lua\n  root_dir = function(bufnr, on_dir)\n    -- The project root is where the LSP can be started from\n    -- As stated in the documentation above, this LSP supports monorepos and simple projects.\n    -- We select then from the project root, which is identified by the presence of a package\n    -- manager lock file.\n    local project_root_markers = { 'package-lock.json', 'yarn.lock', 'pnpm-lock.yaml', 'bun.lockb', 'bun.lock' }\n    local project_root = vim.fs.root(bufnr, project_root_markers)\n    if not project_root then\n      return nil\n    end\n\n    -- We know that the buffer is using ESLint if it has a config file\n    -- in its directory tree.\n    --\n    -- Eslint used to support package.json files as config files, but it doesn't anymore.\n    -- We keep this for backward compatibility.\n    local filename = vim.api.nvim_buf_get_name(bufnr)\n    local eslint_config_files_with_package_json =\n      util.insert_package_json(eslint_config_files, 'eslintConfig', filename)\n    local is_buffer_using_eslint = vim.fs.find(eslint_config_files_with_package_json, {\n      path = filename,\n      type = 'file',\n      limit = 1,\n      upward = true,\n      stop = vim.fs.dirname(project_root),\n    })[1]\n    if not is_buffer_using_eslint then\n      return nil\n    end\n\n    on_dir(project_root)\n  end,\n```\n</details>\n\nFor eslint/biome servers, the `root_dir` function should:\n* Return if neither a root project marker nor a config file is found.\n* Call `on_dir(config_file_directory)` if only a config file is found (and no root project marker exists).\n\nFor ts_ls/tsgo/vtsls, the `root_dir` function should call `on_dir(nil)` if there is no `project_root` to allow these language servers to attach to standalone files, as suggested [here](https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3202285074) by @justinmk.\n\n<details>\n<summary>Previous description</summary>\n\n### Summary\n\nts_ls server don't attach to javascript or typescript files when there are no root marker files in directory (ex. package-lock.json)\n\n#### Steps to reproduce\n\n1. create minimal neovim config file.\n\n<details><summary>Minimal init.lua</summary>\n\n```\nvim.o.clipboard = 'unnamedplus'\nvim.o.softtabstop = 2\nvim.o.shiftwidth = 2\nvim.o.expandtab = true\n\n\n-- Bootstrap lazy.nvim\nlocal lazypath = vim.fn.stdpath(\"data\") .. \"/lazy/lazy.nvim\"\nif not (vim.uv or vim.loop).fs_stat(lazypath) then\n  local lazyrepo = \"https://github.com/folke/lazy.nvim.git\"\n  local out = vim.fn.system({ \"git\", \"clone\", \"--filter=blob:none\", \"--branch=stable\", lazyrepo, lazypath })\n  if vim.v.shell_error ~= 0 then\n    vim.api.nvim_echo({\n      { \"Failed to clone lazy.nvim:\\n\", \"ErrorMsg\" },\n      { out, \"WarningMsg\" },\n      { \"\\nPress any key to exit...\" },\n    }, true, {})\n    vim.fn.getchar()\n    os.exit(1)\n  end\nend\nvim.opt.rtp:prepend(lazypath)\n\n-- Make sure to setup `mapleader` and `maplocalleader` before\n-- loading lazy.nvim so that mappings are correct.\n-- This is also a good place to setup other settings (vim.opt)\nvim.g.mapleader = \" \"\nvim.g.maplocalleader = \" \"\n\n-- Setup lazy.nvim\nrequire(\"lazy\").setup({\n  spec = {\n    \"neovim/nvim-lspconfig\",\n    config = function()\n      vim.lsp.enable(\"ts_ls\")\n    end,\n  },\n  -- Configure any other settings here. See the documentation for more details.\n  -- colorscheme that will be used when installing plugins.\n  install = { colorscheme = { \"habamax\" } },\n  -- automatically check for plugin updates\n  checker = { enabled = true },\n})\n```\n</details>\n\n2. install localy ts_ls server `npm install -g typescript typescript-language-server`.\n3. run neovim with minimal config `nvim -u /path/to/minimal_init.lua`.\n4. start editing index.js file `:e index.js<CR>`.\n5. open lsp info `:LspInfo<CR>`. ts_ls is not an active lsp.\n6. start editing index.ts file `:e index.js<CR>`\n7. open lsp info `:LspInfo<CR>`. ts_ls is not an active lsp.\n8. run `npm init -y`.\n9. repeat steps from 4 to 7.\n10. create package-lock.json file.\n11. repeat steps from 4 to 7. now ts_ls attached to both index.js and index.ts files\n\n#### Expected behavior\nts_ls server should always be attached to any javascript or typescript files regardless where these files are located\n\n#### Current behavior\nts_ls server don't attach to javascript or typescript files when there are no root marker files in directory (ex. package-lock.json)\n\n#### LspInfo\n<details><summary> index.js LspInfo</summary>\n\n```\n- LSP log level : WARN\n- Log path: /home/user/.local/state/nvim/lsp.log\n- Log size: 0 KB\n\nvim.lsp: Active Clients ~\n- No active clients\n\nvim.lsp: Enabled Configurations ~\n- ts_ls:\n  - cmd: { \"typescript-language-server\", \"--stdio\" }\n  - commands: {\n      [\"editor.action.showReferences\"] = <function 1>\n    }\n  - filetypes: javascript, javascriptreact, javascript.jsx, typescript, typescriptreact, typescript.tsx\n  - handlers: {\n      [\"_typescript.rename\"] = <function 1>\n    }\n  - init_options: {\n      hostInfo = \"neovim\"\n    }\n  - on_attach: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:110>\n  - root_dir: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:56>\n\n\nvim.lsp: File Watcher ~\n- file watching \"(workspace/didChangeWatchedFiles)\" disabled on all clients\n\nvim.lsp: Position Encodings ~\n- No active clients\n```\n</details>\n<details><summary>index.ts LspInfo</summary>\n\n```\n- LSP log level : WARN\n- Log path: /home/user/.local/state/nvim/lsp.log\n- Log size: 0 KB\n\nvim.lsp: Active Clients ~\n- No active clients\n\nvim.lsp: Enabled Configurations ~\n- ts_ls:\n  - cmd: { \"typescript-language-server\", \"--stdio\" }\n  - commands: {\n      [\"editor.action.showReferences\"] = <function 1>\n    }\n  - filetypes: javascript, javascriptreact, javascript.jsx, typescript, typescriptreact, typescript.tsx\n  - handlers: {\n      [\"_typescript.rename\"] = <function 1>\n    }\n  - init_options: {\n      hostInfo = \"neovim\"\n    }\n  - on_attach: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:110>\n  - root_dir: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:56>\n\n\nvim.lsp: File Watcher ~\n- file watching \"(workspace/didChangeWatchedFiles)\" disabled on all clients\n\nvim.lsp: Position Encodings ~\n- No active clients\n```\n</details>\n<details><summary>index.js LspInfo with package-lock.json file in directory</summary>\n\n```\n- LSP log level : WARN\n- Log path: /home/user/.local/state/nvim/lsp.log\n- Log size: 0 KB\n\nvim.lsp: Active Clients ~\n- ts_ls (id: 1)\n  - Version: ? (no serverInfo.version response)\n  - Root directory: /tmp/nvim\n  - Command: { \"typescript-language-server\", \"--stdio\" }\n  - Settings: {}\n  - Attached buffers: 1\n\nvim.lsp: Enabled Configurations ~\n- ts_ls:\n  - cmd: { \"typescript-language-server\", \"--stdio\" }\n  - commands: {\n      [\"editor.action.showReferences\"] = <function 1>\n    }\n  - filetypes: javascript, javascriptreact, javascript.jsx, typescript, typescriptreact, typescript.tsx\n  - handlers: {\n      [\"_typescript.rename\"] = <function 1>\n    }\n  - init_options: {\n      hostInfo = \"neovim\"\n    }\n  - on_attach: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:110>\n  - root_dir: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:56>\n\n\nvim.lsp: File Watcher ~\n- file watching \"(workspace/didChangeWatchedFiles)\" disabled on all clients\n\nvim.lsp: Position Encodings ~\n- No buffers contain mixed position encodings\n```\n</details>\n<details><summary>index.ts LspInfo with package-lock.json file in directory</summary>\n\n```\n- LSP log level : WARN\n- Log path: /home/user/.local/state/nvim/lsp.log\n- Log size: 0 KB\n\nvim.lsp: Active Clients ~\n- ts_ls (id: 1)\n  - Version: ? (no serverInfo.version response)\n  - Root directory: /tmp/nvim\n  - Command: { \"typescript-language-server\", \"--stdio\" }\n  - Settings: {}\n  - Attached buffers: 1, 4\n\nvim.lsp: Enabled Configurations ~\n- ts_ls:\n  - cmd: { \"typescript-language-server\", \"--stdio\" }\n  - commands: {\n      [\"editor.action.showReferences\"] = <function 1>\n    }\n  - filetypes: javascript, javascriptreact, javascript.jsx, typescript, typescriptreact, typescript.tsx\n  - handlers: {\n      [\"_typescript.rename\"] = <function 1>\n    }\n  - init_options: {\n      hostInfo = \"neovim\"\n    }\n  - on_attach: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:110>\n  - root_dir: <function @/home/user/.local/share/nvim/lazy/nvim-lspconfig/lsp/ts_ls.lua:56>\n\n\nvim.lsp: File Watcher ~\n- file watching \"(workspace/didChangeWatchedFiles)\" disabled on all clients\n\nvim.lsp: Position Encodings ~\n- No buffers contain mixed position encodings\n```\n</details>\n\n#### Investigation\n\nBy using git bisect I found that this [Commit 8ad2d8d](https://github.com/neovim/nvim-lspconfig/commit/8ad2d8d8991d868ff8e7c21a7db624f32b882531) introduced changes that broke server ability to attach to any javascript or typescript files outside of root directory which contains root marker files (ex. package-lock.json)\n</details>",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> this [Commit 8ad2d8d](https://github.com/neovim/nvim-lspconfig/commit/8ad2d8d8991d868ff8e7c21a7db624f32b882531) introduced changes that broke server ability to attach to any javascript or typescript files outside of root directory\n\nlsp/eslint.lua and lsp/biome.lua specify `workspace_required=true`, but not the others, so yes I would expect ts_ls and others to not require a workspace.\n\nI think the way to fix this would be to call `on_dir(nil)` instead of `return nil`. I'm not sure if that was intentional @fuegoio ",
            "created_at": "2025-08-19T21:25:38Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3202285074",
            "id": 3202285074,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186-3v4S",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3202285074/reactions"
            },
            "updated_at": "2025-08-19T21:25:38Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3202285074",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "+1, I am facing the same issue with `biome`. I am using biome on a static website which doesn't use any lock files. The root directory only contains `biome.json` without any lock files or node packages.",
            "created_at": "2025-08-20T06:37:48Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3204394075",
            "id": 3204394075,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186-_yxb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3204394075/reactions"
            },
            "updated_at": "2025-08-20T06:43:00Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3204394075",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1546426?v=4",
                "events_url": "https://api.github.com/users/pratyushmittal/events{/privacy}",
                "followers_url": "https://api.github.com/users/pratyushmittal/followers",
                "following_url": "https://api.github.com/users/pratyushmittal/following{/other_user}",
                "gists_url": "https://api.github.com/users/pratyushmittal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/pratyushmittal",
                "id": 1546426,
                "login": "pratyushmittal",
                "node_id": "MDQ6VXNlcjE1NDY0MjY=",
                "organizations_url": "https://api.github.com/users/pratyushmittal/orgs",
                "received_events_url": "https://api.github.com/users/pratyushmittal/received_events",
                "repos_url": "https://api.github.com/users/pratyushmittal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/pratyushmittal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pratyushmittal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/pratyushmittal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hello, @justinmk \n> I think the way to fix this would be to call `on_dir(nil)` instead of `return nil`.\n\nCan confirm on ts_ls config that your solution is working as expected. ts_ls attaches to javascript/typescript files outside of  workspace directory.\n<details><summary> root_dir function example</summary>\n\n```lua\n...rest config\n          root_dir = function(bufnr, on_dir)\n            -- The project root is where the LSP can be started from\n            -- As stated in the documentation above, this LSP supports monorepos and simple projects.\n            -- We select then from the project root, which is identified by the presence of a package\n            -- manager lock file.\n            local project_root_markers = {\n              'package-lock.json',\n              'yarn.lock',\n              'pnpm-lock.yaml',\n              'bun.lockb',\n              'bun.lock',\n            }\n            local project_root = vim.fs.root(bufnr, project_root_markers)\n\n            local dir_root = project_root and project_root or nil\n            on_dir(dir_root)\n          end,\n...rest config\n```\n</details>",
            "created_at": "2025-08-20T09:54:08Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3205277267",
            "id": 3205277267,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_DKZT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3205277267/reactions"
            },
            "updated_at": "2025-08-20T13:19:16Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3205277267",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/78154887?v=4",
                "events_url": "https://api.github.com/users/krukroman/events{/privacy}",
                "followers_url": "https://api.github.com/users/krukroman/followers",
                "following_url": "https://api.github.com/users/krukroman/following{/other_user}",
                "gists_url": "https://api.github.com/users/krukroman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krukroman",
                "id": 78154887,
                "login": "krukroman",
                "node_id": "MDQ6VXNlcjc4MTU0ODg3",
                "organizations_url": "https://api.github.com/users/krukroman/orgs",
                "received_events_url": "https://api.github.com/users/krukroman/received_events",
                "repos_url": "https://api.github.com/users/krukroman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krukroman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krukroman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krukroman",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "pr welcome",
            "created_at": "2025-08-20T16:32:49Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3207121474",
            "id": 3207121474,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_KMpC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3207121474/reactions"
            },
            "updated_at": "2025-08-20T16:32:49Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3207121474",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> pr welcome\n\n@justinmk  pr #4022. Could you please review it when you will have spare time? Thank you.\n",
            "created_at": "2025-08-20T19:41:56Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3207834654",
            "id": 3207834654,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_M6we",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3207834654/reactions"
            },
            "updated_at": "2025-08-20T20:53:22Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3207834654",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/78154887?v=4",
                "events_url": "https://api.github.com/users/krukroman/events{/privacy}",
                "followers_url": "https://api.github.com/users/krukroman/followers",
                "following_url": "https://api.github.com/users/krukroman/following{/other_user}",
                "gists_url": "https://api.github.com/users/krukroman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krukroman",
                "id": 78154887,
                "login": "krukroman",
                "node_id": "MDQ6VXNlcjc4MTU0ODg3",
                "organizations_url": "https://api.github.com/users/krukroman/orgs",
                "received_events_url": "https://api.github.com/users/krukroman/received_events",
                "repos_url": "https://api.github.com/users/krukroman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krukroman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krukroman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krukroman",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Similar issue here.\nMy project uses Git submodules to include sub-projects. However, the vtsls server will treats each sub-project's subdirectory as its root directory.\nThe change introduced in [commit 8ad2d8d](https://github.com/neovim/nvim-lspconfig/commit/8ad2d8d8991d868ff8e7c21a7db624f32b882531) seems beneficial for users working with monorepos, but unfortunately, it breaks functionality in my setup.\nFor now I have to delete lock-files in submodules, and check manually for each commit when I make changes on submodules... \nAnd this change is not marked as breaking change, some project like mine will just not work after update with no warnings.",
            "created_at": "2025-08-21T01:41:13Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3208645185",
            "id": 3208645185,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_QApB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3208645185/reactions"
            },
            "updated_at": "2025-08-21T01:41:13Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3208645185",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/29415530?v=4",
                "events_url": "https://api.github.com/users/hanool/events{/privacy}",
                "followers_url": "https://api.github.com/users/hanool/followers",
                "following_url": "https://api.github.com/users/hanool/following{/other_user}",
                "gists_url": "https://api.github.com/users/hanool/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hanool",
                "id": 29415530,
                "login": "hanool",
                "node_id": "MDQ6VXNlcjI5NDE1NTMw",
                "organizations_url": "https://api.github.com/users/hanool/orgs",
                "received_events_url": "https://api.github.com/users/hanool/received_events",
                "repos_url": "https://api.github.com/users/hanool/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hanool/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hanool/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hanool",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hello @hanool !\n\nCould you please in your package manager switch `nvim-lspconfig` to commit `782dda9` and check again if vtsls treats your submodules subdirectories as root dirs?",
            "created_at": "2025-08-21T03:21:29Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3208860954",
            "id": 3208860954,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_Q1Ua",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3208860954/reactions"
            },
            "updated_at": "2025-08-21T03:21:29Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3208860954",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/78154887?v=4",
                "events_url": "https://api.github.com/users/krukroman/events{/privacy}",
                "followers_url": "https://api.github.com/users/krukroman/followers",
                "following_url": "https://api.github.com/users/krukroman/following{/other_user}",
                "gists_url": "https://api.github.com/users/krukroman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krukroman",
                "id": 78154887,
                "login": "krukroman",
                "node_id": "MDQ6VXNlcjc4MTU0ODg3",
                "organizations_url": "https://api.github.com/users/krukroman/orgs",
                "received_events_url": "https://api.github.com/users/krukroman/received_events",
                "repos_url": "https://api.github.com/users/krukroman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krukroman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krukroman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krukroman",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@justinmk After attempting to fix this issue, I realized that adding workarounds to this implementations of configs, introduced in PR #3955, will only increase complexity and maintainability. Also I tested some behavior of configs on commit `782dda9` before changes, and found that PR only partially achieved its goal. Solutions, that was merged do not prevent LSPs from spawning multiple instances of clients if projects don't follow monorepo structure.\n\n<details><summary>Example project structure every dir is root dir</summary>\n\n```\n- project_dir\n   - frontend_dir\n       - ...files and dirs\n       - package-lock.json\n       - eslint.config.js\n    - backend_dir\n        - ...files and dirs\n        - package-lock.json\n        - eslint.config.js\n    - ...files\n    - package-lock.json\n    - eslint.config.js\n```\n</details>\nConsider the folder structure listed above. If the current working directory is project_dir, the LSP will spawn separate clients for each lockfile and ESLint config, because every directory is treated as a project root due to the presence of root marker files (e.g., opening all three eslint.config.js files results in three ts_ls and three ESLint clients running).\n\nTo address this issue properly, we need to agree on:\n* The standard criteria for identifying the root folder in TS/JS projects, accounting for all possible edge cases;\n* How to search for and apply these criteria;\n* How to handle edge cases without introducing excessive complexity;\n\nAlternatively, we could opt for the simplest implementation, as it was before PR #3955, and let users to customize the behavior via vim.lsp.config(server_name, config).\n\nWhat do you think about this?",
            "created_at": "2025-08-21T08:13:22Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3209492315",
            "id": 3209492315,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_TPdb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3209492315/reactions"
            },
            "updated_at": "2025-08-21T14:22:10Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3209492315",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/78154887?v=4",
                "events_url": "https://api.github.com/users/krukroman/events{/privacy}",
                "followers_url": "https://api.github.com/users/krukroman/followers",
                "following_url": "https://api.github.com/users/krukroman/following{/other_user}",
                "gists_url": "https://api.github.com/users/krukroman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krukroman",
                "id": 78154887,
                "login": "krukroman",
                "node_id": "MDQ6VXNlcjc4MTU0ODg3",
                "organizations_url": "https://api.github.com/users/krukroman/orgs",
                "received_events_url": "https://api.github.com/users/krukroman/received_events",
                "repos_url": "https://api.github.com/users/krukroman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krukroman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krukroman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krukroman",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@krukroman Checked with commit `782dda9` (the commit before th PR #3955), and vtsls treats the parent dir as root dir.\n\nMy current environment.\n- local dir of repo = ~/dev/foo\n- submodule in the repo = ~/dev/foo/bar\n\n**main branch,** with `yarn.lock` file existing in submodule, LspInfo shows,\n```\n- vtsls (id: 3)\n  - Version: 0.2.9\n  - Root directory: ~/dev/foo/bar\n```\n \nmain branch, with **no** `yarn.lock`(or any lock files) in submodule\n```\n- vtsls (id: 2)\n  - Version: 0.2.9\n  - Root directory: ~/dev/foo\n```\n\ncommit **782dda9**, with yarn.lock file existing in submodule\n```\n- vtsls (id: 2)\n  - Version: 0.2.9\n  - Root directory: ~/dev/foo\n```",
            "created_at": "2025-08-21T23:57:13Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3212496127",
            "id": 3212496127,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_esz_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3212496127/reactions"
            },
            "updated_at": "2025-08-21T23:57:13Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3212496127",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/29415530?v=4",
                "events_url": "https://api.github.com/users/hanool/events{/privacy}",
                "followers_url": "https://api.github.com/users/hanool/followers",
                "following_url": "https://api.github.com/users/hanool/following{/other_user}",
                "gists_url": "https://api.github.com/users/hanool/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hanool",
                "id": 29415530,
                "login": "hanool",
                "node_id": "MDQ6VXNlcjI5NDE1NTMw",
                "organizations_url": "https://api.github.com/users/hanool/orgs",
                "received_events_url": "https://api.github.com/users/hanool/received_events",
                "repos_url": "https://api.github.com/users/hanool/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hanool/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hanool/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hanool",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> To address this issue properly, we need to agree on:\n> \n> * The standard criteria for identifying the root folder in TS/JS projects, accounting for all possible edge cases;\n\nThere is no such thing, apparently. How does vscode do it?\n\n> Alternatively, we could opt for the simplest implementation, as it was before PR [#3955](https://github.com/neovim/nvim-lspconfig/pull/3955), and let users to customize the behavior via vim.lsp.config(server_name, config).\n\nWell, AFAIR it was not obvious how users could support monorepos before that case.\n\nOr maybe the story changed since Nvim 0.11.3 gained the ability to control \"equal priority\" root markers (https://github.com/neovim/neovim/pull/34276). \n\nMy suggestion in general is that the configs handle the common case while making it easy to opt-in to a custom case. The rubric is like this:\n\n- if monorepos are complex to handle, configs should favor that while letting users easily override (which is already possible via `vim.lsp.config('foo', { root_markers=...})`, it's designed to \"merge\" with the default config...)\n- if monorepos are easy for users to handle, but the \"common cases\" are hard to handle, then the configs should favor the non-monorepo case",
            "created_at": "2025-08-22T02:09:42Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3212786520",
            "id": 3212786520,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_fztY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3212786520/reactions"
            },
            "updated_at": "2025-08-22T02:09:42Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3212786520",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "> There is no such thing, apparently. How does vscode do it?\n\nI am not sure, because I am not familiar enough with vscode code base to find an implemtation, but I think, vscode does background lookups upward from either cwd or file path to find its own root markers (eg. `.git` folder many level above file path).\n\n<details><summary>Example for ts_ls root_dir func</summary>\n\n```lua\n   --- Finds the project root directory based on root markers, supporting both monorepos and simple projects.\n--- @param bufnr integer\n--- @param root_marker string[]\n--- @return string?\nlocal get_root_dir = function(bufnr, root_marker)\n  -- The project root is where the LSP can be started from\n  -- As stated in the documentation above, this LSP supports monorepos and simple projects.\n  -- We select then from the project root, which is identified by the presence of root marker.\n\n  local equal_priority_root_marker = vim.fn.has 'nvim-0.11.3' == 1\n      and { root_marker }\n    or root_marker\n\n  -- We select cwd as starting point to search.\n  local cwd = vim.fn.getcwd()\n\n  -- First, we try to find root directory relative to cwd.\n  local cwd_root = vim.fs.root(cwd, equal_priority_root_marker)\n\n  if cwd_root then\n    return cwd_root\n  end\n\n  -- If not found from cwd, we check for root markers from file path location upward.\n  local fname = vim.api.nvim_buf_get_name(bufnr)\n  -- Before search, we check if file is nested within cwd to ensure that we working with nested directories.\n  local is_fname_nested_in_cwd = cwd == fname:sub(1, #cwd)\n\n  if is_fname_nested_in_cwd then\n    local nested_root_dir = vim.fs.find(root_marker, {\n      upward = true,\n      path = fname,\n      -- We know that there are no root markers in cwd and above\n      stop = cwd,\n    })[1]\n\n    -- We return `cwd` as project root to prevent LSP from spawning multiple clients for nested projects.\n    if nested_root_dir then\n      return cwd\n    end\n  else\n    -- if file is not nested in cwd, we lookup for root markers relative to fname\n    local file_relative_root_dir =\n      vim.fs.root(fname, equal_priority_root_marker)\n\n    if file_relative_root_dir then\n      return file_relative_root_dir\n    end\n  end\n  return nil\nend\n\n---@type vim.lsp.Config\nreturn {\n...rest config\n  root_dir = function(bufnr, on_dir)\n    local root_markers =\n      { 'tsconfig.json', 'jsconfig.json', 'package.json', '.git' }\n\n    local project_root = get_root_dir(bufnr, root_markers)\n\n    -- If `project_root` is nil, we still want to call `on_dir()` because this server supports `standalone`.\n    on_dir(project_root)\n  end,\n...rest config\n}\n```\n</details>\n\n@justinmk , could you please look on snippet above?\n\nIn this snippet, I revert root markers from lock files, because common denominator for projects that use `node` or `bun` is, indeed, `package.json`, and I don't think we should use lock files as markers.\n \nThis implementation searches for the project root by moving upwards from the current working directory (cwd). If no folder contains a root marker, the file path becomes the new starting point.\nBefore the next search, we check if the file is within a nested directory of the cwd. If it is, we search upwards from the file path to the cwd. If a folder with a root marker is found, we set the project root to the cwd to avoid the Language Server Protocol (LSP) from creating multiple clients for nested directories.\nIf the file is not nested, it means it’s located elsewhere in the file system. In this case, we search upwards from the file path. If a folder with a root marker is found, we set that folder as the project root.\n\nWhat do you think about such implementation? Can you suggest improvements?\n\n",
            "created_at": "2025-08-22T12:51:05Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3214277300",
            "id": 3214277300,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_lfq0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3214277300/reactions"
            },
            "updated_at": "2025-08-22T18:18:23Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3214277300",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/78154887?v=4",
                "events_url": "https://api.github.com/users/krukroman/events{/privacy}",
                "followers_url": "https://api.github.com/users/krukroman/followers",
                "following_url": "https://api.github.com/users/krukroman/following{/other_user}",
                "gists_url": "https://api.github.com/users/krukroman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/krukroman",
                "id": 78154887,
                "login": "krukroman",
                "node_id": "MDQ6VXNlcjc4MTU0ODg3",
                "organizations_url": "https://api.github.com/users/krukroman/orgs",
                "received_events_url": "https://api.github.com/users/krukroman/received_events",
                "repos_url": "https://api.github.com/users/krukroman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/krukroman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/krukroman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/krukroman",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I gave the requirements in my previous comment. Whatever meets those requirements is fine.",
            "created_at": "2025-08-22T21:59:00Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015#issuecomment-3215790066",
            "id": 3215790066,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
            "node_id": "IC_kwDODTQC186_rQ_y",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3215790066/reactions"
            },
            "updated_at": "2025-08-22T21:59:00Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/3215790066",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 12,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015/comments",
    "created_at": "2025-08-19T20:50:32Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/4015",
    "id": 3335650661,
    "issue_dependencies_summary": {
        "blocked_by": 0,
        "blocking": 0,
        "total_blocked_by": 0,
        "total_blocking": 0
    },
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC187G0f1l",
    "number": 4015,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 2,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015/timeline",
    "title": "js/ts language servers (eslint/biome/svelte/ts_ls/vtsls/tsgo) attach to files that are only in workspace directory (ex. directory contains lock file)",
    "type": null,
    "updated_at": "2025-08-22T21:59:00Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/4015",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/78154887?v=4",
        "events_url": "https://api.github.com/users/krukroman/events{/privacy}",
        "followers_url": "https://api.github.com/users/krukroman/followers",
        "following_url": "https://api.github.com/users/krukroman/following{/other_user}",
        "gists_url": "https://api.github.com/users/krukroman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/krukroman",
        "id": 78154887,
        "login": "krukroman",
        "node_id": "MDQ6VXNlcjc4MTU0ODg3",
        "organizations_url": "https://api.github.com/users/krukroman/orgs",
        "received_events_url": "https://api.github.com/users/krukroman/received_events",
        "repos_url": "https://api.github.com/users/krukroman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/krukroman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/krukroman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/krukroman",
        "user_view_type": "public"
    }
}